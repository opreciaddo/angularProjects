(self.webpackChunkappsBundle=self.webpackChunkappsBundle||[]).push([[179],{991:(er,Ht,Ee)=>{"use strict";Ee.r(Ht),Ee.d(Ht,{MainPageModule:()=>$t});var W=Ee(6895),me=Ee(6771),$e=Ee(8256);const c=JSON.parse('{"apps":[{"id":1,"name":"Gifs App","desc":"Search pictures in Giphy","img":"assets/pictures/gifsApp.png","url":"/gifs"},{"id":2,"name":"Countries App","desc":"Search in different ways a country","img":"assets/pictures/countriesApp.png","url":"/countries"},{"id":3,"name":"Reactive Forms","desc":"Some forms that can be used in Angular","img":"assets/pictures/formsApp.png","url":"/forms"},{"id":4,"name":"Mapbox App","desc":"Map using Mapbox App","img":"assets/pictures/mapboxApp.png","url":"/mapbox"}]}');var Pe=Ee.t(c,2);let Jt=(()=>{class Kt{constructor(){this.db=Pe}}return Kt.\u0275fac=function(Bt){return new(Bt||Kt)},Kt.\u0275prov=$e.Yz7({token:Kt,factory:Kt.\u0275fac,providedIn:"root"}),Kt})(),Vt=(()=>{class Kt{ngOnInit(){this.backGroundImg=`background-image: linear-gradient(to bottom, rgba(64, 64, 64, 0.7), rgba(64, 64, 64, 0.7)), \n                        url('${this.img}')`}}return Kt.\u0275fac=function(Bt){return new(Bt||Kt)},Kt.\u0275cmp=$e.Xpm({type:Kt,selectors:[["app-card"]],inputs:{name:"name",desc:"desc",img:"img",url:"url"},decls:7,vars:5,consts:[[3,"routerLink"],[1,"card","card-has-bg"],[1,"card-footer"],["id","project-name",1,"card-text"],["id","project-desc",1,"card-text"]],template:function(Bt,cn){1&Bt&&($e.TgZ(0,"a",0)(1,"div",1)(2,"div",2)(3,"h4",3),$e._uU(4),$e.qZA(),$e.TgZ(5,"p",4),$e._uU(6),$e.qZA()()()()),2&Bt&&($e.Q6J("routerLink",cn.url),$e.xp6(1),$e.Akn(cn.backGroundImg),$e.xp6(3),$e.Oqu(cn.name),$e.xp6(2),$e.Oqu(cn.desc))},dependencies:[me.rH],styles:["[_nghost-%COMP%]{flex:0 0 35%}[_nghost-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}[_nghost-%COMP%]   .card[_ngcontent-%COMP%]{width:244px;height:151px;padding:16px;border-radius:4px;border:none;box-shadow:#00000080 1.95px 1.95px 2.6px;transition:all .5s cubic-bezier(.19,1,.22,1);overflow:hidden;display:flex;flex-direction:column;align-items:start;justify-content:end}[_nghost-%COMP%]   .card.card-has-bg[_ngcontent-%COMP%]{transition:all .5s cubic-bezier(.19,1,.22,1);background-size:120%;background-repeat:no-repeat;background-position:center center}[_nghost-%COMP%]   .card.card-has-bg[_ngcontent-%COMP%]:hover{transform:scale(.98);box-shadow:#00000040 0 14px 28px,#00000038 0 10px 10px;background-size:140%;transition:all .8s cubic-bezier(.19,1,.22,1)}[_nghost-%COMP%]   .card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]{padding:0;line-height:14px}[_nghost-%COMP%]   .card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   #project-name[_ngcontent-%COMP%]{margin:0;color:var(--color-2nd)}[_nghost-%COMP%]   .card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   #project-desc[_ngcontent-%COMP%]{font-size:10px;margin:8px 0 0;font-weight:700;color:#ffffffb3}[_nghost-%COMP%]   .card[_ngcontent-%COMP%]:hover{cursor:pointer;transition:all .8s cubic-bezier(.19,1,.22,1)}[_nghost-%COMP%]   .card[_ngcontent-%COMP%]:hover   .card-footer[_ngcontent-%COMP%]{transition:all .8s cubic-bezier(.19,1,.22,1)}[_nghost-%COMP%]   .card[_ngcontent-%COMP%]:hover   .card-footer[_ngcontent-%COMP%]   #project-desc[_ngcontent-%COMP%]{display:none}@media (min-width: 768px){[_nghost-%COMP%]   .card[_ngcontent-%COMP%]{width:307px;height:190px;border-radius:8px}[_nghost-%COMP%]   .card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   #project-desc[_ngcontent-%COMP%]{font-size:13px}}"]}),Kt})();function zt(Kt,ut){if(1&Kt&&$e._UZ(0,"app-card",3),2&Kt){const Bt=ut.$implicit;$e.Q6J("name",Bt.name)("desc",Bt.desc)("img",Bt.img)("url",Bt.url)}}const yt=[{path:"",children:[{path:"",component:(()=>{class Kt{constructor(Bt){this.dbService=Bt,this.cards=this.dbService.db.apps}}return Kt.\u0275fac=function(Bt){return new(Bt||Kt)($e.Y36(Jt))},Kt.\u0275cmp=$e.Xpm({type:Kt,selectors:[["app-main-page"]],decls:3,vars:1,consts:[[1,"container"],[1,"cards-container"],[3,"name","desc","img","url",4,"ngFor","ngForOf"],[3,"name","desc","img","url"]],template:function(Bt,cn){1&Bt&&($e.TgZ(0,"div",0)(1,"div",1),$e.YNc(2,zt,1,4,"app-card",2),$e.qZA()()),2&Bt&&($e.xp6(2),$e.Q6J("ngForOf",cn.cards))},dependencies:[W.sg,Vt],styles:["[_nghost-%COMP%]{width:100%;min-height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;background:var(--color-1st)}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{padding:40px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .cards-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:center;align-items:center;gap:40px}"]}),Kt})()},{path:"**",redirectTo:""}]}];let ct=(()=>{class Kt{}return Kt.\u0275fac=function(Bt){return new(Bt||Kt)},Kt.\u0275mod=$e.oAB({type:Kt}),Kt.\u0275inj=$e.cJS({imports:[me.Bz.forChild(yt)]}),Kt})(),$t=(()=>{class Kt{}return Kt.\u0275fac=function(Bt){return new(Bt||Kt)},Kt.\u0275mod=$e.oAB({type:Kt}),Kt.\u0275inj=$e.cJS({imports:[W.ez,ct,me.Bz]}),Kt})()},33:(er,Ht,Ee)=>{"use strict";var W=Ee(1481),me=Ee(8256);class $e{}class c{}const Pe="*";function pt(Z,M=null){return{type:2,steps:Z,options:M}}function yt(Z){return{type:6,styles:Z,offset:null}}function tr(Z){Promise.resolve().then(Z)}class en{constructor(M=0,P=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=M+P}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(M=>M()),this._onDoneFns=[])}onStart(M){this._originalOnStartFns.push(M),this._onStartFns.push(M)}onDone(M){this._originalOnDoneFns.push(M),this._onDoneFns.push(M)}onDestroy(M){this._onDestroyFns.push(M)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){tr(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(M=>M()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(M=>M()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(M){this._position=this.totalTime?M*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(M){const P="start"==M?this._onStartFns:this._onDoneFns;P.forEach(U=>U()),P.length=0}}class rn{constructor(M){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=M;let P=0,U=0,ee=0;const he=this.players.length;0==he?tr(()=>this._onFinish()):this.players.forEach(be=>{be.onDone(()=>{++P==he&&this._onFinish()}),be.onDestroy(()=>{++U==he&&this._onDestroy()}),be.onStart(()=>{++ee==he&&this._onStart()})}),this.totalTime=this.players.reduce((be,Ie)=>Math.max(be,Ie.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(M=>M()),this._onDoneFns=[])}init(){this.players.forEach(M=>M.init())}onStart(M){this._onStartFns.push(M)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(M=>M()),this._onStartFns=[])}onDone(M){this._onDoneFns.push(M)}onDestroy(M){this._onDestroyFns.push(M)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(M=>M.play())}pause(){this.players.forEach(M=>M.pause())}restart(){this.players.forEach(M=>M.restart())}finish(){this._onFinish(),this.players.forEach(M=>M.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(M=>M.destroy()),this._onDestroyFns.forEach(M=>M()),this._onDestroyFns=[])}reset(){this.players.forEach(M=>M.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(M){const P=M*this.totalTime;this.players.forEach(U=>{const ee=U.totalTime?Math.min(1,P/U.totalTime):1;U.setPosition(ee)})}getPosition(){const M=this.players.reduce((P,U)=>null===P||U.totalTime>P.totalTime?U:P,null);return null!=M?M.getPosition():0}beforeDestroy(){this.players.forEach(M=>{M.beforeDestroy&&M.beforeDestroy()})}triggerCallback(M){const P="start"==M?this._onStartFns:this._onDoneFns;P.forEach(U=>U()),P.length=0}}const ht="!";function ur(Z){return new me.vHH(3e3,!1)}function No(){return typeof window<"u"&&typeof window.document<"u"}function Er(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function vt(Z){switch(Z.length){case 0:return new en;case 1:return Z[0];default:return new rn(Z)}}function nn(Z,M,P,U,ee=new Map,he=new Map){const be=[],Ie=[];let tt=-1,R=null;if(U.forEach(V=>{const z=V.get("offset"),te=z==tt,_e=te&&R||new Map;V.forEach((Fe,Ge)=>{let jt=Ge,bn=Fe;if("offset"!==Ge)switch(jt=M.normalizePropertyName(jt,be),bn){case ht:bn=ee.get(Ge);break;case Pe:bn=he.get(Ge);break;default:bn=M.normalizeStyleValue(Ge,jt,bn,be)}_e.set(jt,bn)}),te||Ie.push(_e),R=_e,tt=z}),be.length)throw function Kr(Z){return new me.vHH(3502,!1)}();return Ie}function br(Z,M,P,U){switch(M){case"start":Z.onStart(()=>U(P&&_r(P,"start",Z)));break;case"done":Z.onDone(()=>U(P&&_r(P,"done",Z)));break;case"destroy":Z.onDestroy(()=>U(P&&_r(P,"destroy",Z)))}}function _r(Z,M,P){const he=Fr(Z.element,Z.triggerName,Z.fromState,Z.toState,M||Z.phaseName,P.totalTime??Z.totalTime,!!P.disabled),be=Z._data;return null!=be&&(he._data=be),he}function Fr(Z,M,P,U,ee="",he=0,be){return{element:Z,triggerName:M,fromState:P,toState:U,phaseName:ee,totalTime:he,disabled:!!be}}function Zr(Z,M,P){let U=Z.get(M);return U||Z.set(M,U=P),U}function hr(Z){const M=Z.indexOf(":");return[Z.substring(1,M),Z.slice(M+1)]}let Yo=(Z,M)=>!1,Ar=(Z,M,P)=>[],Jo=null;function or(Z){const M=Z.parentNode||Z.host;return M===Jo?null:M}(Er()||typeof Element<"u")&&(No()?(Jo=(()=>document.documentElement)(),Yo=(Z,M)=>{for(;M;){if(M===Z)return!0;M=or(M)}return!1}):Yo=(Z,M)=>Z.contains(M),Ar=(Z,M,P)=>{if(P)return Array.from(Z.querySelectorAll(M));const U=Z.querySelector(M);return U?[U]:[]});let eo=null,Di=!1;const Mt=Yo,Ct=Ar;let H=(()=>{class Z{validateStyleProperty(P){return function Xe(Z){eo||(eo=function Oe(){return typeof document<"u"?document.body:null}()||{},Di=!!eo.style&&"WebkitAppearance"in eo.style);let M=!0;return eo.style&&!function qi(Z){return"ebkit"==Z.substring(1,6)}(Z)&&(M=Z in eo.style,!M&&Di&&(M="Webkit"+Z.charAt(0).toUpperCase()+Z.slice(1)in eo.style)),M}(P)}matchesElement(P,U){return!1}containsElement(P,U){return Mt(P,U)}getParentElement(P){return or(P)}query(P,U,ee){return Ct(P,U,ee)}computeStyle(P,U,ee){return ee||""}animate(P,U,ee,he,be,Ie=[],tt){return new en(ee,he)}}return Z.\u0275fac=function(P){return new(P||Z)},Z.\u0275prov=me.Yz7({token:Z,factory:Z.\u0275fac}),Z})(),Y=(()=>{class Z{}return Z.NOOP=new H,Z})();const le=1e3,ue="ng-enter",ne="ng-leave",q="ng-trigger",ae=".ng-trigger",De="ng-animating",We=".ng-animating";function Ue(Z){if("number"==typeof Z)return Z;const M=Z.match(/^(-?[\.\d]+)(m?s)/);return!M||M.length<2?0:bt(parseFloat(M[1]),M[2])}function bt(Z,M){return"s"===M?Z*le:Z}function Wt(Z,M,P){return Z.hasOwnProperty("duration")?Z:function on(Z,M,P){let ee,he=0,be="";if("string"==typeof Z){const Ie=Z.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===Ie)return M.push(ur()),{duration:0,delay:0,easing:""};ee=bt(parseFloat(Ie[1]),Ie[2]);const tt=Ie[3];null!=tt&&(he=bt(parseFloat(tt),Ie[4]));const R=Ie[5];R&&(be=R)}else ee=Z;if(!P){let Ie=!1,tt=M.length;ee<0&&(M.push(function Dt(){return new me.vHH(3100,!1)}()),Ie=!0),he<0&&(M.push(function Yt(){return new me.vHH(3101,!1)}()),Ie=!0),Ie&&M.splice(tt,0,ur())}return{duration:ee,delay:he,easing:be}}(Z,M,P)}function vn(Z,M={}){return Object.keys(Z).forEach(P=>{M[P]=Z[P]}),M}function Xn(Z){const M=new Map;return Object.keys(Z).forEach(P=>{M.set(P,Z[P])}),M}function sr(Z,M=new Map,P){if(P)for(let[U,ee]of P)M.set(U,ee);for(let[U,ee]of Z)M.set(U,ee);return M}function Tr(Z,M,P){return P?M+":"+P+";":""}function po(Z){let M="";for(let P=0;P<Z.style.length;P++){const U=Z.style.item(P);M+=Tr(0,U,Z.style.getPropertyValue(U))}for(const P in Z.style)Z.style.hasOwnProperty(P)&&!P.startsWith("_")&&(M+=Tr(0,mi(P),Z.style[P]));Z.setAttribute("style",M)}function ji(Z,M,P){Z.style&&(M.forEach((U,ee)=>{const he=ui(ee);P&&!P.has(ee)&&P.set(ee,Z.style[he]),Z.style[he]=U}),Er()&&po(Z))}function jr(Z,M){Z.style&&(M.forEach((P,U)=>{const ee=ui(U);Z.style[ee]=""}),Er()&&po(Z))}function it(Z){return Array.isArray(Z)?1==Z.length?Z[0]:pt(Z):Z}const Jr=new RegExp("{{\\s*(.+?)\\s*}}","g");function Bo(Z){let M=[];if("string"==typeof Z){let P;for(;P=Jr.exec(Z);)M.push(P[1]);Jr.lastIndex=0}return M}function ra(Z,M,P){const U=Z.toString(),ee=U.replace(Jr,(he,be)=>{let Ie=M[be];return null==Ie&&(P.push(function gt(Z){return new me.vHH(3003,!1)}()),Ie=""),Ie.toString()});return ee==U?Z:ee}function jn(Z){const M=[];let P=Z.next();for(;!P.done;)M.push(P.value),P=Z.next();return M}const Qr=/-+([a-z0-9])/g;function ui(Z){return Z.replace(Qr,(...M)=>M[1].toUpperCase())}function mi(Z){return Z.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Dn(Z,M,P){switch(M.type){case 7:return Z.visitTrigger(M,P);case 0:return Z.visitState(M,P);case 1:return Z.visitTransition(M,P);case 2:return Z.visitSequence(M,P);case 3:return Z.visitGroup(M,P);case 4:return Z.visitAnimate(M,P);case 5:return Z.visitKeyframes(M,P);case 6:return Z.visitStyle(M,P);case 8:return Z.visitReference(M,P);case 9:return Z.visitAnimateChild(M,P);case 10:return Z.visitAnimateRef(M,P);case 11:return Z.visitQuery(M,P);case 12:return Z.visitStagger(M,P);default:throw function dn(Z){return new me.vHH(3004,!1)}()}}function Wi(Z,M){return window.getComputedStyle(Z)[M]}const Pi="*";function Vr(Z,M){const P=[];return"string"==typeof Z?Z.split(/\s*,\s*/).forEach(U=>function xs(Z,M,P){if(":"==Z[0]){const tt=function bo(Z,M){switch(Z){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(P,U)=>parseFloat(U)>parseFloat(P);case":decrement":return(P,U)=>parseFloat(U)<parseFloat(P);default:return M.push(function Yn(Z){return new me.vHH(3016,!1)}()),"* => *"}}(Z,P);if("function"==typeof tt)return void M.push(tt);Z=tt}const U=Z.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==U||U.length<4)return P.push(function Rn(Z){return new me.vHH(3015,!1)}()),M;const ee=U[1],he=U[2],be=U[3];M.push(Ri(ee,be));"<"==he[0]&&!(ee==Pi&&be==Pi)&&M.push(Ri(be,ee))}(U,P,M)):P.push(Z),P}const An=new Set(["true","1"]),Uo=new Set(["false","0"]);function Ri(Z,M){const P=An.has(Z)||Uo.has(Z),U=An.has(M)||Uo.has(M);return(ee,he)=>{let be=Z==Pi||Z==ee,Ie=M==Pi||M==he;return!be&&P&&"boolean"==typeof ee&&(be=ee?An.has(Z):Uo.has(Z)),!Ie&&U&&"boolean"==typeof he&&(Ie=he?An.has(M):Uo.has(M)),be&&Ie}}const hi=new RegExp("s*:selfs*,?","g");function di(Z,M,P,U){return new kr(Z).build(M,P,U)}class kr{constructor(M){this._driver=M}build(M,P,U){const ee=new Li(P);return this._resetContextStyleTimingState(ee),Dn(this,it(M),ee)}_resetContextStyleTimingState(M){M.currentQuerySelector="",M.collectedStyles=new Map,M.collectedStyles.set("",new Map),M.currentTime=0}visitTrigger(M,P){let U=P.queryCount=0,ee=P.depCount=0;const he=[],be=[];return"@"==M.name.charAt(0)&&P.errors.push(function hn(){return new me.vHH(3006,!1)}()),M.definitions.forEach(Ie=>{if(this._resetContextStyleTimingState(P),0==Ie.type){const tt=Ie,R=tt.name;R.toString().split(/\s*,\s*/).forEach(V=>{tt.name=V,he.push(this.visitState(tt,P))}),tt.name=R}else if(1==Ie.type){const tt=this.visitTransition(Ie,P);U+=tt.queryCount,ee+=tt.depCount,be.push(tt)}else P.errors.push(function Br(){return new me.vHH(3007,!1)}())}),{type:7,name:M.name,states:he,transitions:be,queryCount:U,depCount:ee,options:null}}visitState(M,P){const U=this.visitStyle(M.styles,P),ee=M.options&&M.options.params||null;if(U.containsDynamicStyles){const he=new Set,be=ee||{};U.styles.forEach(Ie=>{Ie instanceof Map&&Ie.forEach(tt=>{Bo(tt).forEach(R=>{be.hasOwnProperty(R)||he.add(R)})})}),he.size&&(jn(he.values()),P.errors.push(function Ne(Z,M){return new me.vHH(3008,!1)}()))}return{type:0,name:M.name,style:U,options:ee?{params:ee}:null}}visitTransition(M,P){P.queryCount=0,P.depCount=0;const U=Dn(this,it(M.animation),P);return{type:1,matchers:Vr(M.expr,P.errors),animation:U,queryCount:P.queryCount,depCount:P.depCount,options:wo(M.options)}}visitSequence(M,P){return{type:2,steps:M.steps.map(U=>Dn(this,U,P)),options:wo(M.options)}}visitGroup(M,P){const U=P.currentTime;let ee=0;const he=M.steps.map(be=>{P.currentTime=U;const Ie=Dn(this,be,P);return ee=Math.max(ee,P.currentTime),Ie});return P.currentTime=ee,{type:3,steps:he,options:wo(M.options)}}visitAnimate(M,P){const U=function Ll(Z,M){if(Z.hasOwnProperty("duration"))return Z;if("number"==typeof Z)return ri(Wt(Z,M).duration,0,"");const P=Z;if(P.split(/\s+/).some(he=>"{"==he.charAt(0)&&"{"==he.charAt(1))){const he=ri(0,0,"");return he.dynamic=!0,he.strValue=P,he}const ee=Wt(P,M);return ri(ee.duration,ee.delay,ee.easing)}(M.timings,P.errors);P.currentAnimateTimings=U;let ee,he=M.styles?M.styles:yt({});if(5==he.type)ee=this.visitKeyframes(he,P);else{let be=M.styles,Ie=!1;if(!be){Ie=!0;const R={};U.easing&&(R.easing=U.easing),be=yt(R)}P.currentTime+=U.duration+U.delay;const tt=this.visitStyle(be,P);tt.isEmptyStep=Ie,ee=tt}return P.currentAnimateTimings=null,{type:4,timings:U,style:ee,options:null}}visitStyle(M,P){const U=this._makeStyleAst(M,P);return this._validateStyleAst(U,P),U}_makeStyleAst(M,P){const U=[],ee=Array.isArray(M.styles)?M.styles:[M.styles];for(let Ie of ee)"string"==typeof Ie?Ie===Pe?U.push(Ie):P.errors.push(new me.vHH(3002,!1)):U.push(Xn(Ie));let he=!1,be=null;return U.forEach(Ie=>{if(Ie instanceof Map&&(Ie.has("easing")&&(be=Ie.get("easing"),Ie.delete("easing")),!he))for(let tt of Ie.values())if(tt.toString().indexOf("{{")>=0){he=!0;break}}),{type:6,styles:U,easing:be,offset:M.offset,containsDynamicStyles:he,options:null}}_validateStyleAst(M,P){const U=P.currentAnimateTimings;let ee=P.currentTime,he=P.currentTime;U&&he>0&&(he-=U.duration+U.delay),M.styles.forEach(be=>{"string"!=typeof be&&be.forEach((Ie,tt)=>{const R=P.collectedStyles.get(P.currentQuerySelector),V=R.get(tt);let z=!0;V&&(he!=ee&&he>=V.startTime&&ee<=V.endTime&&(P.errors.push(function Pt(Z,M,P,U,ee){return new me.vHH(3010,!1)}()),z=!1),he=V.startTime),z&&R.set(tt,{startTime:he,endTime:ee}),P.options&&function rs(Z,M,P){const U=M.params||{},ee=Bo(Z);ee.length&&ee.forEach(he=>{U.hasOwnProperty(he)||P.push(function _t(Z){return new me.vHH(3001,!1)}())})}(Ie,P.options,P.errors)})})}visitKeyframes(M,P){const U={type:5,styles:[],options:null};if(!P.currentAnimateTimings)return P.errors.push(function Ft(){return new me.vHH(3011,!1)}()),U;let he=0;const be=[];let Ie=!1,tt=!1,R=0;const V=M.steps.map(bn=>{const zn=this._makeStyleAst(bn,P);let $n=null!=zn.offset?zn.offset:function gr(Z){if("string"==typeof Z)return null;let M=null;if(Array.isArray(Z))Z.forEach(P=>{if(P instanceof Map&&P.has("offset")){const U=P;M=parseFloat(U.get("offset")),U.delete("offset")}});else if(Z instanceof Map&&Z.has("offset")){const P=Z;M=parseFloat(P.get("offset")),P.delete("offset")}return M}(zn.styles),wn=0;return null!=$n&&(he++,wn=zn.offset=$n),tt=tt||wn<0||wn>1,Ie=Ie||wn<R,R=wn,be.push(wn),zn});tt&&P.errors.push(function kt(){return new me.vHH(3012,!1)}()),Ie&&P.errors.push(function Mn(){return new me.vHH(3200,!1)}());const z=M.steps.length;let te=0;he>0&&he<z?P.errors.push(function Bn(){return new me.vHH(3202,!1)}()):0==he&&(te=1/(z-1));const _e=z-1,Fe=P.currentTime,Ge=P.currentAnimateTimings,jt=Ge.duration;return V.forEach((bn,zn)=>{const $n=te>0?zn==_e?1:te*zn:be[zn],wn=$n*jt;P.currentTime=Fe+Ge.delay+wn,Ge.duration=wn,this._validateStyleAst(bn,P),bn.offset=$n,U.styles.push(bn)}),U}visitReference(M,P){return{type:8,animation:Dn(this,it(M.animation),P),options:wo(M.options)}}visitAnimateChild(M,P){return P.depCount++,{type:9,options:wo(M.options)}}visitAnimateRef(M,P){return{type:10,animation:this.visitReference(M.animation,P),options:wo(M.options)}}visitQuery(M,P){const U=P.currentQuerySelector,ee=M.options||{};P.queryCount++,P.currentQuery=M;const[he,be]=function mo(Z){const M=!!Z.split(/\s*,\s*/).find(P=>":self"==P);return M&&(Z=Z.replace(hi,"")),Z=Z.replace(/@\*/g,ae).replace(/@\w+/g,P=>ae+"-"+P.slice(1)).replace(/:animating/g,We),[Z,M]}(M.selector);P.currentQuerySelector=U.length?U+" "+he:he,Zr(P.collectedStyles,P.currentQuerySelector,new Map);const Ie=Dn(this,it(M.animation),P);return P.currentQuery=null,P.currentQuerySelector=U,{type:11,selector:he,limit:ee.limit||0,optional:!!ee.optional,includeSelf:be,animation:Ie,originalSelector:M.selector,options:wo(M.options)}}visitStagger(M,P){P.currentQuery||P.errors.push(function Ur(){return new me.vHH(3013,!1)}());const U="full"===M.timings?{duration:0,delay:0,easing:"full"}:Wt(M.timings,P.errors,!0);return{type:12,animation:Dn(this,it(M.animation),P),timings:U,options:null}}}class Li{constructor(M){this.errors=M,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function wo(Z){return Z?(Z=vn(Z)).params&&(Z.params=function js(Z){return Z?vn(Z):null}(Z.params)):Z={},Z}function ri(Z,M,P){return{duration:Z,delay:M,easing:P}}function Qo(Z,M,P,U,ee,he,be=null,Ie=!1){return{type:1,element:Z,keyframes:M,preStyleProps:P,postStyleProps:U,duration:ee,delay:he,totalTime:ee+he,easing:be,subTimeline:Ie}}class os{constructor(){this._map=new Map}get(M){return this._map.get(M)||[]}append(M,P){let U=this._map.get(M);U||this._map.set(M,U=[]),U.push(...P)}has(M){return this._map.has(M)}clear(){this._map.clear()}}const ga=new RegExp(":enter","g"),vi=new RegExp(":leave","g");function ss(Z,M,P,U,ee,he=new Map,be=new Map,Ie,tt,R=[]){return(new as).buildKeyframes(Z,M,P,U,ee,he,be,Ie,tt,R)}class as{buildKeyframes(M,P,U,ee,he,be,Ie,tt,R,V=[]){R=R||new os;const z=new ki(M,P,R,ee,he,V,[]);z.options=tt;const te=tt.delay?Ue(tt.delay):0;z.currentTimeline.delayNextStep(te),z.currentTimeline.setStyles([be],null,z.errors,tt),Dn(this,U,z);const _e=z.timelines.filter(Fe=>Fe.containsAnimation());if(_e.length&&Ie.size){let Fe;for(let Ge=_e.length-1;Ge>=0;Ge--){const jt=_e[Ge];if(jt.element===P){Fe=jt;break}}Fe&&!Fe.allowOnlyTimelineStyles()&&Fe.setStyles([Ie],null,z.errors,tt)}return _e.length?_e.map(Fe=>Fe.buildKeyframes()):[Qo(P,[],[],[],0,te,"",!1)]}visitTrigger(M,P){}visitState(M,P){}visitTransition(M,P){}visitAnimateChild(M,P){const U=P.subInstructions.get(P.element);if(U){const ee=P.createSubContext(M.options),he=P.currentTimeline.currentTime,be=this._visitSubInstructions(U,ee,ee.options);he!=be&&P.transformIntoNewTimeline(be)}P.previousNode=M}visitAnimateRef(M,P){const U=P.createSubContext(M.options);U.transformIntoNewTimeline(),this._applyAnimationRefDelays([M.options,M.animation.options],P,U),this.visitReference(M.animation,U),P.transformIntoNewTimeline(U.currentTimeline.currentTime),P.previousNode=M}_applyAnimationRefDelays(M,P,U){for(const ee of M){const he=ee?.delay;if(he){const be="number"==typeof he?he:Ue(ra(he,ee?.params??{},P.errors));U.delayNextStep(be)}}}_visitSubInstructions(M,P,U){let he=P.currentTimeline.currentTime;const be=null!=U.duration?Ue(U.duration):null,Ie=null!=U.delay?Ue(U.delay):null;return 0!==be&&M.forEach(tt=>{const R=P.appendInstructionToTimeline(tt,be,Ie);he=Math.max(he,R.duration+R.delay)}),he}visitReference(M,P){P.updateOptions(M.options,!0),Dn(this,M.animation,P),P.previousNode=M}visitSequence(M,P){const U=P.subContextCount;let ee=P;const he=M.options;if(he&&(he.params||he.delay)&&(ee=P.createSubContext(he),ee.transformIntoNewTimeline(),null!=he.delay)){6==ee.previousNode.type&&(ee.currentTimeline.snapshotCurrentStyles(),ee.previousNode=es);const be=Ue(he.delay);ee.delayNextStep(be)}M.steps.length&&(M.steps.forEach(be=>Dn(this,be,ee)),ee.currentTimeline.applyStylesToKeyframe(),ee.subContextCount>U&&ee.transformIntoNewTimeline()),P.previousNode=M}visitGroup(M,P){const U=[];let ee=P.currentTimeline.currentTime;const he=M.options&&M.options.delay?Ue(M.options.delay):0;M.steps.forEach(be=>{const Ie=P.createSubContext(M.options);he&&Ie.delayNextStep(he),Dn(this,be,Ie),ee=Math.max(ee,Ie.currentTimeline.currentTime),U.push(Ie.currentTimeline)}),U.forEach(be=>P.currentTimeline.mergeTimelineCollectedStyles(be)),P.transformIntoNewTimeline(ee),P.previousNode=M}_visitTiming(M,P){if(M.dynamic){const U=M.strValue;return Wt(P.params?ra(U,P.params,P.errors):U,P.errors)}return{duration:M.duration,delay:M.delay,easing:M.easing}}visitAnimate(M,P){const U=P.currentAnimateTimings=this._visitTiming(M.timings,P),ee=P.currentTimeline;U.delay&&(P.incrementTime(U.delay),ee.snapshotCurrentStyles());const he=M.style;5==he.type?this.visitKeyframes(he,P):(P.incrementTime(U.duration),this.visitStyle(he,P),ee.applyStylesToKeyframe()),P.currentAnimateTimings=null,P.previousNode=M}visitStyle(M,P){const U=P.currentTimeline,ee=P.currentAnimateTimings;!ee&&U.hasCurrentStyleProperties()&&U.forwardFrame();const he=ee&&ee.easing||M.easing;M.isEmptyStep?U.applyEmptyStep(he):U.setStyles(M.styles,he,P.errors,P.options),P.previousNode=M}visitKeyframes(M,P){const U=P.currentAnimateTimings,ee=P.currentTimeline.duration,he=U.duration,Ie=P.createSubContext().currentTimeline;Ie.easing=U.easing,M.styles.forEach(tt=>{Ie.forwardTime((tt.offset||0)*he),Ie.setStyles(tt.styles,tt.easing,P.errors,P.options),Ie.applyStylesToKeyframe()}),P.currentTimeline.mergeTimelineCollectedStyles(Ie),P.transformIntoNewTimeline(ee+he),P.previousNode=M}visitQuery(M,P){const U=P.currentTimeline.currentTime,ee=M.options||{},he=ee.delay?Ue(ee.delay):0;he&&(6===P.previousNode.type||0==U&&P.currentTimeline.hasCurrentStyleProperties())&&(P.currentTimeline.snapshotCurrentStyles(),P.previousNode=es);let be=U;const Ie=P.invokeQuery(M.selector,M.originalSelector,M.limit,M.includeSelf,!!ee.optional,P.errors);P.currentQueryTotal=Ie.length;let tt=null;Ie.forEach((R,V)=>{P.currentQueryIndex=V;const z=P.createSubContext(M.options,R);he&&z.delayNextStep(he),R===P.element&&(tt=z.currentTimeline),Dn(this,M.animation,z),z.currentTimeline.applyStylesToKeyframe(),be=Math.max(be,z.currentTimeline.currentTime)}),P.currentQueryIndex=0,P.currentQueryTotal=0,P.transformIntoNewTimeline(be),tt&&(P.currentTimeline.mergeTimelineCollectedStyles(tt),P.currentTimeline.snapshotCurrentStyles()),P.previousNode=M}visitStagger(M,P){const U=P.parentContext,ee=P.currentTimeline,he=M.timings,be=Math.abs(he.duration),Ie=be*(P.currentQueryTotal-1);let tt=be*P.currentQueryIndex;switch(he.duration<0?"reverse":he.easing){case"reverse":tt=Ie-tt;break;case"full":tt=U.currentStaggerTime}const V=P.currentTimeline;tt&&V.delayNextStep(tt);const z=V.currentTime;Dn(this,M.animation,P),P.previousNode=M,U.currentStaggerTime=ee.currentTime-z+(ee.startTime-U.currentTimeline.startTime)}}const es={};class ki{constructor(M,P,U,ee,he,be,Ie,tt){this._driver=M,this.element=P,this.subInstructions=U,this._enterClassName=ee,this._leaveClassName=he,this.errors=be,this.timelines=Ie,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=es,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=tt||new Oi(this._driver,P,0),Ie.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(M,P){if(!M)return;const U=M;let ee=this.options;null!=U.duration&&(ee.duration=Ue(U.duration)),null!=U.delay&&(ee.delay=Ue(U.delay));const he=U.params;if(he){let be=ee.params;be||(be=this.options.params={}),Object.keys(he).forEach(Ie=>{(!P||!be.hasOwnProperty(Ie))&&(be[Ie]=ra(he[Ie],be,this.errors))})}}_copyOptions(){const M={};if(this.options){const P=this.options.params;if(P){const U=M.params={};Object.keys(P).forEach(ee=>{U[ee]=P[ee]})}}return M}createSubContext(M=null,P,U){const ee=P||this.element,he=new ki(this._driver,ee,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(ee,U||0));return he.previousNode=this.previousNode,he.currentAnimateTimings=this.currentAnimateTimings,he.options=this._copyOptions(),he.updateOptions(M),he.currentQueryIndex=this.currentQueryIndex,he.currentQueryTotal=this.currentQueryTotal,he.parentContext=this,this.subContextCount++,he}transformIntoNewTimeline(M){return this.previousNode=es,this.currentTimeline=this.currentTimeline.fork(this.element,M),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(M,P,U){const ee={duration:P??M.duration,delay:this.currentTimeline.currentTime+(U??0)+M.delay,easing:""},he=new bs(this._driver,M.element,M.keyframes,M.preStyleProps,M.postStyleProps,ee,M.stretchStartingKeyframe);return this.timelines.push(he),ee}incrementTime(M){this.currentTimeline.forwardTime(this.currentTimeline.duration+M)}delayNextStep(M){M>0&&this.currentTimeline.delayNextStep(M)}invokeQuery(M,P,U,ee,he,be){let Ie=[];if(ee&&Ie.push(this.element),M.length>0){M=(M=M.replace(ga,"."+this._enterClassName)).replace(vi,"."+this._leaveClassName);let R=this._driver.query(this.element,M,1!=U);0!==U&&(R=U<0?R.slice(R.length+U,R.length):R.slice(0,U)),Ie.push(...R)}return!he&&0==Ie.length&&be.push(function En(Z){return new me.vHH(3014,!1)}()),Ie}}class Oi{constructor(M,P,U,ee){this._driver=M,this.element=P,this.startTime=U,this._elementTimelineStylesLookup=ee,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(P),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(P,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(M){const P=1===this._keyframes.size&&this._pendingStyles.size;this.duration||P?(this.forwardTime(this.currentTime+M),P&&this.snapshotCurrentStyles()):this.startTime+=M}fork(M,P){return this.applyStylesToKeyframe(),new Oi(this._driver,M,P||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(M){this.applyStylesToKeyframe(),this.duration=M,this._loadKeyframe()}_updateStyle(M,P){this._localTimelineStyles.set(M,P),this._globalTimelineStyles.set(M,P),this._styleSummary.set(M,{time:this.currentTime,value:P})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(M){M&&this._previousKeyframe.set("easing",M);for(let[P,U]of this._globalTimelineStyles)this._backFill.set(P,U||Pe),this._currentKeyframe.set(P,Pe);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(M,P,U,ee){P&&this._previousKeyframe.set("easing",P);const he=ee&&ee.params||{},be=function ls(Z,M){const P=new Map;let U;return Z.forEach(ee=>{if("*"===ee){U=U||M.keys();for(let he of U)P.set(he,Pe)}else sr(ee,P)}),P}(M,this._globalTimelineStyles);for(let[Ie,tt]of be){const R=ra(tt,he,U);this._pendingStyles.set(Ie,R),this._localTimelineStyles.has(Ie)||this._backFill.set(Ie,this._globalTimelineStyles.get(Ie)??Pe),this._updateStyle(Ie,R)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((M,P)=>{this._currentKeyframe.set(P,M)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((M,P)=>{this._currentKeyframe.has(P)||this._currentKeyframe.set(P,M)}))}snapshotCurrentStyles(){for(let[M,P]of this._localTimelineStyles)this._pendingStyles.set(M,P),this._updateStyle(M,P)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const M=[];for(let P in this._currentKeyframe)M.push(P);return M}mergeTimelineCollectedStyles(M){M._styleSummary.forEach((P,U)=>{const ee=this._styleSummary.get(U);(!ee||P.time>ee.time)&&this._updateStyle(U,P.value)})}buildKeyframes(){this.applyStylesToKeyframe();const M=new Set,P=new Set,U=1===this._keyframes.size&&0===this.duration;let ee=[];this._keyframes.forEach((Ie,tt)=>{const R=sr(Ie,new Map,this._backFill);R.forEach((V,z)=>{V===ht?M.add(z):V===Pe&&P.add(z)}),U||R.set("offset",tt/this.duration),ee.push(R)});const he=M.size?jn(M.values()):[],be=P.size?jn(P.values()):[];if(U){const Ie=ee[0],tt=new Map(Ie);Ie.set("offset",0),tt.set("offset",1),ee=[Ie,tt]}return Qo(this.element,ee,he,be,this.duration,this.startTime,this.easing,!1)}}class bs extends Oi{constructor(M,P,U,ee,he,be,Ie=!1){super(M,P,be.delay),this.keyframes=U,this.preStyleProps=ee,this.postStyleProps=he,this._stretchStartingKeyframe=Ie,this.timings={duration:be.duration,delay:be.delay,easing:be.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let M=this.keyframes,{delay:P,duration:U,easing:ee}=this.timings;if(this._stretchStartingKeyframe&&P){const he=[],be=U+P,Ie=P/be,tt=sr(M[0]);tt.set("offset",0),he.push(tt);const R=sr(M[0]);R.set("offset",ia(Ie)),he.push(R);const V=M.length-1;for(let z=1;z<=V;z++){let te=sr(M[z]);const _e=te.get("offset");te.set("offset",ia((P+_e*U)/be)),he.push(te)}U=be,P=0,ee="",M=he}return Qo(this.element,M,this.preStyleProps,this.postStyleProps,U,P,ee,!0)}}function ia(Z,M=3){const P=Math.pow(10,M-1);return Math.round(Z*P)/P}class ts{}const Ha=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class Vs extends ts{normalizePropertyName(M,P){return ui(M)}normalizeStyleValue(M,P,U,ee){let he="";const be=U.toString().trim();if(Ha.has(P)&&0!==U&&"0"!==U)if("number"==typeof U)he="px";else{const Ie=U.match(/^[+-]?[\d\.]+([a-z]*)$/);Ie&&0==Ie[1].length&&ee.push(function Kn(Z,M){return new me.vHH(3005,!1)}())}return be+he}}function dl(Z,M,P,U,ee,he,be,Ie,tt,R,V,z,te){return{type:0,element:Z,triggerName:M,isRemovalTransition:ee,fromState:P,fromStyles:he,toState:U,toStyles:be,timelines:Ie,queriedElements:tt,preStyleProps:R,postStyleProps:V,totalTime:z,errors:te}}const ya={};class qa{constructor(M,P,U){this._triggerName=M,this.ast=P,this._stateStyles=U}match(M,P,U,ee){return function Wa(Z,M,P,U,ee){return Z.some(he=>he(M,P,U,ee))}(this.ast.matchers,M,P,U,ee)}buildStyles(M,P,U){let ee=this._stateStyles.get("*");return void 0!==M&&(ee=this._stateStyles.get(M?.toString())||ee),ee?ee.buildStyles(P,U):new Map}build(M,P,U,ee,he,be,Ie,tt,R,V){const z=[],te=this.ast.options&&this.ast.options.params||ya,Fe=this.buildStyles(U,Ie&&Ie.params||ya,z),Ge=tt&&tt.params||ya,jt=this.buildStyles(ee,Ge,z),bn=new Set,zn=new Map,$n=new Map,wn="void"===ee,xr={params:fl(Ge,te),delay:this.ast.options?.delay},rr=V?[]:ss(M,P,this.ast.animation,he,be,Fe,jt,xr,R,z);let Et=0;if(rr.forEach(bi=>{Et=Math.max(bi.duration+bi.delay,Et)}),z.length)return dl(P,this._triggerName,U,ee,wn,Fe,jt,[],[],zn,$n,Et,z);rr.forEach(bi=>{const no=bi.element,Co=Zr(zn,no,new Set);bi.preStyleProps.forEach(So=>Co.add(So));const ro=Zr($n,no,new Set);bi.postStyleProps.forEach(So=>ro.add(So)),no!==P&&bn.add(no)});const Rr=jn(bn.values());return dl(P,this._triggerName,U,ee,wn,Fe,jt,rr,Rr,zn,$n,Et)}}function fl(Z,M){const P=vn(M);for(const U in Z)Z.hasOwnProperty(U)&&null!=Z[U]&&(P[U]=Z[U]);return P}class va{constructor(M,P,U){this.styles=M,this.defaultParams=P,this.normalizer=U}buildStyles(M,P){const U=new Map,ee=vn(this.defaultParams);return Object.keys(M).forEach(he=>{const be=M[he];null!==be&&(ee[he]=be)}),this.styles.styles.forEach(he=>{"string"!=typeof he&&he.forEach((be,Ie)=>{be&&(be=ra(be,ee,P));const tt=this.normalizer.normalizePropertyName(Ie,P);be=this.normalizer.normalizeStyleValue(Ie,tt,be,P),U.set(Ie,be)})}),U}}class oa{constructor(M,P,U){this.name=M,this.ast=P,this._normalizer=U,this.transitionFactories=[],this.states=new Map,P.states.forEach(ee=>{this.states.set(ee.name,new va(ee.style,ee.options&&ee.options.params||{},U))}),ws(this.states,"true","1"),ws(this.states,"false","0"),P.transitions.forEach(ee=>{this.transitionFactories.push(new qa(M,ee,this.states))}),this.fallbackTransition=function xa(Z,M,P){return new qa(Z,{type:1,animation:{type:2,steps:[],options:null},matchers:[(be,Ie)=>!0],options:null,queryCount:0,depCount:0},M)}(M,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(M,P,U,ee){return this.transitionFactories.find(be=>be.match(M,P,U,ee))||null}matchStyles(M,P,U){return this.fallbackTransition.buildStyles(M,P,U)}}function ws(Z,M,P){Z.has(M)?Z.has(P)||Z.set(P,Z.get(M)):Z.has(P)&&Z.set(M,Z.get(P))}const wr=new os;class cs{constructor(M,P,U){this.bodyNode=M,this._driver=P,this._normalizer=U,this._animations=new Map,this._playersById=new Map,this.players=[]}register(M,P){const U=[],ee=[],he=di(this._driver,P,U,ee);if(U.length)throw function Ai(Z){return new me.vHH(3503,!1)}();this._animations.set(M,he)}_buildPlayer(M,P,U){const ee=M.element,he=nn(0,this._normalizer,0,M.keyframes,P,U);return this._driver.animate(ee,he,M.duration,M.delay,M.easing,[],!0)}create(M,P,U={}){const ee=[],he=this._animations.get(M);let be;const Ie=new Map;if(he?(be=ss(this._driver,P,he,ue,ne,new Map,new Map,U,wr,ee),be.forEach(V=>{const z=Zr(Ie,V.element,new Map);V.postStyleProps.forEach(te=>z.set(te,null))})):(ee.push(function Ti(){return new me.vHH(3300,!1)}()),be=[]),ee.length)throw function Yr(Z){return new me.vHH(3504,!1)}();Ie.forEach((V,z)=>{V.forEach((te,_e)=>{V.set(_e,this._driver.computeStyle(z,_e,Pe))})});const R=vt(be.map(V=>{const z=Ie.get(V.element);return this._buildPlayer(V,new Map,z)}));return this._playersById.set(M,R),R.onDestroy(()=>this.destroy(M)),this.players.push(R),R}destroy(M){const P=this._getPlayer(M);P.destroy(),this._playersById.delete(M);const U=this.players.indexOf(P);U>=0&&this.players.splice(U,1)}_getPlayer(M){const P=this._playersById.get(M);if(!P)throw function zo(Z){return new me.vHH(3301,!1)}();return P}listen(M,P,U,ee){const he=Fr(P,"","","");return br(this._getPlayer(M),U,he,ee),()=>{}}command(M,P,U,ee){if("register"==U)return void this.register(M,ee[0]);if("create"==U)return void this.create(M,P,ee[0]||{});const he=this._getPlayer(M);switch(U){case"play":he.play();break;case"pause":he.pause();break;case"reset":he.reset();break;case"restart":he.restart();break;case"finish":he.finish();break;case"init":he.init();break;case"setPosition":he.setPosition(parseFloat(ee[0]));break;case"destroy":this.destroy(M)}}}const sa="ng-animate-queued",Lo="ng-animate-disabled",qs=[],Ws={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},Eo={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Xi="__ng_removed";class Ki{get params(){return this.options.params}constructor(M,P=""){this.namespaceId=P;const U=M&&M.hasOwnProperty("value");if(this.value=function wa(Z){return Z??null}(U?M.value:M),U){const he=vn(M);delete he.value,this.options=he}else this.options={};this.options.params||(this.options.params={})}absorbOptions(M){const P=M.params;if(P){const U=this.options.params;Object.keys(P).forEach(ee=>{null==U[ee]&&(U[ee]=P[ee])})}}}const Es="void",aa=new Ki(Es);class Ln{constructor(M,P,U){this.id=M,this.hostElement=P,this._engine=U,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+M,Yi(P,this._hostClassName)}listen(M,P,U,ee){if(!this._triggers.has(P))throw function uo(Z,M){return new me.vHH(3302,!1)}();if(null==U||0==U.length)throw function xn(Z){return new me.vHH(3303,!1)}();if(!function Ds(Z){return"start"==Z||"done"==Z}(U))throw function Lr(Z,M){return new me.vHH(3400,!1)}();const he=Zr(this._elementListeners,M,[]),be={name:P,phase:U,callback:ee};he.push(be);const Ie=Zr(this._engine.statesByElement,M,new Map);return Ie.has(P)||(Yi(M,q),Yi(M,q+"-"+P),Ie.set(P,aa)),()=>{this._engine.afterFlush(()=>{const tt=he.indexOf(be);tt>=0&&he.splice(tt,1),this._triggers.has(P)||Ie.delete(P)})}}register(M,P){return!this._triggers.has(M)&&(this._triggers.set(M,P),!0)}_getTrigger(M){const P=this._triggers.get(M);if(!P)throw function ho(Z){return new me.vHH(3401,!1)}();return P}trigger(M,P,U,ee=!0){const he=this._getTrigger(P),be=new Ts(this.id,P,M);let Ie=this._engine.statesByElement.get(M);Ie||(Yi(M,q),Yi(M,q+"-"+P),this._engine.statesByElement.set(M,Ie=new Map));let tt=Ie.get(P);const R=new Ki(U,this.id);if(!(U&&U.hasOwnProperty("value"))&&tt&&R.absorbOptions(tt.options),Ie.set(P,R),tt||(tt=aa),R.value!==Es&&tt.value===R.value){if(!function $r(Z,M){const P=Object.keys(Z),U=Object.keys(M);if(P.length!=U.length)return!1;for(let ee=0;ee<P.length;ee++){const he=P[ee];if(!M.hasOwnProperty(he)||Z[he]!==M[he])return!1}return!0}(tt.params,R.params)){const Ge=[],jt=he.matchStyles(tt.value,tt.params,Ge),bn=he.matchStyles(R.value,R.params,Ge);Ge.length?this._engine.reportError(Ge):this._engine.afterFlush(()=>{jr(M,jt),ji(M,bn)})}return}const te=Zr(this._engine.playersByElement,M,[]);te.forEach(Ge=>{Ge.namespaceId==this.id&&Ge.triggerName==P&&Ge.queued&&Ge.destroy()});let _e=he.matchTransition(tt.value,R.value,M,R.params),Fe=!1;if(!_e){if(!ee)return;_e=he.fallbackTransition,Fe=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:M,triggerName:P,transition:_e,fromState:tt,toState:R,player:be,isFallbackTransition:Fe}),Fe||(Yi(M,sa),be.onStart(()=>{Fi(M,sa)})),be.onDone(()=>{let Ge=this.players.indexOf(be);Ge>=0&&this.players.splice(Ge,1);const jt=this._engine.playersByElement.get(M);if(jt){let bn=jt.indexOf(be);bn>=0&&jt.splice(bn,1)}}),this.players.push(be),te.push(be),be}deregister(M){this._triggers.delete(M),this._engine.statesByElement.forEach(P=>P.delete(M)),this._elementListeners.forEach((P,U)=>{this._elementListeners.set(U,P.filter(ee=>ee.name!=M))})}clearElementCache(M){this._engine.statesByElement.delete(M),this._elementListeners.delete(M);const P=this._engine.playersByElement.get(M);P&&(P.forEach(U=>U.destroy()),this._engine.playersByElement.delete(M))}_signalRemovalForInnerTriggers(M,P){const U=this._engine.driver.query(M,ae,!0);U.forEach(ee=>{if(ee[Xi])return;const he=this._engine.fetchNamespacesByElement(ee);he.size?he.forEach(be=>be.triggerLeaveAnimation(ee,P,!1,!0)):this.clearElementCache(ee)}),this._engine.afterFlushAnimationsDone(()=>U.forEach(ee=>this.clearElementCache(ee)))}triggerLeaveAnimation(M,P,U,ee){const he=this._engine.statesByElement.get(M),be=new Map;if(he){const Ie=[];if(he.forEach((tt,R)=>{if(be.set(R,tt.value),this._triggers.has(R)){const V=this.trigger(M,R,Es,ee);V&&Ie.push(V)}}),Ie.length)return this._engine.markElementAsRemoved(this.id,M,!0,P,be),U&&vt(Ie).onDone(()=>this._engine.processLeaveNode(M)),!0}return!1}prepareLeaveAnimationListeners(M){const P=this._elementListeners.get(M),U=this._engine.statesByElement.get(M);if(P&&U){const ee=new Set;P.forEach(he=>{const be=he.name;if(ee.has(be))return;ee.add(be);const tt=this._triggers.get(be).fallbackTransition,R=U.get(be)||aa,V=new Ki(Es),z=new Ts(this.id,be,M);this._engine.totalQueuedPlayers++,this._queue.push({element:M,triggerName:be,transition:tt,fromState:R,toState:V,player:z,isFallbackTransition:!0})})}}removeNode(M,P){const U=this._engine;if(M.childElementCount&&this._signalRemovalForInnerTriggers(M,P),this.triggerLeaveAnimation(M,P,!0))return;let ee=!1;if(U.totalAnimations){const he=U.players.length?U.playersByQueriedElement.get(M):[];if(he&&he.length)ee=!0;else{let be=M;for(;be=be.parentNode;)if(U.statesByElement.get(be)){ee=!0;break}}}if(this.prepareLeaveAnimationListeners(M),ee)U.markElementAsRemoved(this.id,M,!1,P);else{const he=M[Xi];(!he||he===Ws)&&(U.afterFlush(()=>this.clearElementCache(M)),U.destroyInnerAnimations(M),U._onRemovalComplete(M,P))}}insertNode(M,P){Yi(M,this._hostClassName)}drainQueuedTransitions(M){const P=[];return this._queue.forEach(U=>{const ee=U.player;if(ee.destroyed)return;const he=U.element,be=this._elementListeners.get(he);be&&be.forEach(Ie=>{if(Ie.name==U.triggerName){const tt=Fr(he,U.triggerName,U.fromState.value,U.toState.value);tt._data=M,br(U.player,Ie.phase,tt,Ie.callback)}}),ee.markedForDestroy?this._engine.afterFlush(()=>{ee.destroy()}):P.push(U)}),this._queue=[],P.sort((U,ee)=>{const he=U.transition.ast.depCount,be=ee.transition.ast.depCount;return 0==he||0==be?he-be:this._engine.driver.containsElement(U.element,ee.element)?1:-1})}destroy(M){this.players.forEach(P=>P.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,M)}elementContainsData(M){let P=!1;return this._elementListeners.has(M)&&(P=!0),P=!!this._queue.find(U=>U.element===M)||P,P}}class Za{_onRemovalComplete(M,P){this.onRemovalComplete(M,P)}constructor(M,P,U){this.bodyNode=M,this.driver=P,this._normalizer=U,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(ee,he)=>{}}get queuedPlayers(){const M=[];return this._namespaceList.forEach(P=>{P.players.forEach(U=>{U.queued&&M.push(U)})}),M}createNamespace(M,P){const U=new Ln(M,P,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,P)?this._balanceNamespaceList(U,P):(this.newHostElements.set(P,U),this.collectEnterElement(P)),this._namespaceLookup[M]=U}_balanceNamespaceList(M,P){const U=this._namespaceList,ee=this.namespacesByHostElement;if(U.length-1>=0){let be=!1,Ie=this.driver.getParentElement(P);for(;Ie;){const tt=ee.get(Ie);if(tt){const R=U.indexOf(tt);U.splice(R+1,0,M),be=!0;break}Ie=this.driver.getParentElement(Ie)}be||U.unshift(M)}else U.push(M);return ee.set(P,M),M}register(M,P){let U=this._namespaceLookup[M];return U||(U=this.createNamespace(M,P)),U}registerTrigger(M,P,U){let ee=this._namespaceLookup[M];ee&&ee.register(P,U)&&this.totalAnimations++}destroy(M,P){if(!M)return;const U=this._fetchNamespace(M);this.afterFlush(()=>{this.namespacesByHostElement.delete(U.hostElement),delete this._namespaceLookup[M];const ee=this._namespaceList.indexOf(U);ee>=0&&this._namespaceList.splice(ee,1)}),this.afterFlushAnimationsDone(()=>U.destroy(P))}_fetchNamespace(M){return this._namespaceLookup[M]}fetchNamespacesByElement(M){const P=new Set,U=this.statesByElement.get(M);if(U)for(let ee of U.values())if(ee.namespaceId){const he=this._fetchNamespace(ee.namespaceId);he&&P.add(he)}return P}trigger(M,P,U,ee){if(Mi(P)){const he=this._fetchNamespace(M);if(he)return he.trigger(P,U,ee),!0}return!1}insertNode(M,P,U,ee){if(!Mi(P))return;const he=P[Xi];if(he&&he.setForRemoval){he.setForRemoval=!1,he.setForMove=!0;const be=this.collectedLeaveElements.indexOf(P);be>=0&&this.collectedLeaveElements.splice(be,1)}if(M){const be=this._fetchNamespace(M);be&&be.insertNode(P,U)}ee&&this.collectEnterElement(P)}collectEnterElement(M){this.collectedEnterElements.push(M)}markElementAsDisabled(M,P){P?this.disabledNodes.has(M)||(this.disabledNodes.add(M),Yi(M,Lo)):this.disabledNodes.has(M)&&(this.disabledNodes.delete(M),Fi(M,Lo))}removeNode(M,P,U,ee){if(Mi(P)){const he=M?this._fetchNamespace(M):null;if(he?he.removeNode(P,ee):this.markElementAsRemoved(M,P,!1,ee),U){const be=this.namespacesByHostElement.get(P);be&&be.id!==M&&be.removeNode(P,ee)}}else this._onRemovalComplete(P,ee)}markElementAsRemoved(M,P,U,ee,he){this.collectedLeaveElements.push(P),P[Xi]={namespaceId:M,setForRemoval:ee,hasAnimation:U,removedBeforeQueried:!1,previousTriggersValues:he}}listen(M,P,U,ee,he){return Mi(P)?this._fetchNamespace(M).listen(P,U,ee,he):()=>{}}_buildInstruction(M,P,U,ee,he){return M.transition.build(this.driver,M.element,M.fromState.value,M.toState.value,U,ee,M.fromState.options,M.toState.options,P,he)}destroyInnerAnimations(M){let P=this.driver.query(M,ae,!0);P.forEach(U=>this.destroyActiveAnimationsForElement(U)),0!=this.playersByQueriedElement.size&&(P=this.driver.query(M,We,!0),P.forEach(U=>this.finishActiveQueriedAnimationOnElement(U)))}destroyActiveAnimationsForElement(M){const P=this.playersByElement.get(M);P&&P.forEach(U=>{U.queued?U.markedForDestroy=!0:U.destroy()})}finishActiveQueriedAnimationOnElement(M){const P=this.playersByQueriedElement.get(M);P&&P.forEach(U=>U.finish())}whenRenderingDone(){return new Promise(M=>{if(this.players.length)return vt(this.players).onDone(()=>M());M()})}processLeaveNode(M){const P=M[Xi];if(P&&P.setForRemoval){if(M[Xi]=Ws,P.namespaceId){this.destroyInnerAnimations(M);const U=this._fetchNamespace(P.namespaceId);U&&U.clearElementCache(M)}this._onRemovalComplete(M,P.setForRemoval)}M.classList?.contains(Lo)&&this.markElementAsDisabled(M,!1),this.driver.query(M,".ng-animate-disabled",!0).forEach(U=>{this.markElementAsDisabled(U,!1)})}flush(M=-1){let P=[];if(this.newHostElements.size&&(this.newHostElements.forEach((U,ee)=>this._balanceNamespaceList(U,ee)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let U=0;U<this.collectedEnterElements.length;U++)Yi(this.collectedEnterElements[U],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const U=[];try{P=this._flushAnimations(U,M)}finally{for(let ee=0;ee<U.length;ee++)U[ee]()}}else for(let U=0;U<this.collectedLeaveElements.length;U++)this.processLeaveNode(this.collectedLeaveElements[U]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(U=>U()),this._flushFns=[],this._whenQuietFns.length){const U=this._whenQuietFns;this._whenQuietFns=[],P.length?vt(P).onDone(()=>{U.forEach(ee=>ee())}):U.forEach(ee=>ee())}}reportError(M){throw function Hi(Z){return new me.vHH(3402,!1)}()}_flushAnimations(M,P){const U=new os,ee=[],he=new Map,be=[],Ie=new Map,tt=new Map,R=new Map,V=new Set;this.disabledNodes.forEach(gn=>{V.add(gn);const ln=this.driver.query(gn,".ng-animate-queued",!0);for(let kn=0;kn<ln.length;kn++)V.add(ln[kn])});const z=this.bodyNode,te=Array.from(this.statesByElement.keys()),_e=Cs(te,this.collectedEnterElements),Fe=new Map;let Ge=0;_e.forEach((gn,ln)=>{const kn=ue+Ge++;Fe.set(ln,kn),gn.forEach(fr=>Yi(fr,kn))});const jt=[],bn=new Set,zn=new Set;for(let gn=0;gn<this.collectedLeaveElements.length;gn++){const ln=this.collectedLeaveElements[gn],kn=ln[Xi];kn&&kn.setForRemoval&&(jt.push(ln),bn.add(ln),kn.hasAnimation?this.driver.query(ln,".ng-star-inserted",!0).forEach(fr=>bn.add(fr)):zn.add(ln))}const $n=new Map,wn=Cs(te,Array.from(bn));wn.forEach((gn,ln)=>{const kn=ne+Ge++;$n.set(ln,kn),gn.forEach(fr=>Yi(fr,kn))}),M.push(()=>{_e.forEach((gn,ln)=>{const kn=Fe.get(ln);gn.forEach(fr=>Fi(fr,kn))}),wn.forEach((gn,ln)=>{const kn=$n.get(ln);gn.forEach(fr=>Fi(fr,kn))}),jt.forEach(gn=>{this.processLeaveNode(gn)})});const xr=[],rr=[];for(let gn=this._namespaceList.length-1;gn>=0;gn--)this._namespaceList[gn].drainQueuedTransitions(P).forEach(kn=>{const fr=kn.player,wi=kn.element;if(xr.push(fr),this.collectedEnterElements.length){const Ui=wi[Xi];if(Ui&&Ui.setForMove){if(Ui.previousTriggersValues&&Ui.previousTriggersValues.has(kn.triggerName)){const ds=Ui.previousTriggersValues.get(kn.triggerName),Ei=this.statesByElement.get(kn.element);if(Ei&&Ei.has(kn.triggerName)){const Ks=Ei.get(kn.triggerName);Ks.value=ds,Ei.set(kn.triggerName,Ks)}}return void fr.destroy()}}const Vo=!z||!this.driver.containsElement(z,wi),Bi=$n.get(wi),_o=Fe.get(wi),zr=this._buildInstruction(kn,U,_o,Bi,Vo);if(zr.errors&&zr.errors.length)return void rr.push(zr);if(Vo)return fr.onStart(()=>jr(wi,zr.fromStyles)),fr.onDestroy(()=>ji(wi,zr.toStyles)),void ee.push(fr);if(kn.isFallbackTransition)return fr.onStart(()=>jr(wi,zr.fromStyles)),fr.onDestroy(()=>ji(wi,zr.toStyles)),void ee.push(fr);const jl=[];zr.timelines.forEach(Ui=>{Ui.stretchStartingKeyframe=!0,this.disabledNodes.has(Ui.element)||jl.push(Ui)}),zr.timelines=jl,U.append(wi,zr.timelines),be.push({instruction:zr,player:fr,element:wi}),zr.queriedElements.forEach(Ui=>Zr(Ie,Ui,[]).push(fr)),zr.preStyleProps.forEach((Ui,ds)=>{if(Ui.size){let Ei=tt.get(ds);Ei||tt.set(ds,Ei=new Set),Ui.forEach((Ks,ha)=>Ei.add(ha))}}),zr.postStyleProps.forEach((Ui,ds)=>{let Ei=R.get(ds);Ei||R.set(ds,Ei=new Set),Ui.forEach((Ks,ha)=>Ei.add(ha))})});if(rr.length){const gn=[];rr.forEach(ln=>{gn.push(function fo(Z,M){return new me.vHH(3505,!1)}())}),xr.forEach(ln=>ln.destroy()),this.reportError(gn)}const Et=new Map,Rr=new Map;be.forEach(gn=>{const ln=gn.element;U.has(ln)&&(Rr.set(ln,ln),this._beforeAnimationBuild(gn.player.namespaceId,gn.instruction,Et))}),ee.forEach(gn=>{const ln=gn.element;this._getPreviousPlayers(ln,!1,gn.namespaceId,gn.triggerName,null).forEach(fr=>{Zr(Et,ln,[]).push(fr),fr.destroy()})});const bi=jt.filter(gn=>Ka(gn,tt,R)),no=new Map;tc(no,this.driver,zn,R,Pe).forEach(gn=>{Ka(gn,tt,R)&&bi.push(gn)});const ro=new Map;_e.forEach((gn,ln)=>{tc(ro,this.driver,new Set(gn),tt,ht)}),bi.forEach(gn=>{const ln=no.get(gn),kn=ro.get(gn);no.set(gn,new Map([...Array.from(ln?.entries()??[]),...Array.from(kn?.entries()??[])]))});const So=[],Mo=[],Is={};be.forEach(gn=>{const{element:ln,player:kn,instruction:fr}=gn;if(U.has(ln)){if(V.has(ln))return kn.onDestroy(()=>ji(ln,fr.toStyles)),kn.disabled=!0,kn.overrideTotalTime(fr.totalTime),void ee.push(kn);let wi=Is;if(Rr.size>1){let Bi=ln;const _o=[];for(;Bi=Bi.parentNode;){const zr=Rr.get(Bi);if(zr){wi=zr;break}_o.push(Bi)}_o.forEach(zr=>Rr.set(zr,wi))}const Vo=this._buildAnimation(kn.namespaceId,fr,Et,he,ro,no);if(kn.setRealPlayer(Vo),wi===Is)So.push(kn);else{const Bi=this.playersByElement.get(wi);Bi&&Bi.length&&(kn.parentPlayer=vt(Bi)),ee.push(kn)}}else jr(ln,fr.fromStyles),kn.onDestroy(()=>ji(ln,fr.toStyles)),Mo.push(kn),V.has(ln)&&ee.push(kn)}),Mo.forEach(gn=>{const ln=he.get(gn.element);if(ln&&ln.length){const kn=vt(ln);gn.setRealPlayer(kn)}}),ee.forEach(gn=>{gn.parentPlayer?gn.syncPlayerEvents(gn.parentPlayer):gn.destroy()});for(let gn=0;gn<jt.length;gn++){const ln=jt[gn],kn=ln[Xi];if(Fi(ln,ne),kn&&kn.hasAnimation)continue;let fr=[];if(Ie.size){let Vo=Ie.get(ln);Vo&&Vo.length&&fr.push(...Vo);let Bi=this.driver.query(ln,We,!0);for(let _o=0;_o<Bi.length;_o++){let zr=Ie.get(Bi[_o]);zr&&zr.length&&fr.push(...zr)}}const wi=fr.filter(Vo=>!Vo.destroyed);wi.length?Xa(this,ln,wi):this.processLeaveNode(ln)}return jt.length=0,So.forEach(gn=>{this.players.push(gn),gn.onDone(()=>{gn.destroy();const ln=this.players.indexOf(gn);this.players.splice(ln,1)}),gn.play()}),So}elementContainsData(M,P){let U=!1;const ee=P[Xi];return ee&&ee.setForRemoval&&(U=!0),this.playersByElement.has(P)&&(U=!0),this.playersByQueriedElement.has(P)&&(U=!0),this.statesByElement.has(P)&&(U=!0),this._fetchNamespace(M).elementContainsData(P)||U}afterFlush(M){this._flushFns.push(M)}afterFlushAnimationsDone(M){this._whenQuietFns.push(M)}_getPreviousPlayers(M,P,U,ee,he){let be=[];if(P){const Ie=this.playersByQueriedElement.get(M);Ie&&(be=Ie)}else{const Ie=this.playersByElement.get(M);if(Ie){const tt=!he||he==Es;Ie.forEach(R=>{R.queued||!tt&&R.triggerName!=ee||be.push(R)})}}return(U||ee)&&(be=be.filter(Ie=>!(U&&U!=Ie.namespaceId||ee&&ee!=Ie.triggerName))),be}_beforeAnimationBuild(M,P,U){const he=P.element,be=P.isRemovalTransition?void 0:M,Ie=P.isRemovalTransition?void 0:P.triggerName;for(const tt of P.timelines){const R=tt.element,V=R!==he,z=Zr(U,R,[]);this._getPreviousPlayers(R,V,be,Ie,P.toState).forEach(_e=>{const Fe=_e.getRealPlayer();Fe.beforeDestroy&&Fe.beforeDestroy(),_e.destroy(),z.push(_e)})}jr(he,P.fromStyles)}_buildAnimation(M,P,U,ee,he,be){const Ie=P.triggerName,tt=P.element,R=[],V=new Set,z=new Set,te=P.timelines.map(Fe=>{const Ge=Fe.element;V.add(Ge);const jt=Ge[Xi];if(jt&&jt.removedBeforeQueried)return new en(Fe.duration,Fe.delay);const bn=Ge!==tt,zn=function ml(Z){const M=[];return Vn(Z,M),M}((U.get(Ge)||qs).map(Et=>Et.getRealPlayer())).filter(Et=>!!Et.element&&Et.element===Ge),$n=he.get(Ge),wn=be.get(Ge),xr=nn(0,this._normalizer,0,Fe.keyframes,$n,wn),rr=this._buildPlayer(Fe,xr,zn);if(Fe.subTimeline&&ee&&z.add(Ge),bn){const Et=new Ts(M,Ie,Ge);Et.setRealPlayer(rr),R.push(Et)}return rr});R.forEach(Fe=>{Zr(this.playersByQueriedElement,Fe.element,[]).push(Fe),Fe.onDone(()=>function To(Z,M,P){let U=Z.get(M);if(U){if(U.length){const ee=U.indexOf(P);U.splice(ee,1)}0==U.length&&Z.delete(M)}return U}(this.playersByQueriedElement,Fe.element,Fe))}),V.forEach(Fe=>Yi(Fe,De));const _e=vt(te);return _e.onDestroy(()=>{V.forEach(Fe=>Fi(Fe,De)),ji(tt,P.toStyles)}),z.forEach(Fe=>{Zr(ee,Fe,[]).push(_e)}),_e}_buildPlayer(M,P,U){return P.length>0?this.driver.animate(M.element,P,M.duration,M.delay,M.easing,U):new en(M.duration,M.delay)}}class Ts{constructor(M,P,U){this.namespaceId=M,this.triggerName=P,this.element=U,this._player=new en,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(M){this._containsRealPlayer||(this._player=M,this._queuedCallbacks.forEach((P,U)=>{P.forEach(ee=>br(M,U,void 0,ee))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(M.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(M){this.totalTime=M}syncPlayerEvents(M){const P=this._player;P.triggerCallback&&M.onStart(()=>P.triggerCallback("start")),M.onDone(()=>this.finish()),M.onDestroy(()=>this.destroy())}_queueEvent(M,P){Zr(this._queuedCallbacks,M,[]).push(P)}onDone(M){this.queued&&this._queueEvent("done",M),this._player.onDone(M)}onStart(M){this.queued&&this._queueEvent("start",M),this._player.onStart(M)}onDestroy(M){this.queued&&this._queueEvent("destroy",M),this._player.onDestroy(M)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(M){this.queued||this._player.setPosition(M)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(M){const P=this._player;P.triggerCallback&&P.triggerCallback(M)}}function Mi(Z){return Z&&1===Z.nodeType}function xi(Z,M){const P=Z.style.display;return Z.style.display=M??"none",P}function tc(Z,M,P,U,ee){const he=[];P.forEach(tt=>he.push(xi(tt)));const be=[];U.forEach((tt,R)=>{const V=new Map;tt.forEach(z=>{const te=M.computeStyle(R,z,ee);V.set(z,te),(!te||0==te.length)&&(R[Xi]=Eo,be.push(R))}),Z.set(R,V)});let Ie=0;return P.forEach(tt=>xi(tt,he[Ie++])),be}function Cs(Z,M){const P=new Map;if(Z.forEach(Ie=>P.set(Ie,[])),0==M.length)return P;const U=1,ee=new Set(M),he=new Map;function be(Ie){if(!Ie)return U;let tt=he.get(Ie);if(tt)return tt;const R=Ie.parentNode;return tt=P.has(R)?R:ee.has(R)?U:be(R),he.set(Ie,tt),tt}return M.forEach(Ie=>{const tt=be(Ie);tt!==U&&P.get(tt).push(Ie)}),P}function Yi(Z,M){Z.classList?.add(M)}function Fi(Z,M){Z.classList?.remove(M)}function Xa(Z,M,P){vt(P).onDone(()=>Z.processLeaveNode(M))}function Vn(Z,M){for(let P=0;P<Z.length;P++){const U=Z[P];U instanceof rn?Vn(U.players,M):M.push(U)}}function Ka(Z,M,P){const U=P.get(Z);if(!U)return!1;let ee=M.get(Z);return ee?U.forEach(he=>ee.add(he)):M.set(Z,U),P.delete(Z),!0}class Ss{constructor(M,P,U){this.bodyNode=M,this._driver=P,this._normalizer=U,this._triggerCache={},this.onRemovalComplete=(ee,he)=>{},this._transitionEngine=new Za(M,P,U),this._timelineEngine=new cs(M,P,U),this._transitionEngine.onRemovalComplete=(ee,he)=>this.onRemovalComplete(ee,he)}registerTrigger(M,P,U,ee,he){const be=M+"-"+ee;let Ie=this._triggerCache[be];if(!Ie){const tt=[],R=[],V=di(this._driver,he,tt,R);if(tt.length)throw function tn(Z,M){return new me.vHH(3404,!1)}();Ie=function pl(Z,M,P){return new oa(Z,M,P)}(ee,V,this._normalizer),this._triggerCache[be]=Ie}this._transitionEngine.registerTrigger(P,ee,Ie)}register(M,P){this._transitionEngine.register(M,P)}destroy(M,P){this._transitionEngine.destroy(M,P)}onInsert(M,P,U,ee){this._transitionEngine.insertNode(M,P,U,ee)}onRemove(M,P,U,ee){this._transitionEngine.removeNode(M,P,ee||!1,U)}disableAnimations(M,P){this._transitionEngine.markElementAsDisabled(M,P)}process(M,P,U,ee){if("@"==U.charAt(0)){const[he,be]=hr(U);this._timelineEngine.command(he,P,be,ee)}else this._transitionEngine.trigger(M,P,U,ee)}listen(M,P,U,ee,he){if("@"==U.charAt(0)){const[be,Ie]=hr(U);return this._timelineEngine.listen(be,P,Ie,he)}return this._transitionEngine.listen(M,P,U,ee,he)}flush(M=-1){this._transitionEngine.flush(M)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let Zs=(()=>{class Z{constructor(P,U,ee){this._element=P,this._startStyles=U,this._endStyles=ee,this._state=0;let he=Z.initialStylesByElement.get(P);he||Z.initialStylesByElement.set(P,he=new Map),this._initialStyles=he}start(){this._state<1&&(this._startStyles&&ji(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ji(this._element,this._initialStyles),this._endStyles&&(ji(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(Z.initialStylesByElement.delete(this._element),this._startStyles&&(jr(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(jr(this._element,this._endStyles),this._endStyles=null),ji(this._element,this._initialStyles),this._state=3)}}return Z.initialStylesByElement=new WeakMap,Z})();function Ta(Z){let M=null;return Z.forEach((P,U)=>{(function us(Z){return"display"===Z||"position"===Z})(U)&&(M=M||new Map,M.set(U,P))}),M}class Da{constructor(M,P,U,ee){this.element=M,this.keyframes=P,this.options=U,this._specialStyles=ee,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=U.duration,this._delay=U.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(M=>M()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const M=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,M,this.options),this._finalKeyframe=M.length?M[M.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(M){const P=[];return M.forEach(U=>{P.push(Object.fromEntries(U))}),P}_triggerWebAnimation(M,P,U){return M.animate(this._convertKeyframesToObject(P),U)}onStart(M){this._originalOnStartFns.push(M),this._onStartFns.push(M)}onDone(M){this._originalOnDoneFns.push(M),this._onDoneFns.push(M)}onDestroy(M){this._onDestroyFns.push(M)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(M=>M()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(M=>M()),this._onDestroyFns=[])}setPosition(M){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=M*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const M=new Map;this.hasStarted()&&this._finalKeyframe.forEach((U,ee)=>{"offset"!==ee&&M.set(ee,this._finished?U:Wi(this.element,ee))}),this.currentSnapshot=M}triggerCallback(M){const P="start"===M?this._onStartFns:this._onDoneFns;P.forEach(U=>U()),P.length=0}}class Rt{validateStyleProperty(M){return!0}validateAnimatableStyleProperty(M){return!0}matchesElement(M,P){return!1}containsElement(M,P){return Mt(M,P)}getParentElement(M){return or(M)}query(M,P,U){return Ct(M,P,U)}computeStyle(M,P,U){return window.getComputedStyle(M)[P]}animate(M,P,U,ee,he,be=[]){const tt={duration:U,delay:ee,fill:0==ee?"both":"forwards"};he&&(tt.easing=he);const R=new Map,V=be.filter(_e=>_e instanceof Da);(function Ut(Z,M){return 0===Z||0===M})(U,ee)&&V.forEach(_e=>{_e.currentSnapshot.forEach((Fe,Ge)=>R.set(Ge,Fe))});let z=function nr(Z){return Z.length?Z[0]instanceof Map?Z:Z.map(M=>Xn(M)):[]}(P).map(_e=>sr(_e));z=function Jn(Z,M,P){if(P.size&&M.length){let U=M[0],ee=[];if(P.forEach((he,be)=>{U.has(be)||ee.push(be),U.set(be,he)}),ee.length)for(let he=1;he<M.length;he++){let be=M[he];ee.forEach(Ie=>be.set(Ie,Wi(Z,Ie)))}}return M}(M,z,R);const te=function Ea(Z,M){let P=null,U=null;return Array.isArray(M)&&M.length?(P=Ta(M[0]),M.length>1&&(U=Ta(M[M.length-1]))):M instanceof Map&&(P=Ta(M)),P||U?new Zs(Z,P,U):null}(M,z);return new Da(M,z,tt,te)}}var dr=Ee(6895);let kl=(()=>{class Z extends $e{constructor(P,U){super(),this._nextAnimationId=0,this._renderer=P.createRenderer(U.body,{id:"0",encapsulation:me.ifc.None,styles:[],data:{animation:[]}})}build(P){const U=this._nextAnimationId.toString();this._nextAnimationId++;const ee=Array.isArray(P)?pt(P):P;return Ms(this._renderer,null,U,"register",[ee]),new Ya(U,this._renderer)}}return Z.\u0275fac=function(P){return new(P||Z)(me.LFG(me.FYo),me.LFG(dr.K0))},Z.\u0275prov=me.Yz7({token:Z,factory:Z.\u0275fac}),Z})();class Ya extends c{constructor(M,P){super(),this._id=M,this._renderer=P}create(M,P){return new zi(this._id,M,P||{},this._renderer)}}class zi{constructor(M,P,U,ee){this.id=M,this.element=P,this._renderer=ee,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",U)}_listen(M,P){return this._renderer.listen(this.element,`@@${this.id}:${M}`,P)}_command(M,...P){return Ms(this._renderer,this.element,this.id,M,P)}onDone(M){this._listen("done",M)}onStart(M){this._listen("start",M)}onDestroy(M){this._listen("destroy",M)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(M){this._command("setPosition",M)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function Ms(Z,M,P,U,ee){return Z.setProperty(M,`@@${P}:${U}`,ee)}const ii="@.disabled";let Ol=(()=>{class Z{constructor(P,U,ee){this.delegate=P,this.engine=U,this._zone=ee,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),U.onRemovalComplete=(he,be)=>{const Ie=be?.parentNode(he);Ie&&be.removeChild(Ie,he)}}createRenderer(P,U){const he=this.delegate.createRenderer(P,U);if(!(P&&U&&U.data&&U.data.animation)){let V=this._rendererCache.get(he);return V||(V=new Ca("",he,this.engine,()=>this._rendererCache.delete(he)),this._rendererCache.set(he,V)),V}const be=U.id,Ie=U.id+"-"+this._currentId;this._currentId++,this.engine.register(Ie,P);const tt=V=>{Array.isArray(V)?V.forEach(tt):this.engine.registerTrigger(be,Ie,P,V.name,V)};return U.data.animation.forEach(tt),new Fl(this,Ie,he,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(P,U,ee){P>=0&&P<this._microtaskId?this._zone.run(()=>U(ee)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(he=>{const[be,Ie]=he;be(Ie)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([U,ee]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return Z.\u0275fac=function(P){return new(P||Z)(me.LFG(me.FYo),me.LFG(Ss),me.LFG(me.R0b))},Z.\u0275prov=me.Yz7({token:Z,factory:Z.\u0275fac}),Z})();class Ca{constructor(M,P,U,ee){this.namespaceId=M,this.delegate=P,this.engine=U,this._onDestroy=ee,this.destroyNode=this.delegate.destroyNode?he=>P.destroyNode(he):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(M,P){return this.delegate.createElement(M,P)}createComment(M){return this.delegate.createComment(M)}createText(M){return this.delegate.createText(M)}appendChild(M,P){this.delegate.appendChild(M,P),this.engine.onInsert(this.namespaceId,P,M,!1)}insertBefore(M,P,U,ee=!0){this.delegate.insertBefore(M,P,U),this.engine.onInsert(this.namespaceId,P,M,ee)}removeChild(M,P,U){this.engine.onRemove(this.namespaceId,P,this.delegate,U)}selectRootElement(M,P){return this.delegate.selectRootElement(M,P)}parentNode(M){return this.delegate.parentNode(M)}nextSibling(M){return this.delegate.nextSibling(M)}setAttribute(M,P,U,ee){this.delegate.setAttribute(M,P,U,ee)}removeAttribute(M,P,U){this.delegate.removeAttribute(M,P,U)}addClass(M,P){this.delegate.addClass(M,P)}removeClass(M,P){this.delegate.removeClass(M,P)}setStyle(M,P,U,ee){this.delegate.setStyle(M,P,U,ee)}removeStyle(M,P,U){this.delegate.removeStyle(M,P,U)}setProperty(M,P,U){"@"==P.charAt(0)&&P==ii?this.disableAnimations(M,!!U):this.delegate.setProperty(M,P,U)}setValue(M,P){this.delegate.setValue(M,P)}listen(M,P,U){return this.delegate.listen(M,P,U)}disableAnimations(M,P){this.engine.disableAnimations(M,P)}}class Fl extends Ca{constructor(M,P,U,ee,he){super(P,U,ee,he),this.factory=M,this.namespaceId=P}setProperty(M,P,U){"@"==P.charAt(0)?"."==P.charAt(1)&&P==ii?this.disableAnimations(M,U=void 0===U||!!U):this.engine.process(this.namespaceId,M,P.slice(1),U):this.delegate.setProperty(M,P,U)}listen(M,P,U){if("@"==P.charAt(0)){const ee=function la(Z){switch(Z){case"body":return document.body;case"document":return document;case"window":return window;default:return Z}}(M);let he=P.slice(1),be="";return"@"!=he.charAt(0)&&([he,be]=function zl(Z){const M=Z.indexOf(".");return[Z.substring(0,M),Z.slice(M+1)]}(he)),this.engine.listen(this.namespaceId,ee,he,be,Ie=>{this.factory.scheduleListenerCallback(Ie._data||-1,U,Ie)})}return this.delegate.listen(M,P,U)}}const Xs=[{provide:$e,useClass:kl},{provide:ts,useFactory:function hs(){return new Vs}},{provide:Ss,useClass:(()=>{class Z extends Ss{constructor(P,U,ee,he){super(P.body,U,ee)}ngOnDestroy(){this.flush()}}return Z.\u0275fac=function(P){return new(P||Z)(me.LFG(dr.K0),me.LFG(Y),me.LFG(ts),me.LFG(me.z2F))},Z.\u0275prov=me.Yz7({token:Z,factory:Z.\u0275fac}),Z})()},{provide:me.FYo,useFactory:function Ja(Z,M,P){return new Ol(Z,M,P)},deps:[W.se,Ss,me.R0b]}],Vi=[{provide:Y,useFactory:()=>new Rt},{provide:me.QbO,useValue:"BrowserAnimations"},...Xs],Nl=[{provide:Y,useClass:H},{provide:me.QbO,useValue:"NoopAnimations"},...Xs];let Qa=(()=>{class Z{static withConfig(P){return{ngModule:Z,providers:P.disableAnimations?Nl:Vi}}}return Z.\u0275fac=function(P){return new(P||Z)},Z.\u0275mod=me.oAB({type:Z}),Z.\u0275inj=me.cJS({providers:Vi,imports:[W.b2]}),Z})();var tl=Ee(6771);const gl=[{path:"",loadChildren:()=>Promise.resolve().then(Ee.bind(Ee,991)).then(Z=>Z.MainPageModule),pathMatch:"full"},{path:"forms",loadChildren:()=>Ee.e(129).then(Ee.bind(Ee,4129)).then(Z=>Z.FormsModule)},{path:"gifs",loadChildren:()=>Ee.e(506).then(Ee.bind(Ee,6506)).then(Z=>Z.GifsModule)},{path:"countries",loadChildren:()=>Promise.all([Ee.e(433),Ee.e(339)]).then(Ee.bind(Ee,1339)).then(Z=>Z.CountriesModule)},{path:"mapbox",loadChildren:()=>Ee.e(962).then(Ee.bind(Ee,5962)).then(Z=>Z.MapboxModule)},{path:"**",redirectTo:""}];let nl=(()=>{class Z{}return Z.\u0275fac=function(P){return new(P||Z)},Z.\u0275mod=me.oAB({type:Z}),Z.\u0275inj=me.cJS({imports:[tl.Bz.forRoot(gl),tl.Bz]}),Z})();var Ul=Ee(529),Sa=Ee(9898);let ca=(()=>{class Z{constructor(){this.title="Angular Apps"}ngOnInit(){Sa.accessToken="pk.eyJ1Ijoiby1wcmVjaWFkbyIsImEiOiJjbGRhYTVldTAwMDU3M3JraGI3b3hrdGoxIn0.UEYhQgk14jzCu76H9DMdmw"}}return Z.\u0275fac=function(P){return new(P||Z)},Z.\u0275cmp=me.Xpm({type:Z,selectors:[["app-root"]],decls:1,vars:0,template:function(P,U){1&P&&me._UZ(0,"router-outlet")},dependencies:[tl.lC]}),Z})();var ua=Ee(991);let Do=(()=>{class Z{}return Z.\u0275fac=function(P){return new(P||Z)},Z.\u0275mod=me.oAB({type:Z,bootstrap:[ca]}),Z.\u0275inj=me.cJS({imports:[W.b2,Qa,Ul.JF,nl,ua.MainPageModule]}),Z})();W.q6().bootstrapModule(Do).catch(Z=>console.error(Z))},9898:function(er){er.exports=function(){"use strict";var Ht,Ee,W;function me(c,Pe){if(Ht)if(Ee){var Jt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ht+")(sharedChunk); ("+Ee+")(sharedChunk); self.onerror = null;",Vt={};Ht(Vt),W=Pe(Vt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(W.workerUrl=window.URL.createObjectURL(new Blob([Jt],{type:"text/javascript"})))}else Ee=Pe;else Ht=Pe}return me(0,function(c){var Pe=typeof self<"u"?self:{},Jt="2.12.0";let Vt;const zt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Vt){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Vt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{Vt=t}}return Vt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},pt={supported:!1,testSupport:function(t){!$t&&ct&&(Kt?ut(t):yt=t)}};let yt,ct,$t=!1,Kt=!1;function ut(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ct),t.isContextLost())return;pt.supported=!0}catch{}t.deleteTexture(e),$t=!0}Pe.document&&(ct=Pe.document.createElement("img"),ct.onload=function(){yt&&ut(yt),yt=null,Kt=!0},ct.onerror=function(){$t=!0,yt=null},ct.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Bt="01";var cn=Wn;function Wn(t,e,n,s){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=s}Wn.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,s=0;s<8;s++){var u=this.sampleCurveX(n)-t;if(Math.abs(u)<e)return n;var f=this.sampleCurveDerivativeX(n);if(Math.abs(f)<1e-6)break;n-=u/f}var y=0,b=1;for(n=t,s=0;s<20&&(u=this.sampleCurveX(n),!(Math.abs(u-t)<e));s++)t>u?y=n:b=n,n=.5*(b-y)+y;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var st=tr;function tr(t,e){this.x=t,this.y=e}tr.prototype={clone:function(){return new tr(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(t,e){var n=Math.cos(t),s=Math.sin(t),u=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},tr.convert=function(t){return t instanceof tr?t:Array.isArray(t)?new tr(t[0],t[1]):t};const en=Math.PI/180,rn=180/Math.PI;function ht(t){return t*en}function un(t){return t*rn}const ur=[[0,0],[1,0],[1,1],[0,1]];function Dt(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Yt(t,e,n,s){const u=new cn(t,e,n,s);return function(f){return u.solve(f)}}const _t=Yt(.25,.1,.25,1);function gt(t,e,n){return Math.min(n,Math.max(e,t))}function dn(t,e,n){return(n=gt((n-t)/(e-t),0,1))*n*(3-2*n)}function Kn(t,e,n){const s=n-e,u=((t-e)%s+s)%s+e;return u===e?n:u}function hn(t,e,n){if(!t.length)return n(null,[]);let s=t.length;const u=new Array(t.length);let f=null;t.forEach((y,b)=>{e(y,(C,S)=>{C&&(f=C),u[b]=S,0==--s&&n(f,u)})})}function Br(t){const e=[];for(const n in t)e.push(t[n]);return e}function Ne(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}let ot=1;function xt(){return ot++}function Pt(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Ft(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function kt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Mn(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Bn(t,e){return-1!==t.indexOf(e,t.length-e.length)}function Ur(t,e,n){const s={};for(const u in t)s[u]=e.call(n||this,t[u],u,t);return s}function En(t,e,n){const s={};for(const u in t)e.call(n||this,t[u],u,t)&&(s[u]=t[u]);return s}function Rn(t){return Array.isArray(t)?t.map(Rn):"object"==typeof t&&t?Ur(t,Rn):t}const Yn={};function Un(t){Yn[t]||(typeof console<"u"&&console.warn(t),Yn[t]=!0)}function vr(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function tn(t){let e=0;for(let n,s,u=0,f=t.length,y=f-1;u<f;y=u++)n=t[u],s=t[y],e+=(s.x-n.x)*(n.y+s.y);return e}function Kr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ai(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,u,f)=>{const y=u||f;return e[s]=!y||y.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Ti=null;function Yr(t){if(null==Ti){const e=t.navigator?t.navigator.userAgent:null;Ti=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ti}function zo(t){try{const e=Pe[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function uo(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const xn="mapbox-tiles";let Lr,ho,Hi=500,vs=50;function fo(){try{return Pe.caches}catch{}}function Or(){fo()&&!Lr&&(Lr=Pe.caches.open(xn))}function No(t){const e=t.indexOf("?");if(e<0)return t;const s=function(u){const f=u.indexOf("?");return f>0?u.slice(f+1).split("&"):[]}(t).filter(u=>{const f=u.split("=");return"language"===f[0]||"worldview"===f[0]});return s.length?`${t.slice(0,e)}?${s.join("&")}`:t.slice(0,e)}let Er=1/0;const vt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(vt);class nn extends Error{constructor(e,n,s){401===n&&qi(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const br=Kr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Pe.location.protocol?Pe.parent:Pe).location.href,_r=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(br())&&!/^\w+:/.test(n))){if(Pe.fetch&&Pe.Request&&Pe.AbortController&&Pe.Request.prototype.hasOwnProperty("signal"))return function(s,u){const f=new Pe.AbortController,y=new Pe.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:br(),signal:f.signal});let b=!1,C=!1;const S=(L=y.url).indexOf("sku=")>0&&qi(L);var L;"json"===s.type&&y.headers.set("Accept","application/json");const F=(j,$,J)=>{if(C)return;if(j&&"SecurityError"!==j.message&&Un(j),$&&J)return B($);const ce=Date.now();Pe.fetch(y).then(ye=>{if(ye.ok){const Te=S?ye.clone():null;return B(ye,Te,ce)}return u(new nn(ye.statusText,ye.status,s.url))}).catch(ye=>{20!==ye.code&&u(new Error(ye.message))})},B=(j,$,J)=>{("arrayBuffer"===s.type?j.arrayBuffer():"json"===s.type?j.json():j.text()).then(ce=>{C||($&&J&&function(ye,Te,pe){if(Or(),!Lr)return;const we={status:Te.status,statusText:Te.statusText,headers:new Pe.Headers};Te.headers.forEach((Ke,qe)=>we.headers.set(qe,Ke));const Re=Ai(Te.headers.get("Cache-Control")||"");if(Re["no-store"])return;Re["max-age"]&&we.headers.set("Expires",new Date(pe+1e3*Re["max-age"]).toUTCString());const Me=we.headers.get("Expires");Me&&(new Date(Me).getTime()-pe<42e4||function(Ke,qe){if(void 0===ho)try{new Response(new ReadableStream),ho=!0}catch{ho=!1}ho?qe(Ke.body):Ke.blob().then(qe)}(Te,Ke=>{const qe=new Pe.Response(Ke,we);Or(),Lr&&Lr.then(lt=>lt.put(No(ye.url),qe)).catch(lt=>Un(lt.message))}))}(y,$,J),b=!0,u(null,ce,j.headers.get("Cache-Control"),j.headers.get("Expires")))}).catch(ce=>{C||u(new Error(ce.message))})};return S?function(j,$){if(Or(),!Lr)return $(null);const J=No(j.url);Lr.then(ce=>{ce.match(J).then(ye=>{const Te=function(pe){if(!pe)return!1;const we=new Date(pe.headers.get("Expires")||0),Re=Ai(pe.headers.get("Cache-Control")||"");return we>Date.now()&&!Re["no-cache"]}(ye);ce.delete(J),Te&&ce.put(J,ye.clone()),$(null,ye,Te)}).catch($)}).catch($)}(y,F):F(null,null),{cancel:()=>{C=!0,b||f.abort()}}}(t,e);if(Kr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(s,u){const f=new Pe.XMLHttpRequest;f.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(f.responseType="arraybuffer");for(const y in s.headers)f.setRequestHeader(y,s.headers[y]);return"json"===s.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===s.credentials,f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let y=f.response;if("json"===s.type)try{y=JSON.parse(f.response)}catch(b){return u(b)}u(null,y,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new nn(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(t,e)},Fr=function(t,e){return _r(Ne(t,{type:"arrayBuffer"}),e)};function Zr(t){const e=Pe.document.createElement("a");return e.href=t,e.protocol===Pe.document.location.protocol&&e.host===Pe.document.location.host}const hr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Yo,Ar;Yo=[],Ar=0;const Jo=function(t,e){if(pt.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ar>=zt.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Yo.push(f),f}Ar++;let n=!1;const s=()=>{if(!n)for(n=!0,Ar--;Yo.length&&Ar<zt.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Yo.shift(),{requestParameters:y,callback:b,cancelled:C}=f;C||(f.cancel=Jo(y,b).cancel)}},u=Fr(t,(f,y,b,C)=>{s(),f?e(f):y&&(Pe.createImageBitmap?function(S,L){const F=new Pe.Blob([new Uint8Array(S)],{type:"image/png"});Pe.createImageBitmap(F).then(B=>{L(null,B)}).catch(B=>{L(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(S,L)=>e(S,L,b,C)):function(S,L){const F=new Pe.Image,B=Pe.URL;F.onload=()=>{L(null,F),B.revokeObjectURL(F.src),F.onload=null,Pe.requestAnimationFrame(()=>{F.src=hr})},F.onerror=()=>L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new Pe.Blob([new Uint8Array(S)],{type:"image/png"});F.src=S.byteLength?B.createObjectURL(j):hr}(y,(S,L)=>e(S,L,b,C)))});return{cancel:()=>{u.cancel(),s()}}},or="NO_ACCESS_TOKEN";function Qi(t){return 0===t.indexOf("mapbox:")}function qi(t){return zt.API_URL_REGEX.test(t)}function eo(t){return zt.API_CDN_URL_REGEX.test(t)}function Di(t){return zt.API_STYLE_REGEX.test(t)&&!Xe(t)}function Xe(t){return zt.API_SPRITE_REGEX.test(t)}const Le=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Oe(t){const e=t.match(Le);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Mt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function Ct(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Pe.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ie{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Ct(zt.ACCESS_TOKEN);let s="";return s=n&&n.u?Pe.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(Number("0x"+f)))):zt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=zo("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const u=Pe.localStorage.getItem(n);u&&(this.eventData=JSON.parse(u));const f=Pe.localStorage.getItem(s);f&&(this.anonId=f)}catch{Un("Unable to read from LocalStorage")}}saveEventData(){const e=zo("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{Pe.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Pe.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Un("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,s,u){if(!zt.EVENTS_URL)return;const f=Oe(zt.EVENTS_URL);f.params.push(`access_token=${u||zt.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(e).toISOString()},b=n?Ne(y,n):y,C={url:Mt(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};var L;this.pendingRequest=(L=S=>{this.pendingRequest=null,s(S),this.saveEventData(),this.processRequests(u)},_r(Ne(C,{method:"POST"}),L))}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const H=new class extends ie{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){zt.EVENTS_URL&&zt.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>Qi(n)||qi(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ct(zt.ACCESS_TOKEN),n=e?e.u:zt.ACCESS_TOKEN;let s=n!==this.eventData.tokenU;kt(this.anonId)||(this.anonId=Pt(),s=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),y=new Date(u),b=(u-this.eventData.lastSuccess)/864e5;s=s||b>=1||b<-1||f.getDate()!==y.getDate()}else s=!0;s?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Jt,skuId:Bt,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=n)},t):this.processRequests()}},Y=H.postTurnstileEvent.bind(H),le=new class extends ie{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,s){this.skuToken=e,this.errorCb=s,zt.EVENTS_URL&&(n||zt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(or)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),kt(this.anonId)||(this.anonId=Pt()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Jt,skuId:Bt,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}},ge=le.postMapLoadEvent.bind(le),Ae=new class extends ie{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){zt.EVENTS_URL&&(t||zt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),s=function(u){const f=Pe.performance.getEntriesByType("resource"),y=Pe.performance.getEntriesByType("mark"),b=function(B){const j={};if(B)for(const $ in B)if("other"!==$)for(const J of B[$]){const ce=`${$}ResolveRangeMin`,ye=`${$}ResolveRangeMax`,Te=`${$}RequestCount`,pe=`${$}RequestCachedCount`;j[ce]=Math.min(j[ce]||1/0,J.startTime),j[ye]=Math.max(j[ye]||-1/0,J.responseEnd);const we=Re=>{void 0===j[Re]&&(j[Re]=0),++j[Re]};void 0!==J.transferSize&&0===J.transferSize&&we(pe),we(Te)}return j}(function(B,j){const $={};if(B)for(const J of B){const ce=j(J);void 0===$[ce]&&($[ce]=[]),$[ce].push(J)}return $}(f,Ue)),C=Pe.devicePixelRatio,S=Pe.navigator.connection||Pe.navigator.mozConnection||Pe.navigator.webkitConnection,L={counters:[],metadata:[],attributes:[]},F=(B,j,$)=>{null!=$&&B.push({name:j,value:$.toString()})};for(const B in b)F(L.counters,B,b[B]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(F(L.counters,"interactionRangeMin",u.interactionRange[0]),F(L.counters,"interactionRangeMax",u.interactionRange[1])),y)for(const B of Object.keys(De)){const j=De[B],$=y.find(J=>J.name===j);$&&F(L.counters,j,$.startTime)}return F(L.counters,"visibilityHidden",u.visibilityHidden),F(L.attributes,"style",function(B){if(B)for(const j of B){const $=j.name.split("?")[0];if(Di($)){const J=$.split("/").slice(-2);if(2===J.length)return`mapbox://styles/${J[0]}/${J[1]}`}}}(f)),F(L.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),F(L.attributes,"fogEnabled",u.fogEnabled?"true":"false"),F(L.attributes,"projection",u.projection),F(L.attributes,"zoom",u.zoom),F(L.metadata,"devicePixelRatio",C),F(L.metadata,"connectionEffectiveType",S?S.effectiveType:void 0),F(L.metadata,"navigatorUserAgent",Pe.navigator.userAgent),F(L.metadata,"screenWidth",Pe.screen.width),F(L.metadata,"screenHeight",Pe.screen.height),F(L.metadata,"windowWidth",Pe.innerWidth),F(L.metadata,"windowHeight",Pe.innerHeight),F(L.metadata,"mapWidth",u.width/C),F(L.metadata,"mapHeight",u.height/C),F(L.metadata,"webglRenderer",u.renderer),F(L.metadata,"webglVendor",u.vendor),F(L.metadata,"sdkVersion",Jt),F(L.metadata,"sdkIdentifier","mapbox-gl-js"),L}(n);for(const u of s.metadata);for(const u of s.counters);for(const u of s.attributes);this.postEvent(e,s,()=>{},t)}},ue=Ae.postPerformanceEvent.bind(Ae),ne=new class extends ie{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,s){if(!zt.API_URL||!zt.SESSION_PATH)return;const u=Oe(zt.API_URL+zt.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${s||zt.ACCESS_TOKEN||""}`);const f={url:Mt(u),headers:{"Content-Type":"text/plain"}};var b;this.pendingRequest=(b=y=>{this.pendingRequest=null,n(y),this.saveEventData(),this.processRequests(s)},_r(Ne(f,{method:"GET"}),b))}getSessionAPI(t,e,n,s){this.skuToken=e,this.errorCb=s,zt.SESSION_PATH&&zt.API_URL&&(n||zt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(or)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}},q=ne.getSessionAPI.bind(ne),ae=new Set,De={create:"create",load:"load",fullLoad:"fullLoad"},We={mark(t){Pe.performance.mark(t)},measure(t,e,n){Pe.performance.measure(t,e,n)}};function Ue(t){const e=t.name.split("?")[0];return eo(e)&&e.includes("mapbox-gl.js")?"javascript":eo(e)&&e.includes("mapbox-gl.css")?"css":zt.API_FONTS_REGEX.test(e)?"fontRange":Xe(e)?"sprite":Di(e)?"style":zt.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const bt=Pe.performance;function Wt(t){const e=t?t.url.toString():void 0;return bt.getEntriesByName(e)}let on,vn,Xn,nr;const fn={now:()=>void 0!==Xn?Xn:Pe.performance.now(),setNow(t){Xn=t},restoreNow(){Xn=void 0},frame(t){const e=Pe.requestAnimationFrame(t);return{cancel:()=>Pe.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:s}=t;nr||(nr=Pe.document.createElement("canvas"));const u=nr.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(n>nr.width||s>nr.height)&&(nr.width=n,nr.height=s),u.clearRect(-e,-e,n+2*e,s+2*e),u.drawImage(t,0,0,n,s),u.getImageData(-e,-e,n+2*e,s+2*e)},resolveURL:t=>(on||(on=Pe.document.createElement("a")),on.href=t,on.href),get devicePixelRatio(){return Pe.devicePixelRatio},get prefersReducedMotion(){return!!Pe.matchMedia&&(null==vn&&(vn=Pe.matchMedia("(prefers-reduced-motion: reduce)")),vn.matches)}};function sr(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Tr(t,e,n){if(n&&n[t]){const s=n[t].indexOf(e);-1!==s&&n[t].splice(s,1)}}class po{constructor(e,n={}){Ne(this,n),this.type=e}}class ji extends po{constructor(e,n={}){super("error",Ne({error:e},n))}}class jr{on(e,n){return this._listeners=this._listeners||{},sr(e,n,this._listeners),this}off(e,n){return Tr(e,n,this._listeners),Tr(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},sr(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){"string"==typeof e&&(e=new po(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const b of u)b.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const b of f)Tr(s,b,this._oneTimeListeners),b.call(this,e);const y=this._eventedParent;y&&(Ne(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof ji&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var it=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function rs(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}function Jr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Bo(t){if(Array.isArray(t))return t.map(Bo);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=Bo(t[n]);return e}return Jr(t)}class ra extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var jn=ra;class Qr{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,u]of n)this.bindings[s]=u}concat(e){return new Qr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var ui=Qr;const mi={kind:"null"},Ut={kind:"number"},Jn={kind:"string"},Dn={kind:"boolean"},Wi={kind:"color"},Ci={kind:"object"},Tt={kind:"value"},Hn={kind:"collator"},Pr={kind:"formatted"},ei={kind:"resolvedImage"};function ti(t,e){return{kind:"array",itemType:t,N:e}}function Qn(t){if("array"===t.kind){const e=Qn(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Pi=[mi,Ut,Jn,Dn,Wi,Pr,Ci,ti(Tt),ei];function Vr(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Vr(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const n of Pi)if(!Vr(n,e))return null}return`Expected ${Qn(t)} but found ${Qn(e)} instead.`}function xs(t,e){return e.some(n=>n.kind===t.kind)}function bo(t,e){return e.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}var An,Uo={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ri(t){return(t=Math.round(t))<0?0:t>255?255:t}function is(t){return Ri("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function hi(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function di(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{An={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Uo)return Uo[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=n.indexOf("("),u=n.indexOf(")");if(-1!==s&&u+1===n.length){var f=n.substr(0,s),y=n.substr(s+1,u-(s+1)).split(","),b=1;switch(f){case"rgba":if(4!==y.length)return null;b=hi(y.pop());case"rgb":return 3!==y.length?null:[is(y[0]),is(y[1]),is(y[2]),b];case"hsla":if(4!==y.length)return null;b=hi(y.pop());case"hsl":if(3!==y.length)return null;var C=(parseFloat(y[0])%360+360)%360/360,S=hi(y[1]),L=hi(y[2]),F=L<=.5?L*(S+1):L+S-L*S,B=2*L-F;return[Ri(255*di(B,F,C+1/3)),Ri(255*di(B,F,C)),Ri(255*di(B,F,C-1/3)),b];default:return null}}return null}}catch{}class Si{constructor(e,n,s,u=1){this.r=e,this.g=n,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof Si)return e;if("string"!=typeof e)return;const n=An(e);return n?new Si(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,s,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${u})`}toArray(){const{r:e,g:n,b:s,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*n/u,255*s/u,u]}toArray01(){const{r:e,g:n,b:s,a:u}=this;return 0===u?[0,0,0,0]:[e/u,n/u,s/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:s,a:u}=this;return[e,n,s,u]}}Si.black=new Si(0,0,0,1),Si.white=new Si(1,1,1,1),Si.transparent=new Si(0,0,0,0),Si.red=new Si(1,0,0,1),Si.blue=new Si(0,0,1,1);var kr=Si;class mo{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class js{constructor(e,n,s,u,f){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=s,this.fontStack=u,this.textColor=f}}class Li{constructor(e){this.sections=e}static fromString(e){return new Li([new js(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Li?e:Li.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(s)}return e}}class gr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new gr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ll(t,e,n,s){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[t,e,n,s]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wo(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof kr||t instanceof mo||t instanceof Li||t instanceof gr)return!0;if(Array.isArray(t)){for(const e of t)if(!wo(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!wo(t[e]))return!1;return!0}return!1}function ri(t){if(null===t)return mi;if("string"==typeof t)return Jn;if("boolean"==typeof t)return Dn;if("number"==typeof t)return Ut;if(t instanceof kr)return Wi;if(t instanceof mo)return Hn;if(t instanceof Li)return Pr;if(t instanceof gr)return ei;if(Array.isArray(t)){const e=t.length;let n;for(const s of t){const u=ri(s);if(n){if(n===u)continue;n=Tt;break}n=u}return ti(n||Tt,e)}return Ci}function Qo(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof kr||t instanceof Li||t instanceof gr?t.toString():JSON.stringify(t)}class os{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!wo(e[1]))return n.error("invalid value");const s=e[1];let u=ri(s);const f=n.expectedType;return"array"!==u.kind||0!==u.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(u=f),new os(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof kr?["rgba"].concat(this.value.toArray()):this.value instanceof Li?this.value.serialize():this.value}}var jo=os,Dr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const ga={string:Jn,number:Ut,boolean:Dn,object:Ci};class to{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,u=1;const f=e[0];if("array"===f){let b,C;if(e.length>2){const S=e[1];if("string"!=typeof S||!(S in ga)||"object"===S)return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=ga[S],u++}else b=Tt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);C=e[2],u++}s=ti(b,C)}else s=ga[f];const y=[];for(;u<e.length;u++){const b=n.parse(e[u],u,Tt);if(!b)return null;y.push(b)}return new to(s,y)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!Vr(this.type,ri(s)))return s;if(n===this.args.length-1)throw new Dr(`Expected value to be of type ${Qn(this.type)}, but found ${Qn(ri(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){n.push(s.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map(s=>s.serialize()))}}var vi=to;class ss{constructor(e){this.type=Pr,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return n.error("First argument must be an image or text section.");const u=[];let f=!1;for(let y=1;y<=e.length-1;++y){const b=e[y];if(f&&"object"==typeof b&&!Array.isArray(b)){f=!1;let C=null;if(b["font-scale"]&&(C=n.parse(b["font-scale"],1,Ut),!C))return null;let S=null;if(b["text-font"]&&(S=n.parse(b["text-font"],1,ti(Jn)),!S))return null;let L=null;if(b["text-color"]&&(L=n.parse(b["text-color"],1,Wi),!L))return null;const F=u[u.length-1];F.scale=C,F.font=S,F.textColor=L}else{const C=n.parse(e[y],1,Tt);if(!C)return null;const S=C.type.kind;if("string"!==S&&"value"!==S&&"null"!==S&&"resolvedImage"!==S)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:C,scale:null,font:null,textColor:null})}}return new ss(u)}evaluate(e){return new Li(this.sections.map(n=>{const s=n.content.evaluate(e);return ri(s)===ei?new js("",s,null,null,null):new js(Qo(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class as{constructor(e){this.type=ei,this.input=e}static parse(e,n){if(2!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,Jn);return s?new as(s):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),s=gr.fromString(n);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(n)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const es={"to-boolean":Dn,"to-color":Wi,"to-number":Ut,"to-string":Jn};class ki{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return n.error("Expected one argument.");const u=es[s],f=[];for(let y=1;y<e.length;y++){const b=n.parse(e[y],y,Tt);if(!b)return null;f.push(b)}return new ki(u,f)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let n,s;for(const u of this.args){if(n=u.evaluate(e),s=null,n instanceof kr)return n;if("string"==typeof n){const f=e.parseColor(n);if(f)return f}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ll(n[0],n[1],n[2],n[3]),!s))return new kr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Dr(s||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const s of this.args){if(n=s.evaluate(e),null===n)return 0;const u=Number(n);if(!isNaN(u))return u}throw new Dr(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?Li.fromString(Qo(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?gr.fromString(Qo(this.args[0].evaluate(e))):Qo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ss([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new as(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Oi=ki;const bs=["Unknown","Point","LineString","Polygon"];var ia=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?bs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(s*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=kr.parse(t)),e}};class ls{constructor(e,n,s,u){this.name=e,this.type=n,this._evaluate=s,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const s=e[0],u=ls.definitions[s];if(!u)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,y=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,b=y.filter(([S])=>!Array.isArray(S)||S.length===e.length-1);let C=null;for(const[S,L]of b){C=new Eo(n.registry,n.path,null,n.scope);const F=[];let B=!1;for(let j=1;j<e.length;j++){const $=e[j],J=Array.isArray(S)?S[j-1]:S.type,ce=C.parse($,1+F.length,J);if(!ce){B=!0;break}F.push(ce)}if(!B)if(Array.isArray(S)&&S.length!==F.length)C.error(`Expected ${S.length} arguments, but found ${F.length} instead.`);else{for(let j=0;j<F.length;j++){const $=Array.isArray(S)?S[j]:S.type,J=F[j];C.concat(j+1).checkSubtype($,J.type)}if(0===C.errors.length)return new ls(s,f,L,F)}}if(1===b.length)n.errors.push(...C.errors);else{const S=(b.length?b:y).map(([F])=>{return B=F,Array.isArray(B)?`(${B.map(Qn).join(", ")})`:`(${Qn(B.type)}...)`;var B}).join(" | "),L=[];for(let F=1;F<e.length;F++){const B=n.parse(e[F],1+L.length);if(!B)return null;L.push(Qn(B.type))}n.error(`Expected arguments of type ${S}, but found (${L.join(", ")}) instead.`)}return null}static register(e,n){ls.definitions=n;for(const s in n)e[s]=ls}}var _a=ls;class ts{constructor(e,n,s){this.type=Hn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return n.error("Collator options argument must be an object.");const u=n.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Dn);if(!u)return null;const f=n.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Dn);if(!f)return null;let y=null;return s.locale&&(y=n.parse(s.locale,1,Jn),!y)?null:new ts(u,f,y)}evaluate(e){return new mo(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Zi=8192;function Ha(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Vs(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function dl(t,e){const n=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*Zi),Math.round(s*u*Zi)]}function ya(t,e,n){const s=t[0]-e[0],u=t[1]-e[1],f=t[0]-n[0],y=t[1]-n[1];return s*y-f*u==0&&s*f<=0&&u*y<=0}function qa(t,e){let n=!1;for(let y=0,b=e.length;y<b;y++){const C=e[y];for(let S=0,L=C.length;S<L-1;S++){if(ya(t,C[S],C[S+1]))return!1;(u=C[S])[1]>(s=t)[1]!=(f=C[S+1])[1]>s[1]&&s[0]<(f[0]-u[0])*(s[1]-u[1])/(f[1]-u[1])+u[0]&&(n=!n)}}var s,u,f;return n}function ec(t,e){for(let n=0;n<e.length;n++)if(qa(t,e[n]))return!0;return!1}function Wa(t,e,n,s){const u=s[0]-n[0],f=s[1]-n[1],y=(t[0]-n[0])*f-u*(t[1]-n[1]),b=(e[0]-n[0])*f-u*(e[1]-n[1]);return y>0&&b<0||y<0&&b>0}function fl(t,e,n){for(const S of n)for(let L=0;L<S.length-1;++L)if((b=[(y=S[L+1])[0]-(f=S[L])[0],y[1]-f[1]])[0]*(C=[(u=e)[0]-(s=t)[0],u[1]-s[1]])[1]-b[1]*C[0]!=0&&Wa(s,u,f,y)&&Wa(f,y,s,u))return!0;var s,u,f,y,b,C;return!1}function va(t,e){for(let n=0;n<t.length;++n)if(!qa(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(fl(t[n],t[n+1],e))return!1;return!0}function pl(t,e){for(let n=0;n<e.length;n++)if(va(t,e[n]))return!0;return!1}function oa(t,e,n){const s=[];for(let u=0;u<t.length;u++){const f=[];for(let y=0;y<t[u].length;y++){const b=dl(t[u][y],n);Ha(e,b),f.push(b)}s.push(f)}return s}function xa(t,e,n){const s=[];for(let u=0;u<t.length;u++){const f=oa(t[u],e,n);s.push(f)}return s}function ws(t,e,n,s){if(t[0]<n[0]||t[0]>n[2]){const u=.5*s;let f=t[0]-n[0]>u?-s:n[0]-t[0]>u?s:0;0===f&&(f=t[0]-n[2]>u?-s:n[2]-t[0]>u?s:0),t[0]+=f}Ha(e,t)}function wr(t,e,n,s){const u=Math.pow(2,s.z)*Zi,f=[s.x*Zi,s.y*Zi],y=[];if(!t)return y;for(const b of t)for(const C of b){const S=[C.x+f[0],C.y+f[1]];ws(S,e,n,u),y.push(S)}return y}function cs(t,e,n,s){const u=Math.pow(2,s.z)*Zi,f=[s.x*Zi,s.y*Zi],y=[];if(!t)return y;for(const C of t){const S=[];for(const L of C){const F=[L.x+f[0],L.y+f[1]];Ha(e,F),S.push(F)}y.push(S)}if(e[2]-e[0]<=u/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const C of y)for(const S of C)ws(S,e,n,u)}var b;return y}class sa{constructor(e,n){this.type=Dn,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(wo(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let u=0;u<s.features.length;++u){const f=s.features[u].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new sa(s,s.features[u].geometry)}else if("Feature"===s.type){const u=s.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new sa(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new sa(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(n,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(!y)return!1;if("Polygon"===s.type){const b=oa(s.coordinates,f,y),C=wr(n.geometry(),u,f,y);if(!Vs(u,f))return!1;for(const S of C)if(!qa(S,b))return!1}if("MultiPolygon"===s.type){const b=xa(s.coordinates,f,y),C=wr(n.geometry(),u,f,y);if(!Vs(u,f))return!1;for(const S of C)if(!ec(S,b))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(n,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(!y)return!1;if("Polygon"===s.type){const b=oa(s.coordinates,f,y),C=cs(n.geometry(),u,f,y);if(!Vs(u,f))return!1;for(const S of C)if(!va(S,b))return!1}if("MultiPolygon"===s.type){const b=xa(s.coordinates,f,y),C=cs(n.geometry(),u,f,y);if(!Vs(u,f))return!1;for(const S of C)if(!pl(S,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var $s=sa;function Lo(t){if(t instanceof _a&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof $s)return!1;let e=!0;return t.eachChild(n=>{e&&!Lo(n)&&(e=!1)}),e}function Gs(t){if(t instanceof _a&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!Gs(n)&&(e=!1)}),e}function Hs(t,e){if(t instanceof _a&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(s=>{n&&!Hs(s,e)&&(n=!1)}),n}class ba{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new ba(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var qs=ba;class Ws{constructor(e,n=[],s,u=new ui,f=[]){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=u,this.errors=f,this.expectedType=s}parse(e,n,s,u,f={}){return n?this.concat(n,s,u)._parse(e,f):this._parse(e,f)}_parse(e,n){function s(u,f,y){return"assert"===y?new vi(f,[u]):"coerce"===y?new Oi(f,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let y=f.parse(e,this);if(!y)return null;if(this.expectedType){const b=this.expectedType,C=y.type;if("string"!==b.kind&&"number"!==b.kind&&"boolean"!==b.kind&&"object"!==b.kind&&"array"!==b.kind||"value"!==C.kind)if("color"!==b.kind&&"formatted"!==b.kind&&"resolvedImage"!==b.kind||"value"!==C.kind&&"string"!==C.kind){if(this.checkSubtype(b,C))return null}else y=s(y,b,n.typeAnnotation||"coerce");else y=s(y,b,n.typeAnnotation||"assert")}if(!(y instanceof jo)&&"resolvedImage"!==y.type.kind&&Xi(y)){const b=new ia;try{y=new jo(y.type,y.evaluate(b))}catch(C){return this.error(C.message),null}}return y}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const u="number"==typeof e?this.path.concat(e):this.path,f=s?this.scope.concat(s):this.scope;return new Ws(this.registry,u,n||null,f,this.errors)}error(e,...n){const s=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new jn(s,e))}checkSubtype(e,n){const s=Vr(e,n);return s&&this.error(s),s}}var Eo=Ws;function Xi(t){if(t instanceof qs)return Xi(t.boundExpression);if(t instanceof _a&&"error"===t.name||t instanceof ts||t instanceof $s)return!1;const e=t instanceof Oi||t instanceof vi;let n=!0;return t.eachChild(s=>{n=e?n&&Xi(s):n&&s instanceof jo}),!!n&&Lo(t)&&Hs(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ki(t,e){const n=t.length-1;let s,u,f=0,y=n,b=0;for(;f<=y;)if(b=Math.floor((f+y)/2),s=t[b],u=t[b+1],s<=e){if(b===n||e<u)return b;f=b+1}else{if(!(s>e))throw new Dr("Input is not a number.");y=b-1}return 0}class Es{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,f]of s)this.labels.push(u),this.outputs.push(f)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,Ut);if(!s)return null;const u=[];let f=null;n.expectedType&&"value"!==n.expectedType.kind&&(f=n.expectedType);for(let y=1;y<e.length;y+=2){const b=1===y?-1/0:e[y],C=e[y+1],S=y,L=y+1;if("number"!=typeof b)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(u.length&&u[u.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const F=n.parse(C,L,f);if(!F)return null;f=f||F.type,u.push([b,F])}return new Es(f,s,u)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return s[0].evaluate(e);const f=n.length;return u>=n[f-1]?s[f-1].evaluate(e):s[Ki(n,u)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var aa=Es;function Ln(t,e,n){return t*(1-n)+e*n}var Za=Object.freeze({__proto__:null,number:Ln,color:function(t,e,n){return new kr(Ln(t.r,e.r,n),Ln(t.g,e.g,n),Ln(t.b,e.b,n),Ln(t.a,e.a,n))},array:function(t,e,n){return t.map((s,u)=>Ln(s,e[u],n))}});const Ts=.95047,To=1.08883,wa=4/29,Mi=6/29,Ds=3*Mi*Mi,xi=Math.PI/180,tc=180/Math.PI;function Cs(t){return t>.008856451679035631?Math.pow(t,1/3):t/Ds+wa}function Yi(t){return t>Mi?t*t*t:Ds*(t-wa)}function Fi(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Xa(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ml(t){const e=Xa(t.r),n=Xa(t.g),s=Xa(t.b),u=Cs((.4124564*e+.3575761*n+.1804375*s)/Ts),f=Cs((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-Cs((.0193339*e+.119192*n+.9503041*s)/To)),alpha:t.a}}function Vn(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*Yi(e),n=Ts*Yi(n),s=To*Yi(s),new kr(Fi(3.2404542*n-1.5371385*e-.4985314*s),Fi(-.969266*n+1.8760108*e+.041556*s),Fi(.0556434*n-.2040259*e+1.0572252*s),t.alpha)}function $r(t,e,n){const s=e-t;return t+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const Ka={forward:ml,reverse:Vn,interpolate:function(t,e,n){return{l:Ln(t.l,e.l,n),a:Ln(t.a,e.a,n),b:Ln(t.b,e.b,n),alpha:Ln(t.alpha,e.alpha,n)}}},Ss={forward:function(t){const{l:e,a:n,b:s}=ml(t),u=Math.atan2(s,n)*tc;return{h:u<0?u+360:u,c:Math.sqrt(n*n+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*xi,n=t.c;return Vn({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:$r(t.h,e.h,n),c:Ln(t.c,e.c,n),l:Ln(t.l,e.l,n),alpha:Ln(t.alpha,e.alpha,n)}}};var Ea=Object.freeze({__proto__:null,lab:Ka,hcl:Ss});class Zs{constructor(e,n,s,u,f){this.type=e,this.operator=n,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[y,b]of f)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(e,n,s,u){let f=0;if("exponential"===e.name)f=Ta(n,e.base,s,u);else if("linear"===e.name)f=Ta(n,1,s,u);else if("cubic-bezier"===e.name){const y=e.controlPoints;f=new cn(y[0],y[1],y[2],y[3]).solve(Ta(n,1,s,u))}return f}static parse(e,n){let[s,u,f,...y]=e;if(!Array.isArray(u)||0===u.length)return n.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const S=u[1];if("number"!=typeof S)return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:S}}else{if("cubic-bezier"!==u[0])return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const S=u.slice(1);if(4!==S.length||S.some(L=>"number"!=typeof L||L<0||L>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(f=n.parse(f,2,Ut),!f)return null;const b=[];let C=null;"interpolate-hcl"===s||"interpolate-lab"===s?C=Wi:n.expectedType&&"value"!==n.expectedType.kind&&(C=n.expectedType);for(let S=0;S<y.length;S+=2){const L=y[S],F=y[S+1],B=S+3,j=S+4;if("number"!=typeof L)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(b.length&&b[b.length-1][0]>=L)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const $=n.parse(F,j,C);if(!$)return null;C=C||$.type,b.push([L,$])}return"number"===C.kind||"color"===C.kind||"array"===C.kind&&"number"===C.itemType.kind&&"number"==typeof C.N?new Zs(C,s,u,f,b):n.error(`Type ${Qn(C)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return s[0].evaluate(e);const f=n.length;if(u>=n[f-1])return s[f-1].evaluate(e);const y=Ki(n,u),b=Zs.interpolationFactor(this.interpolation,u,n[y],n[y+1]),C=s[y].evaluate(e),S=s[y+1].evaluate(e);return"interpolate"===this.operator?Za[this.type.kind.toLowerCase()](C,S,b):"interpolate-hcl"===this.operator?Ss.reverse(Ss.interpolate(Ss.forward(C),Ss.forward(S),b)):Ka.reverse(Ka.interpolate(Ka.forward(C),Ka.forward(S),b))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function Ta(t,e,n,s){const u=s-n,f=t-n;return 0===u?0:1===e?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}var us=Zs;class Da{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const u=n.expectedType;u&&"value"!==u.kind&&(s=u);const f=[];for(const b of e.slice(1)){const C=n.parse(b,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!C)return null;s=s||C.type,f.push(C)}const y=u&&f.some(b=>Vr(u,b.type));return new Da(y?Tt:s,f)}evaluate(e){let n,s=null,u=0;for(const f of this.args){if(u++,s=f.evaluate(e),s&&s instanceof gr&&!s.available&&(n||(n=s),s=null,u===this.args.length))return n;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Rt=Da;class dr{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let f=1;f<e.length-1;f+=2){const y=e[f];if("string"!=typeof y)return n.error(`Expected string, but found ${typeof y} instead.`,f);if(/[^a-zA-Z0-9_]/.test(y))return n.error("Variable names must contain only alphanumeric characters or '_'.",f);const b=n.parse(e[f+1],f+1);if(!b)return null;s.push([y,b])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return u?new dr(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}var kl=dr;class Ya{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Ut),u=n.parse(e[2],2,ti(n.expectedType||Tt));return s&&u?new Ya(u.type.itemType,s,u):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new Dr(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new Dr(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new Dr(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var zi=Ya;class Ms{constructor(e,n){this.type=Dn,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Tt),u=n.parse(e[2],2,Tt);return s&&u?xs(s.type,[Dn,Jn,Ut,mi,Tt])?new Ms(s,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!bo(n,["boolean","string","number","null"]))throw new Dr(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(ri(n))} instead.`);if(!bo(s,["string","array"]))throw new Dr(`Expected second argument to be of type array or string, but found ${Qn(ri(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var go=Ms;class ii{constructor(e,n,s){this.type=Ut,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Tt),u=n.parse(e[2],2,Tt);if(!s||!u)return null;if(!xs(s.type,[Dn,Jn,Ut,mi,Tt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(s.type)} instead`);if(4===e.length){const f=n.parse(e[3],3,Ut);return f?new ii(s,u,f):null}return new ii(s,u)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!bo(n,["boolean","string","number","null"]))throw new Dr(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(ri(n))} instead.`);if(!bo(s,["string","array"]))throw new Dr(`Expected second argument to be of type array or string, but found ${Qn(ri(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(n,u)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ol=ii;class Ca{constructor(e,n,s,u,f,y){this.inputType=e,this.type=n,this.input=s,this.cases=u,this.outputs=f,this.otherwise=y}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,u;n.expectedType&&"value"!==n.expectedType.kind&&(u=n.expectedType);const f={},y=[];for(let S=2;S<e.length-1;S+=2){let L=e[S];const F=e[S+1];Array.isArray(L)||(L=[L]);const B=n.concat(S);if(0===L.length)return B.error("Expected at least one branch label.");for(const $ of L){if("number"!=typeof $&&"string"!=typeof $)return B.error("Branch labels must be numbers or strings.");if("number"==typeof $&&Math.abs($)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof $&&Math.floor($)!==$)return B.error("Numeric branch labels must be integer values.");if(s){if(B.checkSubtype(s,ri($)))return null}else s=ri($);if(void 0!==f[String($)])return B.error("Branch labels must be unique.");f[String($)]=y.length}const j=n.parse(F,S,u);if(!j)return null;u=u||j.type,y.push(j)}const b=n.parse(e[1],1,Tt);if(!b)return null;const C=n.parse(e[e.length-1],e.length-1,u);return C?"value"!==b.type.kind&&n.concat(1).checkSubtype(s,b.type)?null:new Ca(s,u,b,f,y,C):null}evaluate(e){const n=this.input.evaluate(e);return(ri(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],u={};for(const y of n){const b=u[this.cases[y]];void 0===b?(u[this.cases[y]]=s.length,s.push([this.cases[y],[y]])):s[b][1].push(y)}const f=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,b]of s)e.push(1===b.length?f(b[0]):b.map(f)),e.push(this.outputs[y].serialize());return e.push(this.otherwise.serialize()),e}}var Fl=Ca;class la{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&"value"!==n.expectedType.kind&&(s=n.expectedType);const u=[];for(let y=1;y<e.length-1;y+=2){const b=n.parse(e[y],y,Dn);if(!b)return null;const C=n.parse(e[y+1],y+1,s);if(!C)return null;u.push([b,C]),s=s||C.type}const f=n.parse(e[e.length-1],e.length-1,s);return f?new la(s,u,f):null}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var zl=la;class Ni{constructor(e,n,s,u){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Tt),u=n.parse(e[2],2,Ut);if(!s||!u)return null;if(!xs(s.type,[ti(Tt),Jn,Tt]))return n.error(`Expected first argument to be of type array or string, but found ${Qn(s.type)} instead`);if(4===e.length){const f=n.parse(e[3],3,Ut);return f?new Ni(s.type,s,u,f):null}return new Ni(s.type,s,u)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!bo(n,["string","array"]))throw new Dr(`Expected first argument to be of type array or string, but found ${Qn(ri(n))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return n.slice(s,u)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var hs=Ni;function Ja(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Xs(t,e,n,s){return 0===s.compare(e,n)}function Vi(t,e,n){const s="=="!==t&&"!="!==t;return class $0{constructor(f,y,b){this.type=Dn,this.lhs=f,this.rhs=y,this.collator=b,this.hasUntypedArgument="value"===f.type.kind||"value"===y.type.kind}static parse(f,y){if(3!==f.length&&4!==f.length)return y.error("Expected two or three arguments.");const b=f[0];let C=y.parse(f[1],1,Tt);if(!C)return null;if(!Ja(b,C.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${Qn(C.type)}'.`);let S=y.parse(f[2],2,Tt);if(!S)return null;if(!Ja(b,S.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${Qn(S.type)}'.`);if(C.type.kind!==S.type.kind&&"value"!==C.type.kind&&"value"!==S.type.kind)return y.error(`Cannot compare types '${Qn(C.type)}' and '${Qn(S.type)}'.`);s&&("value"===C.type.kind&&"value"!==S.type.kind?C=new vi(S.type,[C]):"value"!==C.type.kind&&"value"===S.type.kind&&(S=new vi(C.type,[S])));let L=null;if(4===f.length){if("string"!==C.type.kind&&"string"!==S.type.kind&&"value"!==C.type.kind&&"value"!==S.type.kind)return y.error("Cannot use collator to compare non-string types.");if(L=y.parse(f[3],3,Hn),!L)return null}return new $0(C,S,L)}evaluate(f){const y=this.lhs.evaluate(f),b=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const C=ri(y),S=ri(b);if(C.kind!==S.kind||"string"!==C.kind&&"number"!==C.kind)throw new Dr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${C.kind}, ${S.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const C=ri(y),S=ri(b);if("string"!==C.kind||"string"!==S.kind)return e(f,y,b)}return this.collator?n(f,y,b,this.collator.evaluate(f)):e(f,y,b)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[t];return this.eachChild(y=>{f.push(y.serialize())}),f}}}const Nl=Vi("==",function(t,e,n){return e===n},Xs),Qa=Vi("!=",function(t,e,n){return e!==n},function(t,e,n,s){return!Xs(0,e,n,s)}),Bl=Vi("<",function(t,e,n){return e<n},function(t,e,n,s){return s.compare(e,n)<0}),nc=Vi(">",function(t,e,n){return e>n},function(t,e,n,s){return s.compare(e,n)>0}),el=Vi("<=",function(t,e,n){return e<=n},function(t,e,n,s){return s.compare(e,n)<=0}),tl=Vi(">=",function(t,e,n){return e>=n},function(t,e,n,s){return s.compare(e,n)>=0});class gl{constructor(e,n,s,u,f,y){this.type=Jn,this.number=e,this.locale=n,this.currency=s,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=y}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,Ut);if(!s)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=n.parse(u.locale,1,Jn),!f))return null;let y=null;if(u.currency&&(y=n.parse(u.currency,1,Jn),!y))return null;let b=null;if(u.unit&&(b=n.parse(u.unit,1,Jn),!b))return null;let C=null;if(u["min-fraction-digits"]&&(C=n.parse(u["min-fraction-digits"],1,Ut),!C))return null;let S=null;return u["max-fraction-digits"]&&(S=n.parse(u["max-fraction-digits"],1,Ut),!S)?null:new gl(s,f,y,b,C,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class nl{constructor(e){this.type=Ut,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?n.error(`Expected argument of type string or array, but found ${Qn(s.type)} instead.`):new nl(s):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n||Array.isArray(n))return n.length;throw new Dr(`Expected value to be of type string or array, but found ${Qn(ri(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Ul={"==":Nl,"!=":Qa,">":nc,"<":Bl,">=":tl,"<=":el,array:vi,at:zi,boolean:vi,case:zl,coalesce:Rt,collator:ts,format:ss,image:as,in:go,"index-of":Ol,interpolate:us,"interpolate-hcl":us,"interpolate-lab":us,length:nl,let:kl,literal:jo,match:Fl,number:vi,"number-format":gl,object:vi,slice:hs,step:aa,string:vi,"to-boolean":Oi,"to-color":Oi,"to-number":Oi,"to-string":Oi,var:qs,within:$s};function Sa(t,[e,n,s,u]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);const f=u?u.evaluate(t):1,y=Ll(e,n,s,f);if(y)throw new Dr(y);return new kr(e/255*f,n/255*f,s/255*f,f)}function ca(t,e){return t in e}function ua(t,e){const n=e[t];return void 0===n?null:n}function Do(t){return{type:t}}_a.register(Ul,{error:[{kind:"error"},[Jn],(t,[e])=>{throw new Dr(e.evaluate(t))}],typeof:[Jn,[Tt],(t,[e])=>Qn(ri(e.evaluate(t)))],"to-rgba":[ti(Ut,4),[Wi],(t,[e])=>e.evaluate(t).toArray()],rgb:[Wi,[Ut,Ut,Ut],Sa],rgba:[Wi,[Ut,Ut,Ut,Ut],Sa],has:{type:Dn,overloads:[[[Jn],(t,[e])=>ca(e.evaluate(t),t.properties())],[[Jn,Ci],(t,[e,n])=>ca(e.evaluate(t),n.evaluate(t))]]},get:{type:Tt,overloads:[[[Jn],(t,[e])=>ua(e.evaluate(t),t.properties())],[[Jn,Ci],(t,[e,n])=>ua(e.evaluate(t),n.evaluate(t))]]},"feature-state":[Tt,[Jn],(t,[e])=>ua(e.evaluate(t),t.featureState||{})],properties:[Ci,[],t=>t.properties()],"geometry-type":[Jn,[],t=>t.geometryType()],id:[Tt,[],t=>t.id()],zoom:[Ut,[],t=>t.globals.zoom],pitch:[Ut,[],t=>t.globals.pitch||0],"distance-from-center":[Ut,[],t=>t.distanceFromCenter()],"heatmap-density":[Ut,[],t=>t.globals.heatmapDensity||0],"line-progress":[Ut,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Ut,[],t=>t.globals.skyRadialProgress||0],accumulated:[Tt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Ut,Do(Ut),(t,e)=>{let n=0;for(const s of e)n+=s.evaluate(t);return n}],"*":[Ut,Do(Ut),(t,e)=>{let n=1;for(const s of e)n*=s.evaluate(t);return n}],"-":{type:Ut,overloads:[[[Ut,Ut],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Ut],(t,[e])=>-e.evaluate(t)]]},"/":[Ut,[Ut,Ut],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Ut,[Ut,Ut],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Ut,[],()=>Math.LN2],pi:[Ut,[],()=>Math.PI],e:[Ut,[],()=>Math.E],"^":[Ut,[Ut,Ut],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Ut,[Ut],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Ut,[Ut],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Ut,[Ut],(t,[e])=>Math.log(e.evaluate(t))],log2:[Ut,[Ut],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Ut,[Ut],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Ut,[Ut],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Ut,[Ut],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Ut,[Ut],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Ut,[Ut],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Ut,[Ut],(t,[e])=>Math.atan(e.evaluate(t))],min:[Ut,Do(Ut),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[Ut,Do(Ut),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[Ut,[Ut],(t,[e])=>Math.abs(e.evaluate(t))],round:[Ut,[Ut],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ut,[Ut],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Ut,[Ut],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Dn,[Jn,Tt],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Dn,[Tt],(t,[e])=>t.id()===e.value],"filter-type-==":[Dn,[Jn],(t,[e])=>t.geometryType()===e.value],"filter-<":[Dn,[Jn,Tt],(t,[e,n])=>{const s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s<u}],"filter-id-<":[Dn,[Tt],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[Dn,[Jn,Tt],(t,[e,n])=>{const s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s>u}],"filter-id->":[Dn,[Tt],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[Dn,[Jn,Tt],(t,[e,n])=>{const s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[Dn,[Tt],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[Dn,[Jn,Tt],(t,[e,n])=>{const s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[Dn,[Tt],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[Dn,[Tt],(t,[e])=>e.value in t.properties()],"filter-has-id":[Dn,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Dn,[ti(Jn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Dn,[ti(Tt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Dn,[Jn,ti(Tt)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Dn,[Jn,ti(Tt)],(t,[e,n])=>function(s,u,f,y){for(;f<=y;){const b=f+y>>1;if(u[b]===s)return!0;u[b]>s?y=b-1:f=b+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Dn,overloads:[[[Dn,Dn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Do(Dn),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Dn,overloads:[[[Dn,Dn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Do(Dn),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Dn,[Dn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Dn,[Jn],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Jn,[Jn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Jn,[Jn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Jn,Do(Tt),(t,e)=>e.map(n=>Qo(n.evaluate(t))).join("")],"resolved-locale":[Jn,[Hn],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Z=Ul;function M(t){return{result:"success",value:t}}function P(t){return{result:"error",value:t}}function U(t){return"data-driven"===t["property-type"]}function ee(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function he(t){return!!t.expression&&t.expression.interpolated}function be(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Ie(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function tt(t){return t}function R(t,e){const n="color"===e.type,s=t.stops&&"object"==typeof t.stops[0][0],u=s||!(s||void 0!==t.property),f=t.type||(he(e)?"exponential":"interval");if(n&&((t=rs({},t)).stops&&(t.stops=t.stops.map(S=>[S[0],kr.parse(S[1])])),t.default=kr.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Ea[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let y,b,C;if("exponential"===f)y=_e;else if("interval"===f)y=te;else if("categorical"===f){y=z,b=Object.create(null);for(const S of t.stops)b[S[0]]=S[1];C=typeof t.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);y=Fe}if(s){const S={},L=[];for(let j=0;j<t.stops.length;j++){const $=t.stops[j],J=$[0].zoom;void 0===S[J]&&(S[J]={zoom:J,type:t.type,property:t.property,default:t.default,stops:[]},L.push(J)),S[J].stops.push([$[0].value,$[1]])}const F=[];for(const j of L)F.push([S[j].zoom,R(S[j],e)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:us.interpolationFactor.bind(void 0,B),zoomStops:F.map(j=>j[0]),evaluate:({zoom:j},$)=>_e({stops:F,base:t.base},e,j).evaluate(j,$)}}if(u){const S="exponential"===f?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:us.interpolationFactor.bind(void 0,S),zoomStops:t.stops.map(L=>L[0]),evaluate:({zoom:L})=>y(t,e,L,b,C)}}return{kind:"source",evaluate(S,L){const F=L&&L.properties?L.properties[t.property]:void 0;return void 0===F?V(t.default,e.default):y(t,e,F,b,C)}}}function V(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function z(t,e,n,s,u){return V(typeof n===u?s[n]:void 0,t.default,e.default)}function te(t,e,n){if("number"!==be(n))return V(t.default,e.default);const s=t.stops.length;if(1===s||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];const u=Ki(t.stops.map(f=>f[0]),n);return t.stops[u][1]}function _e(t,e,n){const s=void 0!==t.base?t.base:1;if("number"!==be(n))return V(t.default,e.default);const u=t.stops.length;if(1===u||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[u-1][0])return t.stops[u-1][1];const f=Ki(t.stops.map(L=>L[0]),n),y=function(L,F,B,j){const $=j-B,J=L-B;return 0===$?0:1===F?J/$:(Math.pow(F,J)-1)/(Math.pow(F,$)-1)}(n,s,t.stops[f][0],t.stops[f+1][0]),b=t.stops[f][1],C=t.stops[f+1][1];let S=Za[e.type]||tt;if(t.colorSpace&&"rgb"!==t.colorSpace){const L=Ea[t.colorSpace];S=(F,B)=>L.reverse(L.interpolate(L.forward(F),L.forward(B),y))}return"function"==typeof b.evaluate?{evaluate(...L){const F=b.evaluate.apply(void 0,L),B=C.evaluate.apply(void 0,L);if(void 0!==F&&void 0!==B)return S(F,B,y)}}:S(b,C,y)}function Fe(t,e,n){return"color"===e.type?n=kr.parse(n):"formatted"===e.type?n=Li.fromString(n.toString()):"resolvedImage"===e.type?n=gr.fromString(n.toString()):be(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),V(n,t.default,e.default)}class Ge{constructor(e,n){var s;this.expression=e,this._warningHistory={},this._evaluator=new ia,this._defaultValue=n?"color"===(s=n).type&&(Ie(s.default)||Array.isArray(s.default))?new kr(0,0,0,0):"color"===s.type?kr.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,s,u,f,y,b,C){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,u,f,y,b,C){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=C||null;try{const S=this.expression.evaluate(this._evaluator);if(null==S||"number"==typeof S&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Dr(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function jt(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Z}function bn(t,e){const n=new Eo(Z,[],e?function(u){const f={color:Wi,string:Jn,number:Ut,enum:Jn,boolean:Dn,formatted:Pr,resolvedImage:ei};return"array"===u.type?ti(f[u.value]||Tt,u.length):f[u.type]}(e):void 0),s=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?M(new Ge(s,e)):P(n.errors)}class zn{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent="constant"!==e&&!Gs(n.expression)}evaluateWithoutErrorHandling(e,n,s,u,f,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,u,f,y)}evaluate(e,n,s,u,f,y){return this._styleExpression.evaluate(e,n,s,u,f,y)}}class $n{constructor(e,n,s,u){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent="camera"!==e&&!Gs(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,s,u,f,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,u,f,y)}evaluate(e,n,s,u,f,y){return this._styleExpression.evaluate(e,n,s,u,f,y)}interpolationFactor(e,n,s){return this.interpolationType?us.interpolationFactor(this.interpolationType,e,n,s):0}}function wn(t,e){if("error"===(t=bn(t,e)).result)return t;const n=t.value.expression,s=Lo(n);if(!s&&!U(e))return P([new jn("","data expressions not supported")]);const u=Hs(n,["zoom","pitch","distance-from-center"]);if(!u&&!ee(e))return P([new jn("","zoom expressions not supported")]);const f=rr(n);return f||u?f instanceof jn?P([f]):f instanceof us&&!he(e)?P([new jn("",'"interpolate" expressions cannot be used with this property')]):M(f?new $n(s?"camera":"composite",t.value,f.labels,f instanceof us?f.interpolation:void 0):new zn(s?"constant":"source",t.value)):P([new jn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class xr{constructor(e,n){this._parameters=e,this._specification=n,rs(this,R(this._parameters,this._specification))}static deserialize(e){return new xr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function rr(t){let e=null;if(t instanceof kl)e=rr(t.result);else if(t instanceof Rt){for(const n of t.args)if(e=rr(n),e)break}else(t instanceof aa||t instanceof us)&&t.input instanceof _a&&"zoom"===t.input.name&&(e=t);return e instanceof jn||t.eachChild(n=>{const s=rr(n);s instanceof jn?e=s:!e&&s?e=new jn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new jn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Et{constructor(e,n,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),null!=n&&n.__line__&&(this.line=n.__line__)}}function Rr(t){const e=t.key,n=t.value,s=t.valueSpec||{},u=t.objectElementValidators||{},f=t.style,y=t.styleSpec;let b=[];const C=be(n);if("object"!==C)return[new Et(e,n,`object expected, ${C} found`)];for(const S in n){const L=S.split(".")[0];let B;u[L]?B=u[L]:s[L]?B=io:u["*"]?B=u["*"]:s["*"]&&(B=io),B?b=b.concat(B({key:(e&&`${e}.`)+S,value:n[S],valueSpec:s[L]||s["*"],style:f,styleSpec:y,object:n,objectKey:S},n)):b.push(new Et(e,n[S],`unknown property "${S}"`))}for(const S in s)u[S]||s[S].required&&void 0===s[S].default&&void 0===n[S]&&b.push(new Et(e,n,`missing required property "${S}"`));return b}function bi(t){const e=t.value,n=t.valueSpec,s=t.style,u=t.styleSpec,f=t.key,y=t.arrayElementValidator||io;if("array"!==be(e))return[new Et(f,e,`array expected, ${be(e)} found`)];if(n.length&&e.length!==n.length)return[new Et(f,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Et(f,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let b={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};u.$version<7&&(b.function=n.function),"object"===be(n.value)&&(b=n.value);let C=[];for(let S=0;S<e.length;S++)C=C.concat(y({array:e,arrayIndex:S,value:e[S],valueSpec:b,style:s,styleSpec:u,key:`${f}[${S}]`}));return C}function no(t){const e=t.key,n=t.value,s=t.valueSpec;let u=be(n);if("number"===u&&n!=n&&(u="NaN"),"number"!==u)return[new Et(e,n,`number expected, ${u} found`)];if("minimum"in s){let f=s.minimum;if("array"===be(s.minimum)&&(f=s.minimum[t.arrayIndex]),n<f)return[new Et(e,n,`${n} is less than the minimum value ${f}`)]}if("maximum"in s){let f=s.maximum;if("array"===be(s.maximum)&&(f=s.maximum[t.arrayIndex]),n>f)return[new Et(e,n,`${n} is greater than the maximum value ${f}`)]}return[]}function Co(t){const e=t.valueSpec,n=Jr(t.value.type);let s,u,f,y={};const b="categorical"!==n&&void 0===t.value.property,C=!b,S="array"===be(t.value.stops)&&"array"===be(t.value.stops[0])&&"object"===be(t.value.stops[0][0]),L=Rr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(j){if("identity"===n)return[new Et(j.key,j.value,'identity function may not have a "stops" property')];let $=[];const J=j.value;return $=$.concat(bi({key:j.key,value:J,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:F})),"array"===be(J)&&0===J.length&&$.push(new Et(j.key,J,"array must have at least one stop")),$},default:function(j){return io({key:j.key,value:j.value,valueSpec:e,style:j.style,styleSpec:j.styleSpec})}}});return"identity"===n&&b&&L.push(new Et(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||L.push(new Et(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!he(t.valueSpec)&&L.push(new Et(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(C&&!U(t.valueSpec)?L.push(new Et(t.key,t.value,"property functions not supported")):b&&!ee(t.valueSpec)&&L.push(new Et(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!S||void 0!==t.value.property||L.push(new Et(t.key,t.value,'"property" property is required')),L;function F(j){let $=[];const J=j.value,ce=j.key;if("array"!==be(J))return[new Et(ce,J,`array expected, ${be(J)} found`)];if(2!==J.length)return[new Et(ce,J,`array length 2 expected, length ${J.length} found`)];if(S){if("object"!==be(J[0]))return[new Et(ce,J,`object expected, ${be(J[0])} found`)];if(void 0===J[0].zoom)return[new Et(ce,J,"object stop key must have zoom")];if(void 0===J[0].value)return[new Et(ce,J,"object stop key must have value")];const ye=Jr(J[0].zoom);if("number"!=typeof ye)return[new Et(ce,J[0].zoom,"stop zoom values must be numbers")];if(f&&f>ye)return[new Et(ce,J[0].zoom,"stop zoom values must appear in ascending order")];ye!==f&&(f=ye,u=void 0,y={}),$=$.concat(Rr({key:`${ce}[0]`,value:J[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:no,value:B}}))}else $=$.concat(B({key:`${ce}[0]`,value:J[0],valueSpec:{},style:j.style,styleSpec:j.styleSpec},J));return jt(Bo(J[1]))?$.concat([new Et(`${ce}[1]`,J[1],"expressions are not allowed in function stops.")]):$.concat(io({key:`${ce}[1]`,value:J[1],valueSpec:e,style:j.style,styleSpec:j.styleSpec}))}function B(j,$){const J=be(j.value),ce=Jr(j.value),ye=null!==j.value?j.value:$;if(s){if(J!==s)return[new Et(j.key,ye,`${J} stop domain type must match previous stop domain type ${s}`)]}else s=J;if("number"!==J&&"string"!==J&&"boolean"!==J&&"number"!=typeof ce&&"string"!=typeof ce&&"boolean"!=typeof ce)return[new Et(j.key,ye,"stop domain value must be a number, string, or boolean")];if("number"!==J&&"categorical"!==n){let Te=`number expected, ${J} found`;return U(e)&&void 0===n&&(Te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Et(j.key,ye,Te)]}return"categorical"!==n||"number"!==J||"number"==typeof ce&&isFinite(ce)&&Math.floor(ce)===ce?"categorical"!==n&&"number"===J&&"number"==typeof ce&&"number"==typeof u&&void 0!==u&&ce<u?[new Et(j.key,ye,"stop domain values must appear in ascending order")]:(u=ce,"categorical"===n&&ce in y?[new Et(j.key,ye,"stop domain values must be unique")]:(y[ce]=!0,[])):[new Et(j.key,ye,`integer expected, found ${String(ce)}`)]}}function ro(t){const e=("property"===t.expressionContext?wn:bn)(Bo(t.value),t.valueSpec);if("error"===e.result)return e.value.map(s=>new Et(`${t.key}${s.key}`,t.value,s.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new Et(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Gs(n))return[new Et(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return So(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Hs(n,["zoom","feature-state"]))return[new Et(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Lo(n))return[new Et(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function So(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)n.delete(u);if(0===n.size)return[];const s=[];return t instanceof _a&&n.has(t.name)?[new Et(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(u=>{s.push(...So(u,e))}),s)}function Mo(t){const e=t.key,n=t.value,s=t.valueSpec,u=[];return Array.isArray(s.values)?-1===s.values.indexOf(Jr(n))&&u.push(new Et(e,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(s.values).indexOf(Jr(n))&&u.push(new Et(e,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function Is(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Is(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function gn(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Is(t)||(t=_o(t));const n=t;let s=!0;try{s=function(S){if(!fr(S))return S;let L=Bo(S);return kn(L),L=ln(L),L}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const u=it[`filter_${e}`],f=bn(s,u);let y=null;if("error"===f.result)throw new Error(f.value.map(S=>`${S.key}: ${S.message}`).join(", "));y=(S,L,F)=>f.value.evaluate(S,L,{},F);let b=null,C=null;if(s!==n){const S=bn(n,u);if("error"===S.result)throw new Error(S.value.map(L=>`${L.key}: ${L.message}`).join(", "));b=(L,F,B,j,$)=>S.value.evaluate(L,F,{},B,void 0,void 0,j,$),C=!Lo(S.value.expression)}return{filter:y,dynamicFilter:b||void 0,needGeometry:Bi(s),needFeature:!!C}}function ln(t){if(!Array.isArray(t))return t;const e=function(n){if(wi.has(n[0]))for(let s=1;s<n.length;s++)if(fr(n[s]))return!0;return n}(t);return!0===e?e:e.map(n=>ln(n))}function kn(t){let e=!1;const n=[];if("case"===t[0]){for(let s=1;s<t.length-1;s+=2)e=e||fr(t[s]),n.push(t[s+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||fr(t[1]);for(let s=2;s<t.length-1;s+=2)n.push(t[s+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||fr(t[1]);for(let s=1;s<t.length-1;s+=2)n.push(t[s+1])}e&&(t.length=0,t.push("any",...n));for(let s=1;s<t.length;s++)kn(t[s])}function fr(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(fr(t[n]))return!0;return!1}const wi=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Vo(t,e){return t<e?-1:t>e?1:0}function Bi(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Bi(t[e]))return!0;return!1}function _o(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?zr(t[1],t[2],"=="):"!="===e?Ui(zr(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?zr(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(_o))):"all"===e?["all"].concat(t.slice(1).map(_o)):"none"===e?["all"].concat(t.slice(1).map(_o).map(Ui)):"in"===e?jl(t[1],t.slice(2)):"!in"===e?Ui(jl(t[1],t.slice(2))):"has"===e?rc(t[1]):"!has"===e?Ui(rc(t[1])):"within"!==e||t;var n}function zr(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function jl(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Vo)]]:["filter-in-small",t,["literal",e]]}}function rc(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ui(t){return["!",t]}function ds(t){return Is(Bo(t.value))?ro(rs({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Ei(t)}function Ei(t){const e=t.value,n=t.key;if("array"!==be(e))return[new Et(n,e,`array expected, ${be(e)} found`)];const s=t.styleSpec;let u,f=[];if(e.length<1)return[new Et(n,e,"filter array must have at least 1 element")];switch(f=f.concat(Mo({key:`${n}[0]`,value:e[0],valueSpec:s.filter_operator,style:t.style,styleSpec:t.styleSpec})),Jr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Jr(e[1])&&f.push(new Et(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&f.push(new Et(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=be(e[1]),"string"!==u&&f.push(new Et(`${n}[1]`,e[1],`string expected, ${u} found`)));for(let y=2;y<e.length;y++)u=be(e[y]),"$type"===Jr(e[1])?f=f.concat(Mo({key:`${n}[${y}]`,value:e[y],valueSpec:s.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&f.push(new Et(`${n}[${y}]`,e[y],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)f=f.concat(Ei({key:`${n}[${y}]`,value:e[y],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":u=be(e[1]),2!==e.length?f.push(new Et(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&f.push(new Et(`${n}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=be(e[1]),2!==e.length?f.push(new Et(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&f.push(new Et(`${n}[1]`,e[1],`object expected, ${u} found`))}return f}function Ks(t,e){const n=t.key,s=t.style,u=t.styleSpec,f=t.value,y=t.objectKey,b=u[`${e}_${t.layerType}`];if(!b)return[];const C=y.match(/^(.*)-transition$/);if("paint"===e&&C&&b[C[1]]&&b[C[1]].transition)return io({key:n,value:f,valueSpec:u.transition,style:s,styleSpec:u});const S=t.valueSpec||b[y];if(!S)return[new Et(n,f,`unknown property "${y}"`)];let L;if("string"===be(f)&&U(S)&&!S.tokens&&(L=/^{([^}]+)}$/.exec(f)))return[new Et(n,f,`"${y}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const F=[];return"symbol"===t.layerType&&("text-field"===y&&s&&!s.glyphs&&F.push(new Et(n,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&Ie(Bo(f))&&"identity"===Jr(f.type)&&F.push(new Et(n,f,'"text-font" does not support identity functions'))),F.concat(io({key:t.key,value:f,valueSpec:S,style:s,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:y}))}function ha(t){return Ks(t,"paint")}function Dc(t){return Ks(t,"layout")}function _l(t){let e=[];const n=t.value,s=t.key,u=t.style,f=t.styleSpec;n.type||n.ref||e.push(new Et(s,n,'either "type" or "ref" is required'));let y=Jr(n.type);const b=Jr(n.ref);if(n.id){const C=Jr(n.id);for(let S=0;S<t.arrayIndex;S++){const L=u.layers[S];Jr(L.id)===C&&e.push(new Et(s,n.id,`duplicate layer id "${n.id}", previously used at line ${L.id.__line__}`))}}if("ref"in n){let C;["type","source","source-layer","filter","layout"].forEach(S=>{S in n&&e.push(new Et(s,n[S],`"${S}" is prohibited for ref layers`))}),u.layers.forEach(S=>{Jr(S.id)===b&&(C=S)}),C?C.ref?e.push(new Et(s,n.ref,"ref cannot reference another ref layer")):y=Jr(C.type):"string"==typeof b&&e.push(new Et(s,n.ref,`ref layer "${b}" not found`))}else if("background"!==y&&"sky"!==y)if(n.source){const C=u.sources&&u.sources[n.source],S=C&&Jr(C.type);C?"vector"===S&&"raster"===y?e.push(new Et(s,n.source,`layer "${n.id}" requires a raster source`)):"raster"===S&&"raster"!==y?e.push(new Et(s,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==S||n["source-layer"]?"raster-dem"===S&&"hillshade"!==y?e.push(new Et(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===S&&C.lineMetrics||e.push(new Et(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Et(s,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Et(s,n.source,`source "${n.source}" not found`))}else e.push(new Et(s,n,'missing required property "source"'));return e=e.concat(Rr({key:s,value:n,valueSpec:f.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>io({key:`${s}.type`,value:n.type,valueSpec:f.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:C=>ds(rs({layerType:y},C)),layout:C=>Rr({layer:n,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":S=>Dc(rs({layerType:y},S))}}),paint:C=>Rr({layer:n,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":S=>ha(rs({layerType:y},S))}})}})),e}function Ys(t){const e=t.value,n=t.key,s=be(e);return"string"!==s?[new Et(n,e,`string expected, ${s} found`)]:[]}const ic={promoteId:function({key:t,value:e}){if("string"===be(e))return Ys({key:t,value:e});{const n=[];for(const s in e)n.push(...Ys({key:`${t}.${s}`,value:e[s]}));return n}}};function bu(t){const e=t.value,n=t.key,s=t.styleSpec,u=t.style;if(!e.type)return[new Et(n,e,'"type" is required')];const f=Jr(e.type);let y;switch(f){case"vector":case"raster":case"raster-dem":return y=Rr({key:n,value:e,valueSpec:s[`source_${f.replace("-","_")}`],style:t.style,styleSpec:s,objectElementValidators:ic}),y;case"geojson":if(y=Rr({key:n,value:e,valueSpec:s.source_geojson,style:u,styleSpec:s,objectElementValidators:ic}),e.cluster)for(const b in e.clusterProperties){const[C,S]=e.clusterProperties[b],L="string"==typeof C?[C,["accumulated"],["get",b]]:C;y.push(...ro({key:`${n}.${b}.map`,value:S,expressionContext:"cluster-map"})),y.push(...ro({key:`${n}.${b}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return y;case"video":return Rr({key:n,value:e,valueSpec:s.source_video,style:u,styleSpec:s});case"image":return Rr({key:n,value:e,valueSpec:s.source_image,style:u,styleSpec:s});case"canvas":return[new Et(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Mo({key:`${n}.type`,value:e.type,valueSpec:{values:Uc(s)},style:u,styleSpec:s})}}function Uc(t){return t.source.reduce((e,n)=>{const s=t[n];return"enum"===s.type.type&&(e=e.concat(Object.keys(s.type.values))),e},[])}function $o(t){const e=t.value,n=t.styleSpec,s=n.light,u=t.style;let f=[];const y=be(e);if(void 0===e)return f;if("object"!==y)return f=f.concat([new Et("light",e,`object expected, ${y} found`)]),f;for(const b in e){const C=b.match(/^(.*)-transition$/);f=f.concat(C&&s[C[1]]&&s[C[1]].transition?io({key:b,value:e[b],valueSpec:n.transition,style:u,styleSpec:n}):s[b]?io({key:b,value:e[b],valueSpec:s[b],style:u,styleSpec:n}):[new Et(b,e[b],`unknown property "${b}"`)])}return f}function oc(t){const e=t.value,n=t.key,s=t.style,u=t.styleSpec,f=u.terrain;let y=[];const b=be(e);if(void 0===e)return y;if("object"!==b)return y=y.concat([new Et("terrain",e,`object expected, ${b} found`)]),y;for(const C in e){const S=C.match(/^(.*)-transition$/);y=y.concat(S&&f[S[1]]&&f[S[1]].transition?io({key:C,value:e[C],valueSpec:u.transition,style:s,styleSpec:u}):f[C]?io({key:C,value:e[C],valueSpec:f[C],style:s,styleSpec:u}):[new Et(C,e[C],`unknown property "${C}"`)])}if(e.source){const C=s.sources&&s.sources[e.source],S=C&&Jr(C.type);C?"raster-dem"!==S&&y.push(new Et(n,e.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):y.push(new Et(n,e.source,`source "${e.source}" not found`))}else y.push(new Et(n,e,'terrain is missing required property "source"'));return y}function Vl(t){const e=t.value,n=t.style,s=t.styleSpec,u=s.fog;let f=[];const y=be(e);if(void 0===e)return f;if("object"!==y)return f=f.concat([new Et("fog",e,`object expected, ${y} found`)]),f;for(const b in e){const C=b.match(/^(.*)-transition$/);f=f.concat(C&&u[C[1]]&&u[C[1]].transition?io({key:b,value:e[b],valueSpec:s.transition,style:n,styleSpec:s}):u[b]?io({key:b,value:e[b],valueSpec:u[b],style:n,styleSpec:s}):[new Et(b,e[b],`unknown property "${b}"`)])}return f}const jc={"*":()=>[],array:bi,boolean:function(t){const e=t.value,n=t.key,s=be(e);return"boolean"!==s?[new Et(n,e,`boolean expected, ${s} found`)]:[]},number:no,color:function(t){const e=t.key,n=t.value,s=be(n);return"string"!==s?[new Et(e,n,`color expected, ${s} found`)]:null===An(n)?[new Et(e,n,`color expected, "${n}" found`)]:[]},enum:Mo,filter:ds,function:Co,layer:_l,object:Rr,source:bu,light:$o,terrain:oc,fog:Vl,string:Ys,formatted:function(t){return 0===Ys(t).length?[]:ro(t)},resolvedImage:function(t){return 0===Ys(t).length?[]:ro(t)},projection:function(t){const e=t.value,n=t.styleSpec,s=n.projection,u=t.style;let f=[];const y=be(e);if("object"===y)for(const b in e)f=f.concat(io({key:b,value:e[b],valueSpec:s[b],style:u,styleSpec:n}));else"string"!==y&&(f=f.concat([new Et("projection",e,`object or string expected, ${y} found`)]));return f}};function io(t){const e=t.value,n=t.valueSpec,s=t.styleSpec;return n.expression&&Ie(Jr(e))?Co(t):n.expression&&jt(Bo(e))?ro(t):n.type&&jc[n.type]?jc[n.type](t):Rr(rs({},t,{valueSpec:n.type?s[n.type]:n}))}function rl(t){const e=t.value,n=t.key,s=Ys(t);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new Et(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new Et(n,e,'"glyphs" url must include a "{range}" token'))),s}function wu(t,e=it){return ko(io({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:rl,"*":()=>[]}}))}const uh=t=>ko(ha(t)),Eu=t=>ko(Dc(t));function ko(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function Vc(t,e){let n=!1;if(e&&e.length)for(const s of e)t.fire(new ji(new Error(s.message))),n=!0;return n}var oo=As;function As(t,e,n){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(n=u[2]);for(var f=0;f<this.d*this.d;f++){var y=u[3+f],b=u[3+f+1];s.push(y===b?null:u.subarray(y,b))}var C=u[3+s.length+1];this.keys=u.subarray(u[3+s.length],C),this.bboxes=u.subarray(C),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var S=0;S<this.d*this.d;S++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var L=n/e*t;this.min=-L,this.max=t+L}As.prototype.insert=function(t,e,n,s,u){this._forEachCell(e,n,s,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(u)},As.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},As.prototype._insertCell=function(t,e,n,s,u,f){this.cells[u].push(f)},As.prototype.query=function(t,e,n,s,u){var f=this.min,y=this.max;if(t<=f&&e<=f&&y<=n&&y<=s&&!u)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(t,e,n,s,this._queryCell,b,{},u),b},As.prototype._queryCell=function(t,e,n,s,u,f,y,b){var C=this.cells[u];if(null!==C)for(var S=this.keys,L=this.bboxes,F=0;F<C.length;F++){var B=C[F];if(void 0===y[B]){var j=4*B;(b?b(L[j+0],L[j+1],L[j+2],L[j+3]):t<=L[j+2]&&e<=L[j+3]&&n>=L[j+0]&&s>=L[j+1])?(y[B]=!0,f.push(S[B])):y[B]=!1}}},As.prototype._forEachCell=function(t,e,n,s,u,f,y,b){for(var C=this._convertToCellCoord(t),S=this._convertToCellCoord(e),L=this._convertToCellCoord(n),F=this._convertToCellCoord(s),B=C;B<=L;B++)for(var j=S;j<=F;j++){var $=this.d*j+B;if((!b||b(this._convertFromCellCoord(B),this._convertFromCellCoord(j),this._convertFromCellCoord(B+1),this._convertFromCellCoord(j+1)))&&u.call(this,t,e,n,s,$,f,y,b))return}},As.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},As.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},As.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var u=new Int32Array(e+n+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,y=0;y<t.length;y++){var b=t[y];u[3+y]=f,u.set(b,f),f+=b.length}return u[3+t.length]=f,u.set(this.keys,f),u[3+t.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};const Ma={};function sn(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Ma[e]={klass:t,omit:n.omit||[]}}sn(Object,"Object"),oo.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},oo.deserialize=function(t){return new oo(t.buffer)},Object.defineProperty(oo,"name",{value:"Grid"}),sn(oo,"Grid"),sn(kr,"Color"),sn(Error,"Error"),sn(nn,"AJAXError"),sn(gr,"ResolvedImage"),sn(xr,"StylePropertyFunction"),sn(Ge,"StyleExpression",{omit:["_evaluator"]}),sn($n,"ZoomDependentExpression"),sn(zn,"ZoomConstantExpression"),sn(_a,"CompoundExpression",{omit:["_evaluate"]});for(const t in Z)Ma[Z[t]._classRegistryKey]||sn(Z[t],`Expression${t}`);function sc(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ns(t){return Pe.ImageBitmap&&t instanceof Pe.ImageBitmap}function Go(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(sc(t)||ns(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof Pe.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const s of t)n.push(Go(s,e));return n}if("object"==typeof t){const n=t.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const u=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const f in t)t.hasOwnProperty(f)&&(Ma[s].omit.indexOf(f)>=0||(u[f]=Go(t[f],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function da(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||sc(t)||ns(t)||ArrayBuffer.isView(t)||t instanceof Pe.ImageData)return t;if(Array.isArray(t))return t.map(da);if("object"==typeof t){const e=t.$name||"Object",{klass:n}=Ma[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const s=Object.create(n.prototype);for(const u of Object.keys(t))"$name"!==u&&(s[u]=da(t[u]));return s}throw new Error("can't deserialize object of type "+typeof t)}const $c=t=>t>=1536&&t<=1791,Gc=t=>t>=1872&&t<=1919,Ia=t=>t>=2208&&t<=2303,Hc=t=>t>=11904&&t<=12031,ac=t=>t>=12032&&t<=12255,ni=t=>t>=12272&&t<=12287,lc=t=>t>=12288&&t<=12351,Cc=t=>t>=12352&&t<=12447,Sc=t=>t>=12448&&t<=12543,hh=t=>t>=12544&&t<=12591,dh=t=>t>=12704&&t<=12735,Kh=t=>t>=12736&&t<=12783,Yh=t=>t>=12784&&t<=12799,fa=t=>t>=12800&&t<=13055,Jh=t=>t>=13056&&t<=13311,Tu=t=>t>=13312&&t<=19903,$i=t=>t>=19968&&t<=40959,Mc=t=>t>=40960&&t<=42127,$l=t=>t>=42128&&t<=42191,qc=t=>t>=44032&&t<=55215,Oo=t=>t>=63744&&t<=64255,h=t=>t>=64336&&t<=65023,r=t=>t>=65040&&t<=65055,l=t=>t>=65072&&t<=65103,m=t=>t>=65104&&t<=65135,x=t=>t>=65136&&t<=65279,E=t=>t>=65280&&t<=65519;function p(t){for(const e of t)if(w(e.charCodeAt(0)))return!0;return!1}function _(t){for(const e of t)if(!g(e.charCodeAt(0)))return!1;return!0}function g(t){return!($c(t)||Gc(t)||Ia(t)||h(t)||x(t))}function w(t){return!(746!==t&&747!==t&&(t<4352||!(dh(t)||hh(t)||l(t)&&!(t>=65097&&t<=65103)||Oo(t)||Jh(t)||Hc(t)||Kh(t)||!(!lc(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Tu(t)||$i(t)||fa(t)||(e=t,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||qc(t)||Cc(t)||ni(t)||(e=>e>=12688&&e<=12703)(t)||ac(t)||Yh(t)||Sc(t)&&12540!==t||!(!E(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!m(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||r(t)||(e=>e>=19904&&e<=19967)(t)||Mc(t)||$l(t))));var e}function D(t){return!(w(t)||(e=t,(n=e)>=128&&n<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(n=>n>=8192&&n<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&9251!==e||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||lc(e)||Sc(e)||(n=>n>=57344&&n<=63743)(e)||l(e)||m(e)||E(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,n}function A(t){return t>=1424&&t<=2303||h(t)||x(t)}function O(t,e){return!(!e&&A(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(n=t,n>=6016&&n<=6143));var n}function G(t){for(const e of t)if(A(e.charCodeAt(0)))return!0;return!1}const K="deferred",re="loading",Q="loaded";let oe=null,fe="unavailable",de=null;const ve=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(fe="error"),oe&&oe(t)};function Se(){Ce.fire(new po("pluginStateChange",{pluginStatus:fe,pluginURL:de}))}const Ce=new jr,ke=function(){return fe},Ze=function(){if(fe!==K||!de)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");fe=re,Se(),de&&Fr({url:de},t=>{t?ve(t):(fe=Q,Se())})},He={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>fe===Q||null!=He.applyArabicShaping,isLoading:()=>fe===re,setState(t){fe=t.pluginStatus,de=t.pluginURL},isParsed:()=>null!=He.applyArabicShaping&&null!=He.processBidirectionalText&&null!=He.processStyledBidirectionalText,getPluginURL:()=>de};class Be{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,s){for(const u of n)if(!O(u.charCodeAt(0),s))return!1;return!0}(e,He.isLoaded())}}class Lt{constructor(e,n){this.property=e,this.value=n,this.expression=function(s,u){if(Ie(s))return new xr(s,u);if(jt(s)){const f=wn(s,u);if("error"===f.result)throw new Error(f.value.map(y=>`${y.key}: ${y.message}`).join(", "));return f.value}{let f=s;return"string"==typeof s&&"color"===u.type&&(f=kr.parse(s)),{kind:"constant",evaluate:()=>f}}}(void 0===n?e.specification.default:n,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class Ve{constructor(e){this.property=e,this.value=new Lt(e,void 0)}transitioned(e,n){return new nt(this.property,this.value,n,Ne({},e.transition,this.transition),e.now)}untransitioned(){return new nt(this.property,this.value,null,{},0)}}class at{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Rn(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Ve(this._values[e].property)),this._values[e].value=new Lt(this._values[e].property,null===n?void 0:Rn(n))}getTransition(e){return Rn(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Ve(this._values[e].property)),this._values[e].transition=Rn(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s);const u=this.getTransition(n);void 0!==u&&(e[`${n}-transition`]=u)}return e}transitioned(e,n){const s=new It(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,n._values[u]);return s}untransitioned(){const e=new It(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class nt{constructor(e,n,s,u,f){const y=u.delay||0,b=u.duration||0;f=f||0,this.property=e,this.value=n,this.begin=f+y,this.end=this.begin+b,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const u=e.now||0,f=this.value.possiblyEvaluate(e,n,s),y=this.prior;if(y){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return y.possiblyEvaluate(e,n,s);{const b=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,n,s),f,Dt(b))}}return f}}class It{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const u=new Nt(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,n,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class et{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Rn(this._values[e].value)}setValue(e,n){this._values[e]=new Lt(this._values[e].property,null===n?void 0:Rn(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const u=new Nt(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,n,s);return u}}class ft{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,n,s,u){return this.property.evaluate(this.value,this.parameters,e,n,s,u)}}class Nt{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class je{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){const u=Za[this.specification.type];return u?u(e,n,s):e}}class Qe{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,u){return new ft(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(n,null,{},s,u)}:e.expression,n)}interpolate(e,n,s){if("constant"!==e.value.kind||"constant"!==n.value.kind)return e;if(void 0===e.value.value||void 0===n.value.value)return new ft(this,{kind:"constant",value:void 0},e.parameters);const u=Za[this.specification.type];return u?new ft(this,{kind:"constant",value:u(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,u,f,y){return"constant"===e.kind?e.value:e.evaluate(n,s,u,f,y)}}class _n{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,u){return!!e.expression.evaluate(n,null,{},s,u)}interpolate(){return!1}}class In{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Be(0,{});for(const s in e){const u=e[s];u.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new Lt(u,void 0),y=this.defaultTransitionablePropertyValues[s]=new Ve(u);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate(n)}}}function yn(t,e){return 256*(t=gt(Math.floor(t),0,255))+gt(Math.floor(e),0,255)}sn(Qe,"DataDrivenProperty"),sn(je,"DataConstantProperty"),sn(_n,"ColorRampProperty");const Nn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ir{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Tn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function an(t,e=1){let n=0,s=0;return{members:t.map(u=>{const f=Nn[u.type].BYTES_PER_ELEMENT,y=n=Gr(n,Math.max(e,f)),b=u.components||1;return s=Math.max(s,f),n+=f*b,{name:u.name,type:u.type,components:b,offset:y}}),size:Gr(n,Math.max(s,e)),alignment:e}}function Gr(t,e){return Math.ceil(t/e)*e}class Mr extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const u=2*e;return this.int16[u+0]=n,this.int16[u+1]=s,e}}Mr.prototype.bytesPerElement=4,sn(Mr,"StructArrayLayout2i4");class oi extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,s)}emplace(e,n,s,u){const f=3*e;return this.int16[f+0]=n,this.int16[f+1]=s,this.int16[f+2]=u,e}}oi.prototype.bytesPerElement=6,sn(oi,"StructArrayLayout3i6");class Hr extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const y=4*e;return this.int16[y+0]=n,this.int16[y+1]=s,this.int16[y+2]=u,this.int16[y+3]=f,e}}Hr.prototype.bytesPerElement=8,sn(Hr,"StructArrayLayout4i8");class Js extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,y,b){const C=this.length;return this.resize(C+1),this.emplace(C,e,n,s,u,f,y,b)}emplace(e,n,s,u,f,y,b,C){const S=6*e,L=12*e,F=3*e;return this.int16[S+0]=n,this.int16[S+1]=s,this.uint8[L+4]=u,this.uint8[L+5]=f,this.uint8[L+6]=y,this.uint8[L+7]=b,this.float32[F+2]=C,e}}Js.prototype.bytesPerElement=12,sn(Js,"StructArrayLayout2i4ub1f12");class Qs extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const y=4*e;return this.float32[y+0]=n,this.float32[y+1]=s,this.float32[y+2]=u,this.float32[y+3]=f,e}}Qs.prototype.bytesPerElement=16,sn(Qs,"StructArrayLayout4f16");class fs extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,u,f)}emplace(e,n,s,u,f,y){const b=6*e,C=3*e;return this.uint16[b+0]=n,this.uint16[b+1]=s,this.uint16[b+2]=u,this.uint16[b+3]=f,this.float32[C+2]=y,e}}fs.prototype.bytesPerElement=12,sn(fs,"StructArrayLayout4ui1f12");class pa extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const y=4*e;return this.uint16[y+0]=n,this.uint16[y+1]=s,this.uint16[y+2]=u,this.uint16[y+3]=f,e}}pa.prototype.bytesPerElement=8,sn(pa,"StructArrayLayout4ui8");class gi extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,s,u,f,y)}emplace(e,n,s,u,f,y,b){const C=6*e;return this.int16[C+0]=n,this.int16[C+1]=s,this.int16[C+2]=u,this.int16[C+3]=f,this.int16[C+4]=y,this.int16[C+5]=b,e}}gi.prototype.bytesPerElement=12,sn(gi,"StructArrayLayout6i12");class si extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,y,b,C,S,L,F,B){const j=this.length;return this.resize(j+1),this.emplace(j,e,n,s,u,f,y,b,C,S,L,F,B)}emplace(e,n,s,u,f,y,b,C,S,L,F,B,j){const $=12*e;return this.int16[$+0]=n,this.int16[$+1]=s,this.int16[$+2]=u,this.int16[$+3]=f,this.uint16[$+4]=y,this.uint16[$+5]=b,this.uint16[$+6]=C,this.uint16[$+7]=S,this.int16[$+8]=L,this.int16[$+9]=F,this.int16[$+10]=B,this.int16[$+11]=j,e}}si.prototype.bytesPerElement=24,sn(si,"StructArrayLayout4i4ui4i24");class Cr extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,s,u,f,y)}emplace(e,n,s,u,f,y,b){const C=10*e,S=5*e;return this.int16[C+0]=n,this.int16[C+1]=s,this.int16[C+2]=u,this.float32[S+2]=f,this.float32[S+3]=y,this.float32[S+4]=b,e}}Cr.prototype.bytesPerElement=20,sn(Cr,"StructArrayLayout3i3f20");class so extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}so.prototype.bytesPerElement=4,sn(so,"StructArrayLayout1ul4");class ps extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,y,b,C,S,L,F,B,j){const $=this.length;return this.resize($+1),this.emplace($,e,n,s,u,f,y,b,C,S,L,F,B,j)}emplace(e,n,s,u,f,y,b,C,S,L,F,B,j,$){const J=20*e,ce=10*e;return this.int16[J+0]=n,this.int16[J+1]=s,this.int16[J+2]=u,this.int16[J+3]=f,this.int16[J+4]=y,this.float32[ce+3]=b,this.float32[ce+4]=C,this.float32[ce+5]=S,this.float32[ce+6]=L,this.int16[J+14]=F,this.uint32[ce+8]=B,this.uint16[J+18]=j,this.uint16[J+19]=$,e}}ps.prototype.bytesPerElement=40,sn(ps,"StructArrayLayout5i4f1i1ul2ui40");class fi extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,y,b){const C=this.length;return this.resize(C+1),this.emplace(C,e,n,s,u,f,y,b)}emplace(e,n,s,u,f,y,b,C){const S=8*e;return this.int16[S+0]=n,this.int16[S+1]=s,this.int16[S+2]=u,this.int16[S+4]=f,this.int16[S+5]=y,this.int16[S+6]=b,this.int16[S+7]=C,e}}fi.prototype.bytesPerElement=16,sn(fi,"StructArrayLayout3i2i2i16");class Ps extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,u,f)}emplace(e,n,s,u,f,y){const b=4*e,C=8*e;return this.float32[b+0]=n,this.float32[b+1]=s,this.float32[b+2]=u,this.int16[C+6]=f,this.int16[C+7]=y,e}}Ps.prototype.bytesPerElement=16,sn(Ps,"StructArrayLayout2f1f2i16");class Du extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const y=12*e,b=3*e;return this.uint8[y+0]=n,this.uint8[y+1]=s,this.float32[b+1]=u,this.float32[b+2]=f,e}}Du.prototype.bytesPerElement=12,sn(Du,"StructArrayLayout2ub2f12");class yl extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,s)}emplace(e,n,s,u){const f=3*e;return this.float32[f+0]=n,this.float32[f+1]=s,this.float32[f+2]=u,e}}yl.prototype.bytesPerElement=12,sn(yl,"StructArrayLayout3f12");class Ho extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,s)}emplace(e,n,s,u){const f=3*e;return this.uint16[f+0]=n,this.uint16[f+1]=s,this.uint16[f+2]=u,e}}Ho.prototype.bytesPerElement=6,sn(Ho,"StructArrayLayout3ui6");class Rs extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,y,b,C,S,L,F,B,j,$,J,ce,ye,Te,pe,we,Re){const Me=this.length;return this.resize(Me+1),this.emplace(Me,e,n,s,u,f,y,b,C,S,L,F,B,j,$,J,ce,ye,Te,pe,we,Re)}emplace(e,n,s,u,f,y,b,C,S,L,F,B,j,$,J,ce,ye,Te,pe,we,Re,Me){const Ke=30*e,qe=15*e,lt=60*e;return this.int16[Ke+0]=n,this.int16[Ke+1]=s,this.int16[Ke+2]=u,this.float32[qe+2]=f,this.float32[qe+3]=y,this.uint16[Ke+8]=b,this.uint16[Ke+9]=C,this.uint32[qe+5]=S,this.uint32[qe+6]=L,this.uint32[qe+7]=F,this.uint16[Ke+16]=B,this.uint16[Ke+17]=j,this.uint16[Ke+18]=$,this.float32[qe+10]=J,this.float32[qe+11]=ce,this.uint8[lt+48]=ye,this.uint8[lt+49]=Te,this.uint8[lt+50]=pe,this.uint32[qe+13]=we,this.int16[Ke+28]=Re,this.uint8[lt+58]=Me,e}}Rs.prototype.bytesPerElement=60,sn(Rs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Aa extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,y,b,C,S,L,F,B,j,$,J,ce,ye,Te,pe,we,Re,Me,Ke,qe,lt,At,Je,dt,mt,St){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,e,n,s,u,f,y,b,C,S,L,F,B,j,$,J,ce,ye,Te,pe,we,Re,Me,Ke,qe,lt,At,Je,dt,mt,St)}emplace(e,n,s,u,f,y,b,C,S,L,F,B,j,$,J,ce,ye,Te,pe,we,Re,Me,Ke,qe,lt,At,Je,dt,mt,St,Ot){const rt=38*e,qt=19*e;return this.int16[rt+0]=n,this.int16[rt+1]=s,this.int16[rt+2]=u,this.float32[qt+2]=f,this.float32[qt+3]=y,this.int16[rt+8]=b,this.int16[rt+9]=C,this.int16[rt+10]=S,this.int16[rt+11]=L,this.int16[rt+12]=F,this.int16[rt+13]=B,this.uint16[rt+14]=j,this.uint16[rt+15]=$,this.uint16[rt+16]=J,this.uint16[rt+17]=ce,this.uint16[rt+18]=ye,this.uint16[rt+19]=Te,this.uint16[rt+20]=pe,this.uint16[rt+21]=we,this.uint16[rt+22]=Re,this.uint16[rt+23]=Me,this.uint16[rt+24]=Ke,this.uint16[rt+25]=qe,this.uint16[rt+26]=lt,this.uint16[rt+27]=At,this.uint16[rt+28]=Je,this.uint32[qt+15]=dt,this.float32[qt+16]=mt,this.float32[qt+17]=St,this.float32[qt+18]=Ot,e}}Aa.prototype.bytesPerElement=76,sn(Aa,"StructArrayLayout3i2f6i15ui1ul3f76");class Pa extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Pa.prototype.bytesPerElement=4,sn(Pa,"StructArrayLayout1f4");class Ic extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,u,f)}emplace(e,n,s,u,f,y){const b=5*e;return this.float32[b+0]=n,this.float32[b+1]=s,this.float32[b+2]=u,this.float32[b+3]=f,this.float32[b+4]=y,e}}Ic.prototype.bytesPerElement=20,sn(Ic,"StructArrayLayout5f20");class ms extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const y=6*e;return this.uint32[3*e+0]=n,this.uint16[y+2]=s,this.uint16[y+3]=u,this.uint16[y+4]=f,e}}ms.prototype.bytesPerElement=12,sn(ms,"StructArrayLayout1ul3ui12");class il extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=s,e}}il.prototype.bytesPerElement=4,sn(il,"StructArrayLayout2ui4");class fh extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}fh.prototype.bytesPerElement=2,sn(fh,"StructArrayLayout1ui2");class Qh extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const u=2*e;return this.float32[u+0]=n,this.float32[u+1]=s,e}}Qh.prototype.bytesPerElement=8,sn(Qh,"StructArrayLayout2f8");class uf extends ir{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}uf.prototype.size=40;class ph extends ps{get(e){return new uf(this,e)}}sn(ph,"CollisionBoxArray");class Np extends ir{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Np.prototype.size=60;class Bp extends Rs{get(e){return new Np(this,e)}}sn(Bp,"PlacedSymbolArray");class Up extends ir{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Up.prototype.size=76;class hf extends Aa{get(e){return new Up(this,e)}}sn(hf,"SymbolInstanceArray");class jp extends Pa{getoffsetX(e){return this.float32[1*e+0]}}sn(jp,"GlyphOffsetArray");class Vp extends Mr{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}sn(Vp,"SymbolLineVertexArray");class ea extends ir{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ea.prototype.size=12;class ed extends ms{get(e){return new ea(this,e)}}sn(ed,"FeatureIndexArray");class df extends il{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}sn(df,"FillExtrusionCentroidArray");const ff=an([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ls=an([{name:"a_dash",components:4,type:"Uint16"}]);var Gl={exports:{}},$p=function(t,e){var n,s,u,f,y,b,C,S;for(s=t.length-(n=3&t.length),u=e,y=3432918353,b=461845907,S=0;S<s;)C=255&t.charCodeAt(S)|(255&t.charCodeAt(++S))<<8|(255&t.charCodeAt(++S))<<16|(255&t.charCodeAt(++S))<<24,++S,u=27492+(65535&(f=5*(65535&(u=(u^=C=(65535&(C=(C=(65535&C)*y+(((C>>>16)*y&65535)<<16)&4294967295)<<15|C>>>17))*b+(((C>>>16)*b&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(C=0,n){case 3:C^=(255&t.charCodeAt(S+2))<<16;case 2:C^=(255&t.charCodeAt(S+1))<<8;case 1:u^=C=(65535&(C=(C=(65535&(C^=255&t.charCodeAt(S)))*y+(((C>>>16)*y&65535)<<16)&4294967295)<<15|C>>>17))*b+(((C>>>16)*b&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0},Gp=function(t,e){for(var n,s=t.length,u=e^s,f=0;s>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(f)|(255&t.charCodeAt(++f))<<8|(255&t.charCodeAt(++f))<<16|(255&t.charCodeAt(++f))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++f;switch(s){case 3:u^=(255&t.charCodeAt(f+2))<<16;case 2:u^=(255&t.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};Gl.exports=$p,Gl.exports.murmur3=$p,Gl.exports.murmur2=Gp;class td{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,s,u){this.ids.push(gf(e)),this.positions.push(n,s,u)}getPositions(e){const n=gf(e);let s=0,u=this.ids.length-1;for(;s<u;){const y=s+u>>1;this.ids[y]>=n?u=y:s=y+1}const f=[];for(;this.ids[s]===n;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(e,n){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return _f(s,u,0,s.length-1),n&&n.push(s.buffer,u.buffer),{ids:s,positions:u}}static deserialize(e){const n=new td;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function gf(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Gl.exports(String(t))}function _f(t,e,n,s){for(;n<s;){const u=t[n+s>>1];let f=n-1,y=s+1;for(;;){do{f++}while(t[f]<u);do{y--}while(t[y]>u);if(f>=y)break;mh(t,f,y),mh(e,3*f,3*y),mh(e,3*f+1,3*y+1),mh(e,3*f+2,3*y+2)}y-n<s-y?(_f(t,e,n,y),n=y+1):(_f(t,e,y+1,s),s=y)}}function mh(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}sn(td,"FeaturePositionMap");class cc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class nd extends cc{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class rd extends cc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class id extends cc{constructor(e){super(e),this.current=kr.transparent}set(e,n,s){this.fetchUniformLocation(e,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const e_=new Float32Array(16),gh=new Float32Array(9),t_=new Float32Array(4);function yf(t){return[yn(255*t.r,255*t.g),yn(255*t.b,255*t.a)]}class Wc{constructor(e,n,s){this.value=e,this.uniformNames=n.map(u=>`u_${u}`),this.type=s}setUniform(e,n,s,u,f){n.set(e,f,u.constantOr(this.value))}getBinding(e,n){return"color"===this.type?new id(e):new nd(e)}}class Ac{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,s,u,f){const y="u_pattern"===f||"u_dash"===f?this.pattern:"u_pixel_ratio"===f?this.pixelRatio:null;y&&n.set(e,f,y)}getBinding(e,n){return"u_pattern"===n||"u_dash"===n?new rd(e):new nd(e)}}class Hl{constructor(e,n,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,s,u,f,y){const b=this.paintVertexArray.length,C=this.expression.evaluate(new Be(0),n,{},f,u,y);this.paintVertexArray.resize(e),this._setPaintValue(b,e,C)}updatePaintArray(e,n,s,u,f){const y=this.expression.evaluate({zoom:0},s,u,void 0,f);this._setPaintValue(e,n,y)}_setPaintValue(e,n,s){if("color"===this.type){const u=yf(s);for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ks{constructor(e,n,s,u,f,y){this.expression=e,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=s,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,n,s,u,f,y){const b=this.expression.evaluate(new Be(this.zoom),n,{},f,u,y),C=this.expression.evaluate(new Be(this.zoom+1),n,{},f,u,y),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,b,C)}updatePaintArray(e,n,s,u,f){const y=this.expression.evaluate({zoom:this.zoom},s,u,void 0,f),b=this.expression.evaluate({zoom:this.zoom+1},s,u,void 0,f);this._setPaintValue(e,n,y,b)}_setPaintValue(e,n,s,u){if("color"===this.type){const f=yf(s),y=yf(u);for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,f[0],f[1],y[0],y[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,s,u,f){const y=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,b=gt(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);n.set(e,f,b)}getBinding(e,n){return new nd(e)}}class ql{constructor(e,n,s,u,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=("array"===s?Ls:ff).members;for(let y=0;y<n.length;++y);this.paintVertexArray=new u}populatePaintArray(e,n,s){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,u,f,y){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],y)}_setPaintValues(e,n,s,u){if(!u||!s)return;const f=u[s];if(!f)return;const{tl:y,br:b,pixelRatio:C}=f;for(let S=e;S<n;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1],C)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class uc{constructor(e,n,s=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!s(f))continue;const y=e.paint.get(f);if(!(y instanceof ft&&U(y.property.specification)))continue;const b=n_(f,e.type),C=y.value,S=y.property.specification.type,L=y.property.useIntegerZoom,F="line-dasharray"===f||f.endsWith("pattern"),B="line-dasharray"===f&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==C.kind||B)if("source"===C.kind||B||F){const j=Hp(f,S,"source");this.binders[f]=F?new ql(C,b,S,j,e.id):new Hl(C,b,S,j),u.push(`/a_${f}`)}else{const j=Hp(f,S,"composite");this.binders[f]=new ks(C,b,S,L,n,j),u.push(`/z_${f}`)}else this.binders[f]=F?new Ac(C.value,b):new Wc(C.value,b,S),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Hl||n instanceof ks?n.maxValue:0}populatePaintArrays(e,n,s,u,f,y){for(const b in this.binders){const C=this.binders[b];(C instanceof Hl||C instanceof ks||C instanceof ql)&&C.populatePaintArray(e,n,s,u,f,y)}}setConstantPatternPositions(e){for(const n in this.binders){const s=this.binders[n];s instanceof Ac&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,n,s,u,f,y){let b=!1;for(const C in e){const S=n.getPositions(C);for(const L of S){const F=s.feature(L.index);for(const B in this.binders){const j=this.binders[B];if((j instanceof Hl||j instanceof ks||j instanceof ql)&&!0===j.expression.isStateDependent){const $=u.paint.get(B);j.expression=$.value,j.updatePaintArray(L.start,L.end,F,e[C],f,y),b=!0}}}}return b}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof Wc||s instanceof Ac)&&e.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Hl||s instanceof ks||s instanceof ql)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Wc||s instanceof Ac||s instanceof ks)for(const u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Wc||u instanceof Ac||u instanceof ks)for(const f of u.uniformNames)n.push({name:f,property:s,binding:u.getBinding(e,f)})}return n}setUniforms(e,n,s,u,f){for(const{name:y,property:b,binding:C}of s)this.binders[b].setUniform(e,C,f,u.get(b),y)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Hl||n instanceof ks||n instanceof ql)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof Hl||s instanceof ks||s instanceof ql)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Hl||n instanceof ks||n instanceof ql)&&n.destroy()}}}class Zc{constructor(e,n,s=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new uc(u,n,s);this.needsUpload=!1,this._featureMap=new td,this._bufferOffset=0}populatePaintArrays(e,n,s,u,f,y,b){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(e,n,u,f,y,b);void 0!==n.id&&this._featureMap.add(n.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,u,f){for(const y of s)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,n,y,u,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const vf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function n_(t,e){return vf[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const r_={"line-pattern":{source:fs,composite:fs},"fill-pattern":{source:fs,composite:fs},"fill-extrusion-pattern":{source:fs,composite:fs},"line-dasharray":{source:pa,composite:pa}},i_={color:{source:Qh,composite:Qs},number:{source:Pa,composite:Qh}};function Hp(t,e,n){const s=r_[t];return s&&s[n]||i_[e][n]}sn(Wc,"ConstantBinder"),sn(Ac,"PatternConstantBinder"),sn(Hl,"SourceExpressionBinder"),sn(ql,"PatternCompositeBinder"),sn(ks,"CompositeExpressionBinder"),sn(uc,"ProgramConfiguration",{omit:["_buffers"]}),sn(Zc,"ProgramConfigurationSet");const od="-transition";class vl extends jr{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new et(n.layout)),n.paint)){this._transitionablePaint=new at(n.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Nt(n.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,s={}){null!=n&&this._validate(Eu,`layers.${this.id}.layout.${e}`,e,n,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return Bn(e,od)?this._transitionablePaint.getTransition(e.slice(0,-od.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,s={}){if(null!=n&&this._validate(uh,`layers.${this.id}.paint.${e}`,e,n,s))return!1;if(Bn(e,od))return this._transitionablePaint.setTransition(e.slice(0,-od.length),n||void 0),!1;{const u=this._transitionablePaint._values[e],f=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value,C=b.isDataDriven(),S=Bn(e,"pattern")||"line-dasharray"===e;return C||f||S||this._handleOverridablePaintPropertyUpdate(e,y,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),En(e,(n,s)=>!(void 0===n||"layout"===s&&!Object.keys(n).length||"paint"===s&&!Object.keys(n).length))}_validate(e,n,s,u,f={}){return(!f||!1!==f.validate)&&Vc(this,e.call(wu,{key:n,layerType:this.type,objectKey:s,value:u,styleSpec:it,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof ft&&U(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=gn(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const qp=an([{name:"a_pos",components:2,type:"Int16"}],4),xf=an([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ao{constructor(e=[]){this.segments=e}prepareSegment(e,n,s,u){let f=this.segments[this.segments.length-1];return e>ao.MAX_VERTEX_ARRAY_LENGTH&&Un(`Max vertices per segment is ${ao.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>ao.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==u&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,u){return new ao([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}ao.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,sn(ao,"SegmentVector");var On=8192;class Pc{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Sr?new Sr(e.lng,e.lat):Sr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Sr?new Sr(e.lng,e.lat):Sr.convert(e),this}extend(e){const n=this._sw,s=this._ne;let u,f;if(e instanceof Sr)u=e,f=e;else{if(!(e instanceof Pc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Pc.convert(e)):this.extend(Sr.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(Sr.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return n||s?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new Sr(u.lng,u.lat),this._ne=new Sr(f.lng,f.lat)),this}getCenter(){return new Sr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Sr(this.getWest(),this.getNorth())}getSouthEast(){return new Sr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:s}=Sr.convert(e);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){return!e||e instanceof Pc?e:new Pc(e)}}const sd=6371008.8;class Sr{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Sr(Kn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,u=e.lat*n,f=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return sd*Math.acos(Math.min(f,1))}toBounds(e=0){const n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new Pc(new Sr(this.lng-s,this.lat-n),new Sr(this.lng+s,this.lat+n))}static convert(e){if(e instanceof Sr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Sr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Sr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const bf=2*Math.PI*sd;function hc(t){return bf*Math.cos(t*Math.PI/180)}function xl(t){return(180+t)/360}function bl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ol(t,e){return t/hc(e)}function sl(t){return 360*t-180}function Io(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Wp(t,e){return t*hc(Io(e))}const wl=85.051129;function wf(t){return 1/Math.cos(t*Math.PI/180)}class Xc{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=Sr.convert(e);return new Xc(xl(s.lng),bl(s.lat),ol(n,s.lat))}toLngLat(){return new Sr(sl(this.x),Io(this.y))}toAltitude(){return Wp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/bf*wf(Io(this.y))}}function _h(t,e,n,s,u,f,y,b,C){const S=(e+s)/2,L=(n+u)/2,F=new st(S,L);b(F),function(B,j,$,J,ce,ye){const Te=$-ce,pe=J-ye;return Math.abs((J-j)*Te-($-B)*pe)/Math.hypot(Te,pe)}(F.x,F.y,f.x,f.y,y.x,y.y)>=C?(_h(t,e,n,S,L,f,F,b,C),_h(t,S,L,s,u,F,y,b,C)):t.push(y)}function Ef(t,e,n){let s=t[0],u=s.x,f=s.y;e(s);const y=[s];for(let b=1;b<t.length;b++){const C=t[b],{x:S,y:L}=C;e(C),_h(y,u,f,S,L,s,C,e,n),u=S,f=L,s=C}return y}function Cu(t,e,n,s){if(s(e,n)){const u=e.add(n)._mult(.5);Cu(t,e,u,s),Cu(t,u,n,s)}else t.push(n)}function ad(t,e){let n=t[0];const s=[n];for(let u=1;u<t.length;u++){const f=t[u];Cu(s,n,f,e),n=f}return s}const ld=Math.pow(2,14)-1,cd=-ld-1;function Tf(t,e){const n=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=gt(n,cd,ld),t.y=gt(s,cd,ld),(n<t.x||n>t.x+1||s<t.y||s>t.y+1)&&Un("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function El(t,e,n){const s=t.loadGeometry(),u=t.extent,f=On/u;if(e&&n&&n.projection.isReprojectedInTileSpace){const y=1<<e.z,{scale:b,x:C,y:S,projection:L}=n,F=B=>{const j=sl((e.x+B.x/u)/y),$=Io((e.y+B.y/u)/y),J=L.project(j,$);B.x=(J.x*b-C)*u,B.y=(J.y*b-S)*u};for(let B=0;B<s.length;B++)if(1!==t.type)s[B]=Ef(s[B],F,1);else{const j=[];for(const $ of s[B])$.x<0||$.x>=u||$.y<0||$.y>=u||(F($),j.push($));s[B]=j}}for(const y of s)for(const b of y)Tf(b,f);return s}function Tl(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?El(t):[]}}function ud(t,e,n,s,u){t.emplaceBack(2*e+(s+1)/2,2*n+(u+1)/2)}function yh(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class Df{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Mr,this.indexArray=new Ho,this.segments=new ao,this.programConfigurations=new Zc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,u){const f=this.layers[0],y=[];let b=null;"circle"===f.type&&(b=f.layout.get("circle-sort-key"));for(const{feature:S,id:L,index:F,sourceLayerIndex:B}of e){const j=this.layers[0]._featureFilter.needGeometry,$=Tl(S,j);if(!this.layers[0]._featureFilter.filter(new Be(this.zoom),$,s))continue;const J=b?b.evaluate($,{},s):void 0,ce={id:L,properties:S.properties,type:S.type,sourceLayerIndex:B,index:F,geometry:j?$.geometry:El(S,s,u),patterns:{},sortKey:J};y.push(ce)}b&&y.sort((S,L)=>S.sortKey-L.sortKey);let C=null;"globe"===u.projection.name&&(this.globeExtVertexArray=new gi,C=u.projection);for(const S of y){const{geometry:L,index:F,sourceLayerIndex:B}=S,j=e[F].feature;this.addFeature(S,L,F,n.availableImages,s,C),n.featureIndex.insert(j,L,F,B,this.index)}}update(e,n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,xf.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,s,u,f,y){for(const b of n)for(const C of b){const S=C.x,L=C.y;if(S<0||S>=On||L<0||L>=On)continue;if(y){const j=y.projectTilePoint(S,L,f),$=y.upVector(f,S,L),J=this.globeExtVertexArray;yh(J,j,$),yh(J,j,$),yh(J,j,$),yh(J,j,$)}const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),B=F.vertexLength;ud(this.layoutVertexArray,S,L,-1,-1),ud(this.layoutVertexArray,S,L,1,-1),ud(this.layoutVertexArray,S,L,1,1),ud(this.layoutVertexArray,S,L,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,f)}}function Zp(t,e){for(let n=0;n<t.length;n++)if(Mu(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Mu(t,e[n]))return!0;return!!Su(t,e)}function o_(t,e,n){return!!Mu(t,e)||!!Rc(e,t,n)}function Cf(t,e){if(1===t.length)return Yp(e,t[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let u=0;u<s.length;u++)if(Mu(t,s[u]))return!0}for(let n=0;n<t.length;n++)if(Yp(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Su(t,e[n]))return!0;return!1}function Xp(t,e,n){if(t.length>1){if(Su(t,e))return!0;for(let s=0;s<e.length;s++)if(Rc(e[s],t,n))return!0}for(let s=0;s<t.length;s++)if(Rc(t[s],e,n))return!0;return!1}function Su(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const s=t[n],u=t[n+1];for(let f=0;f<e.length-1;f++)if(Sf(s,u,e[f],e[f+1]))return!0}return!1}function Sf(t,e,n,s){return vr(t,n,s)!==vr(e,n,s)&&vr(t,e,n)!==vr(t,e,s)}function Rc(t,e,n){const s=n*n;if(1===e.length)return t.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(Kp(t,e[u-1],e[u])<s)return!0;return!1}function Kp(t,e,n){const s=e.distSqr(n);if(0===s)return t.distSqr(e);const u=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/s;return t.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function Yp(t,e){let n,s,u,f=!1;for(let y=0;y<t.length;y++){n=t[y];for(let b=0,C=n.length-1;b<n.length;C=b++)s=n[b],u=n[C],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(f=!f)}return f}function Mu(t,e){let n=!1;for(let s=0,u=t.length-1;s<t.length;u=s++){const f=t[s],y=t[u];f.y>e.y!=y.y>e.y&&e.x<(y.x-f.x)*(e.y-f.y)/(y.y-f.y)+f.x&&(n=!n)}return n}function Jp(t,e,n,s,u){for(const y of t)if(e<=y.x&&n<=y.y&&s>=y.x&&u>=y.y)return!0;const f=[new st(e,n),new st(e,u),new st(s,u),new st(s,n)];if(t.length>2)for(const y of f)if(Mu(t,y))return!0;for(let y=0;y<t.length-1;y++)if(Mf(t[y],t[y+1],f))return!0;return!1}function Mf(t,e,n){const s=n[0],u=n[2];if(t.x<s.x&&e.x<s.x||t.x>u.x&&e.x>u.x||t.y<s.y&&e.y<s.y||t.y>u.y&&e.y>u.y)return!1;const f=vr(t,e,n[0]);return f!==vr(t,e,n[1])||f!==vr(t,e,n[2])||f!==vr(t,e,n[3])}function Iu(t,e,n){const s=e.paint.get(t).value;return"constant"===s.kind?s.value:n.programConfigurations.get(e.id).getMaxValue(t)}function vh(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function xh(t,e,n,s,u){if(!e[0]&&!e[1])return t;const f=st.convert(e)._mult(u);"viewport"===n&&f._rotate(-s);const y=[];for(let b=0;b<t.length;b++)y.push(t[b].sub(f));return y}function hd(t,e,n,s){const u=st.convert(t)._mult(s);return"viewport"===e&&u._rotate(-n),u}sn(Df,"CircleBucket",{omit:["layers"]});const Qp=new In({"circle-sort-key":new Qe(it.layout_circle["circle-sort-key"])});var em={paint:new In({"circle-radius":new Qe(it.paint_circle["circle-radius"]),"circle-color":new Qe(it.paint_circle["circle-color"]),"circle-blur":new Qe(it.paint_circle["circle-blur"]),"circle-opacity":new Qe(it.paint_circle["circle-opacity"]),"circle-translate":new je(it.paint_circle["circle-translate"]),"circle-translate-anchor":new je(it.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new je(it.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new je(it.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Qe(it.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Qe(it.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Qe(it.paint_circle["circle-stroke-opacity"])}),layout:Qp},bh=1e-6,ta=typeof Float32Array<"u"?Float32Array:Array;function tm(){var t=new ta(9);return ta!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function nm(t,e,n){var s=e[0],u=e[1],f=e[2],y=e[3],b=e[4],C=e[5],S=e[6],L=e[7],F=e[8],B=n[0],j=n[1],$=n[2],J=n[3],ce=n[4],ye=n[5],Te=n[6],pe=n[7],we=n[8];return t[0]=B*s+j*y+$*S,t[1]=B*u+j*b+$*L,t[2]=B*f+j*C+$*F,t[3]=J*s+ce*y+ye*S,t[4]=J*u+ce*b+ye*L,t[5]=J*f+ce*C+ye*F,t[6]=Te*s+pe*y+we*S,t[7]=Te*u+pe*b+we*L,t[8]=Te*f+pe*C+we*F,t}function Dl(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function If(t,e){var n=e[0],s=e[1],u=e[2],f=e[3],y=e[4],b=e[5],C=e[6],S=e[7],L=e[8],F=e[9],B=e[10],j=e[11],$=e[12],J=e[13],ce=e[14],ye=e[15],Te=n*b-s*y,pe=n*C-u*y,we=n*S-f*y,Re=s*C-u*b,Me=s*S-f*b,Ke=u*S-f*C,qe=L*J-F*$,lt=L*ce-B*$,At=L*ye-j*$,Je=F*ce-B*J,dt=F*ye-j*J,mt=B*ye-j*ce,St=Te*mt-pe*dt+we*Je+Re*At-Me*lt+Ke*qe;return St?(t[0]=(b*mt-C*dt+S*Je)*(St=1/St),t[1]=(u*dt-s*mt-f*Je)*St,t[2]=(J*Ke-ce*Me+ye*Re)*St,t[3]=(B*Me-F*Ke-j*Re)*St,t[4]=(C*At-y*mt-S*lt)*St,t[5]=(n*mt-u*At+f*lt)*St,t[6]=(ce*we-$*Ke-ye*pe)*St,t[7]=(L*Ke-B*we+j*pe)*St,t[8]=(y*dt-b*At+S*qe)*St,t[9]=(s*At-n*dt-f*qe)*St,t[10]=($*Me-J*we+ye*Te)*St,t[11]=(F*we-L*Me-j*Te)*St,t[12]=(b*lt-y*Je-C*qe)*St,t[13]=(n*Je-s*lt+u*qe)*St,t[14]=(J*pe-$*Re-ce*Te)*St,t[15]=(L*Re-F*pe+B*Te)*St,t):null}function Kc(t,e,n){var s=e[0],u=e[1],f=e[2],y=e[3],b=e[4],C=e[5],S=e[6],L=e[7],F=e[8],B=e[9],j=e[10],$=e[11],J=e[12],ce=e[13],ye=e[14],Te=e[15],pe=n[0],we=n[1],Re=n[2],Me=n[3];return t[0]=pe*s+we*b+Re*F+Me*J,t[1]=pe*u+we*C+Re*B+Me*ce,t[2]=pe*f+we*S+Re*j+Me*ye,t[3]=pe*y+we*L+Re*$+Me*Te,t[4]=(pe=n[4])*s+(we=n[5])*b+(Re=n[6])*F+(Me=n[7])*J,t[5]=pe*u+we*C+Re*B+Me*ce,t[6]=pe*f+we*S+Re*j+Me*ye,t[7]=pe*y+we*L+Re*$+Me*Te,t[8]=(pe=n[8])*s+(we=n[9])*b+(Re=n[10])*F+(Me=n[11])*J,t[9]=pe*u+we*C+Re*B+Me*ce,t[10]=pe*f+we*S+Re*j+Me*ye,t[11]=pe*y+we*L+Re*$+Me*Te,t[12]=(pe=n[12])*s+(we=n[13])*b+(Re=n[14])*F+(Me=n[15])*J,t[13]=pe*u+we*C+Re*B+Me*ce,t[14]=pe*f+we*S+Re*j+Me*ye,t[15]=pe*y+we*L+Re*$+Me*Te,t}function al(t,e,n){var s,u,f,y,b,C,S,L,F,B,j,$,J=n[0],ce=n[1],ye=n[2];return e===t?(t[12]=e[0]*J+e[4]*ce+e[8]*ye+e[12],t[13]=e[1]*J+e[5]*ce+e[9]*ye+e[13],t[14]=e[2]*J+e[6]*ce+e[10]*ye+e[14],t[15]=e[3]*J+e[7]*ce+e[11]*ye+e[15]):(u=e[1],f=e[2],y=e[3],b=e[4],C=e[5],S=e[6],L=e[7],F=e[8],B=e[9],j=e[10],$=e[11],t[0]=s=e[0],t[1]=u,t[2]=f,t[3]=y,t[4]=b,t[5]=C,t[6]=S,t[7]=L,t[8]=F,t[9]=B,t[10]=j,t[11]=$,t[12]=s*J+b*ce+F*ye+e[12],t[13]=u*J+C*ce+B*ye+e[13],t[14]=f*J+S*ce+j*ye+e[14],t[15]=y*J+L*ce+$*ye+e[15]),t}function Cl(t,e,n){var s=n[0],u=n[1],f=n[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*f,t[9]=e[9]*f,t[10]=e[10]*f,t[11]=e[11]*f,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Af(t,e,n){var s=Math.sin(n),u=Math.cos(n),f=e[4],y=e[5],b=e[6],C=e[7],S=e[8],L=e[9],F=e[10],B=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=f*u+S*s,t[5]=y*u+L*s,t[6]=b*u+F*s,t[7]=C*u+B*s,t[8]=S*u-f*s,t[9]=L*u-y*s,t[10]=F*u-b*s,t[11]=B*u-C*s,t}function Pf(t,e,n){var s=Math.sin(n),u=Math.cos(n),f=e[0],y=e[1],b=e[2],C=e[3],S=e[8],L=e[9],F=e[10],B=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u-S*s,t[1]=y*u-L*s,t[2]=b*u-F*s,t[3]=C*u-B*s,t[8]=f*s+S*u,t[9]=y*s+L*u,t[10]=b*s+F*u,t[11]=C*s+B*u,t}function s_(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function a_(t,e,n){var s,u,f,y=n[0],b=n[1],C=n[2],S=Math.hypot(y,b,C);return S<bh?null:(y*=S=1/S,b*=S,C*=S,s=Math.sin(e),u=Math.cos(e),t[0]=y*y*(f=1-u)+u,t[1]=b*y*f+C*s,t[2]=C*y*f-b*s,t[3]=0,t[4]=y*b*f-C*s,t[5]=b*b*f+u,t[6]=C*b*f+y*s,t[7]=0,t[8]=y*C*f+b*s,t[9]=b*C*f-y*s,t[10]=C*C*f+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ny=Kc;function rm(){var t=new ta(3);return ta!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Rf(t){var e=new ta(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function wh(t){return Math.hypot(t[0],t[1],t[2])}function Au(t,e,n){var s=new ta(3);return s[0]=t,s[1]=e,s[2]=n,s}function dc(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Lf(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function dd(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Ra(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function fc(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function ma(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Pu(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t}function gs(t,e){var n=e[0],s=e[1],u=e[2],f=n*n+s*s+u*u;return f>0&&(f=1/Math.sqrt(f)),t[0]=e[0]*f,t[1]=e[1]*f,t[2]=e[2]*f,t}function Sl(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function im(t,e,n){var s=e[0],u=e[1],f=e[2],y=n[0],b=n[1],C=n[2];return t[0]=u*C-f*b,t[1]=f*y-s*C,t[2]=s*b-u*y,t}function lo(t,e,n){var s=e[0],u=e[1],f=e[2],y=n[3]*s+n[7]*u+n[11]*f+n[15];return t[0]=(n[0]*s+n[4]*u+n[8]*f+n[12])/(y=y||1),t[1]=(n[1]*s+n[5]*u+n[9]*f+n[13])/y,t[2]=(n[2]*s+n[6]*u+n[10]*f+n[14])/y,t}function fd(t,e,n){var s=n[0],u=n[1],f=n[2],y=e[0],b=e[1],C=e[2],S=u*C-f*b,L=f*y-s*C,F=s*b-u*y,B=u*F-f*L,j=f*S-s*F,$=s*L-u*S,J=2*n[3];return L*=J,F*=J,j*=2,$*=2,t[0]=y+(S*=J)+(B*=2),t[1]=b+L+j,t[2]=C+F+$,t}var Yc,Wl=Lf,By=dd,om=wh;function sm(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function am(t,e){var n=e[0],s=e[1],u=e[2],f=e[3],y=n*n+s*s+u*u+f*f;return y>0&&(y=1/Math.sqrt(y)),t[0]=n*y,t[1]=s*y,t[2]=u*y,t[3]=f*y,t}function Jc(t,e,n){var s=e[0],u=e[1],f=e[2],y=e[3];return t[0]=n[0]*s+n[4]*u+n[8]*f+n[12]*y,t[1]=n[1]*s+n[5]*u+n[9]*f+n[13]*y,t[2]=n[2]*s+n[6]*u+n[10]*f+n[14]*y,t[3]=n[3]*s+n[7]*u+n[11]*f+n[15]*y,t}function lm(){var t=new ta(4);return ta!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function kf(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Eh(t,e,n){n*=.5;var s=e[0],u=e[1],f=e[2],y=e[3],b=Math.sin(n),C=Math.cos(n);return t[0]=s*C+y*b,t[1]=u*C+f*b,t[2]=f*C-u*b,t[3]=y*C-s*b,t}function cm(t,e,n){n*=.5;var s=e[0],u=e[1],f=e[2],y=e[3],b=Math.sin(n),C=Math.cos(n);return t[0]=s*C-f*b,t[1]=u*C+y*b,t[2]=f*C+s*b,t[3]=y*C-u*b,t}rm(),Yc=new ta(4),ta!=Float32Array&&(Yc[0]=0,Yc[1]=0,Yc[2]=0,Yc[3]=0);var Of=am;rm(),Au(1,0,0),Au(0,1,0),lm(),lm(),tm();class Ff{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,s){const u=Sl(n,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/u;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,n,s){if(J=(j=this.pos)[0],ce=j[1],ye=j[2],Te=($=e)[0],pe=$[1],we=$[2],Math.abs(J-Te)<=bh*Math.max(1,Math.abs(J),Math.abs(Te))&&Math.abs(ce-pe)<=bh*Math.max(1,Math.abs(ce),Math.abs(pe))&&Math.abs(ye-we)<=bh*Math.max(1,Math.abs(ye),Math.abs(we))||0===n)return s[0]=s[1]=s[2]=0,!1;var j,$,J,ce,ye,Te,pe,we;const[u,f,y]=this.dir,b=this.pos[0]-e[0],C=this.pos[1]-e[1],S=this.pos[2]-e[2],L=u*u+f*f+y*y,F=2*(b*u+C*f+S*y),B=F*F-4*L*(b*b+C*C+S*S-n*n);if(B<0){const j=Math.max(-F/2,0),$=b+u*j,J=C+f*j,ce=S+y*j,ye=Math.hypot($,J,ce);return s[0]=$*n/ye,s[1]=J*n/ye,s[2]=ce*n/ye,!1}{const j=(-F-Math.sqrt(B))/(2*L);if(j<0){const $=Math.hypot(b,C,S);return s[0]=b*n/$,s[1]=C*n/$,s[2]=S*n/$,!1}return s[0]=b+u*j,s[1]=C+f*j,s[2]=S+y*j,!0}}}class yo{constructor(e,n,s,u,f){this.TL=e,this.TR=n,this.BR=s,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,n,s){const u=[-1,1,1],f=[1,1,1],y=[1,-1,1],b=[-1,-1,1],C=lo(u,u,e),S=lo(f,f,e),L=lo(y,y,e),F=lo(b,b,e);return new yo(C,S,L,F,n/s)}}class zf{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,s,u){const f=Math.pow(2,s),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const S=Jc([],C,e),L=1/S[3]/n*f;return(F=S)[0]=(B=S)[0]*(j=[L,L,u?1/S[3]:L,L])[0],F[1]=B[1]*j[1],F[2]=B[2]*j[2],F[3]=B[3]*j[3],F;var F,B,j}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const S=gs([],im([],Wl([],y[C[0]],y[C[1]]),Wl([],y[C[2]],y[C[1]]))),L=-Sl(S,y[C[1]]);return S.concat(L)});return new zf(y,b)}}class Os{static fromPoints(e){const n=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const u of e)Ra(n,n,u),fc(s,s,u);return new Os(n,s)}static applyTransform(e,n){const s=e.getCorners();for(let u=0;u<s.length;++u)lo(s[u],s[u],n);return Os.fromPoints(s)}constructor(e,n){this.min=e,this.max=n,this.center=ma([],dc([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],s=Rf(this.min),u=Rf(this.max);for(let f=0;f<n.length;f++)s[f]=n[f]?this.min[f]:this.center[f],u[f]=n[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Os(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let s=!0;for(let u=0;u<e.planes.length;u++){const f=e.planes[u];let y=0;for(let b=0;b<n.length;b++)y+=Sl(f,n[b])+f[3]>=0;if(0===y)return 0;y!==n.length&&(s=!1)}if(s)return 2;for(let u=0;u<3;u++){let f=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let b=0;b<e.points.length;b++){const C=e.points[b][u]-this.min[u];f=Math.min(f,C),y=Math.max(y,C)}if(y<0||f>this.max[u]-this.min[u])return 0}return 1}}function pd(t,e,n,s,u,f,y,b,C){if(f&&t.queryGeometry.isAboveHorizon)return!1;f&&(C*=t.pixelToTileUnitsFactor);const S=t.tileID.canonical,L=n.projection.upVectorScale(S,n.center.lat,n.worldSize).metersToTile;for(const F of e)for(const B of F){const j=B.add(b),$=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt(j.x,j.y,!0):0,J=n.projection.projectTilePoint(j.x,j.y,S);if($>0){const pe=n.projection.upVector(S,j.x,j.y);J.x+=pe[0]*L*$,J.y+=pe[1]*L*$,J.z+=pe[2]*L*$}const ce=f?j:um(J.x,J.y,J.z,s),ye=f?t.tilespaceRays.map(pe=>c_(pe,$)):t.queryGeometry.screenGeometry,Te=Jc([],[J.x,J.y,J.z,1],s);if(!y&&f?C*=Te[3]/n.cameraToCenterDistance:y&&!f&&(C*=n.cameraToCenterDistance/Te[3]),f){const pe=Io((B.y/On+S.y)/(1<<S.z));C/=n.projection.pixelsPerMeter(pe,1)/ol(1,pe)}if(o_(ye,ce,C))return!0}return!1}function um(t,e,n,s){const u=Jc([],[t,e,n,1],s);return new st(u[0]/u[3],u[1]/u[3])}const hm=Au(0,0,0),l_=Au(0,0,1);function c_(t,e){const n=rm();return hm[2]=e,t.intersectsPlane(hm,l_,n),new st(n[0],n[1])}class dm extends Df{}function Nf(t,{width:e,height:n},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*n*s);return t.width=e,t.height=n,t.data=u,t}function u_(t,e,n){const{width:s,height:u}=e;s===t.width&&u===t.height||(fm(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,u)},n),t.width=s,t.height=u,t.data=e.data)}function fm(t,e,n,s,u,f){if(0===u.width||0===u.height)return e;if(u.width>t.width||u.height>t.height||n.x>t.width-u.width||n.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const y=t.data,b=e.data;for(let C=0;C<u.height;C++){const S=((n.y+C)*t.width+n.x)*f,L=((s.y+C)*e.width+s.x)*f;for(let F=0;F<u.width*f;F++)b[L+F]=y[S+F]}return e}sn(dm,"HeatmapBucket",{omit:["layers"]});class La{constructor(e,n){Nf(this,e,1,n)}resize(e){u_(this,new La(e),1)}clone(){return new La({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,u,f){fm(e,n,s,u,f,1)}}class Fs{constructor(e,n){Nf(this,e,4,n)}resize(e){u_(this,new Fs(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Fs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,u,f){fm(e,n,s,u,f,4)}}sn(La,"AlphaImage"),sn(Fs,"RGBAImage");var pm={paint:new In({"heatmap-radius":new Qe(it.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Qe(it.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new je(it.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _n(it.paint_heatmap["heatmap-color"]),"heatmap-opacity":new je(it.paint_heatmap["heatmap-opacity"])})};function md(t){const e={},n=t.resolution||256,s=t.clips?t.clips.length:1,u=t.image||new Fs({width:n,height:s}),f=(y,b,C)=>{e[t.evaluationKey]=C;const S=t.expression.evaluate(e);u.data[y+b+0]=Math.floor(255*S.r/S.a),u.data[y+b+1]=Math.floor(255*S.g/S.a),u.data[y+b+2]=Math.floor(255*S.b/S.a),u.data[y+b+3]=Math.floor(255*S.a)};if(t.clips)for(let y=0,b=0;y<s;++y,b+=4*n)for(let C=0,S=0;C<n;C++,S+=4){const L=C/(n-1),{start:F,end:B}=t.clips[y];f(b,S,F*(1-L)+B*L)}else for(let y=0,b=0;y<n;y++,b+=4)f(0,b,y/(n-1));return u}var mm={paint:new In({"hillshade-illumination-direction":new je(it.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new je(it.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new je(it.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new je(it.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new je(it.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new je(it.paint_hillshade["hillshade-accent-color"])})};const h_=an([{name:"a_pos",components:2,type:"Int16"}],4),{members:d_}=h_;var Ru={exports:{}};function Th(t,e,n){n=n||2;var s,u,f,y,b,C,S,L=e&&e.length,F=L?e[0]*n:t.length,B=gd(t,0,F,n,!0),j=[];if(!B||B.next===B.prev)return j;if(L&&(B=function(J,ce,ye,Te){var pe,we,Re,Me=[];for(pe=0,we=ce.length;pe<we;pe++)(Re=gd(J,ce[pe]*Te,pe<we-1?ce[pe+1]*Te:J.length,Te,!1))===Re.next&&(Re.steiner=!0),Me.push(m_(Re));for(Me.sort(eu),pe=0;pe<Me.length;pe++)ye=p_(Me[pe],ye);return ye}(t,e,B,n)),t.length>80*n){s=f=t[0],u=y=t[1];for(var $=n;$<F;$+=n)(b=t[$])<s&&(s=b),(C=t[$+1])<u&&(u=C),b>f&&(f=b),C>y&&(y=C);S=0!==(S=Math.max(f-s,y-u))?32767/S:0}return Qc(B,j,n,s,u,S,0),j}function gd(t,e,n,s,u){var f,y;if(u===Sh(t,e,n,s)>0)for(f=e;f<n;f+=s)y=ym(f,t[f],t[f+1],y);else for(f=n-s;f>=e;f-=s)y=ym(f,t[f],t[f+1],y);return y&&Dh(y,y.next)&&(Ch(y),y=y.next),y}function Lu(t,e){if(!t)return t;e||(e=t);var n,s=t;do{if(n=!1,s.steiner||!Dh(s,s.next)&&0!==_i(s.prev,s,s.next))s=s.next;else{if(Ch(s),(s=e=s.prev)===s.next)break;n=!0}}while(n||s!==e);return e}function Qc(t,e,n,s,u,f,y){if(t){!y&&f&&function(L,F,B,j){var $=L;do{0===$.z&&($.z=ku($.x,$.y,F,B,j)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next}while($!==L);$.prevZ.nextZ=null,$.prevZ=null,function(J){var ce,ye,Te,pe,we,Re,Me,Ke,qe=1;do{for(ye=J,J=null,we=null,Re=0;ye;){for(Re++,Te=ye,Me=0,ce=0;ce<qe&&(Me++,Te=Te.nextZ);ce++);for(Ke=qe;Me>0||Ke>0&&Te;)0!==Me&&(0===Ke||!Te||ye.z<=Te.z)?(pe=ye,ye=ye.nextZ,Me--):(pe=Te,Te=Te.nextZ,Ke--),we?we.nextZ=pe:J=pe,pe.prevZ=we,we=pe;ye=Te}we.nextZ=null,qe*=2}while(Re>1)}($)}(t,s,u,f);for(var b,C,S=t;t.prev!==t.next;)if(b=t.prev,C=t.next,f?Bf(t,s,u,f):f_(t))e.push(b.i/n|0),e.push(t.i/n|0),e.push(C.i/n|0),Ch(t),t=C.next,S=C.next;else if((t=C)===S){y?1===y?Qc(t=gm(Lu(t),e,n),e,n,s,u,f,2):2===y&&_m(t,e,n,s,u,f):Qc(Lu(t),e,n,s,u,f,1);break}}}function f_(t){var e=t.prev,n=t,s=t.next;if(_i(e,n,s)>=0)return!1;for(var u=e.x,f=n.x,y=s.x,b=e.y,C=n.y,S=s.y,L=u<f?u<y?u:y:f<y?f:y,F=b<C?b<S?b:S:C<S?C:S,B=u>f?u>y?u:y:f>y?f:y,j=b>C?b>S?b:S:C>S?C:S,$=s.next;$!==e;){if($.x>=L&&$.x<=B&&$.y>=F&&$.y<=j&&Lc(u,b,f,C,y,S,$.x,$.y)&&_i($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function Bf(t,e,n,s){var u=t.prev,f=t,y=t.next;if(_i(u,f,y)>=0)return!1;for(var b=u.x,C=f.x,S=y.x,L=u.y,F=f.y,B=y.y,j=b<C?b<S?b:S:C<S?C:S,$=L<F?L<B?L:B:F<B?F:B,J=b>C?b>S?b:S:C>S?C:S,ce=L>F?L>B?L:B:F>B?F:B,ye=ku(j,$,e,n,s),Te=ku(J,ce,e,n,s),pe=t.prevZ,we=t.nextZ;pe&&pe.z>=ye&&we&&we.z<=Te;){if(pe.x>=j&&pe.x<=J&&pe.y>=$&&pe.y<=ce&&pe!==u&&pe!==y&&Lc(b,L,C,F,S,B,pe.x,pe.y)&&_i(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,we.x>=j&&we.x<=J&&we.y>=$&&we.y<=ce&&we!==u&&we!==y&&Lc(b,L,C,F,S,B,we.x,we.y)&&_i(we.prev,we,we.next)>=0))return!1;we=we.nextZ}for(;pe&&pe.z>=ye;){if(pe.x>=j&&pe.x<=J&&pe.y>=$&&pe.y<=ce&&pe!==u&&pe!==y&&Lc(b,L,C,F,S,B,pe.x,pe.y)&&_i(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;we&&we.z<=Te;){if(we.x>=j&&we.x<=J&&we.y>=$&&we.y<=ce&&we!==u&&we!==y&&Lc(b,L,C,F,S,B,we.x,we.y)&&_i(we.prev,we,we.next)>=0)return!1;we=we.nextZ}return!0}function gm(t,e,n){var s=t;do{var u=s.prev,f=s.next.next;!Dh(u,f)&&yd(u,s,s.next,f)&&Ou(u,f)&&Ou(f,u)&&(e.push(u.i/n|0),e.push(s.i/n|0),e.push(f.i/n|0),Ch(s),Ch(s.next),s=t=f),s=s.next}while(s!==t);return Lu(s)}function _m(t,e,n,s,u,f){var y=t;do{for(var b=y.next.next;b!==y.prev;){if(y.i!==b.i&&_d(y,b)){var C=tu(y,b);return y=Lu(y,y.next),C=Lu(C,C.next),Qc(y,e,n,s,u,f,0),void Qc(C,e,n,s,u,f,0)}b=b.next}y=y.next}while(y!==t)}function eu(t,e){return t.x-e.x}function p_(t,e){var n=function(u,f){var y,b=f,C=u.x,S=u.y,L=-1/0;do{if(S<=b.y&&S>=b.next.y&&b.next.y!==b.y){var F=b.x+(S-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(F<=C&&F>L&&(L=F,y=b.x<b.next.x?b:b.next,F===C))return y}b=b.next}while(b!==f);if(!y)return null;var B,j=y,$=y.x,J=y.y,ce=1/0;b=y;do{C>=b.x&&b.x>=$&&C!==b.x&&Lc(S<J?C:L,S,$,J,S<J?L:C,S,b.x,b.y)&&(B=Math.abs(S-b.y)/(C-b.x),Ou(b,u)&&(B<ce||B===ce&&(b.x>y.x||b.x===y.x&&Uf(y,b)))&&(y=b,ce=B)),b=b.next}while(b!==j);return y}(t,e);if(!n)return e;var s=tu(n,t);return Lu(s,s.next),Lu(n,n.next)}function Uf(t,e){return _i(t.prev,t,e.prev)<0&&_i(e.next,t,t.next)<0}function ku(t,e,n,s,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function m_(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Lc(t,e,n,s,u,f,y,b){return(u-y)*(e-b)>=(t-y)*(f-b)&&(t-y)*(s-b)>=(n-y)*(e-b)&&(n-y)*(f-b)>=(u-y)*(s-b)}function _d(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,s){var u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==s.i&&u.next.i!==s.i&&yd(u,u.next,n,s))return!0;u=u.next}while(u!==n);return!1}(t,e)&&(Ou(t,e)&&Ou(e,t)&&function(n,s){var u=n,f=!1,y=(n.x+s.x)/2,b=(n.y+s.y)/2;do{u.y>b!=u.next.y>b&&u.next.y!==u.y&&y<(u.next.x-u.x)*(b-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next}while(u!==n);return f}(t,e)&&(_i(t.prev,t,e.prev)||_i(t,e.prev,e))||Dh(t,e)&&_i(t.prev,t,t.next)>0&&_i(e.prev,e,e.next)>0)}function _i(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Dh(t,e){return t.x===e.x&&t.y===e.y}function yd(t,e,n,s){var u=xd(_i(t,e,n)),f=xd(_i(t,e,s)),y=xd(_i(n,s,t)),b=xd(_i(n,s,e));return u!==f&&y!==b||!(0!==u||!vd(t,n,e))||!(0!==f||!vd(t,s,e))||!(0!==y||!vd(n,t,s))||!(0!==b||!vd(n,e,s))}function vd(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function xd(t){return t>0?1:t<0?-1:0}function Ou(t,e){return _i(t.prev,t,t.next)<0?_i(t,e,t.next)>=0&&_i(t,t.prev,e)>=0:_i(t,e,t.prev)<0||_i(t,t.next,e)<0}function tu(t,e){var n=new jf(t.i,t.x,t.y),s=new jf(e.i,e.x,e.y),u=t.next,f=e.prev;return t.next=e,e.prev=t,n.next=u,u.prev=n,s.next=n,n.prev=s,f.next=s,s.prev=f,s}function ym(t,e,n,s){var u=new jf(t,e,n);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function Ch(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function jf(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Sh(t,e,n,s){for(var u=0,f=e,y=n-s;f<n;f+=s)u+=(t[y]-t[f])*(t[f+1]+t[y+1]),y=f;return u}function g_(t,e,n,s,u){Vf(t,e,n||0,s||t.length-1,u||vm)}function Vf(t,e,n,s,u){for(;s>n;){if(s-n>600){var f=s-n+1,y=e-n+1,b=Math.log(f),C=.5*Math.exp(2*b/3),S=.5*Math.sqrt(b*C*(f-C)/f)*(y-f/2<0?-1:1);Vf(t,e,Math.max(n,Math.floor(e-y*C/f+S)),Math.min(s,Math.floor(e+(f-y)*C/f+S)),u)}var L=t[e],F=n,B=s;for(Mh(t,n,e),u(t[s],L)>0&&Mh(t,n,s);F<B;){for(Mh(t,F,B),F++,B--;u(t[F],L)<0;)F++;for(;u(t[B],L)>0;)B--}0===u(t[n],L)?Mh(t,n,B):Mh(t,++B,s),B<=e&&(n=B+1),e<=B&&(s=B-1)}}function Mh(t,e,n){var s=t[e];t[e]=t[n],t[n]=s}function vm(t,e){return t<e?-1:t>e?1:0}function xm(t,e){const n=t.length;if(n<=1)return[t];const s=[];let u,f;for(let y=0;y<n;y++){const b=tn(t[y]);0!==b&&(t[y].area=Math.abs(b),void 0===f&&(f=b<0),f===b<0?(u&&s.push(u),u=[t[y]]):u.push(t[y]))}if(u&&s.push(u),e>1)for(let y=0;y<s.length;y++)s[y].length<=e||(g_(s[y],e,1,s[y].length-1,__),s[y]=s[y].slice(0,e));return s}function __(t,e){return e.area-t.area}function nu(t,e,n){const s=n.patternDependencies;let u=!1;for(const f of e){const y=f.paint.get(`${t}-pattern`);y.isConstant()||(u=!0);const b=y.constantOr(null);b&&(u=!0,s[b]=!0)}return u}function $f(t,e,n,s,u){const f=u.patternDependencies;for(const y of e){const b=y.paint.get(`${t}-pattern`).value;if("constant"!==b.kind){let C=b.evaluate({zoom:s},n,{},u.availableImages);C=C&&C.name?C.name:C,f[C]=!0,n.patterns[y.id]=C}}return n}Ru.exports=Th,Ru.exports.default=Th,Th.deviation=function(t,e,n,s){var u=e&&e.length,f=Math.abs(Sh(t,0,u?e[0]*n:t.length,n));if(u)for(var y=0,b=e.length;y<b;y++)f-=Math.abs(Sh(t,e[y]*n,y<b-1?e[y+1]*n:t.length,n));var C=0;for(y=0;y<s.length;y+=3){var S=s[y]*n,L=s[y+1]*n,F=s[y+2]*n;C+=Math.abs((t[S]-t[F])*(t[L+1]-t[S+1])-(t[S]-t[L])*(t[F+1]-t[S+1]))}return 0===f&&0===C?0:Math.abs((C-f)/f)},Th.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,u=0;u<t.length;u++){for(var f=0;f<t[u].length;f++)for(var y=0;y<e;y++)n.vertices.push(t[u][f][y]);u>0&&n.holes.push(s+=t[u-1].length)}return n};class pc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Mr,this.indexArray=new Ho,this.indexArray2=new il,this.programConfigurations=new Zc(e.layers,e.zoom),this.segments=new ao,this.segments2=new ao,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,s,u){this.hasPattern=nu("fill",this.layers,n);const f=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:b,id:C,index:S,sourceLayerIndex:L}of e){const F=this.layers[0]._featureFilter.needGeometry,B=Tl(b,F);if(!this.layers[0]._featureFilter.filter(new Be(this.zoom),B,s))continue;const j=f?f.evaluate(B,{},s,n.availableImages):void 0,$={id:C,properties:b.properties,type:b.type,sourceLayerIndex:L,index:S,geometry:F?B.geometry:El(b,s,u),patterns:{},sortKey:j};y.push($)}f&&y.sort((b,C)=>b.sortKey-C.sortKey);for(const b of y){const{geometry:C,index:S,sourceLayerIndex:L}=b;if(this.hasPattern){const F=$f("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(b,C,S,s,{},n.availableImages);n.featureIndex.insert(e[S].feature,C,S,L,this.index)}}update(e,n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,u)}addFeatures(e,n,s,u,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,d_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,u,f,y=[]){for(const b of xm(n,500)){let C=0;for(const $ of b)C+=$.length;const S=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray),L=S.vertexLength,F=[],B=[];for(const $ of b){if(0===$.length)continue;$!==b[0]&&B.push(F.length/2);const J=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),ce=J.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(ce+$.length-1,ce),F.push($[0].x),F.push($[0].y);for(let ye=1;ye<$.length;ye++)this.layoutVertexArray.emplaceBack($[ye].x,$[ye].y),this.indexArray2.emplaceBack(ce+ye-1,ce+ye),F.push($[ye].x),F.push($[ye].y);J.vertexLength+=$.length,J.primitiveLength+=$.length}const j=Ru.exports(F,B);for(let $=0;$<j.length;$+=3)this.indexArray.emplaceBack(L+j[$],L+j[$+1],L+j[$+2]);S.vertexLength+=C,S.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,y,u)}}sn(pc,"FillBucket",{omit:["layers","patternFeatures"]});const Ih=new In({"fill-sort-key":new Qe(it.layout_fill["fill-sort-key"])});var y_={paint:new In({"fill-antialias":new je(it.paint_fill["fill-antialias"]),"fill-opacity":new Qe(it.paint_fill["fill-opacity"]),"fill-color":new Qe(it.paint_fill["fill-color"]),"fill-outline-color":new Qe(it.paint_fill["fill-outline-color"]),"fill-translate":new je(it.paint_fill["fill-translate"]),"fill-translate-anchor":new je(it.paint_fill["fill-translate-anchor"]),"fill-pattern":new Qe(it.paint_fill["fill-pattern"])}),layout:Ih};const bm=an([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),v_=an([{name:"a_centroid_pos",components:2,type:"Uint16"}]),x_=an([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:b_}=bm;var Ah={},w_=st,bd=kc;function kc(t,e,n,s,u){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=u,t.readFields(E_,this,e)}function E_(t,e,n){1==t?e.id=n.readVarint():2==t?function(s,u){for(var f=s.readVarint()+s.pos;s.pos<f;){var y=u._keys[s.readVarint()],b=u._values[s.readVarint()];u.properties[y]=b}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function Gf(t){for(var e,n,s=0,u=0,f=t.length,y=f-1;u<f;y=u++)s+=((n=t[y]).x-(e=t[u]).x)*(e.y+n.y);return s}kc.types=["Unknown","Point","LineString","Polygon"],kc.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,s=1,u=0,f=0,y=0,b=[];t.pos<n;){if(u<=0){var C=t.readVarint();s=7&C,u=C>>3}if(u--,1===s||2===s)f+=t.readSVarint(),y+=t.readSVarint(),1===s&&(e&&b.push(e),e=[]),e.push(new w_(f,y));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&b.push(e),b},kc.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,s=0,u=0,f=0,y=1/0,b=-1/0,C=1/0,S=-1/0;t.pos<e;){if(s<=0){var L=t.readVarint();n=7&L,s=L>>3}if(s--,1===n||2===n)(u+=t.readSVarint())<y&&(y=u),u>b&&(b=u),(f+=t.readSVarint())<C&&(C=f),f>S&&(S=f);else if(7!==n)throw new Error("unknown command "+n)}return[y,C,b,S]},kc.prototype.toGeoJSON=function(t,e,n){var s,u,f=this.extent*Math.pow(2,n),y=this.extent*t,b=this.extent*e,C=this.loadGeometry(),S=kc.types[this.type];function L(j){for(var $=0;$<j.length;$++){var J=j[$];j[$]=[360*(J.x+y)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+b)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(s=0;s<C.length;s++)F[s]=C[s][0];L(C=F);break;case 2:for(s=0;s<C.length;s++)L(C[s]);break;case 3:for(C=function(j){var $=j.length;if($<=1)return[j];for(var J,ce,ye=[],Te=0;Te<$;Te++){var pe=Gf(j[Te]);0!==pe&&(void 0===ce&&(ce=pe<0),ce===pe<0?(J&&ye.push(J),J=[j[Te]]):J.push(j[Te]))}return J&&ye.push(J),ye}(C),s=0;s<C.length;s++)for(u=0;u<C[s].length;u++)L(C[s][u])}1===C.length?C=C[0]:S="Multi"+S;var B={type:"Feature",geometry:{type:S,coordinates:C},properties:this.properties};return"id"in this&&(B.id=this.id),B};var Ph=bd,wm=Em;function Em(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(T_,this,e),this.length=this._features.length}function T_(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(s){for(var u=null,f=s.readVarint()+s.pos;s.pos<f;){var y=s.readVarint()>>3;u=1===y?s.readString():2===y?s.readFloat():3===y?s.readDouble():4===y?s.readVarint64():5===y?s.readVarint():6===y?s.readSVarint():7===y?s.readBoolean():null}return u}(n))}Em.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Ph(this._pbf,e,this.extent,this._keys,this._values)};var D_=wm;function C_(t,e,n){if(3===t){var s=new D_(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}var Hf=Ah.VectorTile=function(t,e){this.layers=t.readFields(C_,{},e)},wd=Ah.VectorTileFeature=bd;function mc(t,e,n,s){const u=[],f=0===s?(y,b,C,S,L,F)=>{y.push(new st(F,C+(F-b)/(S-b)*(L-C)))}:(y,b,C,S,L,F)=>{y.push(new st(b+(F-C)/(L-C)*(S-b),F))};for(const y of t){const b=[];for(const C of y){if(C.length<=2)continue;const S=[];for(let B=0;B<C.length-1;B++){const j=C[B].x,$=C[B].y,J=C[B+1].x,ce=C[B+1].y,ye=0===s?j:$,Te=0===s?J:ce;ye<e?Te>e&&f(S,j,$,J,ce,e):ye>n?Te<n&&f(S,j,$,J,ce,n):S.push(C[B]),Te<e&&ye>=e&&f(S,j,$,J,ce,e),Te>n&&ye<=n&&f(S,j,$,J,ce,n)}let L=C[C.length-1];const F=0===s?L.x:L.y;F>=e&&F<=n&&S.push(L),S.length&&(L=S[S.length-1],S[0].x===L.x&&S[0].y===L.y||S.push(S[0]),b.push(S))}b.length&&u.push(b)}return u}Ah.VectorTileLayer=wm;const gc=wd.types,S_=Math.pow(2,13);function Rh(t,e,n,s,u,f,y,b){t.emplaceBack((e<<1)+y,(n<<1)+f,(Math.floor(s*S_)<<1)+u,Math.round(b))}function Ed(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class M_{constructor(){this.acc=new st(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new st(e.x,e.y),this.max=new st(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,u=this.max;e.x<s.x?s.x=e.x:e.x>u.x&&(u.x=e.x),e.y<s.y?s.y=e.y:e.y>u.y&&(u.y=e.y),((0===e.x||e.x===On)&&e.x===n.x)!=((0===e.y||e.y===On)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,Ln(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>On!=e.x>On&&this.addBorderIntersection(1,Ln(n.y,e.y,(On-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Ln(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>On!=e.y>On&&this.addBorderIntersection(3,Ln(n.x,e.x,(On-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((n,s)=>n+s.edges,0);return 0!==e?this.acc.div(e)._round():new st(0,0)}span(){return new st(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class Fu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Hr,this.centroidVertexArray=new df,this.indexArray=new Ho,this.programConfigurations=new Zc(e.layers,e.zoom),this.segments=new ao,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,s,u){this.features=[],this.hasPattern=nu("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const y=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*y/(y*y+1)/On/(1<<f.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:y,index:b,sourceLayerIndex:C}of e){const S=this.layers[0]._featureFilter.needGeometry,L=Tl(f,S);if(!this.layers[0]._featureFilter.filter(new Be(this.zoom),L,s))continue;const F={id:y,sourceLayerIndex:C,index:b,geometry:S?L.geometry:El(f,s,u),properties:f.properties,type:f.type,patterns:{}},B=this.layoutVertexArray.length;this.hasPattern?this.features.push($f("fill-extrusion",this.layers,F,this.zoom,n)):this.addFeature(F,F.geometry,b,s,{},n.availableImages,u),n.featureIndex.insert(f,F.geometry,b,C,this.index,B)}this.sortBorders()}addFeatures(e,n,s,u,f){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,n,s,u,f)}this.sortBorders()}update(e,n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,b_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,x_.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,v_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,u,f,y,b){const C=[new st(0,0),new st(On,On)],S=b.projection,L="globe"===S.name,F=this.enableTerrain&&!L?new M_:null,B="Polygon"===gc[e.type];L&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new gi);const j=xm(n,500);for(let ye=j.length-1;ye>=0;ye--){const Te=j[ye];(0===Te.length||($=Te[0]).every(pe=>pe.x<=0)||$.every(pe=>pe.x>=On)||$.every(pe=>pe.y<=0)||$.every(pe=>pe.y>=On))&&j.splice(ye,1)}var $;let J;if(L)J=ll(j,C,u);else{J=[];for(const ye of j)J.push({polygon:ye,bounds:C})}const ce=B?this.edgeRadius:0;for(const{polygon:ye,bounds:Te}of J){let pe=0,we=0;for(const Me of ye)B&&!Me[0].equals(Me[Me.length-1])&&Me.push(Me[0]),we+=B?Me.length-1:Me.length;const Re=this.segments.prepareSegment((B?5:4)*we,this.layoutVertexArray,this.indexArray);if(B){const Me=[],Ke=[];pe=Re.vertexLength;for(const lt of ye){let At,Je;lt.length&&lt!==ye[0]&&Ke.push(Me.length/2),At=lt[1].sub(lt[0])._perp()._unit();for(let dt=1;dt<lt.length;dt++){const mt=lt[dt],St=lt[dt===lt.length-1?1:dt+1];let{x:Ot,y:rt}=mt;if(ce){Je=St.sub(mt)._perp()._unit();const qt=At.add(Je)._unit(),Sn=ce*Math.min(4,1/(At.x*qt.x+At.y*qt.y));Ot+=Sn*qt.x,rt+=Sn*qt.y,At=Je}Rh(this.layoutVertexArray,Ot,rt,0,0,1,1,0),Re.vertexLength++,Me.push(mt.x,mt.y),L&&Ed(this.layoutVertexExtArray,S.projectTilePoint(Ot,rt,u),S.upVector(u,Ot,rt))}}const qe=Ru.exports(Me,Ke);for(let lt=0;lt<qe.length;lt+=3)this.indexArray.emplaceBack(pe+qe[lt],pe+qe[lt+2],pe+qe[lt+1]),Re.primitiveLength++}for(const Me of ye){F&&Me.length&&F.startRing(Me[0]);let Ke,qe,lt,At=Me.length>4&&Wf(Me[Me.length-2],Me[0],Me[1]),Je=ce?Tm(Me[Me.length-2],Me[0],Me[1],ce):0;qe=Me[1].sub(Me[0])._perp()._unit();let dt=!0;for(let mt=1,St=0;mt<Me.length;mt++){let Ot=Me[mt-1],rt=Me[mt];const qt=Me[mt===Me.length-1?1:mt+1];if(F&&B&&F.currentPolyCount.top++,Dm(rt,Ot,Te)){ce&&(qe=qt.sub(rt)._perp()._unit(),dt=!dt);continue}F&&F.append(rt,Ot);const Sn=rt.sub(Ot)._perp(),Qt=Sn.x/(Math.abs(Sn.x)+Math.abs(Sn.y)),mn=Sn.y>0?1:0,Zt=Ot.dist(rt);if(St+Zt>32768&&(St=0),ce){lt=qt.sub(rt)._perp()._unit();let cr=qf(Ot,rt,qt,I_(qe,lt),ce);isNaN(cr)&&(cr=0);const Fn=rt.sub(Ot)._unit();Ot=Ot.add(Fn.mult(Je))._round(),rt=rt.add(Fn.mult(-cr))._round(),Je=cr,qe=lt}const Pn=Re.vertexLength,ar=Me.length>4&&Wf(Ot,rt,qt);let lr=Cm(St,At,dt);if(Rh(this.layoutVertexArray,Ot.x,Ot.y,Qt,mn,0,0,lr),Rh(this.layoutVertexArray,Ot.x,Ot.y,Qt,mn,0,1,lr),St+=Zt,lr=Cm(St,ar,!dt),At=ar,Rh(this.layoutVertexArray,rt.x,rt.y,Qt,mn,0,0,lr),Rh(this.layoutVertexArray,rt.x,rt.y,Qt,mn,0,1,lr),Re.vertexLength+=4,this.indexArray.emplaceBack(Pn+0,Pn+1,Pn+2),this.indexArray.emplaceBack(Pn+1,Pn+3,Pn+2),Re.primitiveLength+=2,ce){const cr=pe+(1===mt?Me.length-2:mt-2),Fn=1===mt?pe:cr+1;if(this.indexArray.emplaceBack(Pn+1,cr,Pn+3),this.indexArray.emplaceBack(cr,Fn,Pn+3),Re.primitiveLength+=2,void 0===Ke&&(Ke=Pn),!Dm(qt,Me[mt],Te)){const Nr=mt===Me.length-1?Ke:Re.vertexLength;this.indexArray.emplaceBack(Pn+2,Pn+3,Nr),this.indexArray.emplaceBack(Pn+3,Nr+1,Nr),this.indexArray.emplaceBack(Pn+3,Fn,Nr+1),Re.primitiveLength+=3}dt=!dt}if(L){const cr=this.layoutVertexExtArray,Fn=S.projectTilePoint(Ot.x,Ot.y,u),Nr=S.projectTilePoint(rt.x,rt.y,u),Gn=S.upVector(u,Ot.x,Ot.y),mr=S.upVector(u,rt.x,rt.y);Ed(cr,Fn,Gn),Ed(cr,Fn,Gn),Ed(cr,Nr,mr),Ed(cr,Nr,mr)}}B&&(pe+=Me.length-1)}}if(F&&F.polyCount.length>0){if(F.borders){F.vertexArrayOffset=this.centroidVertexArray.length;const ye=F.borders,Te=this.featuresOnBorder.push(F)-1;for(let pe=0;pe<4;pe++)ye[pe][0]!==Number.MAX_VALUE&&this.borders[pe].push(Te)}this.encodeCentroid(F.borders?void 0:F.centroid(),F)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,y,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,s)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,n,s=!0){let u,f;if(e)if(0!==e.y){const b=n.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(b.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else u=Math.ceil(7*(e.x+450)),f=0;else u=0,f=+s;let y=s?this.centroidVertexArray.length:n.vertexArrayOffset;for(const b of n.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let C=0;C<b.top;C++)this.centroidVertexArray.emplace(y++,u,f);for(let C=0;C<2*b.edges;C++)this.centroidVertexArray.emplace(y++,0,f),this.centroidVertexArray.emplace(y++,u,f)}}}function I_(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function Tm(t,e,n,s){const u=e.sub(t)._perp()._unit(),f=n.sub(e)._perp()._unit();return qf(t,e,n,I_(u,f),s)}function qf(t,e,n,s,u){const f=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(n)/3,u*f/s)}function Dm(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function Wf(t,e,n){if(t.x<0||t.x>=On||e.x<0||e.x>=On||n.x<0||n.x>=On)return!1;const s=n.sub(e),u=s.perp(),f=t.sub(e);return(s.x*f.x+s.y*f.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function Cm(t,e,n){const s=e?2|t:-3&t;return n?1|s:-2&s}function Sm(){const t=Math.PI/32,e=Math.tan(t),n=sd;return n*Math.sqrt(1+2*e*e)-n}function ll(t,e,n){const s=1<<n.z,u=sl(n.x/s),f=sl((n.x+1)/s),y=Io(n.y/s),b=Io((n.y+1)/s);return function(C,S,L,F,B=0,j){const $=[];if(!C.length||!L||!F)return $;const J=(Me,Ke)=>{for(const qe of Me)$.push({polygon:qe,bounds:Ke})},ce=Math.ceil(Math.log2(L)),ye=Math.ceil(Math.log2(F)),Te=ce-ye,pe=[];for(let Me=0;Me<Math.abs(Te);Me++)pe.push(Te>0?0:1);for(let Me=0;Me<Math.min(ce,ye);Me++)pe.push(0),pe.push(1);let we=C;if(we=mc(we,S[0].y-B,S[1].y+B,1),we=mc(we,S[0].x-B,S[1].x+B,0),!we.length)return $;const Re=[];for(pe.length?Re.push({polygons:we,bounds:S,depth:0}):J(we,S);Re.length;){const Me=Re.pop(),Ke=Me.depth,qe=pe[Ke],lt=Me.bounds[0],At=Me.bounds[1],Je=0===qe?lt.x:lt.y,dt=0===qe?At.x:At.y,mt=j?j(qe,Je,dt):.5*(Je+dt),St=mc(Me.polygons,Je-B,mt+B,qe),Ot=mc(Me.polygons,mt-B,dt+B,qe);if(St.length){const rt=[lt,new st(0===qe?mt:At.x,1===qe?mt:At.y)];pe.length>Ke+1?Re.push({polygons:St,bounds:rt,depth:Ke+1}):J(St,rt)}if(Ot.length){const rt=[new st(0===qe?mt:lt.x,1===qe?mt:lt.y),At];pe.length>Ke+1?Re.push({polygons:Ot,bounds:rt,depth:Ke+1}):J(Ot,rt)}}return $}(t,e,Math.ceil((f-u)/11.25),Math.ceil((y-b)/11.25),1,(C,S,L)=>{if(0===C)return.5*(S+L);{const F=Io((n.y+S/On)/s);return(bl(.5*(Io((n.y+L/On)/s)+F))*s-n.y)*On}})}sn(Fu,"FillExtrusionBucket",{omit:["layers","features"]}),sn(M_,"PartMetadata");const A_=new In({"fill-extrusion-edge-radius":new je(it["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Mm={paint:new In({"fill-extrusion-opacity":new je(it["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Qe(it["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new je(it["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new je(it["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Qe(it["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Qe(it["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Qe(it["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new je(it["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new je(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new je(it["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:A_};function Im(t,e,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[t*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Td{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=zu(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const s=(y=this.y,b=this.z,C=Im(256*(f=this.x),256*(y=Math.pow(2,b)-y-1),b),S=Im(256*(f+1),256*(y+1),b),C[0]+","+C[1]+","+S[0]+","+S[1]),u=function(f,y,b){let C,S="";for(let L=f;L>0;L--)C=1<<L-1,S+=(y&C?1:0)+(b&C?2:0);return S}(this.z,this.x,this.y);var f,y,b,C,S;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Am{constructor(e,n){this.wrap=e,this.canonical=n,this.key=zu(e,n.z,n.z,n.x,n.y)}}class zs{constructor(e,n,s,u,f){this.overscaledZ=e,this.wrap=n,this.canonical=new Td(s,+u,+f),this.key=0===n&&e===s?this.canonical.key:zu(n,e,s,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new zs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zs(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return zu(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return zu(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new zs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new zs(n,this.wrap,n,s,u),new zs(n,this.wrap,n,s+1,u),new zs(n,this.wrap,n,s,u+1),new zs(n,this.wrap,n,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new zs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new zs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Am(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function zu(t,e,n,s,u){const f=1<<Math.min(n,22);let y=f*(u%f)+s%f;return t&&n<22&&(y+=f*f*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*y+n)+(e-n)}sn(Td,"CanonicalTileID"),sn(zs,"OverscaledTileID",{omit:["projMatrix"]});class Nu extends st{constructor(e,n,s){super(e,n),this.z=s}}function Lh(t,e){return t.x*e.x+t.y*e.y}function Pm(t,e){if(1===t.length){let n=0;const s=e[n++];let u;for(;!u||s.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){const f=e[n],y=t[0],b=u.sub(s),C=f.sub(s),S=y.sub(s),L=Lh(b,b),F=Lh(b,C),B=Lh(C,C),j=Lh(S,b),$=Lh(S,C),J=L*B-F*F,ce=(B*j-F*$)/J,ye=(L*$-F*j)/J,Te=s.z*(1-ce-ye)+u.z*ce+f.z*ye;if(isFinite(Te))return Te}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}function pr(t,e,n,s,u,f,y,b){const C=y*u.getElevationAt(t,e,!0,!0),S=0!==f[0],L=S?0===f[1]?y*(f[0]/7-450):y*function(F,B,j){const $=Math.floor(B[0]/8),J=Math.floor(B[1]/8),ce=10*(B[0]-8*$),ye=10*(B[1]-8*J),Te=F.getElevationAt($,J,!0,!0),pe=F.getMeterToDEM(j),we=Math.floor(.5*(ce*pe-1)),Re=Math.floor(.5*(ye*pe-1)),Me=F.tileCoordToPixel($,J),Ke=2*we+1,qe=2*Re+1,lt=(Sn=Ke,Qt=qe,[(Ot=F).getElevationAtPixel(rt=Me.x-we,qt=Me.y-Re,!0),Ot.getElevationAtPixel(rt+Qt,qt,!0),Ot.getElevationAtPixel(rt,qt+Qt,!0),Ot.getElevationAtPixel(rt+Sn,qt+Qt,!0)]),At=Math.abs(lt[0]-lt[1]),Je=Math.abs(lt[2]-lt[3]),dt=Math.abs(lt[0]-lt[2])+Math.abs(lt[1]-lt[3]),mt=Math.min(.25,.5*pe*(At+Je)/Ke),St=Math.min(.25,.5*pe*dt/qe);var Ot,rt,qt,Sn,Qt;return Te+Math.max(mt*ce,St*ye)}(u,f,b):C;return{base:C+(0===n)?-1:n,top:S?Math.max(L+s,C+n+2):C+s}}const Rm=an([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Lm}=Rm,km=an([{name:"a_packed",components:4,type:"Float32"}]),{members:P_}=km,R_=wd.types,Om=Math.cos(Math.PI/180*37.5);class Dd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Js,this.layoutVertexArray2=new Qs,this.indexArray=new Ho,this.programConfigurations=new Zc(e.layers,e.zoom),this.segments=new ao,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,u){this.hasPattern=nu("line",this.layers,n);const f=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:L,id:F,index:B,sourceLayerIndex:j}of e){const $=this.layers[0]._featureFilter.needGeometry,J=Tl(L,$);if(!this.layers[0]._featureFilter.filter(new Be(this.zoom),J,s))continue;const ce=f?f.evaluate(J,{},s):void 0,ye={id:F,properties:L.properties,type:L.type,sourceLayerIndex:j,index:B,geometry:$?J.geometry:El(L,s,u),patterns:{},sortKey:ce};y.push(ye)}f&&y.sort((L,F)=>L.sortKey-F.sortKey);const{lineAtlas:b,featureIndex:C}=n,S=this.addConstantDashes(b);for(const L of y){const{geometry:F,index:B,sourceLayerIndex:j}=L;if(S&&this.addFeatureDashes(L,b),this.hasPattern){const $=$f("line",this.layers,L,this.zoom,n);this.patternFeatures.push($)}else this.addFeature(L,F,B,s,b.positions,n.availableImages);C.insert(e[B].feature,F,B,j,this.index)}}addConstantDashes(e){let n=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==f.kind)n=!0;else{const y=f.value,b=u.value;if(!b)continue;e.addDash(b,y)}}return n}addFeatureDashes(e,n){const s=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,y=u.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===y.kind)continue;let b,C;if("constant"===f.kind){if(b=f.value,!b)continue}else b=f.evaluate({zoom:s},e);C="constant"===y.kind?y.value:y.evaluate({zoom:s},e),n.addDash(b,C),e.patterns[u.id]=n.getKey(b,C)}}update(e,n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,u)}addFeatures(e,n,s,u,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,P_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,u,f,y){const b=this.layers[0].layout,C=b.get("line-join").evaluate(e,{}),S=b.get("line-cap").evaluate(e,{}),L=b.get("line-miter-limit"),F=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const B of n)this.addLine(B,e,C,S,L,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,y,u)}addLine(e,n,s,u,f,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ye=0;ye<e.length-1;ye++)this.totalDistance+=e[ye].dist(e[ye+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b="Polygon"===R_[n.type];let C=e.length;for(;C>=2&&e[C-1].equals(e[C-2]);)C--;let S=0;for(;S<C-1&&e[S].equals(e[S+1]);)S++;if(C<(b?3:2))return;"bevel"===s&&(f=1.05);const L=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let B,j,$,J,ce;this.e1=this.e2=-1,b&&(B=e[C-2],ce=e[S].sub(B)._unit()._perp());for(let ye=S;ye<C;ye++){if($=ye===C-1?b?e[S+1]:void 0:e[ye+1],$&&e[ye].equals($))continue;ce&&(J=ce),B&&(j=B),B=e[ye],ce=$?$.sub(B)._unit()._perp():J,J=J||ce;let Te=J.add(ce);0===Te.x&&0===Te.y||Te._unit();const pe=J.x*ce.x+J.y*ce.y,we=Te.x*ce.x+Te.y*ce.y,Re=0!==we?1/we:1/0,Me=2*Math.sqrt(2-2*we),Ke=we<Om&&j&&$,qe=J.x*ce.y-J.y*ce.x>0;if(Ke&&ye>S){const Je=B.dist(j);if(Je>2*L){const dt=B.sub(B.sub(j)._mult(L/Je)._round());this.updateDistance(j,dt),this.addCurrentVertex(dt,J,0,0,F),j=dt}}const lt=j&&$;let At=lt?s:b?"butt":u;if(lt&&"round"===At&&(Re<y?At="miter":Re<=2&&(At="fakeround")),"miter"===At&&Re>f&&(At="bevel"),"bevel"===At&&(Re>2&&(At="flipbevel"),Re<f&&(At="miter")),j&&this.updateDistance(j,B),"miter"===At)Te._mult(Re),this.addCurrentVertex(B,Te,0,0,F);else if("flipbevel"===At){if(Re>100)Te=ce.mult(-1);else{const Je=Re*J.add(ce).mag()/J.sub(ce).mag();Te._perp()._mult(Je*(qe?-1:1))}this.addCurrentVertex(B,Te,0,0,F),this.addCurrentVertex(B,Te.mult(-1),0,0,F)}else if("bevel"===At||"fakeround"===At){const Je=-Math.sqrt(Re*Re-1),dt=qe?Je:0,mt=qe?0:Je;if(j&&this.addCurrentVertex(B,J,dt,mt,F),"fakeround"===At){const St=Math.round(180*Me/Math.PI/20);for(let Ot=1;Ot<St;Ot++){let rt=Ot/St;if(.5!==rt){const Sn=rt-.5;rt+=rt*Sn*(rt-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*Sn*Sn+(.848013+pe*(.215638*pe-1.06021)))}const qt=ce.sub(J)._mult(rt)._add(J)._unit()._mult(qe?-1:1);this.addHalfVertex(B,qt.x,qt.y,!1,qe,0,F)}}$&&this.addCurrentVertex(B,ce,-dt,-mt,F)}else if("butt"===At)this.addCurrentVertex(B,Te,0,0,F);else if("square"===At){const Je=j?1:-1;j||this.addCurrentVertex(B,Te,Je,Je,F),this.addCurrentVertex(B,Te,0,0,F),j&&this.addCurrentVertex(B,Te,Je,Je,F)}else"round"===At&&(j&&(this.addCurrentVertex(B,J,0,0,F),this.addCurrentVertex(B,J,1,1,F,!0)),$&&(this.addCurrentVertex(B,ce,-1,-1,F,!0),this.addCurrentVertex(B,ce,0,0,F)));if(Ke&&ye<C-1){const Je=B.dist($);if(Je>2*L){const dt=B.add($.sub(B)._mult(L/Je)._round());this.updateDistance(B,dt),this.addCurrentVertex(dt,ce,0,0,F),B=dt}}}}addCurrentVertex(e,n,s,u,f,y=!1){const b=n.y*u-n.x,C=-n.y-n.x*u;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,y,!1,s,f),this.addHalfVertex(e,b,C,y,!0,-u,f)}addHalfVertex({x:e,y:n},s,u,f,y,b,C){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(n<<1)+(y?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(0===b?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),C.primitiveLength++),y?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}sn(Dd,"LineBucket",{omit:["layers","patternFeatures"]});const Fm=new In({"line-cap":new Qe(it.layout_line["line-cap"]),"line-join":new Qe(it.layout_line["line-join"]),"line-miter-limit":new je(it.layout_line["line-miter-limit"]),"line-round-limit":new je(it.layout_line["line-round-limit"]),"line-sort-key":new Qe(it.layout_line["line-sort-key"])});var zm={paint:new In({"line-opacity":new Qe(it.paint_line["line-opacity"]),"line-color":new Qe(it.paint_line["line-color"]),"line-translate":new je(it.paint_line["line-translate"]),"line-translate-anchor":new je(it.paint_line["line-translate-anchor"]),"line-width":new Qe(it.paint_line["line-width"]),"line-gap-width":new Qe(it.paint_line["line-gap-width"]),"line-offset":new Qe(it.paint_line["line-offset"]),"line-blur":new Qe(it.paint_line["line-blur"]),"line-dasharray":new Qe(it.paint_line["line-dasharray"]),"line-pattern":new Qe(it.paint_line["line-pattern"]),"line-gradient":new _n(it.paint_line["line-gradient"]),"line-trim-offset":new je(it.paint_line["line-trim-offset"])}),layout:Fm};const Nm=new class extends Qe{possiblyEvaluate(t,e){return e=new Be(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,s){return e=Ne({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,s)}}(zm.paint.properties["line-width"].specification);function L_(t,e){return e>0?e+2*t:t}Nm.useIntegerZoom=!0;const Bm=an([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Um=an([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ru=an([{name:"a_projected_pos",components:4,type:"Float32"}],4);an([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const k_=an([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Zf=an([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);an([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Cd=an([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),O_=an([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);an([{name:"triangle",components:3,type:"Uint16"}]),an([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),an([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),an([{type:"Float32",name:"offsetX"}]),an([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var _s=24;const _c=128;function jm(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Be(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:u}=n;let f=0;for(;f<s.length&&s[f]<=t;)f++;f=Math.max(0,f-1);let y=f;for(;y<s.length&&s[y]<t+1;)y++;y=Math.min(s.length-1,y);const b=s[f],C=s[y];return"composite"===n.kind?{kind:"composite",minZoom:b,maxZoom:C,interpolationType:u}:{kind:"camera",minZoom:b,maxZoom:C,minSize:n.evaluate(new Be(b)),maxSize:n.evaluate(new Be(C)),interpolationType:u}}}function Sd(t,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:u}){return"source"===t.kind?s/_c:"composite"===t.kind?Ln(s/_c,u/_c,n):e}function iu(t,e){let n=0,s=0;if("constant"===t.kind)s=t.layoutSize;else if("source"!==t.kind){const{interpolationType:u,minZoom:f,maxZoom:y}=t,b=u?gt(us.interpolationFactor(u,e,f,y),0,1):0;"camera"===t.kind?s=Ln(t.minSize,t.maxSize,b):n=b}return{uSizeT:n,uSize:s}}var Uy=Object.freeze({__proto__:null,getSizeData:jm,evaluateSizeForFeature:Sd,evaluateSizeForZoom:iu,SIZE_PACK_FACTOR:_c});function F_(t,e,n){return t.sections.forEach(s=>{s.text=function(u,f,y){const b=f.layout.get("text-transform").evaluate(y,{});return"uppercase"===b?u=u.toLocaleUpperCase():"lowercase"===b&&(u=u.toLocaleLowerCase()),He.applyArabicShaping&&(u=He.applyArabicShaping(u)),u}(s.text,e,n)}),t}const Zl={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function z_(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function Vm(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var Oc=ai,$m=function(t,e,n,s,u){var f,y,b=8*u-s-1,C=(1<<b)-1,S=C>>1,L=-7,F=n?u-1:0,B=n?-1:1,j=t[e+F];for(F+=B,f=j&(1<<-L)-1,j>>=-L,L+=b;L>0;f=256*f+t[e+F],F+=B,L-=8);for(y=f&(1<<-L)-1,f>>=-L,L+=s;L>0;y=256*y+t[e+F],F+=B,L-=8);if(0===f)f=1-S;else{if(f===C)return y?NaN:1/0*(j?-1:1);y+=Math.pow(2,s),f-=S}return(j?-1:1)*y*Math.pow(2,f-s)},Xf=function(t,e,n,s,u,f){var y,b,C,S=8*f-u-1,L=(1<<S)-1,F=L>>1,B=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,j=s?0:f-1,$=s?1:-1,J=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,y=L):(y=Math.floor(Math.log(e)/Math.LN2),e*(C=Math.pow(2,-y))<1&&(y--,C*=2),(e+=y+F>=1?B/C:B*Math.pow(2,1-F))*C>=2&&(y++,C/=2),y+F>=L?(b=0,y=L):y+F>=1?(b=(e*C-1)*Math.pow(2,u),y+=F):(b=e*Math.pow(2,F-1)*Math.pow(2,u),y=0));u>=8;t[n+j]=255&b,j+=$,b/=256,u-=8);for(y=y<<u|b,S+=u;S>0;t[n+j]=255&y,j+=$,y/=256,S-=8);t[n+j-$]|=128*J};function ai(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ai.Varint=0,ai.Fixed64=1,ai.Bytes=2,ai.Fixed32=5;var Kf=4294967296,Gm=1/Kf,Hm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function yc(t){return t.type===ai.Bytes?t.readVarint()+t.pos:t.pos+1}function qm(t,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var u=n.pos-1;u>=t;u--)n.buf[u+s]=n.buf[u]}function Wm(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Zm(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Yf(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function jy(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function Jf(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function N_(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function Vy(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function Bu(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function Xm(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Md(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function su(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function Km(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function B_(t,e,n){e.glyphs=[],1===t&&n.readMessage(Id,e)}function Id(t,e,n){if(3===t){const{id:s,bitmap:u,width:f,height:y,left:b,top:C,advance:S}=n.readMessage(Uu,{});e.glyphs.push({id:s,bitmap:new La({width:f+6,height:y+6},u),metrics:{width:f,height:y,left:b,top:C,advance:S}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function Uu(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function kh(t){let e=0,n=0;for(const y of t)e+=y.w*y.h,n=Math.max(n,y.w);t.sort((y,b)=>b.h-y.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let u=0,f=0;for(const y of t)for(let b=s.length-1;b>=0;b--){const C=s[b];if(!(y.w>C.w||y.h>C.h)){if(y.x=C.x,y.y=C.y,f=Math.max(f,y.y+y.h),u=Math.max(u,y.x+y.w),y.w===C.w&&y.h===C.h){const S=s.pop();b<s.length&&(s[b]=S)}else y.h===C.h?(C.x+=y.w,C.w-=y.w):y.w===C.w?(C.y+=y.h,C.h-=y.h):(s.push({x:C.x+y.w,y:C.y,w:C.w-y.w,h:y.h}),C.y+=y.h,C.h-=y.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}ai.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),u=s>>3,f=this.pos;this.type=7&s,t(u,e,this),this.pos===f&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Md(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Km(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Md(this.buf,this.pos)+Md(this.buf,this.pos+4)*Kf;return this.pos+=8,t},readSFixed64:function(){var t=Md(this.buf,this.pos)+Km(this.buf,this.pos+4)*Kf;return this.pos+=8,t},readFloat:function(){var t=$m(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=$m(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(u,f,y){var b,C,S=y.buf;if(b=(112&(C=S[y.pos++]))>>4,C<128||(b|=(127&(C=S[y.pos++]))<<3,C<128)||(b|=(127&(C=S[y.pos++]))<<10,C<128)||(b|=(127&(C=S[y.pos++]))<<17,C<128)||(b|=(127&(C=S[y.pos++]))<<24,C<128)||(b|=(1&(C=S[y.pos++]))<<31,C<128))return function ou(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(u,b,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Hm?Hm.decode(this.buf.subarray(e,t)):function(n,s,u){for(var f="",y=s;y<u;){var b,C,S,L=n[y],F=null,B=L>239?4:L>223?3:L>191?2:1;if(y+B>u)break;1===B?L<128&&(F=L):2===B?128==(192&(b=n[y+1]))&&(F=(31&L)<<6|63&b)<=127&&(F=null):3===B?(C=n[y+2],128==(192&(b=n[y+1]))&&128==(192&C)&&((F=(15&L)<<12|(63&b)<<6|63&C)<=2047||F>=55296&&F<=57343)&&(F=null)):4===B&&(C=n[y+2],S=n[y+3],128==(192&(b=n[y+1]))&&128==(192&C)&&128==(192&S)&&((F=(15&L)<<18|(63&b)<<12|(63&C)<<6|63&S)<=65535||F>=1114112)&&(F=null)),null===F?(F=65533,B=1):F>65535&&(F-=65536,f+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),f+=String.fromCharCode(F),y+=B}return f}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ai.Bytes)return t.push(this.readVarint(e));var n=yc(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ai.Bytes)return t.push(this.readSVarint());var e=yc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ai.Bytes)return t.push(this.readBoolean());var e=yc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ai.Bytes)return t.push(this.readFloat());var e=yc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ai.Bytes)return t.push(this.readDouble());var e=yc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ai.Bytes)return t.push(this.readFixed32());var e=yc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ai.Bytes)return t.push(this.readSFixed32());var e=yc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ai.Bytes)return t.push(this.readFixed64());var e=yc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ai.Bytes)return t.push(this.readSFixed64());var e=yc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ai.Varint)for(;this.buf[this.pos++]>127;);else if(e===ai.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ai.Fixed32)this.pos+=4;else{if(e!==ai.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),su(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),su(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),su(this.buf,-1&t,this.pos),su(this.buf,Math.floor(t*Gm),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),su(this.buf,-1&t,this.pos),su(this.buf,Math.floor(t*Gm),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var s,u,f,b;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),f=s,(b=n).buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,b.buf[b.pos]=127&(f>>>=7),function(f,y){var b=(7&f)<<4;y.buf[y.pos++]|=b|((f>>>=3)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f)))))}(u,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,u,f){for(var y,b,C=0;C<u.length;C++){if((y=u.charCodeAt(C))>55295&&y<57344){if(!b){y>56319||C+1===u.length?(s[f++]=239,s[f++]=191,s[f++]=189):b=y;continue}if(y<56320){s[f++]=239,s[f++]=191,s[f++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(s[f++]=239,s[f++]=191,s[f++]=189,b=null);y<128?s[f++]=y:(y<2048?s[f++]=y>>6|192:(y<65536?s[f++]=y>>12|224:(s[f++]=y>>18|240,s[f++]=y>>12&63|128),s[f++]=y>>6&63|128),s[f++]=63&y|128)}return f}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&qm(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Xf(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Xf(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var s=this.pos-n;s>=128&&qm(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,n){this.writeTag(t,ai.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Wm,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Zm,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Jf,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Yf,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,jy,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,N_,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Vy,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Bu,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Xm,e)},writeBytesField:function(t,e){this.writeTag(t,ai.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ai.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ai.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ai.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ai.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ai.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ai.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ai.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ai.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ai.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class au{constructor(e,{pixelRatio:n,version:s,stretchX:u,stretchY:f,content:y}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=u,this.stretchY=f,this.content=y,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ad{constructor(e,n){const s={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,s,f),this.addImages(n,u,f);const{w:y,h:b}=kh(f),C=new Fs({width:y||1,height:b||1});for(const S in e){const L=e[S],F=s[S].paddedRect;Fs.copy(L.data,C,{x:0,y:0},{x:F.x+1,y:F.y+1},L.data)}for(const S in n){const L=n[S],F=u[S].paddedRect,B=F.x+1,j=F.y+1,$=L.data.width,J=L.data.height;Fs.copy(L.data,C,{x:0,y:0},{x:B,y:j},L.data),Fs.copy(L.data,C,{x:0,y:J-1},{x:B,y:j-1},{width:$,height:1}),Fs.copy(L.data,C,{x:0,y:0},{x:B,y:j+J},{width:$,height:1}),Fs.copy(L.data,C,{x:$-1,y:0},{x:B-1,y:j},{width:1,height:J}),Fs.copy(L.data,C,{x:0,y:0},{x:B+$,y:j},{width:1,height:J})}this.image=C,this.iconPositions=s,this.patternPositions=u}addImages(e,n,s){for(const u in e){const f=e[u],y={x:0,y:0,w:f.data.width+2,h:f.data.height+2};s.push(y),n[u]=new au(y,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[u,f]=e.tl;s.update(n.data,void 0,{x:u,y:f})}}sn(au,"ImagePosition"),sn(Ad,"ImageAtlas");const Ns={horizontal:1,vertical:2,horizontalOnly:3};class ju{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new ju;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new ju;return n.imageName=e,n}}class Fc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new Fc;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?s.addImageSection(f):s.addTextSection(f,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,s){let u="";for(let f=0;f<n.length;f++){const y=n.charCodeAt(f+1)||null,b=n.charCodeAt(f-1)||null;u+=!s&&(y&&D(y)&&!Zl[n[f+1]]||b&&D(b)&&!Zl[n[f-1]])||!Zl[n[f]]?n[f]:Zl[n[f]]}return u}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Vu[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Vu[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new Fc;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(ju.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.name:"";if(0===n.length)return void Un("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(ju.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Un("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Oh(t,e,n,s,u,f,y,b,C,S,L,F,B,j,$){const J=Fc.fromFeature(t,u);F===Ns.vertical&&J.verticalizePunctuation(B);let ce=[];const ye=function(Me,Ke,qe,lt,At,Je){if(!Me)return[];const dt=[],mt=function(qt,Sn,Qt,mn,Zt,Pn){let ar=0;for(let lr=0;lr<qt.length();lr++){const cr=qt.getSection(lr);ar+=Pd(qt.getCharCode(lr),cr,mn,Zt,Sn,Pn)}return ar/Math.max(1,Math.ceil(ar/Qt))}(Me,Ke,qe,lt,At,Je),St=Me.text.indexOf("\u200b")>=0;let Ot=0;for(let qt=0;qt<Me.length();qt++){const Sn=Me.getSection(qt),Qt=Me.getCharCode(qt);if(Vu[Qt]||(Ot+=Pd(Qt,Sn,lt,At,Ke,Je)),qt<Me.length()-1){const mn=!((rt=Qt)<11904||!(dh(rt)||hh(rt)||l(rt)||Oo(rt)||Jh(rt)||Hc(rt)||Kh(rt)||lc(rt)||Tu(rt)||$i(rt)||fa(rt)||E(rt)||Cc(rt)||ni(rt)||ac(rt)||Yh(rt)||Sc(rt)||r(rt)||$l(rt)||Mc(rt)));(Ym[Qt]||mn||Sn.imageName)&&dt.push(Qf(qt+1,Ot,mt,dt,U_(Qt,Me.getCharCode(qt+1),mn&&St),!1))}}var rt;return Qm(Qf(Me.length(),Ot,mt,dt,0,!0))}(J,S,f,e,s,j),{processBidirectionalText:Te,processStyledBidirectionalText:pe}=He;if(Te&&1===J.sections.length){const Me=Te(J.toString(),ye);for(const Ke of Me){const qe=new Fc;qe.text=Ke,qe.sections=J.sections;for(let lt=0;lt<Ke.length;lt++)qe.sectionIndex.push(0);ce.push(qe)}}else if(pe){const Me=pe(J.text,J.sectionIndex,ye);for(const Ke of Me){const qe=new Fc;qe.text=Ke[0],qe.sectionIndex=Ke[1],qe.sections=J.sections,ce.push(qe)}}else ce=function(Me,Ke){const qe=[],lt=Me.text;let At=0;for(const Je of Ke)qe.push(Me.substring(At,Je)),At=Je;return At<lt.length&&qe.push(Me.substring(At,lt.length)),qe}(J,ye);const we=[],Re={positionedLines:we,text:J.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:F,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Me,Ke,qe,lt,At,Je,dt,mt,St,Ot,rt,qt){let Sn=0,Qt=0,mn=0;const Zt="right"===mt?1:"left"===mt?0:.5;let Pn=!1;for(const Gn of At){const mr=Gn.getSections();for(const qr of mr){if(qr.imageName)continue;const li=Ke[qr.fontStack];if(li&&(Pn=void 0!==li.ascender&&void 0!==li.descender,!Pn))break}if(!Pn)break}let ar=0;for(const Gn of At){Gn.trim();const mr=Gn.getMaxScale(),qr=(mr-1)*_s,li={positionedGlyphs:[],lineOffset:0};Me.positionedLines[ar]=li;const ci=li.positionedGlyphs;let pi=0;if(!Gn.length()){Qt+=Je,++ar;continue}let yi=0,Gi=0;for(let Wr=0;Wr<Gn.length();Wr++){const vo=Gn.getSection(Wr),co=Gn.getSectionIndex(Wr),Ir=Gn.getCharCode(Wr);let Ii=vo.scale,Ro=null,Xr=null,Ji=null,ys=_s,Wo=0;const Zo=!(St===Ns.horizontal||!rt&&!w(Ir)||rt&&(Vu[Ir]||(lr=Ir,$c(lr)||Gc(lr)||Ia(lr)||h(lr)||x(lr))));if(vo.imageName){const Us=lt[vo.imageName];if(!Us)continue;Ji=vo.imageName,Me.iconsInText=Me.iconsInText||!0,Xr=Us.paddedRect;const Xo=Us.displaySize;Ii=Ii*_s/qt,Ro={width:Xo[0],height:Xo[1],left:1,top:-3,advance:Zo?Xo[1]:Xo[0],localGlyph:!1},Wo=Pn?-Ro.height*Ii:mr*_s-17-Xo[1]*Ii,ys=Ro.advance;const Jl=(Zo?Xo[0]:Xo[1])*Ii-_s*mr;Jl>0&&Jl>pi&&(pi=Jl)}else{const Us=qe[vo.fontStack];if(!Us)continue;Us[Ir]&&(Xr=Us[Ir]);const Xo=Ke[vo.fontStack];if(!Xo)continue;const Jl=Xo.glyphs[Ir];if(!Jl)continue;if(Ro=Jl.metrics,ys=8203!==Ir?_s:0,Pn){const yu=void 0!==Xo.ascender?Math.abs(Xo.ascender):0,sh=void 0!==Xo.descender?Math.abs(Xo.descender):0,ah=(yu+sh)*Ii;yi<ah&&(yi=ah,Gi=(yu-sh)/2*Ii),Wo=-yu*Ii}else Wo=(mr-Ii)*_s-17}Zo?(Me.verticalizable=!0,ci.push({glyph:Ir,imageName:Ji,x:Sn,y:Qt+Wo,vertical:Zo,scale:Ii,localGlyph:Ro.localGlyph,fontStack:vo.fontStack,sectionIndex:co,metrics:Ro,rect:Xr}),Sn+=ys*Ii+Ot):(ci.push({glyph:Ir,imageName:Ji,x:Sn,y:Qt+Wo,vertical:Zo,scale:Ii,localGlyph:Ro.localGlyph,fontStack:vo.fontStack,sectionIndex:co,metrics:Ro,rect:Xr}),Sn+=Ro.advance*Ii+Ot)}0!==ci.length&&(mn=Math.max(Sn-Ot,mn),Pn?ep(ci,Zt,pi,Gi,Je*mr/2):ep(ci,Zt,pi,0,Je/2)),Sn=0;const qo=Je*mr+pi;li.lineOffset=Math.max(pi,qr),Qt+=qo,++ar}var lr;const cr=Qt,{horizontalAlign:Fn,verticalAlign:Nr}=Rd(dt);(function(Gn,mr,qr,li,ci,pi){const yi=(mr-qr)*ci,Gi=-pi*li;for(const qo of Gn)for(const Wr of qo.positionedGlyphs)Wr.x+=yi,Wr.y+=Gi})(Me.positionedLines,Zt,Fn,Nr,mn,cr),Me.top+=-Nr*cr,Me.bottom=Me.top+cr,Me.left+=-Fn*mn,Me.right=Me.left+mn,Me.hasBaseline=Pn}(Re,e,n,s,ce,y,b,C,F,S,B,$),!function(Me){for(const Ke of Me)if(0!==Ke.positionedGlyphs.length)return!1;return!0}(we)&&Re}const Vu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ym={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Pd(t,e,n,s,u,f){if(e.imageName){const y=s[e.imageName];return y?y.displaySize[0]*e.scale*_s/f+u:0}{const y=n[e.fontStack],b=y&&y.glyphs[t];return b?b.metrics.advance*e.scale+u:0}}function Jm(t,e,n,s){const u=Math.pow(t-e,2);return s?t<e?u/2:2*u:u+Math.abs(n)*n}function U_(t,e,n){let s=0;return 10===t&&(s-=1e4),n&&(s+=150),40!==t&&65288!==t||(s+=50),41!==e&&65289!==e||(s+=50),s}function Qf(t,e,n,s,u,f){let y=null,b=Jm(e,n,u,f);for(const C of s){const S=Jm(e-C.x,n,u,f)+C.badness;S<=b&&(y=C,b=S)}return{index:t,x:e,priorBreak:y,badness:b}}function Qm(t){return t?Qm(t.priorBreak).concat(t.index):[]}function Rd(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function ep(t,e,n,s,u){if(!(e||n||s||u))return;const f=t.length-1,y=t[f],b=(y.x+y.metrics.advance*y.scale)*e;for(let C=0;C<=f;C++)t[C].x-=b,t[C].y+=n+s+u}function j_(t,e,n){const{horizontalAlign:s,verticalAlign:u}=Rd(n),f=e[0]-t.displaySize[0]*s,y=e[1]-t.displaySize[1]*u;return{image:t,top:y,bottom:y+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function eg(t,e,n,s,u,f){const y=t.image;let b;if(y.content){const ce=y.content,ye=y.pixelRatio||1;b=[ce[0]/ye,ce[1]/ye,y.displaySize[0]-ce[2]/ye,y.displaySize[1]-ce[3]/ye]}const C=e.left*f,S=e.right*f;let L,F,B,j;"width"===n||"both"===n?(j=u[0]+C-s[3],F=u[0]+S+s[1]):(j=u[0]+(C+S-y.displaySize[0])/2,F=j+y.displaySize[0]);const $=e.top*f,J=e.bottom*f;return"height"===n||"both"===n?(L=u[1]+$-s[0],B=u[1]+J+s[2]):(L=u[1]+($+J-y.displaySize[1])/2,B=L+y.displaySize[1]),{image:y,top:L,right:F,bottom:B,left:j,collisionPadding:b}}class Ao extends st{constructor(e,n,s,u,f){super(e,n),this.angle=u,this.z=s,void 0!==f&&(this.segment=f)}clone(){return new Ao(this.x,this.y,this.z,this.angle,this.segment)}}function tg(t,e,n,s,u){if(void 0===e.segment)return!0;let f=e,y=e.segment+1,b=0;for(;b>-n/2;){if(y--,y<0)return!1;b-=t[y].dist(f),f=t[y]}b+=t[y].dist(t[y+1]),y++;const C=[];let S=0;for(;b<n/2;){const L=t[y],F=t[y+1];if(!F)return!1;let B=t[y-1].angleTo(L)-L.angleTo(F);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:b,angleDelta:B}),S+=B;b-C[0].distance>s;)S-=C.shift().angleDelta;if(S>u)return!1;y++,b+=L.dist(F)}return!0}function ng(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function V_(t,e,n){return t?.6*e*n:0}function Ld(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function rg(t,e,n,s,u,f){const y=V_(n,u,f),b=Ld(n,s)*f;let C=0;const S=ng(t)/2;for(let L=0;L<t.length-1;L++){const F=t[L],B=t[L+1],j=F.dist(B);if(C+j>S){const $=(S-C)/j,J=Ln(F.x,B.x,$),ce=Ln(F.y,B.y,$),ye=new Ao(J,ce,0,B.angleTo(F),L);return!y||tg(t,ye,b,y,e)?ye:void 0}C+=j}}function $_(t,e,n,s,u,f,y,b,C){const S=V_(s,f,y),L=Ld(s,u),F=L*y,B=0===t[0].x||t[0].x===C||0===t[0].y||t[0].y===C;return e-F<e/4&&(e=F+e/4),ig(t,B?e/2*b%e:(L/2+2*f)*y*b%e,e,S,n,F,B,!1,C)}function ig(t,e,n,s,u,f,y,b,C){const S=f/2,L=ng(t);let F=0,B=e-n,j=[];for(let $=0;$<t.length-1;$++){const J=t[$],ce=t[$+1],ye=J.dist(ce),Te=ce.angleTo(J);for(;B+n<F+ye;){B+=n;const pe=(B-F)/ye,we=Ln(J.x,ce.x,pe),Re=Ln(J.y,ce.y,pe);if(we>=0&&we<C&&Re>=0&&Re<C&&B-S>=0&&B+S<=L){const Me=new Ao(we,Re,0,Te,$);Me._round(),s&&!tg(t,Me,f,s,u)||j.push(Me)}}F+=ye}return b||j.length||y||(j=ig(t,F/2,n,s,u,f,y,!0,C)),j}function og(t,e,n,s,u){const f=[];for(let y=0;y<t.length;y++){const b=t[y];let C;for(let S=0;S<b.length-1;S++){let L=b[S],F=b[S+1];L.x<e&&F.x<e||(L.x<e?L=new st(e,L.y+(e-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x<e&&(F=new st(e,L.y+(e-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y<n&&F.y<n||(L.y<n?L=new st(L.x+(n-L.y)/(F.y-L.y)*(F.x-L.x),n)._round():F.y<n&&(F=new st(L.x+(n-L.y)/(F.y-L.y)*(F.x-L.x),n)._round()),L.x>=s&&F.x>=s||(L.x>=s?L=new st(s,L.y+(s-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x>=s&&(F=new st(s,L.y+(s-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y>=u&&F.y>=u||(L.y>=u?L=new st(L.x+(u-L.y)/(F.y-L.y)*(F.x-L.x),u)._round():F.y>=u&&(F=new st(L.x+(u-L.y)/(F.y-L.y)*(F.x-L.x),u)._round()),C&&L.equals(C[C.length-1])||(C=[L],f.push(C)),C.push(F)))))}}return f}sn(Ao,"Anchor");const $u=1e20;function sg(t,e,n,s,u,f,y,b,C){for(let S=e;S<e+s;S++)ag(t,n*f+S,f,u,y,b,C);for(let S=n;S<n+u;S++)ag(t,S*f+e,1,s,y,b,C)}function ag(t,e,n,s,u,f,y){f[0]=0,y[0]=-$u,y[1]=$u,u[0]=t[e];for(let b=1,C=0,S=0;b<s;b++){u[b]=t[e+b*n];const L=b*b;do{const F=f[C];S=(u[b]-u[F]+L-F*F)/(b-F)/2}while(S<=y[C]&&--C>-1);C++,f[C]=b,y[C]=S,y[C+1]=$u}for(let b=0,C=0;b<s;b++){for(;y[C+1]<b;)C++;const S=f[C],L=b-S;t[e+b*n]=u[S]+L*L}}const Fh={none:0,ideographs:1,all:2};class Gu{constructor(e,n,s){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const s=[];for(const u in e)for(const f of e[u])s.push({stack:u,id:f});hn(s,({stack:u,id:f},y)=>{let b=this.entries[u];b||(b=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=b.glyphs[f];if(void 0!==C)return void y(null,{stack:u,id:f,glyph:C});if(C=this._tinySDF(b,u,f),C)return b.glyphs[f]=C,void y(null,{stack:u,id:f,glyph:C});const S=Math.floor(f/256);if(256*S>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[S])return void y(null,{stack:u,id:f,glyph:C});let L=b.requests[S];L||(L=b.requests[S]=[],Gu.loadGlyphRange(u,S,this.url,this.requestManager,(F,B)=>{if(B){b.ascender=B.ascender,b.descender=B.descender;for(const j in B.glyphs)this._doesCharSupportLocalGlyph(+j)||(b.glyphs[+j]=B.glyphs[+j]);b.ranges[S]=!0}for(const j of L)j(F,B);delete b.requests[S]})),L.push((F,B)=>{F?y(F):B&&y(null,{stack:u,id:f,glyph:B.glyphs[f]||null})})},(u,f)=>{if(u)n(u);else if(f){const y={};for(const{stack:b,id:C,glyph:S}of f)void 0===y[b]&&(y[b]={}),void 0===y[b].glyphs&&(y[b].glyphs={}),y[b].glyphs[C]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;n(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Fh.none&&(this.localGlyphMode===Fh.all?!!this.localFontFamily:!!this.localFontFamily&&($i(e)||qc(e)||Cc(e)||Sc(e)||lc(e)))}_tinySDF(e,n,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let f=e.tinySDF;if(!f){let J="400";/bold/i.test(n)?J="900":/medium/i.test(n)?J="500":/light/i.test(n)&&(J="200"),f=e.tinySDF=new Gu.TinySDF({fontFamily:u,fontWeight:J,fontSize:48,buffer:6,radius:16}),f.fontWeight=J}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const y=String.fromCharCode(s),{data:b,width:C,height:S,glyphWidth:L,glyphHeight:F,glyphLeft:B,glyphTop:j,glyphAdvance:$}=f.draw(y);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new La({width:C,height:S},b),metrics:{width:L/2,height:F/2,left:B/2,top:j/2-27,advance:$/2,localGlyph:!0}}}}function lg(t,e,n,s){const u=[],f=t.image,y=f.pixelRatio,b=f.paddedRect.w-2,C=f.paddedRect.h-2,S=t.right-t.left,L=t.bottom-t.top,F=f.stretchX||[[0,b]],B=f.stretchY||[[0,C]],j=(Je,dt)=>Je+dt[1]-dt[0],$=F.reduce(j,0),J=B.reduce(j,0),ce=b-$,ye=C-J;let Te=0,pe=$,we=0,Re=J,Me=0,Ke=ce,qe=0,lt=ye;if(f.content&&s){const Je=f.content;Te=kd(F,0,Je[0]),we=kd(B,0,Je[1]),pe=kd(F,Je[0],Je[2]),Re=kd(B,Je[1],Je[3]),Me=Je[0]-Te,qe=Je[1]-we,Ke=Je[2]-Je[0]-pe,lt=Je[3]-Je[1]-Re}const At=(Je,dt,mt,St)=>{const Ot=Od(Je.stretch-Te,pe,S,t.left),rt=ka(Je.fixed-Me,Ke,Je.stretch,$),qt=Od(dt.stretch-we,Re,L,t.top),Sn=ka(dt.fixed-qe,lt,dt.stretch,J),Qt=Od(mt.stretch-Te,pe,S,t.left),mn=ka(mt.fixed-Me,Ke,mt.stretch,$),Zt=Od(St.stretch-we,Re,L,t.top),Pn=ka(St.fixed-qe,lt,St.stretch,J),ar=new st(Ot,qt),lr=new st(Qt,qt),cr=new st(Qt,Zt),Fn=new st(Ot,Zt),Nr=new st(rt/y,Sn/y),Gn=new st(mn/y,Pn/y),mr=e*Math.PI/180;if(mr){const ci=Math.sin(mr),pi=Math.cos(mr),yi=[pi,-ci,ci,pi];ar._matMult(yi),lr._matMult(yi),Fn._matMult(yi),cr._matMult(yi)}const qr=Je.stretch+Je.fixed,li=dt.stretch+dt.fixed;return{tl:ar,tr:lr,bl:Fn,br:cr,tex:{x:f.paddedRect.x+1+qr,y:f.paddedRect.y+1+li,w:mt.stretch+mt.fixed-qr,h:St.stretch+St.fixed-li},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Nr,pixelOffsetBR:Gn,minFontScaleX:Ke/y/S,minFontScaleY:lt/y/L,isSDF:n}};if(s&&(f.stretchX||f.stretchY)){const Je=cg(F,ce,$),dt=cg(B,ye,J);for(let mt=0;mt<Je.length-1;mt++){const St=Je[mt],Ot=Je[mt+1];for(let rt=0;rt<dt.length-1;rt++)u.push(At(St,dt[rt],Ot,dt[rt+1]))}}else u.push(At({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:C+1}));return u}function kd(t,e,n){let s=0;for(const u of t)s+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return s}function cg(t,e,n){const s=[{fixed:-1,stretch:0}];for(const[u,f]of t){const y=s[s.length-1];s.push({fixed:u-y.stretch,stretch:y.stretch}),s.push({fixed:u-y.stretch,stretch:y.stretch+(f-u)})}return s.push({fixed:e+1,stretch:n}),s}function Od(t,e,n,s){return t/e*n+s}function ka(t,e,n,s){return t-e*n/s}function tp(t,e,n,s){const u=e+t.positionedLines[s].lineOffset;return 0===s?n+u/2:n+(u+(e+t.positionedLines[s-1].lineOffset))/2}Gu.loadGlyphRange=function(t,e,n,s,u){const f=256*e,y=f+255,b=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${f}-${y}`),vt.Glyphs);Fr(b,(C,S)=>{if(C)u(C);else if(S){const L={},F=new Oc(S).readFields(B_,{});for(const B of F.glyphs)L[B.id]=B;u(null,{glyphs:L,ascender:F.ascender,descender:F.descender})}})},Gu.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=n;const b=this.size=t+4*e,C=this._createCanvas(b),S=this.ctx=C.getContext("2d",{willReadFrequently:!0});S.font=`${y} ${f} ${t}px ${u}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(t),y=Math.ceil(n),b=Math.min(this.size-this.buffer,Math.ceil(f-u)),C=Math.min(this.size-this.buffer,y+Math.ceil(s)),S=b+2*this.buffer,L=C+2*this.buffer,F=Math.max(S*L,0),B=new Uint8ClampedArray(F),j={data:B,width:S,height:L,glyphWidth:b,glyphHeight:C,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(0===b||0===C)return j;const{ctx:$,buffer:J,gridInner:ce,gridOuter:ye}=this;$.clearRect(J,J,b,C),$.fillText(t,J,J+y);const Te=$.getImageData(J,J,b,C);ye.fill($u,0,F),ce.fill(0,0,F);for(let pe=0;pe<C;pe++)for(let we=0;we<b;we++){const Re=Te.data[4*(pe*b+we)+3]/255;if(0===Re)continue;const Me=(pe+J)*S+we+J;if(1===Re)ye[Me]=0,ce[Me]=$u;else{const Ke=.5-Re;ye[Me]=Ke>0?Ke*Ke:0,ce[Me]=Ke<0?Ke*Ke:0}}sg(ye,0,0,S,L,S,this.f,this.v,this.z),sg(ce,J,J,b,C,S,this.f,this.v,this.z);for(let pe=0;pe<F;pe++){const we=Math.sqrt(ye[pe])-Math.sqrt(ce[pe]);B[pe]=Math.round(255-255*(we/this.radius+this.cutoff))}return j}};class G_{constructor(e=[],n=H_){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,u=n[e];for(;e>0;){const f=e-1>>1,y=n[f];if(s(u,y)>=0)break;n[e]=y,e=f}n[e]=u}_down(e){const{data:n,compare:s}=this,u=this.length>>1,f=n[e];for(;e<u;){let y=1+(e<<1),b=n[y];const C=y+1;if(C<this.length&&s(n[C],b)<0&&(y=C,b=n[C]),s(b,f)>=0)break;n[e]=b,e=y}n[e]=f}}function H_(t,e){return t<e?-1:t>e?1:0}function ug(t,e=1,n=!1){let s=1/0,u=1/0,f=-1/0,y=-1/0;const b=t[0];for(let j=0;j<b.length;j++){const $=b[j];(!j||$.x<s)&&(s=$.x),(!j||$.y<u)&&(u=$.y),(!j||$.x>f)&&(f=$.x),(!j||$.y>y)&&(y=$.y)}const C=Math.min(f-s,y-u);let S=C/2;const L=new G_([],q_);if(0===C)return new st(s,u);for(let j=s;j<f;j+=C)for(let $=u;$<y;$+=C)L.push(new Hu(j+S,$+S,S,t));let F=function(j){let $=0,J=0,ce=0;const ye=j[0];for(let Te=0,pe=ye.length,we=pe-1;Te<pe;we=Te++){const Re=ye[Te],Me=ye[we],Ke=Re.x*Me.y-Me.x*Re.y;J+=(Re.x+Me.x)*Ke,ce+=(Re.y+Me.y)*Ke,$+=3*Ke}return new Hu(J/$,ce/$,0,j)}(t),B=L.length;for(;L.length;){const j=L.pop();(j.d>F.d||!F.d)&&(F=j,n&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,B)),j.max-F.d<=e||(S=j.h/2,L.push(new Hu(j.p.x-S,j.p.y-S,S,t)),L.push(new Hu(j.p.x+S,j.p.y-S,S,t)),L.push(new Hu(j.p.x-S,j.p.y+S,S,t)),L.push(new Hu(j.p.x+S,j.p.y+S,S,t)),B+=4)}return n&&(console.log(`num probes: ${B}`),console.log(`best distance: ${F.d}`)),F.p}function q_(t,e){return e.max-t.max}function Hu(t,e,n,s){this.p=new st(t,e),this.h=n,this.d=function(u,f){let y=!1,b=1/0;for(let C=0;C<f.length;C++){const S=f[C];for(let L=0,F=S.length,B=F-1;L<F;B=L++){const j=S[L],$=S[B];j.y>u.y!=$.y>u.y&&u.x<($.x-j.x)*(u.y-j.y)/($.y-j.y)+j.x&&(y=!y),b=Math.min(b,Kp(u,j,$))}}return(y?1:-1)*Math.sqrt(b)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const np=Number.POSITIVE_INFINITY,rp=Math.sqrt(2);function hg(t,[e,n]){let s=0,u=0;if(n===np){e<0&&(e=0);const f=e/rp;switch(t){case"top-right":case"top-left":u=f-7;break;case"bottom-right":case"bottom-left":u=7-f;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(t){case"top-right":case"bottom-right":s=-f;break;case"top-left":case"bottom-left":s=f;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":u=n-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-n}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,u]}function W_(t,e,n,s,u,f,y,b,C,S){t.createArrays(),t.tilePixelRatio=On/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const L=t.layers[0].layout,F=t.layers[0]._unevaluatedLayout._values,B={};if("composite"===t.textSizeData.kind){const{minZoom:J,maxZoom:ce}=t.textSizeData;B.compositeTextSizes=[F["text-size"].possiblyEvaluate(new Be(J),b),F["text-size"].possiblyEvaluate(new Be(ce),b)]}if("composite"===t.iconSizeData.kind){const{minZoom:J,maxZoom:ce}=t.iconSizeData;B.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new Be(J),b),F["icon-size"].possiblyEvaluate(new Be(ce),b)]}B.layoutTextSize=F["text-size"].possiblyEvaluate(new Be(C+1),b),B.layoutIconSize=F["icon-size"].possiblyEvaluate(new Be(C+1),b),B.textMaxSize=F["text-size"].possiblyEvaluate(new Be(18),b);const j="map"===L.get("text-rotation-alignment")&&"point"!==L.get("symbol-placement"),$=L.get("text-size");for(const J of t.features){const ce=L.get("text-font").evaluate(J,{},b).join(","),ye=$.evaluate(J,{},b),Te=B.layoutTextSize.evaluate(J,{},b),pe=(B.layoutIconSize.evaluate(J,{},b),{horizontal:{},vertical:void 0}),we=J.text;let Re,Me=[0,0];if(we){const lt=we.toString(),At=L.get("text-letter-spacing").evaluate(J,{},b)*_s,Je=L.get("text-line-height").evaluate(J,{},b)*_s,dt=_(lt)?At:0,mt=L.get("text-anchor").evaluate(J,{},b),St=L.get("text-variable-anchor");if(!St){const Qt=L.get("text-radial-offset").evaluate(J,{},b);Me=Qt?hg(mt,[Qt*_s,np]):L.get("text-offset").evaluate(J,{},b).map(mn=>mn*_s)}let Ot=j?"center":L.get("text-justify").evaluate(J,{},b);const rt="point"===L.get("symbol-placement"),qt=rt?L.get("text-max-width").evaluate(J,{},b)*_s:1/0,Sn=Qt=>{t.allowVerticalPlacement&&p(lt)&&(pe.vertical=Oh(we,e,n,u,ce,qt,Je,mt,Qt,dt,Me,Ns.vertical,!0,Te,ye))};if(!j&&St){const Qt="auto"===Ot?St.map(Zt=>qu(Zt)):[Ot];let mn=!1;for(let Zt=0;Zt<Qt.length;Zt++){const Pn=Qt[Zt];if(!pe.horizontal[Pn])if(mn)pe.horizontal[Pn]=pe.horizontal[0];else{const ar=Oh(we,e,n,u,ce,qt,Je,"center",Pn,dt,Me,Ns.horizontal,!1,Te,ye);ar&&(pe.horizontal[Pn]=ar,mn=1===ar.positionedLines.length)}}Sn("left")}else{if("auto"===Ot&&(Ot=qu(mt)),rt||L.get("text-writing-mode").indexOf("horizontal")>=0||!p(lt)){const Qt=Oh(we,e,n,u,ce,qt,Je,mt,Ot,dt,Me,Ns.horizontal,!1,Te,ye);Qt&&(pe.horizontal[Ot]=Qt)}Sn(rt?"left":Ot)}}let Ke=!1;if(J.icon&&J.icon.name){const lt=s[J.icon.name];lt&&(Re=j_(u[J.icon.name],L.get("icon-offset").evaluate(J,{},b),L.get("icon-anchor").evaluate(J,{},b)),Ke=lt.sdf,void 0===t.sdfIcons?t.sdfIcons=lt.sdf:t.sdfIcons!==lt.sdf&&Un("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(lt.pixelRatio!==t.pixelRatio||0!==L.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const qe=zd(pe.horizontal)||pe.vertical;t.iconsInText||(t.iconsInText=!!qe&&qe.iconsInText),(qe||Re)&&Fd(t,J,pe,Re,s,B,Te,0,Me,Ke,y,b,S)}f&&t.generateCollisionDebugBuffers(C,t.collisionBoxArray)}function qu(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Fd(t,e,n,s,u,f,y,b,C,S,L,F,B){let j=f.textMaxSize.evaluate(e,{},F);void 0===j&&(j=y);const $=t.layers[0].layout,J=$.get("icon-offset").evaluate(e,{},F),ce=zd(n.horizontal)||n.vertical,ye="globe"===B.name,Te=y/24,pe=t.tilePixelRatio*j/24,we=(dt=t.overscaling,t.zoom>18&&dt>2&&(dt>>=1),Math.max(On/(512*dt),1)*$.get("symbol-spacing")),Re=$.get("text-padding")*t.tilePixelRatio,Me=$.get("icon-padding")*t.tilePixelRatio,Ke=ht($.get("text-max-angle")),qe="map"===$.get("text-rotation-alignment")&&"point"!==$.get("symbol-placement"),lt="map"===$.get("icon-rotation-alignment")&&"point"!==$.get("symbol-placement"),At=$.get("symbol-placement"),Je=we/2;var dt;const mt=$.get("icon-text-fit");let St;s&&"none"!==mt&&(t.allowVerticalPlacement&&n.vertical&&(St=eg(s,n.vertical,mt,$.get("icon-text-fit-padding"),J,Te)),ce&&(s=eg(s,ce,mt,$.get("icon-text-fit-padding"),J,Te)));const Ot=(rt,qt,Sn)=>{if(qt.x<0||qt.x>=On||qt.y<0||qt.y>=On)return;let Qt=null;if(ye){const{x:mn,y:Zt,z:Pn}=B.projectTilePoint(qt.x,qt.y,Sn);Qt={anchor:new Ao(mn,Zt,Pn,0,void 0),up:B.upVector(Sn,qt.x,qt.y)}}!function(mn,Zt,Pn,ar,lr,cr,Fn,Nr,Gn,mr,qr,li,ci,pi,yi,Gi,qo,Wr,vo,co,Ir,Ii,Ro,Xr,Ji){const ys=mn.addToLineVertexArray(Zt,ar);let Wo,Zo,Us,Xo,Jl,yu,sh,ah=0,wp=0,Ep=0,Tp=0,nf=-1,rf=-1;const Rl={};let Dp=Gl.exports("");const ja=Pn?Pn.anchor:Zt;let Cp=0,Sp=0;if(void 0===Gn._unevaluatedLayout.getValue("text-radial-offset")?[Cp,Sp]=Gn.layout.get("text-offset").evaluate(Ir,{},Ji).map($a=>$a*_s):(Cp=Gn.layout.get("text-radial-offset").evaluate(Ir,{},Ji)*_s,Sp=np),mn.allowVerticalPlacement&&lr.vertical){const $a=lr.vertical;if(yi)yu=Nd($a),Nr&&(sh=Nd(Nr));else{const na=Gn.layout.get("text-rotate").evaluate(Ir,{},Ji)+90;Us=ip(mr,ja,Zt,qr,li,ci,$a,pi,na,Gi),Nr&&(Xo=ip(mr,ja,Zt,qr,li,ci,Nr,Wr,na))}}if(cr){const $a=Gn.layout.get("icon-rotate").evaluate(Ir,{},Ji),na="none"!==Gn.layout.get("icon-text-fit"),lh=lg(cr,$a,Ro,na),Bg=Nr?lg(Nr,$a,Ro,na):void 0;Zo=ip(mr,ja,Zt,qr,li,ci,cr,Wr,$a),ah=4*lh.length;const Zn=mn.iconSizeData;let vu=null;"source"===Zn.kind?(vu=[_c*Gn.layout.get("icon-size").evaluate(Ir,{},Ji)],vu[0]>Ml&&Un(`${mn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Zn.kind&&(vu=[_c*Ii.compositeIconSizes[0].evaluate(Ir,{},Ji),_c*Ii.compositeIconSizes[1].evaluate(Ir,{},Ji)],(vu[0]>Ml||vu[1]>Ml)&&Un(`${mn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),mn.addSymbols(mn.icon,lh,vu,co,vo,Ir,!1,Pn,Zt,ys.lineStartIndex,ys.lineLength,-1,Xr,Ji),nf=mn.icon.placedSymbolArray.length-1,Bg&&(wp=4*Bg.length,mn.addSymbols(mn.icon,Bg,vu,co,vo,Ir,Ns.vertical,Pn,Zt,ys.lineStartIndex,ys.lineLength,-1,Xr,Ji),rf=mn.icon.placedSymbolArray.length-1)}for(const $a in lr.horizontal){const na=lr.horizontal[$a];Wo||(Dp=Gl.exports(na.text),yi?Jl=Nd(na):Wo=ip(mr,ja,Zt,qr,li,ci,na,pi,Gn.layout.get("text-rotate").evaluate(Ir,{},Ji),Gi));const lh=1===na.positionedLines.length;if(Ep+=Z_(mn,Pn,Zt,na,Fn,Gn,yi,Ir,Gi,ys,lr.vertical?Ns.horizontal:Ns.horizontalOnly,lh?Object.keys(lr.horizontal):[$a],Rl,nf,Ii,Xr,Ji),lh)break}lr.vertical&&(Tp+=Z_(mn,Pn,Zt,lr.vertical,Fn,Gn,yi,Ir,Gi,ys,Ns.vertical,["vertical"],Rl,rf,Ii,Xr,Ji));let Va=-1;const Ng=($a,na)=>$a?Math.max($a,na):na;Va=Ng(Jl,Va),Va=Ng(yu,Va),Va=Ng(sh,Va);const Mp=Va>-1?1:0;mn.glyphOffsetArray.length>=xc.MAX_GLYPHS&&Un("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ir.sortKey&&mn.addToSortKeyRanges(mn.symbolInstances.length,Ir.sortKey),mn.symbolInstances.emplaceBack(ja.x,ja.y,ja.z,Zt.x,Zt.y,Rl.right>=0?Rl.right:-1,Rl.center>=0?Rl.center:-1,Rl.left>=0?Rl.left:-1,Rl.vertical>=0?Rl.vertical:-1,nf,rf,Dp,void 0!==Wo?Wo:mn.collisionBoxArray.length,void 0!==Wo?Wo+1:mn.collisionBoxArray.length,void 0!==Us?Us:mn.collisionBoxArray.length,void 0!==Us?Us+1:mn.collisionBoxArray.length,void 0!==Zo?Zo:mn.collisionBoxArray.length,void 0!==Zo?Zo+1:mn.collisionBoxArray.length,Xo||mn.collisionBoxArray.length,Xo?Xo+1:mn.collisionBoxArray.length,qr,Ep,Tp,ah,wp,Mp,0,Cp,Sp,Va)}(t,qt,Qt,rt,n,s,u,St,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Re,qe,C,0,Me,lt,J,e,f,S,L,F)};if("line"===At)for(const rt of og(e.geometry,0,0,On,On)){const qt=$_(rt,we,Ke,n.vertical||ce,s,24,pe,t.overscaling,On);for(const Sn of qt)ce&&dg(t,ce.text,Je,Sn)||Ot(rt,Sn,F)}else if("line-center"===At){for(const rt of e.geometry)if(rt.length>1){const qt=rg(rt,Ke,n.vertical||ce,s,24,pe);qt&&Ot(rt,qt,F)}}else if("Polygon"===e.type)for(const rt of xm(e.geometry,0)){const qt=ug(rt,16);Ot(rt[0],new Ao(qt.x,qt.y,0,0,void 0),F)}else if("LineString"===e.type)for(const rt of e.geometry)Ot(rt,new Ao(rt[0].x,rt[0].y,0,0,void 0),F);else if("Point"===e.type)for(const rt of e.geometry)for(const qt of rt)Ot([qt],new Ao(qt.x,qt.y,0,0,void 0),F)}const Ml=32640;function Z_(t,e,n,s,u,f,y,b,C,S,L,F,B,j,$,J,ce){const ye=function(we,Re,Me,Ke,qe,lt,At,Je){const dt=[];if(0===Re.positionedLines.length)return dt;const mt=Ke.layout.get("text-rotate").evaluate(lt,{})*Math.PI/180,St=function(Qt){const mn=Qt[0],Zt=Qt[1],Pn=mn*Zt;return Pn>0?[mn,-Zt]:Pn<0?[-mn,Zt]:0===mn?[Zt,mn]:[Zt,-mn]}(Me);let Ot=Math.abs(Re.top-Re.bottom);for(const Qt of Re.positionedLines)Ot-=Qt.lineOffset;const rt=Re.positionedLines.length,qt=Ot/rt;let Sn=Re.top-Me[1];for(let Qt=0;Qt<rt;++Qt){const mn=Re.positionedLines[Qt];Sn=tp(Re,qt,Sn,Qt);for(const Zt of mn.positionedGlyphs){if(!Zt.rect)continue;const Pn=Zt.rect||{};let ar=4,lr=!0,cr=1,Fn=0;if(Zt.imageName){const Xr=At[Zt.imageName];if(!Xr)continue;if(Xr.sdf){Un("SDF images are not supported in formatted text and will be ignored.");continue}lr=!1,cr=Xr.pixelRatio,ar=1/cr}const Nr=(qe||Je)&&Zt.vertical,Gn=Zt.metrics.advance*Zt.scale/2,mr=Zt.metrics,qr=Zt.rect;if(null===qr)continue;Je&&Re.verticalizable&&(Fn=Zt.imageName?Gn-Zt.metrics.width*Zt.scale/2:0);const li=qe?[Zt.x+Gn,Zt.y]:[0,0];let ci=[0,0],pi=[0,0],yi=!1;qe||(Nr?(pi=[Zt.x+Gn+St[0],Zt.y+St[1]-Fn],yi=!0):ci=[Zt.x+Gn+Me[0],Zt.y+Me[1]-Fn]);const Gi=qr.w*Zt.scale/(cr*(Zt.localGlyph?2:1)),qo=qr.h*Zt.scale/(cr*(Zt.localGlyph?2:1));let Wr,vo,co,Ir;if(Nr){const Xr=Zt.y-Sn,Ji=new st(-Gn,Gn-Xr),ys=-Math.PI/2,Wo=new st(...pi);Wr=new st(-Gn+ci[0],ci[1]),Wr._rotateAround(ys,Ji)._add(Wo),Wr.x+=-Xr+Gn,Wr.y-=(mr.left-ar)*Zt.scale;const Zo=Zt.imageName?mr.advance*Zt.scale:_s*Zt.scale,Us=String.fromCharCode(Zt.glyph);z_(Us)?Wr.x+=(1-ar)*Zt.scale:Vm(Us)?Wr.x+=Zo-mr.height*Zt.scale+(-ar-1)*Zt.scale:Wr.x+=Zt.imageName||mr.width+2*ar===qr.w&&mr.height+2*ar===qr.h?(Zo-qo)/2:(Zo-(mr.height+2*ar)*Zt.scale)/2,vo=new st(Wr.x,Wr.y-Gi),co=new st(Wr.x+qo,Wr.y),Ir=new st(Wr.x+qo,Wr.y-Gi)}else{const Xr=(mr.left-ar)*Zt.scale-Gn+ci[0],Ji=(-mr.top-ar)*Zt.scale+ci[1],ys=Xr+Gi,Wo=Ji+qo;Wr=new st(Xr,Ji),vo=new st(ys,Ji),co=new st(Xr,Wo),Ir=new st(ys,Wo)}if(mt){let Xr;Xr=qe?new st(0,0):yi?new st(St[0],St[1]):new st(Me[0],Me[1]),Wr._rotateAround(mt,Xr),vo._rotateAround(mt,Xr),co._rotateAround(mt,Xr),Ir._rotateAround(mt,Xr)}const Ii=new st(0,0),Ro=new st(0,0);dt.push({tl:Wr,tr:vo,bl:co,br:Ir,tex:Pn,writingMode:Re.writingMode,glyphOffset:li,sectionIndex:Zt.sectionIndex,isSDF:lr,pixelOffsetTL:Ii,pixelOffsetBR:Ro,minFontScaleX:0,minFontScaleY:0})}}return dt}(0,s,C,f,y,b,u,t.allowVerticalPlacement),Te=t.textSizeData;let pe=null;"source"===Te.kind?(pe=[_c*f.layout.get("text-size").evaluate(b,{},ce)],pe[0]>Ml&&Un(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Te.kind&&(pe=[_c*$.compositeTextSizes[0].evaluate(b,{},ce),_c*$.compositeTextSizes[1].evaluate(b,{},ce)],(pe[0]>Ml||pe[1]>Ml)&&Un(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,ye,pe,C,y,b,L,e,n,S.lineStartIndex,S.lineLength,j,J,ce);for(const we of F)B[we]=t.text.placedSymbolArray.length-1;return 4*ye.length}function zd(t){for(const e in t)return t[e];return null}function ip(t,e,n,s,u,f,y,b,C,S){let L=y.top,F=y.bottom,B=y.left,j=y.right;const $=y.collisionPadding;if($&&(B-=$[0],L-=$[1],j+=$[2],F+=$[3]),C){const J=new st(B,L),ce=new st(j,L),ye=new st(B,F),Te=new st(j,F),pe=ht(C);let we=new st(0,0);S&&(we=new st(S[0],S[1])),J._rotateAround(pe,we),ce._rotateAround(pe,we),ye._rotateAround(pe,we),Te._rotateAround(pe,we),B=Math.min(J.x,ce.x,ye.x,Te.x),j=Math.max(J.x,ce.x,ye.x,Te.x),L=Math.min(J.y,ce.y,ye.y,Te.y),F=Math.max(J.y,ce.y,ye.y,Te.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,B,L,j,F,b,s,u,f),t.length-1}function Nd(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function dg(t,e,n,s){const u=t.compareText;if(e in u){const f=u[e];for(let y=f.length-1;y>=0;y--)if(s.dist(f[y])<n)return!0}else u[e]=[];return u[e].push(s),!1}const fg=an([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:op}=fg,Bd=an([{name:"a_pos_3",components:3,type:"Int16"}]);var Oa=an([{name:"a_pos",type:"Int16",components:2}]);const cl=On/Math.PI/2,Wu=2*ol(1,0)*cl*Math.PI,Zu=[64,32,16],Fa=-cl,za=cl,X_=[new Os([Fa,Fa,Fa],[za,za,za]),new Os([Fa,Fa,Fa],[0,0,za]),new Os([0,Fa,Fa],[za,0,za]),new Os([Fa,0,Fa],[0,za,za]),new Os([0,0,Fa],[za,za,za])];function pg(t,e,n,s=!0){const u=ma([],t._camera.position,t.worldSize),f=[e,n,1,1];Jc(f,f,t.pixelMatrixInverse),sm(f,f,1/f[3]);const y=gs([],Wl([],f,u)),b=t.globeMatrix,C=[b[12],b[13],b[14]],S=Wl([],C,u),L=wh(S),F=gs([],S),B=t.worldSize/(2*Math.PI),j=Sl(F,y),$=Math.asin(B/L);if($<Math.acos(j)){if(!s)return null;const At=[],Je=[];ma(At,y,L/j),gs(Je,Wl(Je,At,S)),gs(y,dc(y,S,ma(y,Je,Math.tan($)*L)))}const J=[];new Ff(u,y).closestPointOnSphere(C,B,J);const ce=gs([],uo(b,0)),ye=gs([],uo(b,1)),Te=gs([],uo(b,2)),pe=Sl(ce,J),we=Sl(ye,J),Re=Sl(Te,J),Me=un(Math.asin(-we/B));let Ke=un(Math.atan2(pe,Re));Ke=t.center.lng+function(At,Je){const dt=(Je-At+180)%360-180;return dt<-180?dt+360:dt}(t.center.lng,Ke);const qe=xl(Ke),lt=gt(bl(Me),0,1);return new Xc(qe,lt)}class zh{constructor(e,n,s){this.a=Wl([],e,s),this.b=Wl([],n,s),this.center=s;const u=gs([],this.a),f=gs([],this.b);this.angle=Math.acos(Sl(u,f))}}function sp(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(s,u,f,y){const b=Math.sin(f);return s*(Math.sin((1-y)*f)/b)+u*(Math.sin(y*f)/b)}(t.a[e],t.b[e],t.angle,gt(n,0,1))+t.center[e]}function vc(t){if(t.z<=1)return X_[t.z+2*t.y+t.x];const e=ap(Ud(t));return Os.fromPoints(e)}function lu(t,e,n){return ma(t,t,1-n),Pu(t,t,e,n)}function mg(t,e){const n=Yu(e.zoom);if(0===n)return vc(t);const s=Ud(t),u=ap(s),f=xl(s.getWest())*e.worldSize,y=xl(s.getEast())*e.worldSize,b=bl(s.getNorth())*e.worldSize,C=bl(s.getSouth())*e.worldSize,S=[f,b,0],L=[y,b,0],F=[f,C,0],B=[y,C,0],j=If([],e.globeMatrix);return lo(S,S,j),lo(L,L,j),lo(F,F,j),lo(B,B,j),u[0]=lu(u[0],F,n),u[1]=lu(u[1],B,n),u[2]=lu(u[2],L,n),u[3]=lu(u[3],S,n),Os.fromPoints(u)}function gg(t,e,n){for(const s of t)lo(s,s,e),ma(s,s,n)}function Ud({x:t,y:e,z:n}){const s=1/(1<<n),u=new Sr(sl(t*s),Io((e+1)*s)),f=new Sr(sl((t+1)*s),Io(e*s));return new Pc(u,f)}function ap(t){const e=ht(t.getNorth()),n=ht(t.getSouth()),s=Math.cos(e),u=Math.cos(n),f=Math.sin(e),y=Math.sin(n),b=t.getWest(),C=t.getEast();return[Xu(u,y,b),Xu(u,y,C),Xu(s,f,C),Xu(s,f,b)]}function Xu(t,e,n,s=cl){return n=ht(n),[t*Math.sin(n)*s,-e*s,t*Math.cos(n)*s]}function Ku(t,e,n){return Xu(Math.cos(ht(t)),Math.sin(ht(t)),e,n)}function cu(t,e,n,s){const u=1<<n.z,f=(t/On+n.x)/u;return Ku(Io((e/On+n.y)/u),sl(f),s)}function jd({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Vd=new Float64Array(16);function Nh(t){const e=jd(t),n=s_(Vd,[e,e,e]);return al(n,n,((s=[])[0]=-(u=t.min)[0],s[1]=-u[1],s[2]=-u[2],s));var s,u}function lp(t){const e=(s=t.min,(n=Vd)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=s[0],n[13]=s[1],n[14]=s[2],n[15]=1,n);var n,s;const u=1/jd(t);return Cl(e,e,[u,u,u])}function _g(t,e,n,s,u){const f=function(C){const S=On/(2*Math.PI);return C/(2*Math.PI)/S}(n),y=[t,e,-n/(2*Math.PI)],b=Dl(new Float64Array(16));return al(b,b,y),Cl(b,b,[f,f,f]),Af(b,b,ht(-u)),Pf(b,b,ht(-s)),b}function Yu(t){return dn(5,6,t)}function yg(t,e){const n=Ku(e.lat,e.lng);return y=(u=Lf([],function($){const J=Ku($._center.lat,$._center.lng);let ce=im([],Au(0,1,0),J);const ye=a_([],-$.angle,J);ce=lo(ce,ce,ye),a_(ye,-$._pitch,ce);const Te=gs([],J);return ma(Te,Te,$.cameraToCenterDistance/$.pixelsPerMeter*Wu),lo(Te,Te,ye),dc([],J,Te)}(t),n))[0],b=u[1],C=u[2],S=(f=n)[0],L=f[1],F=f[2],j=(B=Math.sqrt(y*y+b*b+C*C)*Math.sqrt(S*S+L*L+F*F))&&Sl(u,f)/B,Math.acos(Math.min(Math.max(j,-1),1));var u,f,y,b,C,S,L,F,B,j}function cp(t,e){return yg(t,e)>Math.PI/2*1.01}const vg=ht(85),xg=Math.cos(vg),bg=Math.sin(vg);function wg(t,e){const n=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),f=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),y=Math.sin(t._pitch)*f+u;return Math.min(1.01*y,u*(1/t._horizonShift))}function Ju(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),s=t.x*n,u=(t.x+1)*n,f=t.y*n,y=(t.y+1)*n,b=sl(s),C=sl(u),S=Io(f),L=Io(y),F=e.project(b,S),B=e.project(C,S),j=e.project(C,L),$=e.project(b,L);let J=Math.min(F.x,B.x,j.x,$.x),ce=Math.min(F.y,B.y,j.y,$.y),ye=Math.max(F.x,B.x,j.x,$.x),Te=Math.max(F.y,B.y,j.y,$.y);const pe=n/16;function we(Me,Ke,qe,lt,At,Je){const dt=(qe+At)/2,mt=(lt+Je)/2,St=e.project(sl(dt),Io(mt)),Ot=Math.max(0,J-St.x,ce-St.y,St.x-ye,St.y-Te);J=Math.min(J,St.x),ye=Math.max(ye,St.x),ce=Math.min(ce,St.y),Te=Math.max(Te,St.y),Ot>pe&&(we(Me,St,qe,lt,dt,mt),we(St,Ke,dt,mt,At,Je))}we(F,B,s,f,u,f),we(B,j,u,f,u,y),we(j,$,u,y,s,y),we($,F,s,y,s,f),J-=pe,ce-=pe,ye+=pe,Te+=pe;const Re=1/Math.max(ye-J,Te-ce);return{scale:Re,x:J*Re,y:ce*Re,x2:ye*Re,y2:Te*Re,projection:e}}const Eg=Dl(new Float32Array(16));class uu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Sr(0,0)}projectTilePoint(e,n,s){return{x:e,y:n,z:0}}locationPoint(e,n,s=!0){return e._coordinatePoint(e.locationCoordinate(n),s)}pixelsPerMeter(e,n){return ol(1,e)*n}pixelSpaceConversion(e,n,s){return 1}farthestPixelDistance(e){return wg(e,e.pixelsPerMeter)}pointCoordinate(e,n,s,u){const f=e.horizonLineFromTop(!1),y=new st(n,Math.max(f,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(y,u))}pointCoordinate3D(e,n,s){const u=new st(n,s);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const s=e.horizonLineFromTop();return n.y<s}createInversionMatrix(e,n){return Eg}createTileMatrix(e,n,s){let u,f,y;const b=s.canonical,C=Dl(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=Ju(b,this);u=1,f=S.x+s.wrap*S.scale,y=S.y,Cl(C,C,[u/S.scale,u/S.scale,e.pixelsPerMeter/n])}else u=n/e.zoomScale(b.z),f=(b.x+Math.pow(2,b.z)*s.wrap)*u,y=b.y*u;return al(C,C,[f,y,0]),Cl(C,C,[u/On,u/On,1]),C}upVector(e,n,s){return[0,0,1]}upVectorScale(e,n,s){return{metersToTile:1}}}class $d extends uu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,s]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(ht(n));this.n=(u+Math.sin(ht(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:s,c:u,r0:f}=this,y=ht(e-this.center[0]),b=ht(n),C=Math.sqrt(u-2*s*Math.sin(b))/s;return{x:C*Math.sin(y*s),y:C*Math.cos(y*s)-f,z:0}}unproject(e,n){const{n:s,c:u,r0:f}=this,y=f+n;let b=Math.atan2(e,Math.abs(y))*Math.sign(y);y*s<0&&(b-=Math.PI*Math.sign(e)*Math.sign(y));const C=ht(this.center[0])*s;b=Kn(b,-Math.PI-C,Math.PI-C);const S=gt(un(b/s)+this.center[0],-180,180),L=Math.asin(gt((u-(e*e+y*y)*s*s)/(2*s),-1,1)),F=gt(un(L),-85.051129,wl);return new Sr(S,F)}}const Bh=1.340264,Uh=-.081106,hu=893e-6,jh=.003796,Na=Math.sqrt(3)/2;class Vh extends uu{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Na*Math.sin(n)),u=s*s,f=u*u*u;return{x:.5*(e*Math.cos(s)/(Na*(Bh+3*Uh*u+f*(7*hu+9*jh*u)))/Math.PI+.5),y:1-.5*(s*(Bh+Uh*u+f*(hu+jh*u))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,u=s*s,f=u*u*u;for(let L,F,B,j=0;j<12&&(F=s*(Bh+Uh*u+f*(hu+jh*u))-n,B=Bh+3*Uh*u+f*(7*hu+9*jh*u),L=F/B,s=gt(s-L,-Math.PI/3,Math.PI/3),u=s*s,f=u*u*u,!(Math.abs(L)<1e-12));++j);const y=Na*e*(Bh+3*Uh*u+f*(7*hu+9*jh*u))/Math.cos(s),b=Math.asin(Math.sin(s)/Na),C=gt(180*y/Math.PI,-180,180),S=gt(180*b/Math.PI,-85.051129,wl);return new Sr(C,S)}}class Bs extends uu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const s=360*(e-.5),u=gt(360*(.5-n),-85.051129,wl);return new Sr(s,u)}}const ul=Math.PI/2;function du(t){return Math.tan((ul+t)/2)}class hl extends uu{constructor(e){super(e),this.center=e.center||[0,30];const[n,s]=this.parallels=e.parallels||[30,30];let u=ht(n),f=ht(s);this.southernCenter=u+f<0,this.southernCenter&&(u=-u,f=-f);const y=Math.cos(u),b=du(u);this.n=u===f?Math.sin(u):Math.log(y/Math.cos(f))/Math.log(du(f)/b),this.f=y*Math.pow(du(u),this.n)/this.n}project(e,n){n=ht(n),this.southernCenter&&(n=-n),e=ht(e-this.center[0]);const s=1e-6,{n:u,f}=this;f>0?n<-ul+s&&(n=-ul+s):n>ul-s&&(n=ul-s);const y=f/Math.pow(du(n),u);let b=y*Math.sin(u*e),C=f-y*Math.cos(u*e);return b=.5*(b/Math.PI+.5),C=.5*(C/Math.PI+.5),{x:b,y:this.southernCenter?C:1-C,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:s,f:u}=this,f=u-n,y=Math.sign(f),b=Math.sign(s)*Math.sqrt(e*e+f*f);let C=Math.atan2(e,Math.abs(f))*y;f*s<0&&(C-=Math.PI*Math.sign(e)*y);const S=gt(un(C/s)+this.center[0],-180,180),L=gt(un(2*Math.atan(Math.pow(u/b,1/s))-ul),-85.051129,wl);return new Sr(S,this.southernCenter?-L:L)}}class Gd extends uu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:xl(e),y:bl(n),z:0}}unproject(e,n){const s=sl(e),u=Io(n);return new Sr(s,u)}}const fu=ht(wl);class Qu extends uu{project(e,n){const s=(n=ht(n))*n,u=s*s;return{x:.5*((e=ht(e))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,u=25,f=0,y=s*s;do{y=s*s;const S=y*y;f=(s*(1.007226+y*(.015085+S*(.028874*y-.044475-.005916*S)))-n)/(1.007226+y*(.045255+S*(.259866*y-.311325-.005916*11*S))),s=gt(s-f,-fu,fu)}while(Math.abs(f)>1e-6&&--u>0);y=s*s;const b=gt(un(e/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),C=un(s);return new Sr(b,C)}}const pu=ht(wl);class eh extends uu{project(e,n){n=ht(n),e=ht(e);const s=Math.cos(n),u=2/Math.PI,f=Math.acos(s*Math.cos(e/2)),y=Math.sin(f)/f,b=.5*(e*u+2*s*Math.sin(e/2)/y)||0,C=.5*(n+Math.sin(n)/y)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(e,n){let s=e=(2*e-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,f=25;const y=1e-6;let b=0,C=0;do{const S=Math.cos(u),L=Math.sin(u),F=2*L*S,B=L*L,j=S*S,$=Math.cos(s/2),J=Math.sin(s/2),ce=2*$*J,ye=J*J,Te=1-j*$*$,pe=Te?1/Te:0,we=Te?Math.acos(S*$)*Math.sqrt(1/Te):0,Re=.5*(2*we*S*J+2*s/Math.PI)-e,Me=.5*(we*L+u)-n,Ke=.5*pe*(j*ye+we*S*$*B)+1/Math.PI,qe=pe*(ce*F/4-we*L*J),lt=.125*pe*(F*J-we*L*j*ce),At=.5*pe*(B*$+we*ye*S)+.5,Je=qe*lt-At*Ke;b=(Me*qe-Re*At)/Je,C=(Re*lt-Me*Ke)/Je,s=gt(s-b,-Math.PI,Math.PI),u=gt(u-C,-pu,pu)}while((Math.abs(b)>y||Math.abs(C)>y)&&--f>0);return new Sr(un(s),un(u))}}class mu extends uu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ht(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:s,cosPhi:u}=this;return{x:ht(e)*u*s+.5,y:-Math.sin(ht(n))/u*s+.5,z:0}}unproject(e,n){const{scale:s,cosPhi:u}=this,f=-(n-.5)/s,y=gt(un((e-.5)/s)/u,-180,180),b=Math.asin(gt(f*u,-1,1)),C=gt(un(b),-85.051129,wl);return new Sr(y,C)}}class th extends Gd{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,n,s){const u=cu(e,n,s);return lo(u,u,Nh(vc(s))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,n){const s=Ku(n.lat,n.lng),u=gs([],s),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;Pu(s,s,u,ol(1,0)*On*f);const y=Dl(new Float64Array(16));return Kc(y,e.pixelMatrix,e.globeMatrix),lo(s,s,y),new st(s[0],s[1])}pixelsPerMeter(e,n){return ol(1,0)*n}pixelSpaceConversion(e,n,s){const u=ol(1,e)*n,f=Ln(ol(1,45)*n,u,s);return this.pixelsPerMeter(e,n)/f}createTileMatrix(e,n,s){const u=lp(vc(s.canonical));return Kc(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,n){const{center:s}=e,u=Nh(vc(n));return Pf(u,u,ht(s.lng)),Af(u,u,ht(s.lat)),Cl(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,n,s,u){return pg(e,n,s,!0)||new Xc(0,0)}pointCoordinate3D(e,n,s){const u=this.pointCoordinate(e,n,s,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,n){return!pg(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(u,f){const y=u.cameraToCenterDistance,b=u._centerAltitude*f,C=u._camera,S=u._camera.forward(),L=dc([],ma([],S,-y),[0,0,b]),F=u.worldSize/(2*Math.PI),B=[0,0,-F],j=u.width/u.height,$=Math.tan(u.fovAboveCenter),J=ma([],C.up(),$),ce=ma([],C.right(),$*j),ye=gs([],dc([],dc([],S,J),ce)),Te=[];let pe;if(new Ff(L,ye).closestPointOnSphere(B,F,Te)){const we=dc([],Te,B),Re=Wl([],we,L);pe=Math.cos(u.fovAboveCenter)*wh(Re)}else{const we=Wl([],L,B),Re=Wl([],B,L);gs(Re,Re);const Me=wh(we)-F;pe=Math.sqrt(Me*(Me+2*F));const Ke=Math.acos(pe/(F+Me))-Math.acos(Sl(S,Re));pe*=Math.cos(Ke)}return 1.01*pe}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Yu(e.zoom);if(s>0){const u=wg(e,ol(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),y=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ln(n,u+f*(1-Math.cos(y)),Math.pow(s,10))}return n}upVector(e,n,s){return cu(n,s,e,1)}upVectorScale(e){return{metersToTile:Wu*jd(vc(e))}}}function gu(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Gd(t);case"equirectangular":return new Bs(t);case"naturalEarth":return new Qu(t);case"equalEarth":return new Vh(t);case"winkelTripel":return new eh(t);case"albers":return n?new mu(t):new $d(t);case"lambertConformalConic":return n?new mu(t):new hl(t);case"globe":return new th(t)}throw new Error(`Invalid projection name: ${t.name}`)}const nh=wd.types,rh=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $h(t,e,n,s,u,f,y,b,C,S,L,F,B){const j=b?Math.min(Ml,Math.round(b[0])):0,$=b?Math.min(Ml,Math.round(b[1])):0;t.emplaceBack(e,n,Math.round(32*s),Math.round(32*u),f,y,(j<<1)+(C?1:0),$,16*S,16*L,256*F,256*B)}function Gh(t,e,n,s,u,f,y){t.emplaceBack(e,n,s,u,f,y)}function Hh(t,e,n,s,u){t.emplaceBack(e,n,s,u),t.emplaceBack(e,n,s,u),t.emplaceBack(e,n,s,u),t.emplaceBack(e,n,s,u)}function Tg(t){for(const e of t.sections)if(G(e.text))return!0;return!1}class Hd{constructor(e){this.layoutVertexArray=new si,this.indexArray=new Ho,this.programConfigurations=e,this.segments=new ao,this.dynamicLayoutVertexArray=new Qs,this.opacityVertexArray=new so,this.placedSymbolArray=new Bp,this.globeExtVertexArray=new Cr}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,n,s,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ru.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,rh,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Um.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}sn(Hd,"SymbolBuffers");class qd{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new ao,this.collisionVertexArray=new Du,this.collisionVertexArrayExt=new yl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,k_.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Zf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}sn(qd,"CollisionBuffers");class xc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Dl([]),this.placementViewportMatrix=Dl([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jm(this.zoom,n["text-size"]),this.iconSizeData=jm(this.zoom,n["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(y=>Ns[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Hd(new Zc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Hd(new Zc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new jp,this.lineVertexArray=new Vp,this.symbolInstances=new hf}calculateGlyphDependencies(e,n,s,u,f){for(let y=0;y<e.length;y++)if(n[e.charCodeAt(y)]=!0,u&&f){const b=Zl[e.charAt(y)];b&&(n[b.charCodeAt(0)]=!0)}}populate(e,n,s,u){const f=this.layers[0],y=f.layout,b="globe"===this.projection.name,C=y.get("text-font"),S=y.get("text-field"),L=y.get("icon-image"),F=("constant"!==S.value.kind||S.value.value instanceof Li&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&("constant"!==C.value.kind||C.value.value.length>0),B="constant"!==L.value.kind||!!L.value.value||Object.keys(L.parameters).length>0,j=y.get("symbol-sort-key");if(this.features=[],!F&&!B)return;const $=n.iconDependencies,J=n.glyphDependencies,ce=n.availableImages,ye=new Be(this.zoom);for(const{feature:Te,id:pe,index:we,sourceLayerIndex:Re}of e){const Me=f._featureFilter.needGeometry,Ke=Tl(Te,Me);if(!f._featureFilter.filter(ye,Ke,s))continue;if(Me||(Ke.geometry=El(Te,s,u)),b&&1!==Te.type&&s.z<=5){const Je=Ke.geometry,dt=.98078528056,mt=(St,Ot)=>Sl(cu(St.x,St.y,s,1),cu(Ot.x,Ot.y,s,1))<dt;for(let St=0;St<Je.length;St++)Je[St]=ad(Je[St],mt)}let qe,lt;if(F){const Je=f.getValueAndResolveTokens("text-field",Ke,s,ce),dt=Li.factory(Je);Tg(dt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ke()||this.hasRTLText&&He.isParsed())&&(qe=F_(dt,f,Ke))}if(B){const Je=f.getValueAndResolveTokens("icon-image",Ke,s,ce);lt=Je instanceof gr?Je:gr.fromString(Je)}if(!qe&&!lt)continue;const At=this.sortFeaturesByKey?j.evaluate(Ke,{},s):void 0;if(this.features.push({id:pe,text:qe,icon:lt,index:we,sourceLayerIndex:Re,geometry:Ke.geometry,properties:Te.properties,type:nh[Te.type],sortKey:At}),lt&&($[lt.name]=!0),qe){const Je=C.evaluate(Ke,{},s).join(","),dt="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ns.vertical)>=0;for(const mt of qe.sections)if(mt.image)$[mt.image.name]=!0;else{const St=p(qe.toString()),Ot=mt.fontStack||Je,rt=J[Ot]=J[Ot]||{};this.calculateGlyphDependencies(mt.text,rt,dt,this.allowVerticalPlacement,St)}}}"line"===y.get("symbol-placement")&&(this.features=function(Te){const pe={},we={},Re=[];let Me=0;function Ke(Je){Re.push(Te[Je]),Me++}function qe(Je,dt,mt){const St=we[Je];return delete we[Je],we[dt]=St,Re[St].geometry[0].pop(),Re[St].geometry[0]=Re[St].geometry[0].concat(mt[0]),St}function lt(Je,dt,mt){const St=pe[dt];return delete pe[dt],pe[Je]=St,Re[St].geometry[0].shift(),Re[St].geometry[0]=mt[0].concat(Re[St].geometry[0]),St}function At(Je,dt,mt){const St=mt?dt[0][dt[0].length-1]:dt[0][0];return`${Je}:${St.x}:${St.y}`}for(let Je=0;Je<Te.length;Je++){const dt=Te[Je],mt=dt.geometry,St=dt.text?dt.text.toString():null;if(!St){Ke(Je);continue}const Ot=At(St,mt),rt=At(St,mt,!0);if(Ot in we&&rt in pe&&we[Ot]!==pe[rt]){const qt=lt(Ot,rt,mt),Sn=qe(Ot,rt,Re[qt].geometry);delete pe[Ot],delete we[rt],we[At(St,Re[Sn].geometry,!0)]=Sn,Re[qt].geometry=null}else Ot in we?qe(Ot,rt,mt):rt in pe?lt(Ot,rt,mt):(Ke(Je),pe[Ot]=Me-1,we[rt]=Me-1)}return Re.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Te,pe)=>Te.sortKey-pe.sortKey)}update(e,n,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,s,u),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,s,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=gu(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:u,y:f}of n)this.lineVertexArray.emplaceBack(u,f);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,u,f,y,b,C,S,L,F,B,j,$){const J=e.indexArray,ce=e.layoutVertexArray,ye=e.globeExtVertexArray,Te=e.segments.prepareSegment(4*n.length,ce,J,this.canOverlap?y.sortKey:void 0),pe=this.glyphOffsetArray.length,we=Te.vertexLength,Re=this.allowVerticalPlacement&&b===Ns.vertical?Math.PI/2:0,Me=y.text&&y.text.sections;for(let qe=0;qe<n.length;qe++){const{tl:lt,tr:At,bl:Je,br:dt,tex:mt,pixelOffsetTL:St,pixelOffsetBR:Ot,minFontScaleX:rt,minFontScaleY:qt,glyphOffset:Sn,isSDF:Qt,sectionIndex:mn}=n[qe],Zt=Te.vertexLength,Pn=Sn[1];if($h(ce,S.x,S.y,lt.x,Pn+lt.y,mt.x,mt.y,s,Qt,St.x,St.y,rt,qt),$h(ce,S.x,S.y,At.x,Pn+At.y,mt.x+mt.w,mt.y,s,Qt,Ot.x,St.y,rt,qt),$h(ce,S.x,S.y,Je.x,Pn+Je.y,mt.x,mt.y+mt.h,s,Qt,St.x,Ot.y,rt,qt),$h(ce,S.x,S.y,dt.x,Pn+dt.y,mt.x+mt.w,mt.y+mt.h,s,Qt,Ot.x,Ot.y,rt,qt),C){const{x:ar,y:lr,z:cr}=C.anchor,[Fn,Nr,Gn]=C.up;Gh(ye,ar,lr,cr,Fn,Nr,Gn),Gh(ye,ar,lr,cr,Fn,Nr,Gn),Gh(ye,ar,lr,cr,Fn,Nr,Gn),Gh(ye,ar,lr,cr,Fn,Nr,Gn),Hh(e.dynamicLayoutVertexArray,ar,lr,cr,Re)}else Hh(e.dynamicLayoutVertexArray,S.x,S.y,S.z,Re);J.emplaceBack(Zt,Zt+1,Zt+2),J.emplaceBack(Zt+1,Zt+2,Zt+3),Te.vertexLength+=4,Te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Sn[0]),qe!==n.length-1&&mn===n[qe+1].sectionIndex||e.programConfigurations.populatePaintArrays(ce.length,y,y.index,{},j,$,Me&&Me[mn])}const Ke=C?C.anchor:S;e.placedSymbolArray.emplaceBack(Ke.x,Ke.y,Ke.z,S.x,S.y,pe,this.glyphOffsetArray.length-pe,we,L,F,S.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],b,0,!1,0,B,0)}_commitLayoutVertex(e,n,s,u,f,y,b){e.emplaceBack(n,s,u,f,y,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,n,s,u,f,y,b){const C=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),S=C.vertexLength,L=b.tileAnchorX,F=b.tileAnchorY;for(let j=0;j<4;j++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,u,f,y,L,F,new st(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,y,L,F,new st(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,y,L,F,new st(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,f,y,L,F,new st(e.x1,e.y2)),C.vertexLength+=4;const B=s.indexArray;B.emplaceBack(S,S+1),B.emplaceBack(S+1,S+2),B.emplaceBack(S+2,S+3),B.emplaceBack(S+3,S),C.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,s,u,f,y){for(let b=u;b<f;b++){const C=s.get(b),S=this.getSymbolInstanceTextSize(e,y,n,b);this._addCollisionDebugVertices(C,S,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(e,n,s,u,f,y){for(let b=u;b<f;b++){const C=s.get(b),S=this.getSymbolInstanceIconSize(e,n,y.placedIconSymbolIndex);this._addCollisionDebugVertices(C,S,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new qd(fi,Cd.members,il),this.iconCollisionBox=new qd(fi,Cd.members,il);const s=iu(this.iconSizeData,e),u=iu(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const y=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,n,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(u,e,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(s,e,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(s,e,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,n,s,u){const f=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),y=Sd(this.textSizeData,e,f)/_s;return this.tilePixelRatio*y}getSymbolInstanceIconSize(e,n,s){const u=this.icon.placedSymbolArray.get(s),f=Sd(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,n,s){e.emplaceBack(n,-s,-s),e.emplaceBack(n,s,-s),e.emplaceBack(n,s,s),e.emplaceBack(n,-s,s)}_updateTextDebugCollisionBoxes(e,n,s,u,f,y){for(let b=u;b<f;b++){const C=s.get(b),S=this.getSymbolInstanceTextSize(e,y,n,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,C.padding)}}_updateIconDebugCollisionBoxes(e,n,s,u,f,y){for(let b=u;b<f;b++){const C=s.get(b),S=this.getSymbolInstanceIconSize(e,n,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,C.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=iu(this.iconSizeData,e),u=iu(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const y=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,n,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(u,e,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(s,e,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,s,u,f,y,b,C,S){const L={};if(n<s){const{x1:F,y1:B,x2:j,y2:$,padding:J,projectedAnchorX:ce,projectedAnchorY:ye,projectedAnchorZ:Te,tileAnchorX:pe,tileAnchorY:we,featureIndex:Re}=e.get(n);L.textBox={x1:F,y1:B,x2:j,y2:$,padding:J,projectedAnchorX:ce,projectedAnchorY:ye,projectedAnchorZ:Te,tileAnchorX:pe,tileAnchorY:we},L.textFeatureIndex=Re}if(u<f){const{x1:F,y1:B,x2:j,y2:$,padding:J,projectedAnchorX:ce,projectedAnchorY:ye,projectedAnchorZ:Te,tileAnchorX:pe,tileAnchorY:we,featureIndex:Re}=e.get(u);L.verticalTextBox={x1:F,y1:B,x2:j,y2:$,padding:J,projectedAnchorX:ce,projectedAnchorY:ye,projectedAnchorZ:Te,tileAnchorX:pe,tileAnchorY:we},L.verticalTextFeatureIndex=Re}if(y<b){const{x1:F,y1:B,x2:j,y2:$,padding:J,projectedAnchorX:ce,projectedAnchorY:ye,projectedAnchorZ:Te,tileAnchorX:pe,tileAnchorY:we,featureIndex:Re}=e.get(y);L.iconBox={x1:F,y1:B,x2:j,y2:$,padding:J,projectedAnchorX:ce,projectedAnchorY:ye,projectedAnchorZ:Te,tileAnchorX:pe,tileAnchorY:we},L.iconFeatureIndex=Re}if(C<S){const{x1:F,y1:B,x2:j,y2:$,padding:J,projectedAnchorX:ce,projectedAnchorY:ye,projectedAnchorZ:Te,tileAnchorX:pe,tileAnchorY:we,featureIndex:Re}=e.get(C);L.verticalIconBox={x1:F,y1:B,x2:j,y2:$,padding:J,projectedAnchorX:ce,projectedAnchorY:ye,projectedAnchorZ:Te,tileAnchorX:pe,tileAnchorY:we},L.verticalIconFeatureIndex=Re}return L}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),u=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),u=[],f=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const C=this.symbolInstances.get(b);u.push(0|Math.round(n*C.tileAnchorX+s*C.tileAnchorY)),f.push(C.featureIndex)}return y.sort((b,C)=>u[b]-u[C]||f[C]-f[b]),y}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:S}=s;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),y>=0&&y!==f&&y!==u&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}sn(xc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),xc.MAX_GLYPHS=65535,xc.addDynamicAttributes=Hh;const Dg=new In({"symbol-placement":new je(it.layout_symbol["symbol-placement"]),"symbol-spacing":new je(it.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new je(it.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Qe(it.layout_symbol["symbol-sort-key"]),"symbol-z-order":new je(it.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new je(it.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new je(it.layout_symbol["icon-ignore-placement"]),"icon-optional":new je(it.layout_symbol["icon-optional"]),"icon-rotation-alignment":new je(it.layout_symbol["icon-rotation-alignment"]),"icon-size":new Qe(it.layout_symbol["icon-size"]),"icon-text-fit":new je(it.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new je(it.layout_symbol["icon-text-fit-padding"]),"icon-image":new Qe(it.layout_symbol["icon-image"]),"icon-rotate":new Qe(it.layout_symbol["icon-rotate"]),"icon-padding":new je(it.layout_symbol["icon-padding"]),"icon-keep-upright":new je(it.layout_symbol["icon-keep-upright"]),"icon-offset":new Qe(it.layout_symbol["icon-offset"]),"icon-anchor":new Qe(it.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new je(it.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new je(it.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new je(it.layout_symbol["text-rotation-alignment"]),"text-field":new Qe(it.layout_symbol["text-field"]),"text-font":new Qe(it.layout_symbol["text-font"]),"text-size":new Qe(it.layout_symbol["text-size"]),"text-max-width":new Qe(it.layout_symbol["text-max-width"]),"text-line-height":new Qe(it.layout_symbol["text-line-height"]),"text-letter-spacing":new Qe(it.layout_symbol["text-letter-spacing"]),"text-justify":new Qe(it.layout_symbol["text-justify"]),"text-radial-offset":new Qe(it.layout_symbol["text-radial-offset"]),"text-variable-anchor":new je(it.layout_symbol["text-variable-anchor"]),"text-anchor":new Qe(it.layout_symbol["text-anchor"]),"text-max-angle":new je(it.layout_symbol["text-max-angle"]),"text-writing-mode":new je(it.layout_symbol["text-writing-mode"]),"text-rotate":new Qe(it.layout_symbol["text-rotate"]),"text-padding":new je(it.layout_symbol["text-padding"]),"text-keep-upright":new je(it.layout_symbol["text-keep-upright"]),"text-transform":new Qe(it.layout_symbol["text-transform"]),"text-offset":new Qe(it.layout_symbol["text-offset"]),"text-allow-overlap":new je(it.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new je(it.layout_symbol["text-ignore-placement"]),"text-optional":new je(it.layout_symbol["text-optional"])});var Wd={paint:new In({"icon-opacity":new Qe(it.paint_symbol["icon-opacity"]),"icon-color":new Qe(it.paint_symbol["icon-color"]),"icon-halo-color":new Qe(it.paint_symbol["icon-halo-color"]),"icon-halo-width":new Qe(it.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Qe(it.paint_symbol["icon-halo-blur"]),"icon-translate":new je(it.paint_symbol["icon-translate"]),"icon-translate-anchor":new je(it.paint_symbol["icon-translate-anchor"]),"text-opacity":new Qe(it.paint_symbol["text-opacity"]),"text-color":new Qe(it.paint_symbol["text-color"],{runtimeType:Wi,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Qe(it.paint_symbol["text-halo-color"]),"text-halo-width":new Qe(it.paint_symbol["text-halo-width"]),"text-halo-blur":new Qe(it.paint_symbol["text-halo-blur"]),"text-translate":new je(it.paint_symbol["text-translate"]),"text-translate-anchor":new je(it.paint_symbol["text-translate-anchor"])}),layout:Dg};class Cg{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:mi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}sn(Cg,"FormatSectionOverride",{omit:["defaultValue"]});class Zd extends vl{constructor(e){super(e,Wd)}recalculate(e,n){super.recalculate(e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const f of s)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,s,u){const f=this.layout.get(e).evaluate(n,{},s,u),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||jt(y.value)||!f?f:(b=n.properties,f.replace(/{([^{}]+)}/g,(S,L)=>L in b?String(b[L]):""));var b}createBucket(e){return new xc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Wd.paint.overridableProperties){if(!Zd.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new Cg(n),u=new Ge(s,n.property.specification);let f=null;f="constant"===n.value.kind||"source"===n.value.kind?new zn("source",u):new $n("composite",u,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new ft(n.property,f,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&Zd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),u=Wd.paint.properties[n];let f=!1;const y=b=>{for(const C of b)if(u.overrides&&u.overrides.hasOverride(C))return void(f=!0)};if("constant"===s.value.kind&&s.value.value instanceof Li)y(s.value.value.sections);else if("source"===s.value.kind){const b=S=>{f||(S instanceof jo&&ri(S.value)===Pr?y(S.value.sections):S instanceof ss?y(S.sections):S.eachChild(b))},C=s.value;C._styleExpression&&b(C._styleExpression.expression)}return f}getProgramConfiguration(e){return new uc(this,e)}}var Sg={paint:new In({"background-color":new je(it.paint_background["background-color"]),"background-pattern":new je(it.paint_background["background-pattern"]),"background-opacity":new je(it.paint_background["background-opacity"])})},Y_={paint:new In({"raster-opacity":new je(it.paint_raster["raster-opacity"]),"raster-hue-rotate":new je(it.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new je(it.paint_raster["raster-brightness-min"]),"raster-brightness-max":new je(it.paint_raster["raster-brightness-max"]),"raster-saturation":new je(it.paint_raster["raster-saturation"]),"raster-contrast":new je(it.paint_raster["raster-contrast"]),"raster-resampling":new je(it.paint_raster["raster-resampling"]),"raster-fade-duration":new je(it.paint_raster["raster-fade-duration"])})};class Mg extends vl{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var up={paint:new In({"sky-type":new je(it.paint_sky["sky-type"]),"sky-atmosphere-sun":new je(it.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new je(it.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new je(it.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new je(it.paint_sky["sky-gradient-radius"]),"sky-gradient":new _n(it.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new je(it.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new je(it.paint_sky["sky-atmosphere-color"]),"sky-opacity":new je(it.paint_sky["sky-opacity"])})};function qh(t,e,n){const s=[0,0,1],u=kf([]);return cm(u,u,n?-ht(t)+Math.PI:ht(t)),Eh(u,u,-ht(e)),fd(s,s,u),gs(s,s)}const J_={circle:class extends vl{constructor(t){super(t,em)}createBucket(t){return new Df(t)}queryRadius(t){const e=t;return Iu("circle-radius",this,e)+Iu("circle-stroke-width",this,e)+vh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,s,u,f,y,b){const C=hd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return pd(t,s,f,y,b,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),C,S)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new uc(this,t)}},heatmap:class extends vl{createBucket(t){return new dm(t)}constructor(t){super(t,pm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=md({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Iu("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,s,u,f,y,b){const C=this.paint.get("heatmap-radius").evaluate(e,n);return pd(t,s,f,y,b,!0,!0,new st(0,0),C)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new uc(this,t)}},hillshade:class extends vl{constructor(t){super(t,mm)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends vl{constructor(t){super(t,y_)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new uc(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new pc(t)}queryRadius(){return vh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,s,u,f){return!t.queryGeometry.isAboveHorizon&&Cf(xh(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends vl{constructor(t){super(t,Mm)}createBucket(t){return new Fu(t)}queryRadius(){return vh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new uc(this,t)}queryIntersectsFeature(t,e,n,s,u,f,y,b,C){const S=hd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),L=this.paint.get("fill-extrusion-height").evaluate(e,n),F=this.paint.get("fill-extrusion-base").evaluate(e,n),B=[0,0],j=b&&f.elevation,$=f.elevation?f.elevation.exaggeration():1,J=t.tile.getBucket(this);if(j&&J instanceof Fu){const we=J.centroidVertexArray,Re=C+1;Re<we.length&&(B[0]=we.geta_centroid_pos0(Re),B[1]=we.geta_centroid_pos1(Re))}if(0===B[0]&&1===B[1])return!1;"globe"===f.projection.name&&(s=ll([s],[new st(0,0),new st(On,On)],t.tileID.canonical).map(we=>we.polygon).flat());const ce=j?b:null,[ye,Te]=(Re=s,Me=F,Ke=L,qe=S,lt=y,At=ce,Je=B,dt=$,mt=f.center.lat,"globe"===(we=f).projection.name?function(Ot,rt,qt,Sn,Qt,mn,Zt,Pn,ar,lr,cr){const Fn=[],Nr=[],Gn=Ot.projection.upVectorScale(cr,Ot.center.lat,Ot.worldSize).metersToTile,mr=[0,0,0,1],qr=[0,0,0,1],li=(pi,yi,Gi,qo)=>{pi[0]=yi,pi[1]=Gi,pi[2]=qo,pi[3]=1},ci=Sm();qt>0&&(qt+=ci),Sn+=ci;for(const pi of rt){const yi=[],Gi=[];for(const qo of pi){const Wr=qo.x+Qt.x,vo=qo.y+Qt.y,co=Ot.projection.projectTilePoint(Wr,vo,cr),Ir=Ot.projection.upVector(cr,qo.x,qo.y);let Ii=qt,Ro=Sn;if(Zt){const Xr=pr(Wr,vo,qt,Sn,Zt,Pn,ar,lr);Ii+=Xr.base,Ro+=Xr.top}0!==qt?li(mr,co.x+Ir[0]*Gn*Ii,co.y+Ir[1]*Gn*Ii,co.z+Ir[2]*Gn*Ii):li(mr,co.x,co.y,co.z),li(qr,co.x+Ir[0]*Gn*Ro,co.y+Ir[1]*Gn*Ro,co.z+Ir[2]*Gn*Ro),lo(mr,mr,mn),lo(qr,qr,mn),yi.push(new Nu(mr[0],mr[1],mr[2])),Gi.push(new Nu(qr[0],qr[1],qr[2]))}Fn.push(yi),Nr.push(Gi)}return[Fn,Nr]}(we,Re,Me,Ke,qe,lt,At,Je,dt,mt,t.tileID.canonical):At?function(Ot,rt,qt,Sn,Qt,mn,Zt,Pn,ar){const lr=[],cr=[],Fn=[0,0,0,1];for(const Nr of Ot){const Gn=[],mr=[];for(const qr of Nr){const li=qr.x+Sn.x,ci=qr.y+Sn.y,pi=pr(li,ci,rt,qt,mn,Zt,Pn,ar);Fn[0]=li,Fn[1]=ci,Fn[2]=pi.base,Fn[3]=1,Jc(Fn,Fn,Qt),Fn[3]=Math.max(Fn[3],1e-5);const yi=new Nu(Fn[0]/Fn[3],Fn[1]/Fn[3],Fn[2]/Fn[3]);Fn[0]=li,Fn[1]=ci,Fn[2]=pi.top,Fn[3]=1,Jc(Fn,Fn,Qt),Fn[3]=Math.max(Fn[3],1e-5);const Gi=new Nu(Fn[0]/Fn[3],Fn[1]/Fn[3],Fn[2]/Fn[3]);Gn.push(yi),mr.push(Gi)}lr.push(Gn),cr.push(mr)}return[lr,cr]}(Re,Me,Ke,qe,lt,At,Je,dt,mt):function(Ot,rt,qt,Sn,Qt){const mn=[],Zt=[],Pn=Qt[8]*rt,ar=Qt[9]*rt,lr=Qt[10]*rt,cr=Qt[11]*rt,Fn=Qt[8]*qt,Nr=Qt[9]*qt,Gn=Qt[10]*qt,mr=Qt[11]*qt;for(const qr of Ot){const li=[],ci=[];for(const pi of qr){const yi=pi.x+Sn.x,Gi=pi.y+Sn.y,qo=Qt[0]*yi+Qt[4]*Gi+Qt[12],Wr=Qt[1]*yi+Qt[5]*Gi+Qt[13],vo=Qt[2]*yi+Qt[6]*Gi+Qt[14],co=Qt[3]*yi+Qt[7]*Gi+Qt[15],Ir=qo+Pn,Ii=Wr+ar,Ro=vo+lr,Xr=Math.max(co+cr,1e-5),Ji=qo+Fn,ys=Wr+Nr,Wo=vo+Gn,Zo=Math.max(co+mr,1e-5);li.push(new Nu(Ir/Xr,Ii/Xr,Ro/Xr)),ci.push(new Nu(Ji/Zo,ys/Zo,Wo/Zo))}mn.push(li),Zt.push(ci)}return[mn,Zt]}(Re,Me,Ke,qe,lt)),pe=t.queryGeometry;var we,Re,Me,Ke,qe,lt,At,Je,dt,mt;return function(we,Re,Me){let Ke=1/0;Cf(Me,Re)&&(Ke=Pm(Me,Re[0]));for(let qe=0;qe<Re.length;qe++){const lt=Re[qe],At=we[qe];for(let Je=0;Je<lt.length-1;Je++){const dt=lt[Je],mt=[dt,lt[Je+1],At[Je+1],At[Je],dt];Zp(Me,mt)&&(Ke=Math.min(Ke,Pm(Me,mt)))}}return Ke!==1/0&&Ke}(ye,Te,pe.isPointQuery()?pe.screenBounds:pe.screenGeometry)}},line:class extends vl{constructor(t){super(t,zm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof aa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Nm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Dd(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new uc(this,t)}queryRadius(t){const e=t,n=L_(Iu("line-width",this,e),Iu("line-gap-width",this,e)),s=Iu("line-offset",this,e);return n/2+Math.abs(s)+vh(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,s,u,f){if(t.queryGeometry.isAboveHorizon)return!1;const y=xh(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),b=t.pixelToTileUnitsFactor/2*L_(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),C=this.paint.get("line-offset").evaluate(e,n);return C&&(s=function(S,L){const F=[],B=new st(0,0);for(let j=0;j<S.length;j++){const $=S[j],J=[];for(let ce=0;ce<$.length;ce++){const Te=$[ce],pe=$[ce+1],we=0===ce?B:Te.sub($[ce-1])._unit()._perp(),Re=ce===$.length-1?B:pe.sub(Te)._unit()._perp(),Me=we._add(Re)._unit();Me._mult(1/(Me.x*Re.x+Me.y*Re.y)),J.push(Me._mult(L)._add(Te))}F.push(J)}return F}(s,C*t.pixelToTileUnitsFactor)),function(S,L,F){for(let B=0;B<L.length;B++){const j=L[B];if(S.length>=3)for(let $=0;$<j.length;$++)if(Mu(S,j[$]))return!0;if(Xp(S,j,F))return!0}return!1}(y,s,b)}isTileClipped(){return!0}},symbol:Zd,background:class extends vl{constructor(t){super(t,Sg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends vl{constructor(t){super(t,Y_)}getProgramIds(){return["raster"]}},sky:class extends vl{constructor(t){super(t,up),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=md({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),u=!s,f=t.style.light,y=f.properties.get("position");return u&&"viewport"===f.properties.get("anchor")&&Un("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?qh(y.azimuthal,90-y.polar,e):qh(s[0],90-s[1],e)}const n=this.paint.get("sky-gradient-center");return qh(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class zc{constructor(e,n,s,u){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,s){const{width:u,height:f}=e,{context:y}=this,{gl:b}=y,{HTMLImageElement:C,HTMLCanvasElement:S,HTMLVideoElement:L,ImageData:F,ImageBitmap:B}=Pe;if(b.bindTexture(b.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||!1!==n.premultiply)),s||this.size&&this.size[0]===u&&this.size[1]===f){const{x:j,y:$}=s||{x:0,y:0};e instanceof C||e instanceof S||e instanceof L||e instanceof F||B&&e instanceof B?b.texSubImage2D(b.TEXTURE_2D,0,j,$,b.RGBA,b.UNSIGNED_BYTE,e):b.texSubImage2D(b.TEXTURE_2D,0,j,$,u,f,b.RGBA,b.UNSIGNED_BYTE,e.data)}else this.size=[u,f],e instanceof C||e instanceof S||e instanceof L||e instanceof F||B&&e instanceof B?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,e):b.texImage2D(b.TEXTURE_2D,0,this.format,u,f,0,this.format,b.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(e,n){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Xd{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class hp{constructor(){this.tasks={},this.taskQueue=[],Mn(["process"],this),this.invoker=new Xd(this.process),this.nextId=0}add(e,n){const s=this.nextId++,u=function({type:f,isSymbolTile:y,zoom:b}){return b=b||0,"message"===f?0:"maybePrepare"!==f||y?"parseTile"!==f||y?"parseTile"===f&&y?300-b:"maybePrepare"===f&&y?400-b:500:200-b:100-b}(n);if(0===u){Kr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:n,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){Kr();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<n&&(n=f.priority,e=u)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class Ig{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const dp=["tile","layer","source","sourceLayer","state"];class Kd{constructor(e,n,s,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=s,this._y=u,this.properties=e.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const n of dp)void 0!==this[n]&&(e[n]=this[n]);return e}}const Ba=32,Il=33,Kl=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,s=0,u=0,f=0,y=0,b=0;for(1&e?u=f=y=Ba:n=s=b=Ba;(e>>=1)>1;){const S=n+u>>1,L=s+f>>1;1&e?(u=n,f=s,n=y,s=b):(n=u,s=f,u=y,f=b),y=S,b=L}const C=4*t;Kl[C+0]=n,Kl[C+1]=s,Kl[C+2]=u,Kl[C+3]=f}const Al=new Uint16Array(2178),bc=new Uint8Array(1089),ih=new Uint16Array(1089);function fp(t){return 0===t?-.03125:32===t?.03125:0}var Ag=an([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const pp={type:2,extent:On,loadGeometry:()=>[[new st(0,0),new st(8193,0),new st(8193,8193),new st(0,8193),new st(0,0)]]};class Yd{constructor(e,n,s,u,f){this.tileID=e,this.uid=xt(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<fn.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Ju(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const y={};if(!f)return y;for(const b of u){const C=b.layerIds.map(S=>f.getLayer(S)).filter(Boolean);if(0!==C.length){b.layers=C,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(S=>C.filter(L=>L.id===S)[0]));for(const S of C)y[S.id]=b}}return y}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof xc){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof xc&&f.hasRTLText){this.hasRTLText=!0,He.isLoading()||He.isLoaded()||"deferred"!==ke()||Ze();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ph}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const u=this.buckets[s];u.uploadPending()&&u.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new zc(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new zc(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new zc(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,s,u,f,y,b,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:b,transform:y,params:f,tileTransform:this.tileTransform},e,n,s):{}}querySourceFeatures(e,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const u=s.loadVTLayers(),f=n?n.sourceLayer:"",y=u._geojsonTileLayer||u[f];if(!y)return;const b=gn(n&&n.filter),{z:C,x:S,y:L}=this.tileID.canonical,F={z:C,x:S,y:L};for(let B=0;B<y.length;B++){const j=y.feature(B);if(b.needGeometry){const ce=Tl(j,!0);if(!b.filter(new Be(this.tileID.overscaledZ),ce,this.tileID.canonical))continue}else if(!b.filter(new Be(this.tileID.overscaledZ),j))continue;const $=s.getId(j,f),J=new Kd(j,C,S,L,$);J.tile=F,e.push(J)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const s=Ai(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let u=!1;if(this.expirationTime>s)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{const f=this.expirationTime-n;f?this.expirationTime=s+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!n)return;const s=this.latestFeatureIndex.loadVTLayers(),u=n.style.listImages();for(const f in this.buckets){if(!n.style.hasLayer(f))continue;const y=this.buckets[f],b=y.layers[0].sourceLayer||"_geojsonTileLayer",C=s[b],S=e[b];if(!C||!S||0===Object.keys(S).length)continue;if(y.update(S,C,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof Dd||y instanceof pc){const F=n.style._getSourceCache(y.layers[0].source);n._terrain&&n._terrain.enabled&&F&&y.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(F.id,this.tileID)}const L=n&&n.style&&n.style.getLayer(f);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<fn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=fn.now()+e}setTexture(e,n){const s=n.context,u=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new zc(s,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(e,n){const s={};for(const u of n)s[u]=!0;this.dependencies[e]=s}hasDependency(e,n){for(const s of e){const u=this.dependencies[s];if(u)for(const f of n)if(u[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const s=El(pp,this.tileID.canonical,this.tileTransform)[0],u=new Mr,f=new fh;for(let y=0;y<s.length;y++){const{x:b,y:C}=s[y];u.emplaceBack(b,C),f.emplaceBack(y)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,Oa.members),this._tileDebugSegments=ao.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const s=El(pp,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const y=function(b,C){const S=Ju(b,C),L=Math.pow(2,b.z);for(let ce=0;ce<Il;ce++)for(let ye=0;ye<Il;ye++){const Te=sl((b.x+(ye+fp(ye))/Ba)/L),pe=Io((b.y+(ce+fp(ce))/Ba)/L),we=C.project(Te,pe),Re=ce*Il+ye;Al[2*Re+0]=Math.round((we.x*S.scale-S.x)*On),Al[2*Re+1]=Math.round((we.y*S.scale-S.y)*On)}bc.fill(0),ih.fill(0);for(let ce=2045;ce>=0;ce--){const ye=4*ce,Te=Kl[ye+0],pe=Kl[ye+1],we=Kl[ye+2],Re=Kl[ye+3],Me=Te+we>>1,Ke=pe+Re>>1,qe=Me+Ke-pe,lt=Ke+Te-Me,At=pe*Il+Te,Je=Re*Il+we,dt=Ke*Il+Me,mt=Math.hypot((Al[2*At+0]+Al[2*Je+0])/2-Al[2*dt+0],(Al[2*At+1]+Al[2*Je+1])/2-Al[2*dt+1])>=16;bc[dt]=bc[dt]||(mt?1:0),ce<1022&&(bc[dt]=bc[dt]||bc[(pe+lt>>1)*Il+(Te+qe>>1)]||bc[(Re+lt>>1)*Il+(we+qe>>1)])}const F=new Hr,B=new Ho;let j=0;function $(ce,ye){const Te=ye*Il+ce;return 0===ih[Te]&&(F.emplaceBack(Al[2*Te+0],Al[2*Te+1],ce*On/Ba,ye*On/Ba),ih[Te]=++j),ih[Te]-1}function J(ce,ye,Te,pe,we,Re){const Me=ce+Te>>1,Ke=ye+pe>>1;if(Math.abs(ce-we)+Math.abs(ye-Re)>1&&bc[Ke*Il+Me])J(we,Re,ce,ye,Me,Ke),J(Te,pe,we,Re,Me,Ke);else{const qe=$(ce,ye),lt=$(Te,pe),At=$(we,Re);B.emplaceBack(qe,lt,At)}}return J(0,0,Ba,Ba,Ba,0),J(Ba,Ba,0,0,0,Ba),{vertices:F,indices:B}}(this.tileID.canonical,n);u=y.vertices,f=y.indices}else{u=new Hr,f=new Ho;for(const{x:b,y:C}of s)u.emplaceBack(b,C,0,0);const y=Ru.exports(u.int16,void 0,4);for(let b=0;b<y.length;b+=3)f.emplaceBack(y[b],y[b+1],y[b+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,Ag.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=ao.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugBuffers(e,n){const s=n.projection;if(!s||"globe"!==s.name||n.freezeTileCoverage)return;const u=this.tileID.canonical,f=Nh(mg(u,n)),y=Yu(n.zoom);let b;y>0&&(b=If(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,n,f,b,y),this._makeGlobeTileDebugTextBuffer(e,u,n,f,b,y)}_globePoint(e,n,s,u,f,y,b){let C=cu(e,n,s);if(y){const S=1<<s.z,L=xl(u.center.lng),F=bl(u.center.lat),B=(s.x+.5)/S-L;let j=0;B>.5?j=-1:B<-.5&&(j=1);let $=(e/On+s.x)/S+j,J=(n/On+s.y)/S;$=($-L)*u._pixelsPerMercatorPixel+L,J=(J-F)*u._pixelsPerMercatorPixel+F;const ce=[$*u.worldSize,J*u.worldSize,0];lo(ce,ce,y),C=lu(C,ce,b)}return lo(C,C,f)}_makeGlobeTileDebugBorderBuffer(e,n,s,u,f,y){const b=new Mr,C=new fh,S=new oi,L=(B,j,$,J,ce)=>{const ye=($-B)/(ce-1),Te=(J-j)/(ce-1),pe=b.length;for(let we=0;we<ce;we++){const Re=B+we*ye,Me=j+we*Te;b.emplaceBack(Re,Me);const Ke=this._globePoint(Re,Me,n,s,u,f,y);S.emplaceBack(Ke[0],Ke[1],Ke[2]),C.emplaceBack(pe+we)}},F=On;L(0,0,F,0,16),L(F,0,F,F,16),L(F,F,0,F,16),L(0,F,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(C),this._tileDebugBuffer=e.createVertexBuffer(b,Oa.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(S,Bd.members),this._tileDebugSegments=ao.simpleSegment(0,0,b.length,C.length)}_makeGlobeTileDebugTextBuffer(e,n,s,u,f,y){const b=new Mr,C=new Ho,S=new oi,L=25;C.reserve(32),b.reserve(L),S.reserve(L);const F=(B,j)=>L*B+j;for(let B=0;B<L;B++){const j=2048*B;for(let $=0;$<L;$++){const J=2048*$;b.emplaceBack(J,j);const ce=this._globePoint(J,j,n,s,u,f,y);S.emplaceBack(ce[0],ce[1],ce[2])}}for(let B=0;B<4;B++)for(let j=0;j<4;j++){const $=F(B,j),J=F(B,j+1),ce=F(B+1,j),ye=F(B+1,j+1);C.emplaceBack($,J,ce),C.emplaceBack(ce,J,ye)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(C),this._tileDebugTextBuffer=e.createVertexBuffer(b,Oa.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(S,Bd.members),this._tileDebugTextSegments=ao.simpleSegment(0,0,L,32)}}class Pg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,s){const u=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Ne(this.stateChanges[e][u],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const f in this.state[e][u])s[f]||(this.deletedStates[e][u][f]=null)}else for(const f in s)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][f]&&delete this.deletedStates[e][u][f]}removeFeatureState(e,n,s){if(null===this.deletedStates[e])return;const u=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==n)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][s]=null);else if(void 0!==n)if(this.stateChanges[e]&&this.stateChanges[e][u])for(s in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][s]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,n){const s=String(n),u=Ne({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const f=this.deletedStates[e][n];if(null===f)return{};for(const y in f)delete u[y]}return u}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const s={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const y in this.stateChanges[u])this.state[u][y]||(this.state[u][y]={}),Ne(this.state[u][y],this.stateChanges[u][y]),f[y]=this.state[u][y];s[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(null===this.deletedStates[u])for(const y in this.state[u])f[y]={},this.state[u][y]={};else for(const y in this.deletedStates[u]){if(null===this.deletedStates[u][y])this.state[u][y]={};else for(const b of Object.keys(this.deletedStates[u][y]))delete this.state[u][y][b];f[y]=this.state[u][y]}s[u]=s[u]||{},Ne(s[u],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const u in e)e[u].setFeatureState(s,n)}}class mp{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const s=this.toIdx(e,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Rg(t,e,n,s){let u=0,f=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(s[y])<1e-15){if(n[y]<t[y]||n[y]>e[y])return null}else{const b=1/s[y];let C=(t[y]-n[y])*b,S=(e[y]-n[y])*b;if(C>S){const L=C;C=S,S=L}if(C>u&&(u=C),S<f&&(f=S),u>f)return null}return u}function Lg(t,e,n,s,u,f,y,b,C,S,L){const F=s-t,B=u-e,j=f-n,$=y-t,J=b-e,ce=C-n,ye=L[1]*ce-L[2]*J,Te=L[2]*$-L[0]*ce,pe=L[0]*J-L[1]*$,we=F*ye+B*Te+j*pe;if(Math.abs(we)<1e-15)return null;const Re=1/we,Me=S[0]-t,Ke=S[1]-e,qe=S[2]-n,lt=(Me*ye+Ke*Te+qe*pe)*Re;if(lt<0||lt>1)return null;const At=Ke*j-qe*B,Je=qe*F-Me*j,dt=Me*B-Ke*F,mt=(L[0]*At+L[1]*Je+L[2]*dt)*Re;return mt<0||lt+mt>1?null:($*At+J*Je+ce*dt)*Re}function kg(t,e,n){return(t-e)/(n-e)}function gp(t,e,n,s,u,f,y,b,C){const S=1<<n,L=f-s,F=y-u,B=(t+1)/S*L+s,j=(e+0)/S*F+u,$=(e+1)/S*F+u;b[0]=(t+0)/S*L+s,b[1]=j,C[0]=B,C[1]=$}class Jd{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(f){const y=Math.ceil(Math.log2(f.dim/8)),b=[];let C=Math.ceil(Math.pow(2,y));const S=1/C,L=(j,$,J,ce,ye)=>{const Te=ce?1:0,pe=(j+1)*J-Te,we=$*J,Re=($+1)*J-Te;ye[0]=j*J,ye[1]=we,ye[2]=pe,ye[3]=Re};let F=new mp(C);const B=[];for(let j=0;j<C*C;j++){L(j%C,Math.floor(j/C),S,!1,B);const $=wc(B[0],B[1],f),J=wc(B[2],B[1],f),ce=wc(B[2],B[3],f),ye=wc(B[0],B[3],f);F.minimums.push(Math.min($,J,ce,ye)),F.maximums.push(Math.max($,J,ce,ye)),F.leaves.push(1)}for(b.push(F),C/=2;C>=1;C/=2){const j=b[b.length-1];F=new mp(C);for(let $=0;$<C*C;$++){L($%C,Math.floor($/C),2,!0,B);const J=j.getElevation(B[0],B[1]),ce=j.getElevation(B[2],B[1]),ye=j.getElevation(B[2],B[3]),Te=j.getElevation(B[0],B[3]),pe=j.isLeaf(B[0],B[1]),we=j.isLeaf(B[2],B[1]),Re=j.isLeaf(B[2],B[3]),Me=j.isLeaf(B[0],B[3]),Ke=Math.min(J.min,ce.min,ye.min,Te.min),qe=Math.max(J.max,ce.max,ye.max,Te.max),lt=pe&&we&&Re&&Me;F.maximums.push(qe),F.minimums.push(Ke),F.leaves.push(qe-Ke<=5&&lt?1:0)}b.push(F)}return b}(this.dem),s=n.length-1,u=n[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(e,n,s,u,f,y,b=1){return Rg([e,n,-100],[s,u,this.maximums[0]*b],f,y)}raycast(e,n,s,u,f,y,b=1){if(!this.nodeCount)return null;const C=this.raycastRoot(e,n,s,u,f,y,b);if(null==C)return null;const S=[],L=[],F=[],B=[],j=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;j.length>0;){const{idx:$,t:J,nodex:ce,nodey:ye,depth:Te}=j.pop();if(this.leaves[$]){gp(ce,ye,Te,e,n,s,u,F,B);const we=1<<Te,Re=(ce+0)/we,Me=(ce+1)/we,Ke=(ye+0)/we,qe=(ye+1)/we,lt=wc(Re,Ke,this.dem)*b,At=wc(Me,Ke,this.dem)*b,Je=wc(Me,qe,this.dem)*b,dt=wc(Re,qe,this.dem)*b,mt=Lg(F[0],F[1],lt,B[0],F[1],At,B[0],B[1],Je,f,y),St=Lg(B[0],B[1],Je,F[0],B[1],dt,F[0],F[1],lt,f,y),Ot=Math.min(null!==mt?mt:Number.MAX_VALUE,null!==St?St:Number.MAX_VALUE);if(Ot!==Number.MAX_VALUE)return Ot;{const rt=Pu([],f,y,J);if(_p(lt,At,dt,Je,kg(rt[0],F[0],B[0]),kg(rt[1],F[1],B[1]))>=rt[2])return J}continue}let pe=0;for(let we=0;we<this._siblingOffset.length;we++){gp((ce<<1)+this._siblingOffset[we][0],(ye<<1)+this._siblingOffset[we][1],Te+1,e,n,s,u,F,B),F[2]=-100,B[2]=this.maximums[this.childOffsets[$]+we]*b;const Re=Rg(F,B,f,y);if(null!=Re){const Me=Re;S[we]=Me;let Ke=!1;for(let qe=0;qe<pe&&!Ke;qe++)Me>=S[L[qe]]&&(L.splice(qe,0,we),Ke=!0);Ke||(L[pe]=we),pe++}}for(let we=0;we<pe;we++){const Re=L[we];j.push({idx:this.childOffsets[$]+Re,t:S[Re],nodex:(ce<<1)+this._siblingOffset[Re][0],nodey:(ye<<1)+this._siblingOffset[Re][1],depth:Te+1})}}return null}_addNode(e,n,s){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,s,u,f){if(1===e[u].isLeaf(n,s))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const y=u-1,b=e[y];let C=0,S=0;for(let L=0;L<this._siblingOffset.length;L++){const F=2*n+this._siblingOffset[L][0],B=2*s+this._siblingOffset[L][1],j=b.getElevation(F,B),$=b.isLeaf(F,B),J=this._addNode(j.min,j.max,$);$&&(C|=1<<L),S||(S=J)}for(let L=0;L<this._siblingOffset.length;L++)C&1<<L||this._construct(e,2*n+this._siblingOffset[L][0],2*s+this._siblingOffset[L][1],y,S+L)}}function _p(t,e,n,s,u,f){return Ln(Ln(t,n,f),Ln(e,s,f),u)}function wc(t,e,n){const s=n.dim,u=gt(t*s-.5,0,s-1),f=gt(e*s-.5,0,s-1),y=Math.floor(u),b=Math.floor(f),C=Math.min(y+1,s-1),S=Math.min(b+1,s-1);return _p(n.get(y,b),n.get(C,b),n.get(y,S),n.get(C,S),u-y,f-b)}const yp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Wh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,s,u=!1,f=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return Un(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const y=this.dim=n.height-2,b=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=s||"mapbox",this.borderReady=u,!u){for(let C=0;C<y;C++)b[this._idx(-1,C)]=b[this._idx(0,C)],b[this._idx(y,C)]=b[this._idx(y-1,C)],b[this._idx(C,-1)]=b[this._idx(C,0)],b[this._idx(C,y)]=b[this._idx(C,y-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(y,-1)]=b[this._idx(y-1,0)],b[this._idx(-1,y)]=b[this._idx(0,y-1)],b[this._idx(y,y)]=b[this._idx(y-1,y-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Jd(this)}get(e,n,s=!1){s&&(e=gt(e,-1,this.dim),n=gt(n,-1,this.dim));const u=4*this._idx(e,n);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return yp[e]}get unpackVector(){return yp[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,s){return(256*e*256+256*n+s)/10-1e4}_unpackTerrarium(e,n,s){return 256*e+n+s/256-32768}static pack(e,n){const s=[0,0,0,0],u=Wh.getUnpackVector(n);let f=Math.floor((e+u[3])/u[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new Fs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,f=n*this.dim+this.dim,y=s*this.dim,b=s*this.dim+this.dim;switch(n){case-1:u=f-1;break;case 1:f=u+1}switch(s){case-1:y=b-1;break;case 1:b=y+1}const C=-n*this.dim,S=-s*this.dim;for(let L=y;L<b;L++)for(let F=u;F<f;F++){const B=4*this._idx(F,L),j=4*this._idx(F+C,L+S);this.pixels[B+0]=e.pixels[j+0],this.pixels[B+1]=e.pixels[j+1],this.pixels[B+2]=e.pixels[j+2],this.pixels[B+3]=e.pixels[j+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}sn(Wh,"DEMData"),sn(Jd,"DemMinMaxQuadTree",{omit:["dem"]});class Og{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,s){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const f={value:n,timeout:void 0};if(void 0!==s&&(f.timeout=setTimeout(()=>{this.remove(e,f)},s)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const s=e.wrapped().key,u=void 0===n?0:this.data[s].indexOf(n),f=this.data[s][u];return this.data[s].splice(u,1),f.timeout&&clearTimeout(f.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const s in this.data)for(const u of this.data[s])e(u.value)||n.push(u);for(const s of n)this.remove(s.value.tileID,s)}}class _u{constructor(e,n,s){this.func=e,this.mask=n,this.range=s}}_u.ReadOnly=!1,_u.ReadWrite=!0,_u.disabled=new _u(519,_u.ReadOnly,[0,1]);class ef{constructor(e,n,s,u,f,y){this.test=e,this.ref=n,this.mask=s,this.fail=u,this.depthFail=f,this.pass=y}}ef.disabled=new ef({func:519,mask:0},0,0,7680,7680,7680);class Ua{constructor(e,n,s){this.blendFunction=e,this.blendColor=n,this.mask=s}}Ua.Replace=[1,0],Ua.disabled=new Ua(Ua.Replace,kr.transparent,[!1,!1,!1,!1]),Ua.unblended=new Ua(Ua.Replace,kr.transparent,[!0,!0,!0,!0]),Ua.alphaBlended=new Ua([1,771],kr.transparent,[!0,!0,!0,!0]);class Pl{constructor(e,n,s){this.enable=e,this.mode=n,this.frontFace=s}}Pl.disabled=new Pl(!1,1029,2305),Pl.backCCW=new Pl(!0,1029,2305),Pl.backCW=new Pl(!0,1029,2304),Pl.frontCW=new Pl(!0,1028,2304),Pl.frontCCW=new Pl(!0,1028,2305);class Ec extends jr{constructor(e,n,s){super(),this.id=e,this._onlySymbols=s,n.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Og(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Pg,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if("loaded"!==n.state&&"errored"!==n.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const s=this._tiles[n];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return Br(this._tiles).map(e=>e.tileID).sort(Nc).map(e=>e.key)}getRenderableIds(e){const n=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&n.push(this._tiles[s]);return e?n.sort((s,u)=>{const f=s.tileID,y=u.tileID,b=new st(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),C=new st(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-y.overscaledZ||C.y-b.y||C.x-b.x}).map(s=>s.tileID.key):n.map(s=>s.tileID).sort(Nc).map(s=>s.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,e,n)))}_tileLoaded(e,n,s,u){if(u)if(e.state="errored",404!==u.status)this._source.fire(new ji(u,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=fn.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new po("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let u=0;u<n.length;u++){const f=n[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const y=this.getTileByID(f);s(e,y),s(y,e)}}function s(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let y=f.tileID.canonical.x-u.tileID.canonical.x;const b=f.tileID.canonical.y-u.tileID.canonical.y,C=Math.pow(2,u.tileID.canonical.z),S=f.tileID.key;0===y&&0===b||Math.abs(b)>1||(Math.abs(y)>1&&(1===Math.abs(y+C)?y+=C:1===Math.abs(y-C)&&(y-=C)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,y,b),u.neighboringTiles&&u.neighboringTiles[S]&&(u.neighboringTiles[S].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,s,u){for(const f in this._tiles){let y=this._tiles[f];if(u[f]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>s)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const S=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[S.key],y&&y.hasData()&&(b=S)}let C=b;for(;C.overscaledZ>n;)if(C=C.scaledTo(C.overscaledZ-1),e[C.key]){u[b.key]=b;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=e.overscaledZ-1;s>=n;s--){const u=e.scaledTo(s),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const s=Math.ceil(e.width/n)+1,u=Math.ceil(e.height/n)+1,f=Math.floor(s*u*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(b)}handleWrapJump(e){const n=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,n){const s={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+n),s[f.tileID.key]=f}this._tiles=s;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,n,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let u;this.updateCacheSize(e,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new zs(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(u=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(b=>this._source.hasTile(b)))):u=[];const f=this._updateRetainedTiles(u);if(tf(this._source.type)&&0!==u.length){const b={},C={},S=Object.keys(f);for(const F of S){const B=f[F],j=this._tiles[F];if(!j||j.fadeEndTime&&j.fadeEndTime<=fn.now())continue;const $=this.findLoadedParent(B,Math.max(B.overscaledZ-Ec.maxOverzooming,this._source.minzoom));$&&(this._addTile($.tileID),b[$.tileID.key]=$.tileID),C[F]=B}const L=u[u.length-1].overscaledZ;for(const F in this._tiles){const B=this._tiles[F];if(f[F]||!B.hasData())continue;let j=B.tileID;for(;j.overscaledZ>L;){j=j.scaledTo(j.overscaledZ-1);const $=this._tiles[j.key];if($&&$.hasData()&&C[j.key]){f[F]=B.tileID;break}}}for(const F in b)f[F]||(this._coveredTiles[F]=!0,f[F]=b[F])}for(const b in f)this._tiles[b].clearFadeHold();const y=function(b,C){const S=[];for(const L in b)L in C||S.push(L);return S}(this._tiles,f);for(const b of y){const C=this._tiles[b];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(0===e.length)return n;const s={},u=e.reduce((S,L)=>Math.min(S,L.overscaledZ),1/0),f=e[0].overscaledZ,y=Math.max(f-Ec.maxOverzooming,this._source.minzoom),b=Math.max(f+Ec.maxUnderzooming,this._source.minzoom),C={};for(const S of e){const L=this._addTile(S);n[S.key]=S,L.hasData()||u<this._source.maxzoom&&(C[S.key]=S)}this._retainLoadedChildren(C,u,b,n);for(const S of e){let L=this._tiles[S.key];if(L.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const B=S.children(this._source.maxzoom)[0],j=this.getTile(B);if(j&&j.hasData()){n[B.key]=B;continue}}else{const B=S.children(this._source.maxzoom);if(n[B[0].key]&&n[B[1].key]&&n[B[2].key]&&n[B[3].key])continue}let F=L.wasRequested();for(let B=S.overscaledZ-1;B>=y;--B){const j=S.scaledTo(B);if(s[j.key]||(s[j.key]=!0,L=this.getTile(j),!L&&F&&(L=this._addTile(j)),L&&(n[j.key]=j,F=L.wasRequested(),L.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let s,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){s=this._loadedParentTiles[u.key];break}n.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;u=f}for(const f of n)this._loadedParentTiles[f]=s}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const s=Boolean(n);if(!s){const u=this.map?this.map.painter:null;n=new Yd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,s||this._source.fire(new po("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=n.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,s){const u=[],f=this.transform;if(!f)return u;const y="globe"===f.projection.name,b=xl(f.center.lng);for(const C in this._tiles){const S=this._tiles[C];if(s&&S.clearQueryDebugViz(),S.holdingForFade())continue;let L;if(y){const F=S.tileID.canonical;if(0===F.z){const B=[Math.abs(gt(b,...Zh(F,-1))-b),Math.abs(gt(b,...Zh(F,1))-b)];L=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(gt(b,...Zh(F,-1))-b),Math.abs(gt(b,...Zh(F,0))-b),Math.abs(gt(b,...Zh(F,1))-b)];L=[B.indexOf(Math.min(...B))-1]}}else L=[0];for(const F of L){const B=e.containsTile(S,f,n,F);B&&u.push(B)}}return u}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of n)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(tf(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=fn.now())return!0}return!1}setFeatureState(e,n,s){this._state.updateState(e=e||"_geojsonTileLayer",n,s)}removeFeatureState(e,n,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,s)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,s){const u=this._tiles[e];u&&u.setDependencies(n,s)}reloadTilesForDependencies(e,n){for(const s in this._tiles)this._tiles[s].hasDependency(e,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,n))}_preloadTiles(e,n){const s=new Map,u=Array.isArray(e)?e:[e],f=this.map.painter.terrain,y=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const b of u){const C=b.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of C)s.set(S.key,S);this.usedForTerrain&&b.updateElevation(!1)}hn(Array.from(s.values()),(b,C)=>{const S=new Yd(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,L=>{"raster-dem"===this._source.type&&S.dem&&this._backfillDEM(S),C(L,S)})},n)}}function Nc(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function tf(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function Zh(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}Ec.maxOverzooming=10,Ec.maxUnderzooming=3;class oh{constructor(e,n,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(e,n,s){const u=s||e.findDEMTileFor(n);if(!u||!u.dem)return;const f=u.dem,y=u.tileID,b=1<<n.canonical.z-y.canonical.z;return new oh(u,u.tileSize/On/b,[(n.canonical.x/b-y.canonical.x)*f.dim,(n.canonical.y/b-y.canonical.y)*f.dim])}tileCoordToPixel(e,n){const s=n*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(s);return new st(u,f)}getElevationAt(e,n,s,u){const f=e*this._scale+this._offset[0],y=n*this._scale+this._offset[1],b=Math.floor(f),C=Math.floor(y),S=this._dem;return u=!!u,s?Ln(Ln(S.get(b,C,u),S.get(b,C+1,u),y-C),Ln(S.get(b+1,C,u),S.get(b+1,C+1,u),y-C),f-b):S.get(b,C,u)}getElevationAtPixel(e,n,s){return this._dem.get(e,n,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ol(1,e)*this._dem.stride}}class Q_{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new oo(On,16,0),this.featureIndexArray=new ed,this.promoteId=n}insert(e,n,s,u,f,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,f,y);const C=this.grid;for(let S=0;S<n.length;S++){const L=n[S],F=[1/0,1/0,-1/0,-1/0];for(let B=0;B<L.length;B++){const j=L[B];F[0]=Math.min(F[0],j.x),F[1]=Math.min(F[1],j.y),F[2]=Math.max(F[2],j.x),F[3]=Math.max(F[3],j.y)}F[0]<On&&F[1]<On&&F[2]>=0&&F[3]>=0&&C.insert(b,F[0],F[1],F[2],F[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Hf(new Oc(this.rawTileData)).layers,this.sourceLayerCoder=new Ig(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,s,u){this.loadVTLayers();const f=e.params||{},y=gn(f.filter),b=e.tileResult,C=e.transform,S=b.bufferedTilespaceBounds,L=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,($,J,ce,ye)=>Jp(b.bufferedTilespaceGeometry,$,J,ce,ye));L.sort(ty);let F=null;C.elevation&&L.length>0&&(F=oh.create(C.elevation,this.tileID));const B={};let j;for(let $=0;$<L.length;$++){const J=L[$];if(J===j)continue;j=J;const ce=this.featureIndexArray.get(J);let ye=null;this.loadMatchingFeature(B,ce,y,f.layers,f.availableImages,n,s,u,(Te,pe,we,Re=0)=>(ye||(ye=El(Te,this.tileID.canonical,e.tileTransform)),pe.queryIntersectsFeature(b,Te,we,ye,this.z,e.transform,e.pixelPosMatrix,F,Re)))}return B}loadMatchingFeature(e,n,s,u,f,y,b,C,S){const{featureIndex:L,bucketIndex:F,sourceLayerIndex:B,layoutVertexArrayOffset:j}=n,$=this.bucketLayerIDs[F];if(u&&!function(Te,pe){for(let we=0;we<Te.length;we++)if(pe.indexOf(Te[we])>=0)return!0;return!1}(u,$))return;const J=this.sourceLayerCoder.decode(B),ce=this.vtLayers[J].feature(L);if(s.needGeometry){const Te=Tl(ce,!0);if(!s.filter(new Be(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!s.filter(new Be(this.tileID.overscaledZ),ce))return;const ye=this.getId(ce,J);for(let Te=0;Te<$.length;Te++){const pe=$[Te];if(u&&u.indexOf(pe)<0)continue;const we=y[pe];if(!we)continue;let Re={};void 0!==ye&&C&&(Re=C.getState(we.sourceLayer||"_geojsonTileLayer",ye));const Me=Ne({},b[pe]);Me.paint=ey(Me.paint,we.paint,ce,Re,f),Me.layout=ey(Me.layout,we.layout,ce,Re,f);const Ke=!S||S(ce,we,Re,j);if(!Ke)continue;const qe=new Kd(ce,this.z,this.x,this.y,ye);qe.layer=Me;let lt=e[pe];void 0===lt&&(lt=e[pe]=[]),lt.push({featureIndex:L,feature:qe,intersectionZ:Ke})}}lookupSymbolFeatures(e,n,s,u,f,y,b,C){const S={};this.loadVTLayers();const L=gn(f);for(const F of e)this.loadMatchingFeature(S,{bucketIndex:s,sourceLayerIndex:u,featureIndex:F,layoutVertexArrayOffset:0},L,y,b,C,n);return S}loadFeature(e){const{featureIndex:n,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),f=this.vtFeatures[u];if(f[n])return f[n];const y=this.vtLayers[u].feature(n);return f[n]=y,y}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;if(this.promoteId){const u="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=u&&(s=e.properties[u]),"boolean"==typeof s&&(s=Number(s))}return s}}function ey(t,e,n,s,u){return Ur(t,(f,y)=>{const b=e instanceof Nt?e.get(y):null;return b&&b.evaluate?b.evaluate(n,s,u):b})}function ty(t,e){return e-t}sn(Q_,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Fg{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new La({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const s=this.getKey(e,n);return this.positions[s]}trim(){const e=this.width,n=this.height=Ft(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,s){const u=[];let f=e.length%2==1?-e[e.length-1]*s:0,y=e[0]*s,b=!0;u.push({left:f,right:y,isDash:b,zeroLength:0===e[0]});let C=e[0];for(let S=1;S<e.length;S++){b=!b;const L=e[S];f=C*s,C+=L,y=C*s,u.push({left:f,right:y,isDash:b,zeroLength:0===L})}return u}addRoundDash(e,n,s){const u=n/2;for(let f=-s;f<=s;f++){const y=this.width*(this.nextRow+s+f);let b=0,C=e[b];for(let S=0;S<this.width;S++){S/C.right>1&&(C=e[++b]);const L=Math.abs(S-C.left),F=Math.abs(S-C.right),B=Math.min(L,F);let j;const $=f/s*(u+1);if(C.isDash){const J=u-Math.abs($);j=Math.sqrt(B*B+J*J)}else j=u-Math.sqrt(B*B+$*$);this.image.data[y+S]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e,n){for(let C=e.length-1;C>=0;--C){const S=e[C],L=e[C+1];S.zeroLength?e.splice(C,1):L&&L.isDash===S.isDash&&(L.left=S.left,e.splice(C,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const f=this.width*this.nextRow;let y=0,b=e[y];for(let C=0;C<this.width;C++){C/b.right>1&&(b=e[++y]);const S=Math.abs(C-b.left),L=Math.abs(C-b.right),F=Math.min(S,L);this.image.data[f+C]=Math.max(0,Math.min(255,(b.isDash?F:-F)+n+128))}}addDash(e,n){const s=this.getKey(e,n);if(this.positions[s])return this.positions[s];const u="round"===n,f=u?7:0,y=2*f+1;if(this.nextRow+y>this.height)return Un("LineAtlas out of space"),null;0===e.length&&e.push(1);let b=0;for(let L=0;L<e.length;L++)e[L]<0&&(Un("Negative value is found in line dasharray, replacing values with 0"),e[L]=0),b+=e[L];if(0!==b){const L=this.width/b,F=this.getDashRanges(e,this.width,L);u?this.addRoundDash(F,L,f):this.addRegularDash(F,"square"===n?.5*L:0)}const C=this.nextRow+f;this.nextRow+=y;const S={tl:[C,f],br:[b,0]};return this.positions[s]=S,S}}sn(Fg,"LineAtlas");class xp{constructor(e){const n={},s=[];for(const b in e){const C=e[b],S=n[b]={};for(const L in C.glyphs){const F=C.glyphs[+L];if(!F||0===F.bitmap.width||0===F.bitmap.height)continue;const B=F.metrics.localGlyph?2:1,j={x:0,y:0,w:F.bitmap.width+2*B,h:F.bitmap.height+2*B};s.push(j),S[L]=j}}const{w:u,h:f}=kh(s),y=new La({width:u||1,height:f||1});for(const b in e){const C=e[b];for(const S in C.glyphs){const L=C.glyphs[+S];if(!L||0===L.bitmap.width||0===L.bitmap.height)continue;const F=n[b][S],B=L.metrics.localGlyph?2:1;La.copy(L.bitmap,y,{x:0,y:0},{x:F.x+B,y:F.y+B},L.bitmap)}}this.image=y,this.positions=n}}sn(xp,"GlyphAtlas");class ny{constructor(e){this.tileID=new zs(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ju(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,s,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new ph;const y=new Ig(Object.keys(e.layers).sort()),b=new Q_(this.tileID,this.promoteId);b.bucketLayerIDs=[];const C={},S=new Fg(256,256),L={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:s},F=n.familiesBySource[this.source];for(const Re in F){const Me=e.layers[Re];if(!Me)continue;let Ke=!1,qe=!1;for(const Je of F[Re])"symbol"===Je[0].type?Ke=!0:qe=!0;if(!0===this.isSymbolTile&&!Ke||!1===this.isSymbolTile&&!qe)continue;1===Me.version&&Un(`Vector tile source "${this.source}" layer "${Re}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const lt=y.encode(Re),At=[];for(let Je=0;Je<Me.length;Je++){const dt=Me.feature(Je),mt=b.getId(dt,Re);At.push({feature:dt,id:mt,index:Je,sourceLayerIndex:lt})}for(const Je of F[Re]){const dt=Je[0];void 0!==this.isSymbolTile&&"symbol"===dt.type!==this.isSymbolTile||dt.minzoom&&this.zoom<Math.floor(dt.minzoom)||dt.maxzoom&&this.zoom>=dt.maxzoom||"none"!==dt.visibility&&(Po(Je,this.zoom,s),(C[dt.id]=dt.createBucket({index:b.bucketLayerIDs.length,layers:Je,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:lt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(At,L,this.tileID.canonical,this.tileTransform),b.bucketLayerIDs.push(Je.map(mt=>mt.id)))}}let B,j,$,J;S.trim();const ce={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ye=Ur(L.glyphDependencies,Re=>Object.keys(Re).map(Number));Object.keys(ye).length?u.send("getGlyphs",{uid:this.uid,stacks:ye},(Re,Me)=>{B||(B=Re,j=Me,we.call(this))},void 0,!1,ce):j={};const Te=Object.keys(L.iconDependencies);Te.length?u.send("getImages",{icons:Te,source:this.source,tileID:this.tileID,type:"icons"},(Re,Me)=>{B||(B=Re,$=Me,we.call(this))},void 0,!1,ce):$={};const pe=Object.keys(L.patternDependencies);function we(){if(B)return f(B);if(j&&$&&J){const Re=new xp(j),Me=new Ad($,J);for(const Ke in C){const qe=C[Ke];qe instanceof xc?(Po(qe.layers,this.zoom,s),W_(qe,j,Re.positions,$,Me.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):qe.hasPattern&&(qe instanceof Dd||qe instanceof pc||qe instanceof Fu)&&(Po(qe.layers,this.zoom,s),qe.addFeatures(L,this.tileID.canonical,Me.patternPositions,s,this.tileTransform))}this.status="done",f(null,{buckets:Br(C).filter(Ke=>!Ke.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Re.image,lineAtlas:S,imageAtlas:Me,glyphMap:this.returnDependencies?j:null,iconMap:this.returnDependencies?$:null,glyphPositions:this.returnDependencies?Re.positions:null})}}pe.length?u.send("getImages",{icons:pe,source:this.source,tileID:this.tileID,type:"patterns"},(Re,Me)=>{B||(B=Re,J=Me,we.call(this))},void 0,!1,ce):J={},we.call(this)}}function Po(t,e,n){const s=new Be(e);for(const u of t)u.recalculate(s,n)}class bp{constructor(e){this.entries={},this.scheduler=e}request(e,n,s,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[y,b]=f.result;return this.scheduler?this.scheduler.add(()=>{u(y,b)},n):u(y,b),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=s((y,b)=>{f.result=[y,b];for(const C of f.callbacks)this.scheduler?this.scheduler.add(()=>{C(y,b)},n):C(y,b);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(y=>y!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function zg(t,e,n){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{const f=Fr(t.request,(y,b,C,S)=>{y?u(y):b&&u(null,{vectorTile:n?void 0:new Hf(new Oc(b)),rawData:b,cacheControl:C,expires:S})});return()=>{f.cancel(),u()}},e)}c.ARRAY_TYPE=ta,c.AUTH_ERR_MSG=or,c.Aabb=Os,c.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Mn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Kr()?t:Pe,this.scheduler=new hp}send(t,e,n,s,u=!1,f){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=f,this.callbacks[y]=n);const b=Yr(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:t,hasCallback:!!n,targetMapId:s,mustQueue:u,sourceMapId:this.mapId,data:Go(e,b)},b),{cancel:()=>{n&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[n];delete this.cancelCallbacks[n],s&&s.cancel()}else if(e.mustQueue||Kr()){const s=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),s&&s.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if("<response>"===e.type){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(da(e.error)):n(null,da(e.data)))}else{const n=Yr(this.globalScope)?void 0:[],s=e.hasCallback?(f,y)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:f?Go(f):null,data:Go(y,n)},n)}:f=>{},u=da(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,s);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],u.source)[f[1]](u,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.CanonicalTileID=Td,c.Color=kr,c.ColorMode=Ua,c.CullFaceMode=Pl,c.DEMData=Wh,c.DataConstantProperty=je,c.DedupedRequest=bp,c.DepthMode=_u,c.EXTENT=On,c.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,s=1<<n,u=Math.floor(t.x),f=Math.floor((t.x-u)*s),y=Math.floor(t.y*s),b=this.findDEMTileFor(new zs(n,u,n,f,y));return!(!b||!b.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const u=s.getSource().maxzoom,f=1<<u,y=Math.floor(t.x),b=t.x-y,C=new zs(u,y,u,Math.floor(b*f),Math.floor(t.y*f)),S=this.findDEMTileFor(C);if(!S||!S.dem)return e;const L=S.dem,F=1<<S.tileID.canonical.z,B=(b*F-S.tileID.canonical.x)*L.dim,j=(t.y*F-S.tileID.canonical.y)*L.dim,$=Math.floor(B),J=Math.floor(j);return(n?this.exaggeration():1)*Ln(Ln(L.get($,J),L.get($,J+1),j-J),Ln(L.get($+1,J),L.get($+1,J+1),j-J),B-$)}getAtTileOffset(t,e,n){const s=1<<t.canonical.z;return this.getAtPointOrZero(new Xc(t.wrap+(t.canonical.x+e/On)/s,(t.canonical.y+n/On)/s))}getAtTileOffsetFunc(t,e,n,s){return u=>{const f=this.getAtTileOffset(t,u.x,u.y),y=s.upVector(t.canonical,u.x,u.y);return ma(y,y,f*s.upVectorScale(t.canonical,e,n).metersToTile),y}}getForTilePoints(t,e,n,s){if(this.isUsingMockSource())return!1;const u=oh.create(this,t,s);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,s=e.tileID,u=1<<t.canonical.z-s.canonical.z;let f=t.canonical.x/u-s.canonical.x,y=t.canonical.y/u-s.canonical.y,b=0;for(let C=0;C<t.canonical.z-s.canonical.z&&!n.leaves[b];C++){f*=2,y*=2;const S=2*Math.floor(y)+Math.floor(f);b=n.childOffsets[b]+S,f%=1,y%=1}return{min:this.exaggeration()*n.minimums[b],max:this.exaggeration()*n.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},c.ErrorEvent=ji,c.EvaluationParameters=Be,c.Event=po,c.Evented=jr,c.FillExtrusionBucket=Fu,c.Frustum=zf,c.FrustumCorners=yo,c.GLOBE_METERS_TO_ECEF=Wu,c.GLOBE_RADIUS=cl,c.GLOBE_SCALE_MATCH_LATITUDE=45,c.GLOBE_ZOOM_THRESHOLD_MAX=6,c.GLOBE_ZOOM_THRESHOLD_MIN=5,c.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_createGrid(t){const e=new Mr,n=new Ho,s=65;for(let u=0;u<s;u++)for(let f=0;f<s;f++)e.emplaceBack(f,u);this._gridSegments=[];for(let u=0,f=0;u<Zu.length;u++){const y=Zu[u];for(let C=0;C<y;C++)for(let S=0;S<64;S++){const L=C*s+S;n.emplaceBack(L+1,L,L+s),n.emplaceBack(L+s,L+s+1,L+1)}const b=64*y*2;this._gridSegments.push(ao.simpleSegment(0,f,(y+1)*s,b)),f+=b}this._gridBuffer=t.createVertexBuffer(e,Oa.members),this._gridIndexBuffer=t.createIndexBuffer(n,!0)}_createPoles(t){const e=new Ho;for(let u=0;u<=64;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new Ic,s=new Ic;this._poleSegments=[];for(let u=0,f=0;u<5;u++){const y=360/(1<<u);n.emplaceBack(0,-cl,0,.5,0),s.emplaceBack(0,-cl,0,.5,1);for(let b=0;b<=64;b++){const C=b/64,S=Ln(0,y,C),[L,F,B]=Xu(xg,bg,S,cl);n.emplaceBack(L,F,B,C,0),s.emplaceBack(L,F,B,C,1)}this._poleSegments.push(ao.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,op,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,op,!1)}getGridBuffers(t){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[t]]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const n=new il,s=64,u=s+1;this._wireframeSegments=[];for(let f=0,y=0;f<Zu.length;f++){const b=Zu[f];for(let S=0;S<b;S++)for(let L=0;L<s;L++){const F=S*u+L;n.emplaceBack(F,F+1),n.emplaceBack(F,F+u),n.emplaceBack(F,F+u+1)}const C=b*s*3;this._wireframeSegments.push(ao.simpleSegment(0,y,(b+1)*u,C)),y+=C}this._wireframeIndexBuffer=t.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},c.GlyphManager=Gu,c.ImagePosition=au,c.LivePerformanceUtils=We,c.LngLat=Sr,c.LngLatBounds=Pc,c.LocalGlyphMode=Fh,c.MAX_MERCATOR_LATITUDE=wl,c.MercatorCoordinate=Xc,c.ONE_EM=_s,c.OverscaledTileID=zs,c.PerformanceMarkers=De,c.Properties=In,c.RGBAImage=Fs,c.Ray=Ff,c.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Bt,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Qi(t))return t;const n=Oe(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Qi(t))return t;const n=Oe(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,s){if(!Qi(t))return t;const u=Oe(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),n&&u.params.push(`language=${n}`),s&&u.params.push(`worldview=${s}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,s){const u=Oe(t);return Qi(t)?(u.path=`/styles/v1${u.path}/sprite${e}${n}`,this._makeAPIURL(u,this._customAccessToken||s)):(u.path+=`${e}${n}`,Mt(u))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Qi(t))return t;const s=Oe(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&"raster"!==s.authority&&512===n?"@2x":""}${pt.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${zt.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${zt.TILE_URL_VERSION}${s.path}`);const u=this._customAccessToken||function(f){for(const y of f){const b=y.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(s.params)||zt.ACCESS_TOKEN;return zt.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,u)}canonicalizeTileURL(t,e){const n=Oe(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${zt.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${zt.TILE_URL_VERSION}/`,"")}`;let u=n.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(s+=`?${u.join("&")}`),s}canonicalizeTileset(t,e){const n=!!e&&Qi(e),s=[];for(const u of t.tiles||[])qi(u)?s.push(this.canonicalizeTileURL(u,n)):s.push(u);return s}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Oe(zt.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,"http"===t.protocol){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if("/"!==s.path&&(t.path=`${s.path}${t.path}`),!zt.REQUIRE_ACCESS_TOKEN)return Mt(t);if(e=e||zt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(u=>-1===u.indexOf("access_token")),t.params.push(`access_token=${e||""}`),Mt(t)}},c.ResourceType=vt,c.SegmentVector=ao,c.SourceCache=Ec,c.StencilMode=ef,c.StructArrayLayout1ui2=fh,c.StructArrayLayout2f1f2i16=Ps,c.StructArrayLayout2i4=Mr,c.StructArrayLayout2ui4=il,c.StructArrayLayout3f12=yl,c.StructArrayLayout3ui6=Ho,c.StructArrayLayout4i8=Hr,c.StructArrayLayout5f20=Ic,c.Texture=zc,c.Tile=Yd,c.Transitionable=at,c.Uniform1f=nd,c.Uniform1i=class extends cc{constructor(t){super(t),this.current=0}set(t,e,n){this.fetchUniformLocation(t,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},c.Uniform2f=class extends cc{constructor(t){super(t),this.current=[0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},c.Uniform3f=class extends cc{constructor(t){super(t),this.current=[0,0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},c.Uniform4f=rd,c.UniformColor=id,c.UniformMatrix2f=class extends cc{constructor(t){super(t),this.current=t_}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<4;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},c.UniformMatrix3f=class extends cc{constructor(t){super(t),this.current=gh}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<9;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},c.UniformMatrix4f=class extends cc{constructor(t){super(t),this.current=e_}set(t,e,n){if(this.fetchUniformLocation(t,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let s=1;s<16;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},c.UnwrappedTileID=Am,c.ValidationError=Et,c.VectorTileFeature=wd,c.VectorTileWorkerSource=class extends jr{constructor(t,e,n,s,u){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=u||zg,this.loading={},this.loaded={},this.deduped=new bp(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,s=t&&t.request,u=s&&s.collectResourceTiming,f=this.loading[n]=new ny(t);f.abort=this.loadVectorData(t,(y,b)=>{const C=!this.loading[n];if(delete this.loading[n],C||y||!b)return f.status="done",C||(this.loaded[n]=f),e(y);const S=b.rawData,L={};b.expires&&(L.expires=b.expires),b.cacheControl&&(L.cacheControl=b.cacheControl),f.vectorTile=b.vectorTile||new Hf(new Oc(S));const F=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(B,j)=>{if(B||!j)return e(B);const $={};if(u){const J=Wt(s);J.length>0&&($.resourceTiming=JSON.parse(JSON.stringify(J)))}e(null,Ne({rawTileData:S.slice(0)},j,L,$))})};this.isSpriteLoaded?F():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(F,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):F()}),this.loaded=this.loaded||{},this.loaded[n]=f})}reloadTile(t,e){const n=this.loaded,s=t.uid,u=this;if(n&&n[s]){const f=n[s];f.showCollisionBoxes=t.showCollisionBoxes,f.enableTerrain=!!t.enableTerrain,f.projection=t.projection,f.tileTransform=Ju(t.tileID.canonical,t.projection);const y=(b,C)=>{const S=f.reloadCallback;S&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,S)),e(b,C)};"parsing"===f.status?f.reloadCallback=y:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(t,e){const n=t.uid,s=this.loading[n];s&&(s.abort&&s.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,s=t.uid;n&&n[s]&&delete n[s],e()}},c.WritingMode=Ns,c.add=dc,c.addDynamicAttributes=Hh,c.adjoint=function(t,e){var n=e[0],s=e[1],u=e[2],f=e[3],y=e[4],b=e[5],C=e[6],S=e[7],L=e[8];return t[0]=y*L-b*S,t[1]=u*S-s*L,t[2]=s*b-u*y,t[3]=b*C-f*L,t[4]=n*L-u*C,t[5]=u*f-n*b,t[6]=f*S-y*C,t[7]=s*C-n*S,t[8]=n*y-s*f,t},c.asyncAll=hn,c.bezier=Yt,c.bindAll=Mn,c.boundsAttributes=Ag,c.bufferConvexPolygon=function(t,e){const n=[];for(let s=0;s<t.length;s++){const u=Kn(s-1,-1,t.length-1),f=Kn(s+1,-1,t.length-1),y=t[s],b=t[f],C=t[u].sub(y).unit(),S=b.sub(y).unit(),L=S.angleWithSep(C.x,C.y),F=C.add(S).unit().mult(-1*e/Math.sin(L/2));n.push(y.add(F))}return n},c.cacheEntryPossiblyAdded=function(t){Er++,Er>vs&&(t.getActor().send("enforceCacheSizeLimit",Hi),Er=0)},c.calculateGlobeLabelMatrix=function(t,e){const{x:n,y:s}=t.point,u=_g(n,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Kc(u,u,lp(vc(e)))},c.calculateGlobeMatrix=function(t){const{x:e,y:n}=t.point,{lng:s,lat:u}=t._center;return _g(e,n,t.worldSize,s,u)},c.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,n=e/ol(1,t.center.lat),s=Dl(new Float64Array(16));return al(s,s,[t.point.x,t.point.y,0]),Cl(s,s,[n,n,e]),Float32Array.from(s)},c.circumferenceAtLatitude=hc,c.clamp=gt,c.clearTileCache=function(t){if(!fo())return;const e=Pe.caches.delete(xn);t&&e.catch(t).then(()=>t())},c.clipLine=og,c.clone=function(t){var e=new ta(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.clone$1=Rn,c.collisionCircleLayout=O_,c.config=zt,c.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},c.create=function(){var t=new ta(16);return ta!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},c.create$1=tm,c.createExpression=bn,c.createLayout=an,c.createStyleLayer=function(t){return"custom"===t.type?new Mg(t):new J_[t.type](t)},c.cross=im,c.degToRad=ht,c.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},c.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},c.dot=Sl,c.earthRadius=sd,c.ease=_t,c.easeCubicInOut=Dt,c.ecefToLatLng=function([t,e,n]){const s=Math.hypot(t,e,n),u=Math.atan2(t,n),f=.5*Math.PI-Math.acos(-e/s);return new Sr(un(u),un(f))},c.emitValidationErrors=Vc,c.endsWith=Bn,c.enforceCacheSizeLimit=function(t){Or(),Lr&&Lr.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-t;s++)e.delete(n[s])})})},c.evaluateSizeForFeature=Sd,c.evaluateSizeForZoom=iu,c.evaluateVariableOffset=hg,c.evented=Ce,c.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},c.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},c.exported=fn,c.exported$1=pt,c.extend=Ne,c.extend$1=rs,c.fillExtrusionHeightLift=Sm,c.filterObject=En,c.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},c.fromQuat=function(t,e){var n=e[0],s=e[1],u=e[2],f=e[3],y=n+n,b=s+s,C=u+u,S=n*y,L=s*y,F=s*b,B=u*y,j=u*b,$=u*C,J=f*y,ce=f*b,ye=f*C;return t[0]=1-F-$,t[1]=L+ye,t[2]=B-ce,t[3]=0,t[4]=L-ye,t[5]=1-S-$,t[6]=j+J,t[7]=0,t[8]=B+ce,t[9]=j-J,t[10]=1-S-F,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},c.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=-n,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.fromScaling=s_,c.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return ur[e]},c.getAABBPointSquareDist=function(t,e,n){let s=0;for(let u=0;u<2;++u){const f=n?n[u]:0;t[u]>f&&(s+=(t[u]-f)*(t[u]-f)),e[u]<f&&(s+=(f-e[u])*(f-e[u]))}return s},c.getAnchorAlignment=Rd,c.getAnchorJustification=qu,c.getBounds=function(t){let e=1/0,n=1/0,s=-1/0,u=-1/0;for(const f of t)e=Math.min(e,f.x),n=Math.min(n,f.y),s=Math.max(s,f.x),u=Math.max(u,f.y);return{min:new st(e,n),max:new st(s,u)}},c.getColumn=uo,c.getGridMatrix=function(t,e,n,s){const u=e.getNorth(),f=e.getSouth(),y=e.getWest(),b=e.getEast(),C=1<<t.z,S=b-y,L=u-f,F=S/64,B=-L/Zu[n],j=[0,F,0,B,0,0,u,y,0];if(t.z>0){const $=180/s;nm(j,j,[$/S+1,0,0,0,$/L+1,0,-.5*$/F,.5*$/B,1])}return j[2]=C,j[5]=t.x,j[8]=t.y,j},c.getImage=Jo,c.getJSON=function(t,e){return _r(Ne(t,{type:"json"}),e)},c.getLatitudinalLod=function(t){const e=80.051129;t=gt(t,-80.051129,e)/e*90;const n=Math.pow(Math.abs(Math.sin(ht(t))),3);return Math.round(n*(Zu.length-1))},c.getMapSessionAPI=q,c.getPerformanceMeasurement=Wt,c.getProjection=gu,c.getRTLTextPluginStatus=ke,c.getReferrer=br,c.getTilePoint=function(t,{x:e,y:n},s=0){return new st(((e-s)*t.scale-t.x)*On,(n*t.scale-t.y)*On)},c.getTileVec3=function(t,e,n=0){return Au(((e.x-n)*t.scale-t.x)*On,(e.y*t.scale-t.y)*On,Wp(e.z,e.y))},c.getVideo=function(t,e){const n=Pe.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<t.length;s++){const u=Pe.document.createElement("source");Zr(t[s])||(n.crossOrigin="Anonymous"),u.src=t[s],n.appendChild(u)}return{cancel:()=>{}}},c.globeCenterToScreenPoint=function(t){const e=[0,0,0],n=Dl(new Float64Array(16));return Kc(n,t.pixelMatrix,t.globeMatrix),lo(e,e,n),new st(e[0],e[1])},c.globeDenormalizeECEF=lp,c.globeECEFOrigin=function(t,e){const n=[0,0,0];return lo(n,n,Nh(vc(e.canonical))),lo(n,n,t),n},c.globeNormalizeECEF=Nh,c.globePixelsToTileUnits=function(t,e){return On/(512*Math.pow(2,t))*jd(vc(e))},c.globePoleMatrixForTile=function(t,e,n){const s=Dl(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return Pf(s,n.globeMatrix,u),Float32Array.from(s)},c.globeTileBounds=vc,c.globeTiltAtLngLat=yg,c.globeToMercatorTransition=Yu,c.globeUseCustomAntiAliasing=function(t,e,n){const s=Yu(n.zoom),u=t.style.map._antialias,f=!!e.extStandardDerivatives,y=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===s&&!u&&!y&&f},c.identity=Dl,c.identity$1=kf,c.invert=If,c.isFullscreen=function(){return!!Pe.document.fullscreenElement||!!Pe.document.webkitFullscreenElement},c.isLngLatBehindGlobe=cp,c.isMapAuthenticated=function(t){return ae.has(t)},c.isMapboxURL=Qi,c.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Yr(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},c.latFromMercatorY=Io,c.latLngToECEF=Ku,c.len=om,c.length=wh,c.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},c.lngFromMercatorX=sl,c.loadVectorTile=zg,c.makeRequest=_r,c.mapValue=function(t,e,n,s,u){return gt((t-e)/(n-e)*(u-s)+s,s,u)},c.mercatorScale=wf,c.mercatorXfromLng=xl,c.mercatorYfromLat=bl,c.mercatorZfromAltitude=ol,c.mul=Ny,c.mul$1=By,c.multiply=Kc,c.multiply$1=nm,c.multiply$2=dd,c.nextPowerOfTwo=Ft,c.normalize=gs,c.normalize$1=Of,c.normalize$2=am,c.number=Ln,c.ortho=function(t,e,n,s,u,f,y){var b=1/(e-n),C=1/(s-u),S=1/(f-y);return t[0]=-2*b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*C,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*S,t[11]=0,t[12]=(e+n)*b,t[13]=(u+s)*C,t[14]=(y+f)*S,t[15]=1,t},c.pbf=Oc,c.perspective=function(t,e,n,s,u){var f,y=1/Math.tan(e/2);return t[0]=y/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=u&&u!==1/0?(t[10]=(u+s)*(f=1/(s-u)),t[14]=2*u*s*f):(t[10]=-1,t[14]=-2*s),t},c.pick=function(t,e){const n={};for(let s=0;s<e.length;s++){const u=e[s];u in t&&(n[u]=t[u])}return n},c.plugin=He,c.pointGeometry=st,c.polesInViewport=function(t){const e=Dl(new Float64Array(16));Kc(e,t.pixelMatrix,t.globeMatrix);const n=[0,Fa,0],s=[0,za,0];return lo(n,n,e),lo(s,s,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!cp(t,new Sr(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!cp(t,new Sr(t.center.lat,-90))]},c.polygonContainsPoint=Mu,c.polygonIntersectsBox=Jp,c.polygonIntersectsPolygon=Zp,c.polygonizeBounds=function(t,e,n=0,s=!0){const u=new st(n,n),f=t.sub(u),y=e.add(u),b=[f,new st(y.x,f.y),y,new st(f.x,y.y)];return s&&b.push(f.clone()),b},c.posAttributes=Oa,c.postMapLoadEvent=ge,c.postPerformanceEvent=ue,c.postTurnstileEvent=Y,c.potpack=kh,c.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},c.radToDeg=un,c.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.registerForPluginStateChange=function(t){return t({pluginStatus:fe,pluginURL:de}),Ce.on("pluginStateChange",t),t},c.removeAuthState=function(t){ae.delete(t)},c.renderColorRamp=md,c.resample=Ef,c.rotateX=Af,c.rotateX$1=Eh,c.rotateY=Pf,c.rotateY$1=cm,c.rotateZ=function(t,e,n){var s=Math.sin(n),u=Math.cos(n),f=e[0],y=e[1],b=e[2],C=e[3],S=e[4],L=e[5],F=e[6],B=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u+S*s,t[1]=y*u+L*s,t[2]=b*u+F*s,t[3]=C*u+B*s,t[4]=S*u-f*s,t[5]=L*u-y*s,t[6]=F*u-b*s,t[7]=B*u-C*s,t},c.rotateZ$1=function(t,e,n){n*=.5;var s=e[0],u=e[1],f=e[2],y=e[3],b=Math.sin(n),C=Math.cos(n);return t[0]=s*C+u*b,t[1]=u*C-s*b,t[2]=f*C+y*b,t[3]=y*C-f*b,t},c.scale=Cl,c.scale$1=sm,c.scale$2=ma,c.scaleAndAdd=Pu,c.set=function(t,e,n,s){return t[0]=e,t[1]=n,t[2]=s,t},c.setCacheLimits=function(t,e){Hi=t,vs=e},c.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},c.setRTLTextPlugin=function(t,e,n=!1){if(fe===K||fe===re||fe===Q)throw new Error("setRTLTextPlugin cannot be called multiple times.");de=fn.resolveURL(t),fe=K,oe=e,Se(),n||Ze()},c.smoothstep=dn,c.spec=it,c.squaredLength=function(t){var e=t[0],n=t[1],s=t[2];return e*e+n*n+s*s},c.storeAuthState=function(t,e){e?ae.add(t):ae.delete(t)},c.sub=Wl,c.subtract=Lf,c.symbolSize=Uy,c.tileAABB=function(t,e,n,s,u,f,y,b,C){if("globe"===C.name)return function K_(t,e,n){const s=e/t.worldSize,u=t.globeMatrix;if(n.z<=1){const qe=vc(n).getCorners();return gg(qe,u,s),Os.fromPoints(qe)}const f=Ud(n),y=ap(f);gg(y,u,s);const b=Number.MAX_VALUE,C=[-b,-b,-b],S=[b,b,b];if(f.contains(t.center)){for(const At of y)Ra(S,S,At),fc(C,C,At);C[2]=0;const qe=t.point,lt=[qe.x*s,qe.y*s,0];return Ra(S,S,lt),fc(C,C,lt),new Os(S,C)}const L=[u[12]*s,u[13]*s,u[14]*s],F=f.getCenter(),B=gt(t.center.lat,-85.051129,wl),j=gt(F.lat,-85.051129,wl),$=xl(t.center.lng),J=bl(B);let ce=$-xl(F.lng);const ye=J-bl(j);ce>.5?ce-=1:ce<-.5&&(ce+=1);let Te=0;Math.abs(ce)>Math.abs(ye)?Te=ce>=0?1:3:(Te=ye>=0?0:2,Pu(L,L,[u[4]*s,u[5]*s,u[6]*s],-Math.sin(ht(ye>=0?f.getSouth():f.getNorth()))*cl));const pe=y[Te],we=y[(Te+1)%4],Re=new zh(pe,we,L),Me=[sp(Re,0)||pe[0],sp(Re,1)||pe[1],sp(Re,2)||pe[2]],Ke=Yu(t.zoom);if(Ke>0){const qe=function({x:At,y:Je,z:dt},mt,St,Ot,rt){const qt=1/(1<<dt);let Sn=At*qt,Qt=Sn+qt,mn=Je*qt,Zt=mn+qt,Pn=0;const ar=(Sn+Qt)/2-Ot;return ar>.5?Pn=-1:ar<-.5&&(Pn=1),Sn=((Sn+Pn)*mt-(Ot*=mt))*St+Ot,Qt=((Qt+Pn)*mt-Ot)*St+Ot,mn=(mn*mt-(rt*=mt))*St+rt,Zt=(Zt*mt-rt)*St+rt,[[Sn,Zt,0],[Qt,Zt,0],[Qt,mn,0],[Sn,mn,0]]}(n,e,t._pixelsPerMercatorPixel,$,J);for(let At=0;At<y.length;At++)lu(y[At],qe[At],Ke);const lt=dc([],qe[Te],qe[(Te+1)%4]);ma(lt,lt,.5),lu(Me,lt,Ke)}for(const qe of y)Ra(S,S,qe),fc(C,C,qe);return S[2]=Math.min(pe[2],we[2]),Ra(S,S,Me),fc(C,C,Me),new Os(S,C)}(t,e,new Td(n,s,u));const S=Ju({z:n,x:s,y:u},C);return new Os([(f+S.x/S.scale)*e,e*(S.y/S.scale),y],[(f+S.x2/S.scale)*e,e*(S.y2/S.scale),b])},c.tileCornersToBounds=Ud,c.tileTransform=Ju,c.transformMat3=function(t,e,n){var s=e[0],u=e[1],f=e[2];return t[0]=s*n[0]+u*n[3]+f*n[6],t[1]=s*n[1]+u*n[4]+f*n[7],t[2]=s*n[2]+u*n[5]+f*n[8],t},c.transformMat4=lo,c.transformMat4$1=Jc,c.transformQuat=fd,c.transitionTileAABBinECEF=mg,c.translate=al,c.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=s,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},c.triggerPluginCompletionEvent=ve,c.uniqueId=xt,c.updateGlobeVertexNormal=function(t,e,n,s,u){const f=5*e+2;t.float32[f+0]=n,t.float32[f+1]=s,t.float32[f+2]=u},c.validateCustomStyleLayer=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},c.validateFilter=t=>ko(ds(t)),c.validateFog=t=>ko(Vl(t)),c.validateLayer=t=>ko(_l(t)),c.validateLight=t=>ko($o(t)),c.validateSource=t=>ko(bu(t)),c.validateStyle=wu,c.validateTerrain=t=>ko(oc(t)),c.values=Br,c.vectorTile=Ah,c.version=Jt,c.warnOnce=Un,c.window=Pe,c.wrap=Kn}),me(0,function(c){function Pe(ie){if("number"==typeof ie||"boolean"==typeof ie||"string"==typeof ie||null==ie)return JSON.stringify(ie);if(Array.isArray(ie)){let Y="[";for(const le of ie)Y+=`${Pe(le)},`;return`${Y}]`}let H="{";for(const Y of Object.keys(ie).sort())H+=`${Y}:${Pe(ie[Y])},`;return`${H}}`}function Jt(ie){let H="";for(const Y of c.refProperties)H+=`/${Pe(ie[Y])}`;return H}class Vt{constructor(H){this.keyCache={},H&&this.replace(H)}replace(H){this._layerConfigs={},this._layers={},this.update(H,[])}update(H,Y){for(const ge of H)this._layerConfigs[ge.id]=ge,(this._layers[ge.id]=c.createStyleLayer(ge)).compileFilter(),this.keyCache[ge.id]&&delete this.keyCache[ge.id];for(const ge of Y)delete this.keyCache[ge],delete this._layerConfigs[ge],delete this._layers[ge];this.familiesBySource={};const le=function(ge,Ae){const ue={};for(let q=0;q<ge.length;q++){const ae=Ae&&Ae[ge[q].id]||Jt(ge[q]);Ae&&(Ae[ge[q].id]=ae);let De=ue[ae];De||(De=ue[ae]=[]),De.push(ge[q])}const ne=[];for(const q in ue)ne.push(ue[q]);return ne}(c.values(this._layerConfigs),this.keyCache);for(const ge of le){const Ae=ge.map(We=>this._layers[We.id]),ue=Ae[0];if("none"===ue.visibility)continue;const ne=ue.source||"";let q=this.familiesBySource[ne];q||(q=this.familiesBySource[ne]={});const ae=ue.sourceLayer||"_geojsonTileLayer";let De=q[ae];De||(De=q[ae]=[]),De.push(Ae)}}}class zt{loadTile(H,Y){const{uid:le,encoding:ge,rawImageData:Ae,padding:ue,buildQuadTree:ne}=H,q=c.window.ImageBitmap&&Ae instanceof c.window.ImageBitmap?this.getImageData(Ae,ue):Ae;Y(null,new c.DEMData(le,q,ge,ue<1,ne))}getImageData(H,Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);const le=this.offscreenCanvasContext.getImageData(-Y,-Y,H.width+2*Y,H.height+2*Y);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),le}}var pt=function ie(H,Y){var le,ge=H&&H.type;if("FeatureCollection"===ge)for(le=0;le<H.features.length;le++)ie(H.features[le],Y);else if("GeometryCollection"===ge)for(le=0;le<H.geometries.length;le++)ie(H.geometries[le],Y);else if("Feature"===ge)ie(H.geometry,Y);else if("Polygon"===ge)yt(H.coordinates,Y);else if("MultiPolygon"===ge)for(le=0;le<H.coordinates.length;le++)yt(H.coordinates[le],Y);return H};function yt(ie,H){if(0!==ie.length){ct(ie[0],H);for(var Y=1;Y<ie.length;Y++)ct(ie[Y],!H)}}function ct(ie,H){for(var Y=0,le=0,ge=0,Ae=ie.length,ue=Ae-1;ge<Ae;ue=ge++){var ne=(ie[ge][0]-ie[ue][0])*(ie[ue][1]+ie[ge][1]),q=Y+ne;le+=Math.abs(Y)>=Math.abs(ne)?Y-q+ne:ne-q+Y,Y=q}Y+le>=0!=!!H&&ie.reverse()}const $t=c.VectorTileFeature.prototype.toGeoJSON;class Kt{constructor(H){this._feature=H,this.extent=c.EXTENT,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))}loadGeometry(){if(1===this._feature.type){const H=[];for(const Y of this._feature.geometry)H.push([new c.pointGeometry(Y[0],Y[1])]);return H}{const H=[];for(const Y of this._feature.geometry){const le=[];for(const ge of Y)le.push(new c.pointGeometry(ge[0],ge[1]));H.push(le)}return H}}toGeoJSON(H,Y,le){return $t.call(this,H,Y,le)}}class ut{constructor(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.EXTENT,this.length=H.length,this._features=H}feature(H){return new Kt(this._features[H])}}var Bt={exports:{}},cn=c.pointGeometry,Wn=c.vectorTile.VectorTileFeature,st=tr;function tr(ie,H){this.options=H||{},this.features=ie,this.length=ie.length}function en(ie,H){this.id="number"==typeof ie.id?ie.id:void 0,this.type=ie.type,this.rawGeometry=1===ie.type?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=H||4096}tr.prototype.feature=function(ie){return new en(this.features[ie],this.options.extent)},en.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var H=0;H<ie.length;H++){for(var Y=ie[H],le=[],ge=0;ge<Y.length;ge++)le.push(new cn(Y[ge][0],Y[ge][1]));this.geometry.push(le)}return this.geometry},en.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,H=1/0,Y=-1/0,le=1/0,ge=-1/0,Ae=0;Ae<ie.length;Ae++)for(var ue=ie[Ae],ne=0;ne<ue.length;ne++){var q=ue[ne];H=Math.min(H,q.x),Y=Math.max(Y,q.x),le=Math.min(le,q.y),ge=Math.max(ge,q.y)}return[H,le,Y,ge]},en.prototype.toGeoJSON=Wn.prototype.toGeoJSON;var rn=c.pbf,ht=st;function un(ie){var H=new rn;return function(Y,le){for(var ge in Y.layers)le.writeMessage(3,ur,Y.layers[ge])}(ie,H),H.finish()}function ur(ie,H){var Y;H.writeVarintField(15,ie.version||1),H.writeStringField(1,ie.name||""),H.writeVarintField(5,ie.extent||4096);var le={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<ie.length;Y++)le.feature=ie.feature(Y),H.writeMessage(2,Dt,le);var ge=le.keys;for(Y=0;Y<ge.length;Y++)H.writeStringField(3,ge[Y]);var Ae=le.values;for(Y=0;Y<Ae.length;Y++)H.writeMessage(4,Kn,Ae[Y])}function Dt(ie,H){var Y=ie.feature;void 0!==Y.id&&H.writeVarintField(1,Y.id),H.writeMessage(2,Yt,ie),H.writeVarintField(3,Y.type),H.writeMessage(4,dn,Y)}function Yt(ie,H){var Y=ie.feature,le=ie.keys,ge=ie.values,Ae=ie.keycache,ue=ie.valuecache;for(var ne in Y.properties){var q=Y.properties[ne],ae=Ae[ne];if(null!==q){void 0===ae&&(le.push(ne),Ae[ne]=ae=le.length-1),H.writeVarint(ae);var De=typeof q;"string"!==De&&"boolean"!==De&&"number"!==De&&(q=JSON.stringify(q));var We=De+":"+q,Ue=ue[We];void 0===Ue&&(ge.push(q),ue[We]=Ue=ge.length-1),H.writeVarint(Ue)}}}function _t(ie,H){return(H<<3)+(7&ie)}function gt(ie){return ie<<1^ie>>31}function dn(ie,H){for(var Y=ie.loadGeometry(),le=ie.type,ge=0,Ae=0,ue=Y.length,ne=0;ne<ue;ne++){var q=Y[ne],ae=1;1===le&&(ae=q.length),H.writeVarint(_t(1,ae));for(var De=3===le?q.length-1:q.length,We=0;We<De;We++){1===We&&1!==le&&H.writeVarint(_t(2,De-1));var Ue=q[We].x-ge,bt=q[We].y-Ae;H.writeVarint(gt(Ue)),H.writeVarint(gt(bt)),ge+=Ue,Ae+=bt}3===le&&H.writeVarint(_t(7,1))}}function Kn(ie,H){var Y=typeof ie;"string"===Y?H.writeStringField(1,ie):"boolean"===Y?H.writeBooleanField(7,ie):"number"===Y&&(ie%1!=0?H.writeDoubleField(3,ie):ie<0?H.writeSVarintField(6,ie):H.writeVarintField(5,ie))}function hn(ie,H,Y,le,ge,Ae){if(ge-le<=Y)return;const ue=le+ge>>1;Br(ie,H,ue,le,ge,Ae%2),hn(ie,H,Y,le,ue-1,Ae+1),hn(ie,H,Y,ue+1,ge,Ae+1)}function Br(ie,H,Y,le,ge,Ae){for(;ge>le;){if(ge-le>600){const ae=ge-le+1,De=Y-le+1,We=Math.log(ae),Ue=.5*Math.exp(2*We/3),bt=.5*Math.sqrt(We*Ue*(ae-Ue)/ae)*(De-ae/2<0?-1:1);Br(ie,H,Y,Math.max(le,Math.floor(Y-De*Ue/ae+bt)),Math.min(ge,Math.floor(Y+(ae-De)*Ue/ae+bt)),Ae)}const ue=H[2*Y+Ae];let ne=le,q=ge;for(Ne(ie,H,le,Y),H[2*ge+Ae]>ue&&Ne(ie,H,le,ge);ne<q;){for(Ne(ie,H,ne,q),ne++,q--;H[2*ne+Ae]<ue;)ne++;for(;H[2*q+Ae]>ue;)q--}H[2*le+Ae]===ue?Ne(ie,H,le,q):(q++,Ne(ie,H,q,ge)),q<=Y&&(le=q+1),Y<=q&&(ge=q-1)}}function Ne(ie,H,Y,le){ot(ie,Y,le),ot(H,2*Y,2*le),ot(H,2*Y+1,2*le+1)}function ot(ie,H,Y){const le=ie[H];ie[H]=ie[Y],ie[Y]=le}function xt(ie,H,Y,le){const ge=ie-Y,Ae=H-le;return ge*ge+Ae*Ae}Bt.exports=un,Bt.exports.fromVectorTileJs=un,Bt.exports.fromGeojsonVt=function(ie,H){H=H||{};var Y={};for(var le in ie)Y[le]=new ht(ie[le].features,H),Y[le].name=le,Y[le].version=H.version,Y[le].extent=H.extent;return un({layers:Y})},Bt.exports.GeoJSONWrapper=ht;const Pt=ie=>ie[0],Ft=ie=>ie[1];class kt{constructor(H,Y=Pt,le=Ft,ge=64,Ae=Float64Array){this.nodeSize=ge,this.points=H;const ue=H.length<65536?Uint16Array:Uint32Array,ne=this.ids=new ue(H.length),q=this.coords=new Ae(2*H.length);for(let ae=0;ae<H.length;ae++)ne[ae]=ae,q[2*ae]=Y(H[ae]),q[2*ae+1]=le(H[ae]);hn(ne,q,ge,0,ne.length-1,0)}range(H,Y,le,ge){return function(Ae,ue,ne,q,ae,De,We){const Ue=[0,Ae.length-1,0],bt=[];let Wt,on;for(;Ue.length;){const vn=Ue.pop(),Xn=Ue.pop(),nr=Ue.pop();if(Xn-nr<=We){for(let Tr=nr;Tr<=Xn;Tr++)Wt=ue[2*Tr],on=ue[2*Tr+1],Wt>=ne&&Wt<=ae&&on>=q&&on<=De&&bt.push(Ae[Tr]);continue}const fn=Math.floor((nr+Xn)/2);Wt=ue[2*fn],on=ue[2*fn+1],Wt>=ne&&Wt<=ae&&on>=q&&on<=De&&bt.push(Ae[fn]);const sr=(vn+1)%2;(0===vn?ne<=Wt:q<=on)&&(Ue.push(nr),Ue.push(fn-1),Ue.push(sr)),(0===vn?ae>=Wt:De>=on)&&(Ue.push(fn+1),Ue.push(Xn),Ue.push(sr))}return bt}(this.ids,this.coords,H,Y,le,ge,this.nodeSize)}within(H,Y,le){return function(ge,Ae,ue,ne,q,ae){const De=[0,ge.length-1,0],We=[],Ue=q*q;for(;De.length;){const bt=De.pop(),Wt=De.pop(),on=De.pop();if(Wt-on<=ae){for(let sr=on;sr<=Wt;sr++)xt(Ae[2*sr],Ae[2*sr+1],ue,ne)<=Ue&&We.push(ge[sr]);continue}const vn=Math.floor((on+Wt)/2),Xn=Ae[2*vn],nr=Ae[2*vn+1];xt(Xn,nr,ue,ne)<=Ue&&We.push(ge[vn]);const fn=(bt+1)%2;(0===bt?ue-q<=Xn:ne-q<=nr)&&(De.push(on),De.push(vn-1),De.push(fn)),(0===bt?ue+q>=Xn:ne+q>=nr)&&(De.push(vn+1),De.push(Wt),De.push(fn))}return We}(this.ids,this.coords,H,Y,le,this.nodeSize)}}const Mn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},Bn=Math.fround||(Ur=new Float32Array(1),ie=>(Ur[0]=+ie,Ur[0]));var Ur;class En{constructor(H){this.options=Ti(Object.create(Mn),H),this.trees=new Array(this.options.maxZoom+1)}load(H){const{log:Y,minZoom:le,maxZoom:ge,nodeSize:Ae}=this.options;Y&&console.time("total time");const ue=`prepare ${H.length} points`;Y&&console.time(ue),this.points=H;let ne=[];for(let q=0;q<H.length;q++)H[q].geometry&&ne.push(Yn(H[q],q));this.trees[ge+1]=new kt(ne,Yr,zo,Ae,Float32Array),Y&&console.timeEnd(ue);for(let q=ge;q>=le;q--){const ae=+Date.now();ne=this._cluster(ne,q),this.trees[q]=new kt(ne,Yr,zo,Ae,Float32Array),Y&&console.log("z%d: %d clusters in %dms",q,ne.length,+Date.now()-ae)}return Y&&console.timeEnd("total time"),this}getClusters(H,Y){let le=((H[0]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,H[1]));let Ae=180===H[2]?180:((H[2]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)le=-180,Ae=180;else if(le>Ae){const De=this.getClusters([le,ge,180,ue],Y),We=this.getClusters([-180,ge,Ae,ue],Y);return De.concat(We)}const ne=this.trees[this._limitZoom(Y)],q=ne.range(tn(le),Kr(ue),tn(Ae),Kr(ge)),ae=[];for(const De of q){const We=ne.points[De];ae.push(We.numPoints?Un(We):this.points[We.index])}return ae}getChildren(H){const Y=this._getOriginId(H),le=this._getOriginZoom(H),ge="No cluster with the specified id.",Ae=this.trees[le];if(!Ae)throw new Error(ge);const ue=Ae.points[Y];if(!ue)throw new Error(ge);const ne=this.options.radius/(this.options.extent*Math.pow(2,le-1)),q=Ae.within(ue.x,ue.y,ne),ae=[];for(const De of q){const We=Ae.points[De];We.parentId===H&&ae.push(We.numPoints?Un(We):this.points[We.index])}if(0===ae.length)throw new Error(ge);return ae}getLeaves(H,Y,le){const ge=[];return this._appendLeaves(ge,H,Y=Y||10,le=le||0,0),ge}getTile(H,Y,le){const ge=this.trees[this._limitZoom(H)],Ae=Math.pow(2,H),{extent:ue,radius:ne}=this.options,q=ne/ue,ae=(le-q)/Ae,De=(le+1+q)/Ae,We={features:[]};return this._addTileFeatures(ge.range((Y-q)/Ae,ae,(Y+1+q)/Ae,De),ge.points,Y,le,Ae,We),0===Y&&this._addTileFeatures(ge.range(1-q/Ae,ae,1,De),ge.points,Ae,le,Ae,We),Y===Ae-1&&this._addTileFeatures(ge.range(0,ae,q/Ae,De),ge.points,-1,le,Ae,We),We.features.length?We:null}getClusterExpansionZoom(H){let Y=this._getOriginZoom(H)-1;for(;Y<=this.options.maxZoom;){const le=this.getChildren(H);if(Y++,1!==le.length)break;H=le[0].properties.cluster_id}return Y}_appendLeaves(H,Y,le,ge,Ae){const ue=this.getChildren(Y);for(const ne of ue){const q=ne.properties;if(q&&q.cluster?Ae+q.point_count<=ge?Ae+=q.point_count:Ae=this._appendLeaves(H,q.cluster_id,le,ge,Ae):Ae<ge?Ae++:H.push(ne),H.length===le)break}return Ae}_addTileFeatures(H,Y,le,ge,Ae,ue){for(const ne of H){const q=Y[ne],ae=q.numPoints;let De,We,Ue;if(ae)De=vr(q),We=q.x,Ue=q.y;else{const on=this.points[q.index];De=on.properties,We=tn(on.geometry.coordinates[0]),Ue=Kr(on.geometry.coordinates[1])}const bt={type:1,geometry:[[Math.round(this.options.extent*(We*Ae-le)),Math.round(this.options.extent*(Ue*Ae-ge))]],tags:De};let Wt;ae?Wt=q.id:this.options.generateId?Wt=q.index:this.points[q.index].id&&(Wt=this.points[q.index].id),void 0!==Wt&&(bt.id=Wt),ue.features.push(bt)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,Y){const le=[],{radius:ge,extent:Ae,reduce:ue,minPoints:ne}=this.options,q=ge/(Ae*Math.pow(2,Y));for(let ae=0;ae<H.length;ae++){const De=H[ae];if(De.zoom<=Y)continue;De.zoom=Y;const We=this.trees[Y+1],Ue=We.within(De.x,De.y,q),bt=De.numPoints||1;let Wt=bt;for(const on of Ue){const vn=We.points[on];vn.zoom>Y&&(Wt+=vn.numPoints||1)}if(Wt>bt&&Wt>=ne){let on=De.x*bt,vn=De.y*bt,Xn=ue&&bt>1?this._map(De,!0):null;const nr=(ae<<5)+(Y+1)+this.points.length;for(const fn of Ue){const sr=We.points[fn];if(sr.zoom<=Y)continue;sr.zoom=Y;const Tr=sr.numPoints||1;on+=sr.x*Tr,vn+=sr.y*Tr,sr.parentId=nr,ue&&(Xn||(Xn=this._map(De,!0)),ue(Xn,this._map(sr)))}De.parentId=nr,le.push(Rn(on/Wt,vn/Wt,nr,Wt,Xn))}else if(le.push(De),Wt>1)for(const on of Ue){const vn=We.points[on];vn.zoom<=Y||(vn.zoom=Y,le.push(vn))}}return le}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,Y){if(H.numPoints)return Y?Ti({},H.properties):H.properties;const le=this.points[H.index].properties,ge=this.options.map(le);return Y&&ge===le?Ti({},ge):ge}}function Rn(ie,H,Y,le,ge){return{x:Bn(ie),y:Bn(H),zoom:1/0,id:Y,parentId:-1,numPoints:le,properties:ge}}function Yn(ie,H){const[Y,le]=ie.geometry.coordinates;return{x:Bn(tn(Y)),y:Bn(Kr(le)),zoom:1/0,index:H,parentId:-1}}function Un(ie){return{type:"Feature",id:ie.id,properties:vr(ie),geometry:{type:"Point",coordinates:[(H=ie.x,360*(H-.5)),Ai(ie.y)]}};var H}function vr(ie){const H=ie.numPoints,Y=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H;return Ti(Ti({},ie.properties),{cluster:!0,cluster_id:ie.id,point_count:H,point_count_abbreviated:Y})}function tn(ie){return ie/360+.5}function Kr(ie){const H=Math.sin(ie*Math.PI/180),Y=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return Y<0?0:Y>1?1:Y}function Ai(ie){const H=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function Ti(ie,H){for(const Y in H)ie[Y]=H[Y];return ie}function Yr(ie){return ie.x}function zo(ie){return ie.y}function uo(ie,H,Y,le){for(var ge,Ae=le,ue=Y-H>>1,ne=Y-H,q=ie[H],ae=ie[H+1],De=ie[Y],We=ie[Y+1],Ue=H+3;Ue<Y;Ue+=3){var bt=xn(ie[Ue],ie[Ue+1],q,ae,De,We);if(bt>Ae)ge=Ue,Ae=bt;else if(bt===Ae){var Wt=Math.abs(Ue-ue);Wt<ne&&(ge=Ue,ne=Wt)}}Ae>le&&(ge-H>3&&uo(ie,H,ge,le),ie[ge+2]=Ae,Y-ge>3&&uo(ie,ge,Y,le))}function xn(ie,H,Y,le,ge,Ae){var ue=ge-Y,ne=Ae-le;if(0!==ue||0!==ne){var q=((ie-Y)*ue+(H-le)*ne)/(ue*ue+ne*ne);q>1?(Y=ge,le=Ae):q>0&&(Y+=ue*q,le+=ne*q)}return(ue=ie-Y)*ue+(ne=H-le)*ne}function Lr(ie,H,Y,le){var ge={id:void 0===ie?null:ie,type:H,geometry:Y,tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ae){var ue=Ae.geometry,ne=Ae.type;if("Point"===ne||"MultiPoint"===ne||"LineString"===ne)ho(Ae,ue);else if("Polygon"===ne||"MultiLineString"===ne)for(var q=0;q<ue.length;q++)ho(Ae,ue[q]);else if("MultiPolygon"===ne)for(q=0;q<ue.length;q++)for(var ae=0;ae<ue[q].length;ae++)ho(Ae,ue[q][ae])}(ge),ge}function ho(ie,H){for(var Y=0;Y<H.length;Y+=3)ie.minX=Math.min(ie.minX,H[Y]),ie.minY=Math.min(ie.minY,H[Y+1]),ie.maxX=Math.max(ie.maxX,H[Y]),ie.maxY=Math.max(ie.maxY,H[Y+1])}function Hi(ie,H,Y,le){if(H.geometry){var ge=H.geometry.coordinates,Ae=H.geometry.type,ue=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),ne=[],q=H.id;if(Y.promoteId?q=H.properties[Y.promoteId]:Y.generateId&&(q=le||0),"Point"===Ae)vs(ge,ne);else if("MultiPoint"===Ae)for(var ae=0;ae<ge.length;ae++)vs(ge[ae],ne);else if("LineString"===Ae)fo(ge,ne,ue,!1);else if("MultiLineString"===Ae){if(Y.lineMetrics){for(ae=0;ae<ge.length;ae++)fo(ge[ae],ne=[],ue,!1),ie.push(Lr(q,"LineString",ne,H.properties));return}Or(ge,ne,ue,!1)}else if("Polygon"===Ae)Or(ge,ne,ue,!0);else{if("MultiPolygon"!==Ae){if("GeometryCollection"===Ae){for(ae=0;ae<H.geometry.geometries.length;ae++)Hi(ie,{id:q,geometry:H.geometry.geometries[ae],properties:H.properties},Y,le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ae=0;ae<ge.length;ae++){var De=[];Or(ge[ae],De,ue,!0),ne.push(De)}}ie.push(Lr(q,Ae,ne,H.properties))}}function vs(ie,H){H.push(No(ie[0])),H.push(Er(ie[1])),H.push(0)}function fo(ie,H,Y,le){for(var ge,Ae,ue=0,ne=0;ne<ie.length;ne++){var q=No(ie[ne][0]),ae=Er(ie[ne][1]);H.push(q),H.push(ae),H.push(0),ne>0&&(ue+=le?(ge*ae-q*Ae)/2:Math.sqrt(Math.pow(q-ge,2)+Math.pow(ae-Ae,2))),ge=q,Ae=ae}var De=H.length-3;H[2]=1,uo(H,0,De,Y),H[De+2]=1,H.size=Math.abs(ue),H.start=0,H.end=H.size}function Or(ie,H,Y,le){for(var ge=0;ge<ie.length;ge++){var Ae=[];fo(ie[ge],Ae,Y,le),H.push(Ae)}}function No(ie){return ie/360+.5}function Er(ie){var H=Math.sin(ie*Math.PI/180),Y=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return Y<0?0:Y>1?1:Y}function vt(ie,H,Y,le,ge,Ae,ue,ne){if(le/=H,Ae>=(Y/=H)&&ue<le)return ie;if(ue<Y||Ae>=le)return null;for(var q=[],ae=0;ae<ie.length;ae++){var De=ie[ae],We=De.geometry,Ue=De.type,bt=0===ge?De.minX:De.minY,Wt=0===ge?De.maxX:De.maxY;if(bt>=Y&&Wt<le)q.push(De);else if(!(Wt<Y||bt>=le)){var on=[];if("Point"===Ue||"MultiPoint"===Ue)nn(We,on,Y,le,ge);else if("LineString"===Ue)br(We,on,Y,le,ge,!1,ne.lineMetrics);else if("MultiLineString"===Ue)Fr(We,on,Y,le,ge,!1);else if("Polygon"===Ue)Fr(We,on,Y,le,ge,!0);else if("MultiPolygon"===Ue)for(var vn=0;vn<We.length;vn++){var Xn=[];Fr(We[vn],Xn,Y,le,ge,!0),Xn.length&&on.push(Xn)}if(on.length){if(ne.lineMetrics&&"LineString"===Ue){for(vn=0;vn<on.length;vn++)q.push(Lr(De.id,Ue,on[vn],De.tags));continue}"LineString"!==Ue&&"MultiLineString"!==Ue||(1===on.length?(Ue="LineString",on=on[0]):Ue="MultiLineString"),"Point"!==Ue&&"MultiPoint"!==Ue||(Ue=3===on.length?"Point":"MultiPoint"),q.push(Lr(De.id,Ue,on,De.tags))}}}return q.length?q:null}function nn(ie,H,Y,le,ge){for(var Ae=0;Ae<ie.length;Ae+=3){var ue=ie[Ae+ge];ue>=Y&&ue<=le&&(H.push(ie[Ae]),H.push(ie[Ae+1]),H.push(ie[Ae+2]))}}function br(ie,H,Y,le,ge,Ae,ue){for(var ne,q,ae=_r(ie),De=0===ge?hr:Yo,We=ie.start,Ue=0;Ue<ie.length-3;Ue+=3){var bt=ie[Ue],Wt=ie[Ue+1],on=ie[Ue+2],vn=ie[Ue+3],Xn=ie[Ue+4],nr=0===ge?bt:Wt,fn=0===ge?vn:Xn,sr=!1;ue&&(ne=Math.sqrt(Math.pow(bt-vn,2)+Math.pow(Wt-Xn,2))),nr<Y?fn>Y&&(q=De(ae,bt,Wt,vn,Xn,Y),ue&&(ae.start=We+ne*q)):nr>le?fn<le&&(q=De(ae,bt,Wt,vn,Xn,le),ue&&(ae.start=We+ne*q)):Zr(ae,bt,Wt,on),fn<Y&&nr>=Y&&(q=De(ae,bt,Wt,vn,Xn,Y),sr=!0),fn>le&&nr<=le&&(q=De(ae,bt,Wt,vn,Xn,le),sr=!0),!Ae&&sr&&(ue&&(ae.end=We+ne*q),H.push(ae),ae=_r(ie)),ue&&(We+=ne)}var Tr=ie.length-3;bt=ie[Tr],Wt=ie[Tr+1],on=ie[Tr+2],(nr=0===ge?bt:Wt)>=Y&&nr<=le&&Zr(ae,bt,Wt,on),Tr=ae.length-3,Ae&&Tr>=3&&(ae[Tr]!==ae[0]||ae[Tr+1]!==ae[1])&&Zr(ae,ae[0],ae[1],ae[2]),ae.length&&H.push(ae)}function _r(ie){var H=[];return H.size=ie.size,H.start=ie.start,H.end=ie.end,H}function Fr(ie,H,Y,le,ge,Ae){for(var ue=0;ue<ie.length;ue++)br(ie[ue],H,Y,le,ge,Ae,!1)}function Zr(ie,H,Y,le){ie.push(H),ie.push(Y),ie.push(le)}function hr(ie,H,Y,le,ge,Ae){var ue=(Ae-H)/(le-H);return ie.push(Ae),ie.push(Y+(ge-Y)*ue),ie.push(1),ue}function Yo(ie,H,Y,le,ge,Ae){var ue=(Ae-Y)/(ge-Y);return ie.push(H+(le-H)*ue),ie.push(Ae),ie.push(1),ue}function Ar(ie,H){for(var Y=[],le=0;le<ie.length;le++){var ge,Ae=ie[le],ue=Ae.type;if("Point"===ue||"MultiPoint"===ue||"LineString"===ue)ge=Jo(Ae.geometry,H);else if("MultiLineString"===ue||"Polygon"===ue){ge=[];for(var ne=0;ne<Ae.geometry.length;ne++)ge.push(Jo(Ae.geometry[ne],H))}else if("MultiPolygon"===ue)for(ge=[],ne=0;ne<Ae.geometry.length;ne++){for(var q=[],ae=0;ae<Ae.geometry[ne].length;ae++)q.push(Jo(Ae.geometry[ne][ae],H));ge.push(q)}Y.push(Lr(Ae.id,ue,ge,Ae.tags))}return Y}function Jo(ie,H){var Y=[];Y.size=ie.size,void 0!==ie.start&&(Y.start=ie.start,Y.end=ie.end);for(var le=0;le<ie.length;le+=3)Y.push(ie[le]+H,ie[le+1],ie[le+2]);return Y}function or(ie,H){if(ie.transformed)return ie;var Y,le,ge,Ae=1<<ie.z,ue=ie.x,ne=ie.y;for(Y=0;Y<ie.features.length;Y++){var q=ie.features[Y],ae=q.geometry,De=q.type;if(q.geometry=[],1===De)for(le=0;le<ae.length;le+=2)q.geometry.push(Qi(ae[le],ae[le+1],H,Ae,ue,ne));else for(le=0;le<ae.length;le++){var We=[];for(ge=0;ge<ae[le].length;ge+=2)We.push(Qi(ae[le][ge],ae[le][ge+1],H,Ae,ue,ne));q.geometry.push(We)}}return ie.transformed=!0,ie}function Qi(ie,H,Y,le,ge,Ae){return[Math.round(Y*(ie*le-ge)),Math.round(Y*(H*le-Ae))]}function qi(ie,H,Y,le,ge){for(var Ae=H===ge.maxZoom?0:ge.tolerance/((1<<H)*ge.extent),ue={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:le,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ne=0;ne<ie.length;ne++){ue.numFeatures++,eo(ue,ie[ne],Ae,ge);var q=ie[ne].minX,ae=ie[ne].minY,De=ie[ne].maxX,We=ie[ne].maxY;q<ue.minX&&(ue.minX=q),ae<ue.minY&&(ue.minY=ae),De>ue.maxX&&(ue.maxX=De),We>ue.maxY&&(ue.maxY=We)}return ue}function eo(ie,H,Y,le){var ge=H.geometry,Ae=H.type,ue=[];if("Point"===Ae||"MultiPoint"===Ae)for(var ne=0;ne<ge.length;ne+=3)ue.push(ge[ne]),ue.push(ge[ne+1]),ie.numPoints++,ie.numSimplified++;else if("LineString"===Ae)Di(ue,ge,ie,Y,!1,!1);else if("MultiLineString"===Ae||"Polygon"===Ae)for(ne=0;ne<ge.length;ne++)Di(ue,ge[ne],ie,Y,"Polygon"===Ae,0===ne);else if("MultiPolygon"===Ae)for(var q=0;q<ge.length;q++){var ae=ge[q];for(ne=0;ne<ae.length;ne++)Di(ue,ae[ne],ie,Y,!0,0===ne)}if(ue.length){var De=H.tags||null;if("LineString"===Ae&&le.lineMetrics){for(var We in De={},H.tags)De[We]=H.tags[We];De.mapbox_clip_start=ge.start/ge.size,De.mapbox_clip_end=ge.end/ge.size}var Ue={geometry:ue,type:"Polygon"===Ae||"MultiPolygon"===Ae?3:"LineString"===Ae||"MultiLineString"===Ae?2:1,tags:De};null!==H.id&&(Ue.id=H.id),ie.features.push(Ue)}}function Di(ie,H,Y,le,ge,Ae){var ue=le*le;if(le>0&&H.size<(ge?ue:le))Y.numPoints+=H.length/3;else{for(var ne=[],q=0;q<H.length;q+=3)(0===le||H[q+2]>ue)&&(Y.numSimplified++,ne.push(H[q]),ne.push(H[q+1])),Y.numPoints++;ge&&function(ae,De){for(var We=0,Ue=0,bt=ae.length,Wt=bt-2;Ue<bt;Wt=Ue,Ue+=2)We+=(ae[Ue]-ae[Wt])*(ae[Ue+1]+ae[Wt+1]);if(We>0===De)for(Ue=0,bt=ae.length;Ue<bt/2;Ue+=2){var on=ae[Ue],vn=ae[Ue+1];ae[Ue]=ae[bt-2-Ue],ae[Ue+1]=ae[bt-1-Ue],ae[bt-2-Ue]=on,ae[bt-1-Ue]=vn}}(ne,Ae),ie.push(ne)}}function Xe(ie,H){var Y=(H=this.options=function(ge,Ae){for(var ue in Ae)ge[ue]=Ae[ue];return ge}(Object.create(this.options),H)).debug;if(Y&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge,Ae,ue,ne,q,ae,le=function(ge,Ae){var ue=[];if("FeatureCollection"===ge.type)for(var ne=0;ne<ge.features.length;ne++)Hi(ue,ge.features[ne],Ae,ne);else Hi(ue,"Feature"===ge.type?ge:{geometry:ge},Ae);return ue}(ie,H);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ne=ge=le,q=vt(ge,1,-1-(ue=(Ae=H).buffer/Ae.extent),ue,0,-1,2,Ae),ae=vt(ge,1,1-ue,2+ue,0,-1,2,Ae),(q||ae)&&(ne=vt(ge,1,-ue,1+ue,0,-1,2,Ae)||[],q&&(ne=Ar(q,1).concat(ne)),ae&&(ne=ne.concat(Ar(ae,-1)))),(le=ne).length&&this.splitTile(le,0,0,0),Y&&(le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Le(ie,H,Y){return 32*((1<<ie)*Y+H)+ie}function Oe(ie,H){const Y=ie.tileID.canonical;if(!this._geoJSONIndex)return H(null,null);const le=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!le)return H(null,null);const ge=new ut(le.features);let Ae=Bt.exports(ge);0===Ae.byteOffset&&Ae.byteLength===Ae.buffer.byteLength||(Ae=new Uint8Array(Ae)),H(null,{vectorTile:ge,rawData:Ae.buffer})}Xe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Xe.prototype.splitTile=function(ie,H,Y,le,ge,Ae,ue){for(var ne=[ie,H,Y,le],q=this.options,ae=q.debug;ne.length;){le=ne.pop(),Y=ne.pop(),H=ne.pop(),ie=ne.pop();var De=1<<H,We=Le(H,Y,le),Ue=this.tiles[We];if(!Ue&&(ae>1&&console.time("creation"),Ue=this.tiles[We]=qi(ie,H,Y,le,q),this.tileCoords.push({z:H,x:Y,y:le}),ae)){ae>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,Y,le,Ue.numFeatures,Ue.numPoints,Ue.numSimplified),console.timeEnd("creation"));var bt="z"+H;this.stats[bt]=(this.stats[bt]||0)+1,this.total++}if(Ue.source=ie,ge){if(H===q.maxZoom||H===ge)continue;var Wt=1<<ge-H;if(Y!==Math.floor(Ae/Wt)||le!==Math.floor(ue/Wt))continue}else if(H===q.indexMaxZoom||Ue.numPoints<=q.indexMaxPoints)continue;if(Ue.source=null,0!==ie.length){ae>1&&console.time("clipping");var on,vn,Xn,nr,fn,sr,Tr=.5*q.buffer/q.extent,po=.5-Tr,ji=.5+Tr,jr=1+Tr;on=vn=Xn=nr=null,fn=vt(ie,De,Y-Tr,Y+ji,0,Ue.minX,Ue.maxX,q),sr=vt(ie,De,Y+po,Y+jr,0,Ue.minX,Ue.maxX,q),ie=null,fn&&(on=vt(fn,De,le-Tr,le+ji,1,Ue.minY,Ue.maxY,q),vn=vt(fn,De,le+po,le+jr,1,Ue.minY,Ue.maxY,q),fn=null),sr&&(Xn=vt(sr,De,le-Tr,le+ji,1,Ue.minY,Ue.maxY,q),nr=vt(sr,De,le+po,le+jr,1,Ue.minY,Ue.maxY,q),sr=null),ae>1&&console.timeEnd("clipping"),ne.push(on||[],H+1,2*Y,2*le),ne.push(vn||[],H+1,2*Y,2*le+1),ne.push(Xn||[],H+1,2*Y+1,2*le),ne.push(nr||[],H+1,2*Y+1,2*le+1)}}},Xe.prototype.getTile=function(ie,H,Y){var le=this.options,ge=le.extent,Ae=le.debug;if(ie<0||ie>24)return null;var ue=1<<ie,ne=Le(ie,H=(H%ue+ue)%ue,Y);if(this.tiles[ne])return or(this.tiles[ne],ge);Ae>1&&console.log("drilling down to z%d-%d-%d",ie,H,Y);for(var q,ae=ie,De=H,We=Y;!q&&ae>0;)ae--,De=Math.floor(De/2),We=Math.floor(We/2),q=this.tiles[Le(ae,De,We)];return q&&q.source?(Ae>1&&console.log("found parent tile z%d-%d-%d",ae,De,We),Ae>1&&console.time("drilling down"),this.splitTile(q.source,ae,De,We,ie,H,Y),Ae>1&&console.timeEnd("drilling down"),this.tiles[ne]?or(this.tiles[ne],ge):null):null};class Mt extends c.VectorTileWorkerSource{constructor(H,Y,le,ge,Ae){super(H,Y,le,ge,Oe),Ae&&(this.loadGeoJSON=Ae)}loadData(H,Y){const le=H&&H.request,ge=le&&le.collectResourceTiming;this.loadGeoJSON(H,(Ae,ue)=>{if(Ae||!ue)return Y(Ae);if("object"!=typeof ue)return Y(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));{pt(ue,!0);try{if(H.filter){const q=c.createExpression(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===q.result)throw new Error(q.value.map(De=>`${De.key}: ${De.message}`).join(", "));ue={type:"FeatureCollection",features:ue.features.filter(De=>q.value.evaluate({zoom:0},De))}}this._geoJSONIndex=H.cluster?new En(function({superclusterOptions:q,clusterProperties:ae}){if(!ae||!q)return q;const De={},We={},Ue={accumulated:null,zoom:0},bt={properties:null},Wt=Object.keys(ae);for(const on of Wt){const[vn,Xn]=ae[on],nr=c.createExpression(Xn),fn=c.createExpression("string"==typeof vn?[vn,["accumulated"],["get",on]]:vn);De[on]=nr.value,We[on]=fn.value}return q.map=on=>{bt.properties=on;const vn={};for(const Xn of Wt)vn[Xn]=De[Xn].evaluate(Ue,bt);return vn},q.reduce=(on,vn)=>{bt.properties=vn;for(const Xn of Wt)Ue.accumulated=on[Xn],on[Xn]=We[Xn].evaluate(Ue,bt)},q}(H)).load(ue.features):new Xe(q=ue,H.geojsonVtOptions)}catch(q){return Y(q)}this.loaded={};const ne={};if(ge){const q=c.getPerformanceMeasurement(le);q&&(ne.resourceTiming={},ne.resourceTiming[H.source]=JSON.parse(JSON.stringify(q)))}Y(null,ne)}var q})}reloadTile(H,Y){const le=this.loaded;return le&&le[H.uid]?super.reloadTile(H,Y):this.loadTile(H,Y)}loadGeoJSON(H,Y){if(H.request)c.getJSON(H.request,Y);else{if("string"!=typeof H.data)return Y(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));try{return Y(null,JSON.parse(H.data))}catch{return Y(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(H,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(H.clusterId))}catch(le){Y(le)}}getClusterChildren(H,Y){try{Y(null,this._geoJSONIndex.getChildren(H.clusterId))}catch(le){Y(le)}}getClusterLeaves(H,Y){try{Y(null,this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset))}catch(le){Y(le)}}}class Ct{constructor(H){this.self=H,this.actor=new c.Actor(H,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=c.getProjection({name:"mercator"}),this.workerSourceTypes={vector:c.VectorTileWorkerSource,geojson:Mt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Y,le)=>{if(this.workerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.workerSourceTypes[Y]=le},this.self.registerRTLTextPlugin=Y=>{if(c.plugin.isParsed())throw new Error("RTL text plugin already registered.");c.plugin.applyArabicShaping=Y.applyArabicShaping,c.plugin.processBidirectionalText=Y.processBidirectionalText,c.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}}clearCaches(H,Y,le){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H],le()}checkIfReady(H,Y,le){le()}setReferrer(H,Y){this.referrer=Y}spriteLoaded(H,Y){this.isSpriteLoaded[H]=Y;for(const le in this.workerSources[H]){const ge=this.workerSources[H][le];for(const Ae in ge)ge[Ae]instanceof c.VectorTileWorkerSource&&(ge[Ae].isSpriteLoaded=Y,ge[Ae].fire(new c.Event("isSpriteLoaded")))}}setImages(H,Y,le){this.availableImages[H]=Y;for(const ge in this.workerSources[H]){const Ae=this.workerSources[H][ge];for(const ue in Ae)Ae[ue].availableImages=Y}le()}enableTerrain(H,Y,le){this.terrain=Y,le()}setProjection(H,Y){this.projections[H]=c.getProjection(Y)}setLayers(H,Y,le){this.getLayerIndex(H).replace(Y),le()}updateLayers(H,Y,le){this.getLayerIndex(H).update(Y.layers,Y.removedIds),le()}loadTile(H,Y,le){const ge=this.enableTerrain?c.extend({enableTerrain:this.terrain},Y):Y;ge.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,Y.type,Y.source).loadTile(ge,le)}loadDEMTile(H,Y,le){const ge=this.enableTerrain?c.extend({buildQuadTree:this.terrain},Y):Y;this.getDEMWorkerSource(H,Y.source).loadTile(ge,le)}reloadTile(H,Y,le){const ge=this.enableTerrain?c.extend({enableTerrain:this.terrain},Y):Y;ge.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,Y.type,Y.source).reloadTile(ge,le)}abortTile(H,Y,le){this.getWorkerSource(H,Y.type,Y.source).abortTile(Y,le)}removeTile(H,Y,le){this.getWorkerSource(H,Y.type,Y.source).removeTile(Y,le)}removeSource(H,Y,le){if(!this.workerSources[H]||!this.workerSources[H][Y.type]||!this.workerSources[H][Y.type][Y.source])return;const ge=this.workerSources[H][Y.type][Y.source];delete this.workerSources[H][Y.type][Y.source],void 0!==ge.removeSource?ge.removeSource(Y,le):le()}loadWorkerSource(H,Y,le){try{this.self.importScripts(Y.url),le()}catch(ge){le(ge.toString())}}syncRTLPluginState(H,Y,le){try{c.plugin.setState(Y);const ge=c.plugin.getPluginURL();if(c.plugin.isLoaded()&&!c.plugin.isParsed()&&null!=ge){this.self.importScripts(ge);const Ae=c.plugin.isParsed();le(Ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ge}`),Ae)}}catch(ge){le(ge.toString())}}getAvailableImages(H){let Y=this.availableImages[H];return Y||(Y=[]),Y}getLayerIndex(H){let Y=this.layerIndexes[H];return Y||(Y=this.layerIndexes[H]=new Vt),Y}getWorkerSource(H,Y,le){return this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][Y]||(this.workerSources[H][Y]={}),this.workerSources[H][Y][le]||(this.workerSources[H][Y][le]=new this.workerSourceTypes[Y]({send:(Ae,ue,ne,q,ae,De)=>{this.actor.send(Ae,ue,ne,H,ae,De)},scheduler:this.actor.scheduler},this.getLayerIndex(H),this.getAvailableImages(H),this.isSpriteLoaded[H])),this.workerSources[H][Y][le]}getDEMWorkerSource(H,Y){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][Y]||(this.demWorkerSources[H][Y]=new zt),this.demWorkerSources[H][Y]}enforceCacheSizeLimit(H,Y){c.enforceCacheSizeLimit(Y)}getWorkerPerformanceMetrics(H,Y,le){le(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ct(self)),Ct}),me(0,function(c){function Pe(h,r){if(Array.isArray(h)){if(!Array.isArray(r)||h.length!==r.length)return!1;for(let l=0;l<h.length;l++)if(!Pe(h[l],r[l]))return!1;return!0}if("object"==typeof h&&null!==h&&null!==r){if("object"!=typeof r||Object.keys(h).length!==Object.keys(r).length)return!1;for(const l in h)if(!Pe(h[l],r[l]))return!1;return!0}return h===r}var Jt=Vt;function Vt(h){return r=h,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,x,E=new Blob([""],{type:"text/javascript"}),p=URL.createObjectURL(E);try{x=new Worker(p),m=!0}catch{m=!1}return x&&x.terminate(),URL.revokeObjectURL(p),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var x=m.getContext("2d");if(!x)return!1;var E=x.getImageData(0,0,1,1);return E&&E.width===m.width}()||(void 0===zt[l=r&&r.failIfMajorPerformanceCaveat]&&(zt[l]=function(m){var x,p,_,g,E=(p=m,_=document.createElement("canvas"),(g=Object.create(Vt.webGLContextAttributes)).failIfMajorPerformanceCaveat=p,_.getContext("webgl",g)||_.getContext("experimental-webgl",g));if(!E)return!1;try{x=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!x||E.isContextLost())&&(E.shaderSource(x,"void main() {}"),E.compileShader(x),!0===E.getShaderParameter(x,E.COMPILE_STATUS))}(l)),!zt[l]||document.documentMode));var r,l}var zt={};function pt(h,r,l){const m=c.window.document.createElement(h);return void 0!==r&&(m.className=r),l&&l.appendChild(m),m}function yt(h,r,l){const m=c.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const x of Object.keys(r))m.setAttributeNS(null,x,r[x]);return l&&l.appendChild(m),m}Vt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ct=c.window.document&&c.window.document.documentElement.style,$t=ct&&void 0!==ct.userSelect?"userSelect":"WebkitUserSelect";let Kt;function ut(){ct&&$t&&(Kt=ct[$t],ct[$t]="none")}function Bt(){ct&&$t&&(ct[$t]=Kt)}function cn(h){h.preventDefault(),h.stopPropagation(),c.window.removeEventListener("click",cn,!0)}function Wn(){c.window.addEventListener("click",cn,!0),c.window.setTimeout(()=>{c.window.removeEventListener("click",cn,!0)},0)}function st(h,r){const l=h.getBoundingClientRect();return rn(h,l,r)}function tr(h,r){const l=h.getBoundingClientRect(),m=[];for(let x=0;x<r.length;x++)m.push(rn(h,l,r[x]));return m}function en(h){return void 0!==c.window.InstallTrigger&&2===h.button&&h.ctrlKey&&c.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function rn(h,r,l){const m=h.offsetWidth===r.width?1:h.offsetWidth/r.width;return new c.pointGeometry((l.clientX-r.left)*m,(l.clientY-r.top)*m)}function ht(h,r){var l=r[0],m=r[1],x=r[2],E=r[3],p=l*E-x*m;return p?(h[0]=E*(p=1/p),h[1]=-m*p,h[2]=-x*p,h[3]=l*p,h):null}function un(h){const{userImage:r}=h;return!!(r&&r.render&&r.render())&&(h.data.replace(new Uint8Array(r.data.buffer)),!0)}class ur extends c.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:m}of this.requestors)this._notify(l,m);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,l){this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let m=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),m=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),m=!1),this._validateContent(l.content,l)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),m=!1),m}_validateStretch(r,l){if(!r)return!0;let m=0;for(const x of r){if(x[0]<m||x[1]<x[0]||l<x[1])return!1;m=x[1]}return!0}_validateContent(r,l){return!(r&&(4!==r.length||r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,l){l.version=this.images[r].version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let m=!0;if(!this.isLoaded())for(const x of r)this.images[x]||(m=!1);this.isLoaded()||m?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const m={};for(const x of r){this.images[x]||this.fire(new c.Event("styleimagemissing",{id:x}));const E=this.images[x];E?m[x]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:Boolean(E.userImage&&E.userImage.render)}:c.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,m)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],m=this.getImage(r);if(!m)return null;if(l&&l.position.version===m.version)return l.position;if(l)l.position.version=m.version;else{const x={w:m.data.width+2,h:m.data.height+2,x:0,y:0},E=new c.ImagePosition(x,m);this.patterns[r]={bin:x,position:E}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.Texture(r,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const E in this.patterns)r.push(this.patterns[E].bin);const{w:l,h:m}=c.potpack(r),x=this.atlasImage;x.resize({width:l||1,height:m||1});for(const E in this.patterns){const{bin:p}=this.patterns[E],_=p.x+1,g=p.y+1,w=this.images[E].data,D=w.width,A=w.height;c.RGBAImage.copy(w,x,{x:0,y:0},{x:_,y:g},{width:D,height:A}),c.RGBAImage.copy(w,x,{x:0,y:A-1},{x:_,y:g-1},{width:D,height:1}),c.RGBAImage.copy(w,x,{x:0,y:0},{x:_,y:g+A},{width:D,height:1}),c.RGBAImage.copy(w,x,{x:D-1,y:0},{x:_-1,y:g},{width:1,height:A}),c.RGBAImage.copy(w,x,{x:0,y:0},{x:_+D,y:g},{width:1,height:A})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const m=this.images[l];un(m)&&this.updateImage(l,m)}}}const Dt=new c.Properties({anchor:new c.DataConstantProperty(c.spec.light.anchor),position:new class{constructor(){this.specification=c.spec.light.position}possiblyEvaluate(h,r){return function([l,m,x]){const E=c.degToRad(m+90),p=c.degToRad(x);return{x:l*Math.cos(E)*Math.sin(p),y:l*Math.sin(E)*Math.sin(p),z:l*Math.cos(p),azimuthal:m,polar:x}}(h.expression.evaluate(r))}interpolate(h,r,l){return{x:c.number(h.x,r.x,l),y:c.number(h.y,r.y,l),z:c.number(h.z,r.z,l),azimuthal:c.number(h.azimuthal,r.azimuthal,l),polar:c.number(h.polar,r.polar,l)}}},color:new c.DataConstantProperty(c.spec.light.color),intensity:new c.DataConstantProperty(c.spec.light.intensity)}),Yt="-transition";class _t extends c.Evented{constructor(r){super(),this._transitionable=new c.Transitionable(Dt),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(c.validateLight,r,l))for(const m in r){const x=r[m];c.endsWith(m,Yt)?this._transitionable.setTransition(m.slice(0,-Yt.length),x):this._transitionable.setValue(m,x)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,m){return(!m||!1!==m.validate)&&c.emitValidationErrors(this,r.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}const gt=new c.Properties({source:new c.DataConstantProperty(c.spec.terrain.source),exaggeration:new c.DataConstantProperty(c.spec.terrain.exaggeration)}),dn="-transition";class Kn extends c.Evented{constructor(r,l){super(),this._transitionable=new c.Transitionable(gt),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(r){for(const l in r){const m=r[l];c.endsWith(l,dn)?this._transitionable.setTransition(l.slice(0,-dn.length),m):this._transitionable.setValue(l,m)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function hn(h,r,l,m){const x=c.smoothstep(45,65,l),[E,p]=Br(h,m),_=c.length(r);let g=1-Math.min(1,Math.exp((_-E)/(p-E)*-6));return g*=g*g,g=Math.min(1,1.00747*g),g*x*h.alpha}function Br(h,r){const l=.5/Math.tan(.5*r);return[h.range[0]+l,h.range[1]+l]}const Ne=new c.Properties({range:new c.DataConstantProperty(c.spec.fog.range),color:new c.DataConstantProperty(c.spec.fog.color),"high-color":new c.DataConstantProperty(c.spec.fog["high-color"]),"space-color":new c.DataConstantProperty(c.spec.fog["space-color"]),"horizon-blend":new c.DataConstantProperty(c.spec.fog["horizon-blend"]),"star-intensity":new c.DataConstantProperty(c.spec.fog["star-intensity"])}),ot="-transition";class xt extends c.Evented{constructor(r,l){super(),this._transitionable=new c.Transitionable(Ne),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const r=this._transform,l="globe"===r.projection.name,m=c.globeToMercatorTransition(r.zoom),x=this.properties.get("range"),E=[.5,3];return{range:l?[c.number(E[0],x[0],m),c.number(E[1],x[1],m)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l={}){if(!this._validate(c.validateFog,r,l)){for(const m of Object.keys(c.spec.fog))r&&void 0===r[m]&&(r[m]=c.spec.fog[m].default);for(const m in r){const x=r[m];c.endsWith(m,ot)?this._transitionable.setTransition(m.slice(0,-ot.length),x):this._transitionable.setValue(m,x)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:c.smoothstep(45,65,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(m,x,E){const p=c.MercatorCoordinate.fromLngLat(x),_=E.elevation?E.elevation.getAtPointOrZero(p):0,g=[p.x,p.y,_];return c.transformMat4(g,g,E.mercatorFogMatrix),hn(m,g,E.pitch,E._fov)}(this.state,r,l):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Br(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,m){return(!m||!1!==m.validate)&&c.emitValidationErrors(this,r.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}class Pt{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=c.uniqueId();const m=this.workerPool.acquire(this.id);for(let x=0;x<m.length;x++){const E=new Pt.Actor(m[x],l,this.id);E.name=`Worker ${x}`,this.actors.push(E)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,m){c.asyncAll(this.actors,(x,E)=>{x.send(r,l,E)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ft(h,r,l){return r*(c.EXTENT/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}Pt.Actor=c.Actor;class kt{constructor(r,l,m,x){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(r,l){let m,x;if(r instanceof c.pointGeometry||"number"==typeof r[0]){const E=c.pointGeometry.convert(r);m=[E],x=l.isPointAboveHorizon(E)}else{const E=c.pointGeometry.convert(r[0]),p=c.pointGeometry.convert(r[1]);m=[E,p],x=c.polygonizeBounds(E,p).every(_=>l.isPointAboveHorizon(_))}return new kt(m,l.getCameraPoint(),x,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return c.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],x=c.polygonizeBounds(l,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<m.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?x[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(x[3]=this.cameraPoint)),c.bufferConvexPolygon(x,r)}bufferedCameraGeometryGlobe(r){const l=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],x=c.polygonizeBounds(l,m,r),E=this.cameraPoint.clone();switch(3*((E.y>l.y)+(E.y>m.y))+((E.x>l.x)+(E.x>m.x))){case 0:x[0]=E,x[4]=E.clone();break;case 1:x.splice(1,0,E);break;case 2:x[1]=E;break;case 3:x.splice(4,0,E);break;case 5:x.splice(2,0,E);break;case 6:x[3]=E;break;case 7:x.splice(3,0,E);break;case 8:x[2]=E}return x}containsTile(r,l,m,x=0){const E=r.queryPadding/l._pixelsPerMercatorPixel+1,p=m?this._bufferedCameraMercator(E,l):this._bufferedScreenMercator(E,l);let _=r.tileID.wrap+(p.unwrapped?x:0);const g=p.polygon.map(Q=>c.getTilePoint(r.tileTransform,Q,_));if(!c.polygonIntersectsBox(g,0,0,c.EXTENT,c.EXTENT))return;_=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const w=this.screenGeometryMercator.polygon.map(Q=>c.getTileVec3(r.tileTransform,Q,_)),D=w.map(Q=>new c.pointGeometry(Q[0],Q[1])),A=l.getFreeCameraOptions().position||new c.MercatorCoordinate(0,0,0),O=c.getTileVec3(r.tileTransform,A,_),G=w.map(Q=>{const oe=c.sub(Q,Q,O);return c.normalize(oe,oe),new c.Ray(O,oe)}),K=Ft(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:G,bufferedTilespaceGeometry:g,bufferedTilespaceBounds:(re=c.getBounds(g),re.min.x=c.clamp(re.min.x,0,c.EXTENT),re.min.y=c.clamp(re.min.y,0,c.EXTENT),re.max.x=c.clamp(re.max.x,0,c.EXTENT),re.max.y=c.clamp(re.max.y,0,c.EXTENT),re),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:K};var re}_bufferedScreenMercator(r,l){const m=Ur(r);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let x;return x="globe"===l.projection.name?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(E=>l.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[m]=x,x}}_bufferedCameraMercator(r,l){const m=Ur(r);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let x;return x="globe"===l.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(E=>l.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[m]=x,x}}_projectAndResample(r,l){const m=function(E,p){const _=c.multiply([],p.pixelMatrix,p.globeMatrix),g=[0,-c.GLOBE_RADIUS,0,1],w=[0,c.GLOBE_RADIUS,0,1],D=[0,0,0,1];c.transformMat4$1(g,g,_),c.transformMat4$1(w,w,_),c.transformMat4$1(D,D,_);const A=new c.pointGeometry(g[0]/g[3],g[1]/g[3]),O=new c.pointGeometry(w[0]/w[3],w[1]/w[3]),G=c.polygonContainsPoint(E,A)&&g[3]<D[3],K=c.polygonContainsPoint(E,O)&&w[3]<D[3];if(!G&&!K)return null;const re=function(ke,Ze,He){for(let Be=1;Be<ke.length;Be++){const Lt=Bn(Ze.pointCoordinate3D(ke[Be-1]).x),Ve=Bn(Ze.pointCoordinate3D(ke[Be]).x);if(He<0){if(Lt<Ve)return{idx:Be,t:-Lt/(Ve-1-Lt)}}else if(Ve<Lt)return{idx:Be,t:(1-Lt)/(Ve+1-Lt)}}return null}(E,p,G?-1:1);if(!re)return null;const{idx:Q,t:oe}=re;let fe=Q>1?Mn(E.slice(0,Q),p):[],de=Q<E.length?Mn(E.slice(Q),p):[];fe=fe.map(ke=>new c.pointGeometry(Bn(ke.x),ke.y)),de=de.map(ke=>new c.pointGeometry(Bn(ke.x),ke.y));const ve=[...fe];0===ve.length&&ve.push(de[de.length-1]);const Se=c.number(ve[ve.length-1].y,(0===de.length?fe[0]:de[0]).y,oe);let Ce;return Ce=G?[new c.pointGeometry(0,Se),new c.pointGeometry(0,0),new c.pointGeometry(1,0),new c.pointGeometry(1,Se)]:[new c.pointGeometry(1,Se),new c.pointGeometry(1,1),new c.pointGeometry(0,1),new c.pointGeometry(0,Se)],ve.push(...Ce),0===de.length?ve.push(fe[0]):ve.push(...de),{polygon:ve.map(ke=>new c.MercatorCoordinate(ke.x,ke.y)),unwrapped:!1}}(r,l);if(m)return m;const x=function(E,p){let _=!1,g=-1/0,w=0;for(let A=0;A<E.length-1;A++)E[A].x>g&&(g=E[A].x,w=A);for(let A=0;A<E.length-1;A++){const O=(w+A)%(E.length-1),G=E[O],K=E[O+1];Math.abs(G.x-K.x)>.5&&(G.x<K.x?(G.x+=1,0===O&&(E[E.length-1].x+=1)):(K.x+=1,O+1===E.length-1&&(E[0].x+=1)),_=!0)}const D=c.mercatorXfromLng(p.center.lng);return _&&D<Math.abs(D-1)&&E.forEach(A=>{A.x-=1}),{polygon:E,unwrapped:_}}(Mn(r,l).map(E=>new c.pointGeometry(Bn(E.x),E.y)),l);return{polygon:x.polygon.map(E=>new c.MercatorCoordinate(E.x,E.y)),unwrapped:x.unwrapped}}}function Mn(h,r){return c.resample(h,l=>{const m=r.pointCoordinate3D(l);l.x=m.x,l.y=m.y},1/256)}function Bn(h){return h<0?1+h%1:h%1}function Ur(h){return 100*h|0}function En(h,r,l,m,x){const E=function(p,_){if(p)return x(p);if(_){h.url&&_.tiles&&h.tiles&&delete h.tiles;const g=c.pick(c.extend(_,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);_.vector_layers&&(g.vectorLayers=_.vector_layers,g.vectorLayerIds=g.vectorLayers.map(w=>w.id)),g.tiles=r.canonicalizeTileset(g,h.url),x(null,g)}};return h.url?c.getJSON(r.transformRequest(r.normalizeSourceURL(h.url,null,l,m),c.ResourceType.Source),E):c.exported.frame(()=>E(null,h))}class Rn{constructor(r,l,m){this.bounds=c.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=m||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),m=Math.floor(c.mercatorXfromLng(this.bounds.getWest())*l),x=Math.floor(c.mercatorYfromLat(this.bounds.getNorth())*l),E=Math.ceil(c.mercatorXfromLng(this.bounds.getEast())*l),p=Math.ceil(c.mercatorYfromLat(this.bounds.getSouth())*l);return r.x>=m&&r.x<E&&r.y>=x&&r.y<p}}class Yn{constructor(r,l,m){this.context=r;const x=r.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Un={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class vr{constructor(r,l,m,x){this.length=l.length,this.attributes=m,this.itemSize=l.bytesPerElement,this.dynamicDraw=x,this.context=r;const E=r.gl;this.buffer=E.createBuffer(),r.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let m=0;m<this.attributes.length;m++){const x=l.attributes[this.attributes[m].name];void 0!==x&&r.enableVertexAttribArray(x)}}setVertexAttribPointers(r,l,m){for(let x=0;x<this.attributes.length;x++){const E=this.attributes[x],p=l.attributes[E.name];void 0!==p&&r.vertexAttribPointer(p,E.components,r[Un[E.type]],!1,this.itemSize,E.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class tn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Kr extends tn{getDefault(){return c.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ai extends tn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Ti extends tn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Yr extends tn{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class zo extends tn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class uo extends tn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class xn extends tn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Lr extends tn{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class ho extends tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class Hi extends tn{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class vs extends tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class fo extends tn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Or extends tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class No extends tn{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Er extends tn{getDefault(){return c.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class vt extends tn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class nn extends tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class br extends tn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class _r extends tn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Fr extends tn{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class Zr extends tn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class hr extends tn{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Yo extends tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Ar extends tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Jo extends tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class or extends tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Qi extends tn{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class qi extends tn{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class eo extends tn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Di extends tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Xe extends tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Le extends tn{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class Oe extends Le{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Mt extends Le{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Ct extends Mt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ie{constructor(r,l,m,x){this.context=r,this.width=l,this.height=m;const E=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Oe(r,E),x&&(this.depthAttachment=new Mt(r,E))}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const m=this.depthAttachment.get();m&&r.deleteRenderbuffer(m)}r.deleteFramebuffer(this.framebuffer)}}class H{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Kr(this),this.clearDepth=new Ai(this),this.clearStencil=new Ti(this),this.colorMask=new Yr(this),this.depthMask=new zo(this),this.stencilMask=new uo(this),this.stencilFunc=new xn(this),this.stencilOp=new Lr(this),this.stencilTest=new ho(this),this.depthRange=new Hi(this),this.depthTest=new vs(this),this.depthFunc=new fo(this),this.blend=new Or(this),this.blendFunc=new No(this),this.blendColor=new Er(this),this.blendEquation=new vt(this),this.cullFace=new nn(this),this.cullFaceSide=new br(this),this.frontFace=new _r(this),this.program=new Fr(this),this.activeTexture=new Zr(this),this.viewport=new hr(this),this.bindFramebuffer=new Yo(this),this.bindRenderbuffer=new Ar(this),this.bindTexture=new Jo(this),this.bindVertexBuffer=new or(this),this.bindElementBuffer=new Qi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new qi(this),this.pixelStoreUnpack=new eo(this),this.pixelStoreUnpackPremultiplyAlpha=new Di(this),this.pixelStoreUnpackFlipY=new Xe(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new Yn(this,r,l)}createVertexBuffer(r,l,m){return new vr(this,r,l,m)}createRenderbuffer(r,l,m){const x=this.gl,E=x.createRenderbuffer();return this.bindRenderbuffer.set(E),x.renderbufferStorage(x.RENDERBUFFER,r,l,m),this.bindRenderbuffer.set(null),E}createFramebuffer(r,l,m){return new ie(this,r,l,m)}clear({color:r,depth:l,stencil:m}){const x=this.gl;let E=0;r&&(E|=x.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(E|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==m&&(E|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),x.clear(E)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){Pe(r.blendFunction,c.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Y extends c.Evented{constructor(r,l,m,x){super(),this.id=r,this.dispatcher=m,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.extend({type:"raster"},l),c.extend(this,c.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=En(this._options,this.map._requestManager,null,null,(r,l)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new c.ErrorEvent(r)):l&&(c.extend(this,l),l.bounds&&(this.tileBounds=new Rn(l.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(l.tiles),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const m=c.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);r.request=c.getImage(this.map._requestManager.transformRequest(x,c.ResourceType.Tile),(E,p,_,g)=>(delete r.request,r.aborted?(r.state="unloaded",l(null)):E?(r.state="errored",l(E)):p?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:_,expires:g}),r.setTexture(p,this.map.painter),r.state="loaded",c.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(r,l,m){r.setTexture(l,m)}static unloadTileData(r,l){r.texture&&l.saveTileTexture(r.texture)}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}}let le;function ge(h,r,l,m,x,E,p,_){const g=[h,l,x,r,m,E,1,1,1],w=[p,_,1],D=c.adjoint([],g),[A,O,G]=c.transformMat3(w,w,c.transpose(D,D));return c.multiply$1(g,[A,0,0,0,O,0,0,0,G],g)}class Ae extends c.Evented{constructor(r,l,m,x){super(),this.id=r,this.dispatcher=m,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=l,this._dirty=!1}load(r,l){this._loaded=l||!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=c.getImage(this.map._requestManager.transformRequest(this.url,c.ResourceType.Image),(m,x)=>{if(this._imageRequest=null,this._loaded=!0,m)this.fire(new c.ErrorEvent(m));else if(x){const{HTMLImageElement:E}=c.window;this.image=x instanceof E?c.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const l=r.map(c.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let x=1/0,E=1/0,p=-1/0,_=-1/0;for(const A of m)x=Math.min(x,A.x),E=Math.min(E,A.y),p=Math.max(p,A.x),_=Math.max(_,A.y);const g=Math.max(p-x,_-E),w=Math.max(0,Math.floor(-Math.log(g)/Math.LN2)),D=Math.pow(2,w);return new c.CanonicalTileID(w,Math.floor((x+p)/2*D),Math.floor((E+_)/2*D))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const g in this.tiles){const w=this.tiles[g];"loaded"!==w.state&&(w.state="loaded",w.texture=this.texture)}if(this._boundsArray)return;const l=c.tileTransform(this.tileID,this.map.transform.projection),[m,x,E,p]=this.coordinates.map(g=>{const w=l.projection.project(g[0],g[1]);return c.getTilePoint(l,w)._round()});this.perspectiveTransform=function(g,w,D,A,O,G,K,re,Q,oe){const fe=ge(0,0,g,0,0,w,g,w),de=ge(D,A,O,G,K,re,Q,oe);return c.multiply$1(de,c.adjoint(fe,fe),de),[de[6]/de[8]*g/c.EXTENT,de[7]/de[8]*w/c.EXTENT]}(this.width,this.height,m.x,m.y,x.x,x.y,p.x,p.y,E.x,E.y);const _=this._boundsArray=new c.StructArrayLayout4i8;_.emplaceBack(m.x,m.y,0,0),_.emplaceBack(x.x,x.y,c.EXTENT,0),_.emplaceBack(p.x,p.y,0,c.EXTENT),_.emplaceBack(E.x,E.y,c.EXTENT,c.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(_,c.boundsAttributes.members),this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,l=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new c.Texture(r,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ue={vector:class extends c.Evented{constructor(h,r,l,m){if(super(),this.id=h,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.extend(this,c.pick(r,["url","scheme","tileSize","promoteId"])),this._options=c.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new c.DedupedRequest}load(h){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=En(this._options,this.map._requestManager,r,l,(m,x)=>{this._tileJSONRequest=null,this._loaded=!0,m?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),l&&2!==l.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new c.ErrorEvent(m))):x&&(c.extend(this,x),x.bounds&&(this.tileBounds=new Rn(x.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(x.tiles,this.map._requestManager._customAccessToken),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))),h&&h(m)})}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const h=this.map.style._getSourceCaches(this.id);for(const r of h)r.clearTiles()})}setSourceProperty(h){h(),this.reload()}setTiles(h){return this._options.tiles=h,this.reload(),this}setUrl(h){return this.url=h,this._options.url=h,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return c.extend({},this._options)}loadTile(h,r){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(l,c.ResourceType.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:h.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,h.actor&&"expired"!==h.state)"loading"===h.state?h.reloadCallback=r:h.request=h.actor.send("reloadTile",m,x.bind(this));else if(h.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)h.request=h.actor.send("loadTile",m,x.bind(this),void 0,!0);else{const E=c.loadVectorTile.call({deduped:this._deduped},m,(p,_)=>{p||!_?x.call(this,p):(m.data={cacheControl:_.cacheControl,expires:_.expires,rawData:_.rawData.slice(0)},h.actor&&h.actor.send("loadTile",m,x.bind(this),void 0,!0))},!0);h.request={cancel:E}}function x(E,p){return delete h.request,h.aborted?r(null):E&&404!==E.status?r(E):(p&&p.resourceTiming&&(h.resourceTiming=p.resourceTiming),this.map._refreshExpiredTiles&&p&&h.setExpiryData(p),h.loadVectorData(p,this.map.painter),c.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id})}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:Y,"raster-dem":class extends Y{constructor(h,r,l,m){super(h,r,l,m),this.type="raster-dem",this.maxzoom=22,this._options=c.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(h,r){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(x,E){x&&(h.state="errored",r(x)),E&&(h.dem=E,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",r(null))}h.request=c.getImage(this.map._requestManager.transformRequest(l,c.ResourceType.Tile),function(x,E,p,_){if(delete h.request,h.aborted)h.state="unloaded",r(null);else if(x)h.state="errored",r(x);else if(E){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:p,expires:_});const g=c.window.ImageBitmap&&E instanceof c.window.ImageBitmap&&(null==le&&(le=c.window.OffscreenCanvas&&new c.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof c.window.createImageBitmap),le),w=1-(E.width-c.prevPowerOfTwo(E.width))/2;w<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const D=g?E:c.exported.getImageData(E,w),A={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:D,encoding:this.encoding,padding:w};h.actor&&"expired"!==h.state||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",A,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const r=h.canonical,l=Math.pow(2,r.z),m=(r.x-1+l)%l,x=0===r.x?h.wrap-1:h.wrap,E=(r.x+1+l)%l,p=r.x+1===l?h.wrap+1:h.wrap,_={};return _[new c.OverscaledTileID(h.overscaledZ,x,r.z,m,r.y).key]={backfilled:!1},_[new c.OverscaledTileID(h.overscaledZ,p,r.z,E,r.y).key]={backfilled:!1},r.y>0&&(_[new c.OverscaledTileID(h.overscaledZ,x,r.z,m,r.y-1).key]={backfilled:!1},_[new c.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},_[new c.OverscaledTileID(h.overscaledZ,p,r.z,E,r.y-1).key]={backfilled:!1}),r.y+1<l&&(_[new c.OverscaledTileID(h.overscaledZ,x,r.z,m,r.y+1).key]={backfilled:!1},_[new c.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},_[new c.OverscaledTileID(h.overscaledZ,p,r.z,E,r.y+1).key]={backfilled:!1}),_}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends c.Evented{constructor(h,r,l,m){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(m),this._data=r.data,this._options=c.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const x=c.EXTENT/this.tileSize;this.workerOptions=c.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*x,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*x,extent:c.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:c.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*x,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},r),this}getClusterChildren(h,r){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},r),this}getClusterLeaves(h,r,l,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:r,offset:l},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=c.extend({},this.workerOptions),r=this._data;"string"==typeof r?(h.request=this.map._requestManager.transformRequest(c.exported.resolveURL(r),c.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(l,m)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new c.ErrorEvent(l));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(x.resourceTiming=m.resourceTiming[this.id]),this.fire(new c.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,r){const l=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(l,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,x)=>(delete h.request,h.unloadVectorData(),h.aborted?r(null):m?r(m):(h.loadVectorData(x,this.map.painter,"reloadTile"===l),r(null))),void 0,"loadTile"===l)}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return c.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ae{constructor(h,r,l,m){super(h,r,l,m),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const r of h.urls)this.urls.push(this.map._requestManager.transformRequest(r,c.ResourceType.Source).url);c.getVideo(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new c.ErrorEvent(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const r=this.video.seekable;h<r.start(0)||h>r.end(0)?this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const h=this.map.painter.context,r=h.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new c.Texture(h,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ae,canvas:class extends Ae{constructor(h,r,l,m){super(h,r,l,m),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(E=>"number"!=typeof E))||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof c.window.HTMLCanvasElement||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof c.window.HTMLCanvasElement?this.options.canvas:c.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends c.Evented{constructor(h,r,l,m){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new c.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new c.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Rn(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),c.extend(this,c.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return c.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:r,y:l,z:m}=h.canonical;return this._implementation.hasTile({x:r,y:l,z:m})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,r){const{x:l,y:m,z:x}=h.tileID.canonical,E=new c.window.AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:l,y:m,z:x},{signal:E.signal})).then(function(p){return delete h.request,h.aborted?(h.state="unloaded",r(null)):void 0===p?(h.state="errored",r(null)):null===p?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",r(null)):(_=p)instanceof c.window.ImageData||_ instanceof c.window.HTMLCanvasElement||_ instanceof c.window.ImageBitmap||_ instanceof c.window.HTMLImageElement?(this.loadTileData(h,p),h.state="loaded",void r(null)):(h.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var _}.bind(this)).catch(p=>{20!==p.code&&(h.state="errored",r(p))}),h.request.cancel=()=>E.abort()}loadTileData(h,r){Y.loadTileData(h,r,this._map.painter)}unloadTileData(h){Y.unloadTileData(h,this._map.painter)}unloadTile(h,r){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:l,y:m,z:x}=h.tileID.canonical;this._implementation.unloadTile({x:l,y:m,z:x})}r()}abortTile(h,r){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ne=function(h,r,l,m){const x=new ue[r.type](h,r,l,m);if(x.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${x.id}`);return c.bindAll(["load","abort","unload","serialize","prepare"],x),x};function q(h,r){const l=c.identity([]);return c.scale(l,l,[.5*h.width,.5*-h.height,1]),c.translate(l,l,[1,-1,0]),c.multiply(l,l,h.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(l)}function ae(h,r,l,m,x,E,p,_=!1){const g=h.tilesIn(m,p,_);g.sort(We);const w=[];for(const A of g)w.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:A.tile.queryRenderedFeatures(r,l,h._state,A,x,E,q(h.transform,A.tile.tileID),_)});const D=function(A){const O={},G={};for(const K of A){const re=K.queryResults,Q=K.wrappedTileID,oe=G[Q]=G[Q]||{};for(const fe in re){const de=re[fe],ve=oe[fe]=oe[fe]||{},Se=O[fe]=O[fe]||[];for(const Ce of de)ve[Ce.featureIndex]||(ve[Ce.featureIndex]=!0,Se.push(Ce))}}return O}(w);for(const A in D)D[A].forEach(O=>{const G=O.feature,K=G.layer;K&&"background"!==K.type&&"sky"!==K.type&&(G.source=K.source,K["source-layer"]&&(G.sourceLayer=K["source-layer"]),G.state=void 0!==G.id?h.getFeatureState(K["source-layer"],G.id):{})});return D}function De(h,r){const l=h.getRenderableIds().map(E=>h.getTileByID(E)),m=[],x={};for(let E=0;E<l.length;E++){const p=l[E],_=p.tileID.canonical.key;x[_]||(x[_]=!0,p.querySourceFeatures(m,r))}return m}function We(h,r){const l=h.tileID,m=r.tileID;return l.overscaledZ-m.overscaledZ||l.canonical.y-m.canonical.y||l.wrap-m.wrap||l.canonical.x-m.canonical.x}function Ue(){return null!=Oo.workerClass?new Oo.workerClass:new c.window.Worker(Oo.workerUrl)}const bt="mapboxgl_preloaded_worker_pool";class Wt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Wt.workerCount;)this.workers.push(new Ue);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[bt]}numActive(){return Object.keys(this.active).length}}let on;function vn(){return on||(on=new Wt),on}function Xn(h,r){const l={};for(const m in h)"ref"!==m&&(l[m]=h[m]);return c.refProperties.forEach(m=>{m in r&&(l[m]=r[m])}),l}function nr(h){h=h.slice();const r=Object.create(null);for(let l=0;l<h.length;l++)r[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=Xn(h[l],r[h[l].ref]));return h}Wt.workerCount=2;const fn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function sr(h,r,l){l.push({command:fn.addSource,args:[h,r[h]]})}function Tr(h,r,l){r.push({command:fn.removeSource,args:[h]}),l[h]=!0}function po(h,r,l,m){Tr(h,l,m),sr(h,r,l)}function ji(h,r,l){let m;for(m in h[l])if(h[l].hasOwnProperty(m)&&"data"!==m&&!Pe(h[l][m],r[l][m]))return!1;for(m in r[l])if(r[l].hasOwnProperty(m)&&"data"!==m&&!Pe(h[l][m],r[l][m]))return!1;return!0}function jr(h,r,l,m,x,E){let p;for(p in r=r||{},h=h||{})h.hasOwnProperty(p)&&(Pe(h[p],r[p])||l.push({command:E,args:[m,p,r[p],x]}));for(p in r)r.hasOwnProperty(p)&&!h.hasOwnProperty(p)&&(Pe(h[p],r[p])||l.push({command:E,args:[m,p,r[p],x]}))}function it(h){return h.id}function rs(h,r){return h[r.id]=r,h}class Jr{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=c.clamp(r,0,1);let l=1,m=this._distances[l];const x=r*this.paddedLength+this.padding;for(;m<x&&l<this._distances.length;)m=this._distances[++l];const E=l-1,p=this._distances[E],_=m-p,g=_>0?(x-p)/_:0;return this.points[E].mult(1-g).add(this.points[l].mult(g))}}class Bo{constructor(r,l,m){const x=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(r/m),this.yCellCount=Math.ceil(l/m);for(let p=0;p<this.xCellCount*this.yCellCount;p++)x.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,m,x,E){this._forEachCell(l,m,x,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(E)}insertCircle(r,l,m,x){this._forEachCell(l-x,m-x,l+x,m+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(m),this.circles.push(x)}_insertBoxCell(r,l,m,x,E,p){this.boxCells[E].push(p)}_insertCircleCell(r,l,m,x,E,p){this.circleCells[E].push(p)}_query(r,l,m,x,E,p){if(m<0||r>this.width||x<0||l>this.height)return!E&&[];const _=[];if(r<=0&&l<=0&&this.width<=m&&this.height<=x){if(E)return!0;for(let g=0;g<this.boxKeys.length;g++)_.push({key:this.boxKeys[g],x1:this.bboxes[4*g],y1:this.bboxes[4*g+1],x2:this.bboxes[4*g+2],y2:this.bboxes[4*g+3]});for(let g=0;g<this.circleKeys.length;g++){const w=this.circles[3*g],D=this.circles[3*g+1],A=this.circles[3*g+2];_.push({key:this.circleKeys[g],x1:w-A,y1:D-A,x2:w+A,y2:D+A})}return p?_.filter(p):_}return this._forEachCell(r,l,m,x,this._queryCell,_,{hitTest:E,seenUids:{box:{},circle:{}}},p),E?_.length>0:_}_queryCircle(r,l,m,x,E){const p=r-m,_=r+m,g=l-m,w=l+m;if(_<0||p>this.width||w<0||g>this.height)return!x&&[];const D=[];return this._forEachCell(p,g,_,w,this._queryCellCircle,D,{hitTest:x,circle:{x:r,y:l,radius:m},seenUids:{box:{},circle:{}}},E),x?D.length>0:D}query(r,l,m,x,E){return this._query(r,l,m,x,!1,E)}hitTest(r,l,m,x,E){return this._query(r,l,m,x,!0,E)}hitTestCircle(r,l,m,x){return this._queryCircle(r,l,m,!0,x)}_queryCell(r,l,m,x,E,p,_,g){const w=_.seenUids,D=this.boxCells[E];if(null!==D){const O=this.bboxes;for(const G of D)if(!w.box[G]){w.box[G]=!0;const K=4*G;if(r<=O[K+2]&&l<=O[K+3]&&m>=O[K+0]&&x>=O[K+1]&&(!g||g(this.boxKeys[G]))){if(_.hitTest)return p.push(!0),!0;p.push({key:this.boxKeys[G],x1:O[K],y1:O[K+1],x2:O[K+2],y2:O[K+3]})}}}const A=this.circleCells[E];if(null!==A){const O=this.circles;for(const G of A)if(!w.circle[G]){w.circle[G]=!0;const K=3*G;if(this._circleAndRectCollide(O[K],O[K+1],O[K+2],r,l,m,x)&&(!g||g(this.circleKeys[G]))){if(_.hitTest)return p.push(!0),!0;{const re=O[K],Q=O[K+1],oe=O[K+2];p.push({key:this.circleKeys[G],x1:re-oe,y1:Q-oe,x2:re+oe,y2:Q+oe})}}}}}_queryCellCircle(r,l,m,x,E,p,_,g){const w=_.circle,D=_.seenUids,A=this.boxCells[E];if(null!==A){const G=this.bboxes;for(const K of A)if(!D.box[K]){D.box[K]=!0;const re=4*K;if(this._circleAndRectCollide(w.x,w.y,w.radius,G[re+0],G[re+1],G[re+2],G[re+3])&&(!g||g(this.boxKeys[K])))return p.push(!0),!0}}const O=this.circleCells[E];if(null!==O){const G=this.circles;for(const K of O)if(!D.circle[K]){D.circle[K]=!0;const re=3*K;if(this._circlesCollide(G[re],G[re+1],G[re+2],w.x,w.y,w.radius)&&(!g||g(this.circleKeys[K])))return p.push(!0),!0}}}_forEachCell(r,l,m,x,E,p,_,g){const w=this._convertToXCellCoord(r),D=this._convertToYCellCoord(l),A=this._convertToXCellCoord(m),O=this._convertToYCellCoord(x);for(let G=w;G<=A;G++)for(let K=D;K<=O;K++)if(E.call(this,r,l,m,x,this.xCellCount*K+G,p,_,g))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,m,x,E,p){const _=x-r,g=E-l,w=m+p;return w*w>_*_+g*g}_circleAndRectCollide(r,l,m,x,E,p,_){const g=(p-x)/2,w=Math.abs(r-(x+g));if(w>g+m)return!1;const D=(_-E)/2,A=Math.abs(l-(E+D));if(A>D+m)return!1;if(w<=g||A<=D)return!0;const O=w-g,G=A-D;return O*O+G*G<=m*m}}const ra=Math.tan(85*Math.PI/180);function jn(h,r,l,m,x,E,p){const _=c.create();if(l)if("globe"===E.name){const g=c.calculateGlobeLabelMatrix(x,r);c.multiply(_,_,g)}else{const g=ht([],p);_[0]=g[0],_[1]=g[1],_[4]=g[2],_[5]=g[3],m||c.rotateZ(_,_,x.angle)}else c.multiply(_,x.labelPlaneMatrix,h);return _}function Qr(h,r,l,m,x,E,p){const _=jn(h,r,l,m,x,E,p);return"globe"===E.name&&l||(_[2]=_[6]=_[10]=_[14]=0),_}function ui(h,r,l,m,x,E,p){if(l){if("globe"===E.name){const _=jn(h,r,l,m,x,E,p);return c.invert(_,_),c.multiply(_,h,_),_}{const _=c.clone(h),g=c.identity([]);return g[0]=p[0],g[1]=p[1],g[4]=p[2],g[5]=p[3],c.multiply(_,_,g),m||c.rotateZ(_,_,-x.angle),_}}return x.glCoordMatrix}function mi(h,r,l,m){const x=[h,r,l,1];l?c.transformMat4$1(x,x,m):Qn(x,x,m);const E=x[3];return x[0]/=E,x[1]/=E,x[2]/=E,x}function Ut(h,r){return Math.min(.5+h/r*.5,1.5)}function Jn(h,r){const l=h[0]/h[3],m=h[1]/h[3];return l>=-r[0]&&l<=r[0]&&m>=-r[1]&&m<=r[1]}function Dn(h,r,l,m,x,E,p,_,g,w){const D=l.transform,A=m?h.textSizeData:h.iconSizeData,O=c.evaluateSizeForZoom(A,l.transform.zoom),G="globe"===D.projection.name,K=[256/l.width*2+1,256/l.height*2+1],re=m?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;re.clear();let Q=null;G&&(Q=m?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const oe=h.lineVertexArray,fe=m?h.text.placedSymbolArray:h.icon.placedSymbolArray,de=l.transform.width/l.transform.height;let ve,Se=!1;for(let Ce=0;Ce<fe.length;Ce++){const ke=fe.get(Ce),{numGlyphs:Ze,writingMode:He}=ke;if(He!==c.WritingMode.vertical||Se||ve===c.WritingMode.horizontal||(Se=!0),ve=He,(ke.hidden||He===c.WritingMode.vertical)&&!Se){ti(Ze,re);continue}Se=!1;const Be=new c.pointGeometry(ke.tileAnchorX,ke.tileAnchorY);let{x:Lt,y:Ve,z:at}=D.projection.projectTilePoint(Be.x,Be.y,w.canonical);if(g){const[In,yn,Nn]=g(Be);Lt+=In,Ve+=yn,at+=Nn}const nt=[Lt,Ve,at,1];if(c.transformMat4$1(nt,nt,r),!Jn(nt,K)){ti(Ze,re);continue}const It=Ut(l.transform.cameraToCenterDistance,nt[3]),et=c.evaluateSizeForFeature(A,O,ke),ft=p?et/It:et*It,Nt=mi(Lt,Ve,at,x);if(Nt[3]<=0){ti(Ze,re);continue}let je={};const Qe=p?null:g,_n=Tt(ke,ft,!1,_,r,x,E,h.glyphOffsetArray,oe,re,Q,Nt,Be,je,de,Qe,D.projection,w,p);Se=_n.useVertical,Qe&&_n.needsFlipping&&(je={}),(_n.notEnoughRoom||Se||_n.needsFlipping&&Tt(ke,ft,!0,_,r,x,E,h.glyphOffsetArray,oe,re,Q,Nt,Be,je,de,Qe,D.projection,w,p).notEnoughRoom)&&ti(Ze,re)}m?(h.text.dynamicLayoutVertexBuffer.updateData(re),Q&&h.text.globeExtVertexBuffer.updateData(Q)):(h.icon.dynamicLayoutVertexBuffer.updateData(re),Q&&h.icon.globeExtVertexBuffer.updateData(Q))}function Wi(h,r,l,m,x,E,p,_,g,w,D,A,O,G,K,re){const{lineStartIndex:Q,glyphStartIndex:oe,segment:fe}=_,de=oe+_.numGlyphs,ve=Q+_.lineLength,Se=r.getoffsetX(oe),Ce=r.getoffsetX(de-1),ke=ei(h*Se,l,m,x,E,p,fe,Q,ve,g,w,D,A,O,!0,G,K,re);if(!ke)return null;const Ze=ei(h*Ce,l,m,x,E,p,fe,Q,ve,g,w,D,A,O,!0,G,K,re);return Ze?{first:ke,last:Ze}:null}function Ci(h,r,l,m){return h===c.WritingMode.horizontal&&Math.abs(m)>Math.abs(l)?{useVertical:!0}:h===c.WritingMode.vertical?m>0?{needsFlipping:!0}:null:0!==r&&(0===(x=l)||Math.abs(m/x)>ra)?1===r?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null;var x}function Tt(h,r,l,m,x,E,p,_,g,w,D,A,O,G,K,re,Q,oe,fe){const de=r/24,ve=h.lineOffsetX*de,Se=h.lineOffsetY*de,{lineStartIndex:Ce,glyphStartIndex:ke,numGlyphs:Ze,segment:He,writingMode:Be,flipState:Lt}=h,Ve=Ce+h.lineLength,at=nt=>{if(D){const[Nt,je,Qe]=nt.up,_n=w.length;c.updateGlobeVertexNormal(D,_n+0,Nt,je,Qe),c.updateGlobeVertexNormal(D,_n+1,Nt,je,Qe),c.updateGlobeVertexNormal(D,_n+2,Nt,je,Qe),c.updateGlobeVertexNormal(D,_n+3,Nt,je,Qe)}const[It,et,ft]=nt.point;c.addDynamicAttributes(w,It,et,ft,nt.angle)};if(Ze>1){const nt=Wi(de,_,ve,Se,l,A,O,h,g,E,G,re,!1,Q,oe,fe);if(!nt)return{notEnoughRoom:!0};if(m&&!l){let[It,et,ft]=nt.first.point,[Nt,je,Qe]=nt.last.point;[It,et]=mi(It,et,ft,p),[Nt,je]=mi(Nt,je,Qe,p);const _n=Ci(Be,Lt,(Nt-It)*K,je-et);if(h.flipState=_n&&_n.needsFlipping?1:2,_n)return _n}at(nt.first);for(let It=ke+1;It<ke+Ze-1;It++){const et=ei(de*_.getoffsetX(It),ve,Se,l,A,O,He,Ce,Ve,g,E,G,re,!1,!1,Q,oe,fe);if(!et)return w.length-=4*(It-ke),{notEnoughRoom:!0};at(et)}at(nt.last)}else{if(m&&!l){const It=mi(O.x,O.y,0,x),et=Ce+He+1,ft=new c.pointGeometry(g.getx(et),g.gety(et)),Nt=mi(ft.x,ft.y,0,x),je=Nt[3]>0?Nt:Pr(O,ft,It,1,x,void 0,Q,oe.canonical),Qe=Ci(Be,Lt,(je[0]-It[0])*K,je[1]-It[1]);if(h.flipState=Qe&&Qe.needsFlipping?1:2,Qe)return Qe}const nt=ei(de*_.getoffsetX(ke),ve,Se,l,A,O,He,Ce,Ve,g,E,G,re,!1,!1,Q,oe,fe);if(!nt)return{notEnoughRoom:!0};at(nt)}return{}}function Hn(h,r,l,m,x){const{x:E,y:p,z:_}=m.projectTilePoint(h.x,h.y,r);if(!x)return mi(E,p,_,l);const[g,w,D]=x(h);return mi(E+g,p+w,_+D,l)}function Pr(h,r,l,m,x,E,p,_){const g=Hn(h.sub(r)._unit()._add(h),_,x,p,E);return c.sub(g,l,g),c.normalize(g,g),c.scaleAndAdd(g,l,g,m)}function ei(h,r,l,m,x,E,p,_,g,w,D,A,O,G,K,re,Q,oe){const fe=m?h-r:h+r;let de=fe>0?1:-1,ve=0;m&&(de*=-1,ve=Math.PI),de<0&&(ve+=Math.PI);let Se=_+p+(de>0?0:1)|0,Ce=x,ke=x,Ze=0,He=0;const Be=Math.abs(fe),Lt=[],Ve=[];let at=E,nt=at;const It=()=>Pr(nt,at,ke,Be-Ze+1,D,O,re,Q.canonical);for(;Ze+He<=Be;){if(Se+=de,Se<_||Se>=g)return null;if(ke=Ce,nt=at,Lt.push(ke),G&&Ve.push(nt),at=new c.pointGeometry(w.getx(Se),w.gety(Se)),Ce=A[Se],!Ce){const Nn=Hn(at,Q.canonical,D,re,O);Ce=Nn[3]>0?A[Se]=Nn:It()}Ze+=He,He=c.distance(ke,Ce)}K&&O&&(A[Se]&&(Ce=It(),He=c.distance(ke,Ce)),A[Se]=Ce);const et=(Be-Ze)/He,ft=at.sub(nt)._mult(et)._add(nt),Nt=c.sub([],Ce,ke),je=c.scaleAndAdd([],ke,Nt,et);let Qe=[0,0,1],_n=Nt[0],In=Nt[1];if(oe&&(Qe=re.upVector(Q.canonical,ft.x,ft.y),0!==Qe[0]||0!==Qe[1]||1!==Qe[2])){const Nn=[Qe[2],0,-Qe[0]],ir=c.cross([],Qe,Nn);c.normalize(Nn,Nn),c.normalize(ir,ir),_n=c.dot(Nt,Nn),In=c.dot(Nt,ir)}if(l){const Nn=c.cross([],Qe,Nt);c.normalize(Nn,Nn),c.scaleAndAdd(je,je,Nn,l*de)}const yn=ve+Math.atan2(In,_n);return Lt.push(je),G&&Ve.push(ft),{point:je,angle:yn,path:Lt,tilePath:Ve,up:Qe}}function ti(h,r){const l=r.length,m=l+4*h;r.resize(m),r.float32.fill(-1/0,4*l,4*m)}function Qn(h,r,l){const m=r[0],x=r[1];return h[0]=l[0]*m+l[4]*x+l[12],h[1]=l[1]*m+l[5]*x+l[13],h[3]=l[3]*m+l[7]*x+l[15],h}const Pi=100;class Vr{constructor(r,l,m=new Bo(r.width+200,r.height+200,25),x=new Bo(r.width+200,r.height+200,25)){this.transform=r,this.grid=m,this.ignoredGrid=x,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Pi,this.screenBottomBoundary=r.height+Pi,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,m,x,E,p,_,g){let w=m.projectedAnchorX,D=m.projectedAnchorY,A=m.projectedAnchorZ;const O=m.elevation,G=m.tileID,K=r.getProjection();if(O&&G){const[Ce,ke,Ze]=K.upVector(G.canonical,m.tileAnchorX,m.tileAnchorY),He=K.upVectorScale(G.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;w+=Ce*O*He,D+=ke*O*He,A+=Ze*O*He}const re=this.projectAndGetPerspectiveRatio(_,w,D,A,m.tileID,"globe"===K.name||!!O||this.transform.pitch>0,K),Q=p*re.perspectiveRatio,oe=(m.x1*l+x.x-m.padding)*Q+re.point.x,fe=(m.y1*l+x.y-m.padding)*Q+re.point.y,de=(m.x2*l+x.x+m.padding)*Q+re.point.x,ve=(m.y2*l+x.y+m.padding)*Q+re.point.y,Se=re.perspectiveRatio<=.55||re.occluded;return!this.isInsideGrid(oe,fe,de,ve)||!E&&this.grid.hitTest(oe,fe,de,ve,g)||Se?{box:[],offscreen:!1,occluded:re.occluded}:{box:[oe,fe,de,ve],offscreen:this.isOffscreen(oe,fe,de,ve),occluded:!1}}placeCollisionCircles(r,l,m,x,E,p,_,g,w,D,A,O,G,K,re){const Q=[],oe=this.transform.elevation,fe=r.getProjection(),de=oe?oe.getAtTileOffsetFunc(re,this.transform.center.lat,this.transform.worldSize,fe):null,ve=new c.pointGeometry(m.tileAnchorX,m.tileAnchorY);let{x:Se,y:Ce,z:ke}=fe.projectTilePoint(ve.x,ve.y,re.canonical);if(de){const[ft,Nt,je]=de(ve);Se+=ft,Ce+=Nt,ke+=je}const Ze="globe"===fe.name,He=this.projectAndGetPerspectiveRatio(_,Se,Ce,ke,re,Ze||!!oe||this.transform.pitch>0,fe),{perspectiveRatio:Be}=He,Lt=(A?p/Be:p*Be)/c.ONE_EM,Ve=mi(Se,Ce,ke,g),at=He.signedDistanceFromCamera>0?Wi(Lt,E,m.lineOffsetX*Lt,m.lineOffsetY*Lt,!1,Ve,ve,m,x,g,{},oe&&!A?de:null,A&&!!oe,fe,re,A):null;let nt=!1,It=!1,et=!0;if(at&&!He.occluded){const ft=.5*G*Be+K,Nt=new c.pointGeometry(-100,-100),je=new c.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Qe=new Jr,{first:_n,last:In}=at,yn=_n.path.length;let Nn=[];for(let an=yn-1;an>=1;an--)Nn.push(_n.path[an]);for(let an=1;an<In.path.length;an++)Nn.push(In.path[an]);const ir=2.5*ft;w&&(Nn=Nn.map(([an,Gr,Mr],oi)=>(de&&!Ze&&(Mr=de(oi<yn-1?_n.tilePath[yn-1-oi]:In.tilePath[oi-yn+2])[2]),mi(an,Gr,Mr,w))),Nn.some(an=>an[3]<=0)&&(Nn=[]));let Tn=[];if(Nn.length>0){let an=1/0,Gr=-1/0,Mr=1/0,oi=-1/0;for(const Hr of Nn)an=Math.min(an,Hr[0]),Mr=Math.min(Mr,Hr[1]),Gr=Math.max(Gr,Hr[0]),oi=Math.max(oi,Hr[1]);Gr>=Nt.x&&an<=je.x&&oi>=Nt.y&&Mr<=je.y&&(Tn=[Nn.map(Hr=>new c.pointGeometry(Hr[0],Hr[1]))],(an<Nt.x||Gr>je.x||Mr<Nt.y||oi>je.y)&&(Tn=c.clipLine(Tn,Nt.x,Nt.y,je.x,je.y)))}for(const an of Tn){Qe.reset(an,.25*ft);let Gr=0;Gr=Qe.length<=.5*ft?1:Math.ceil(Qe.paddedLength/ir)+1;for(let Mr=0;Mr<Gr;Mr++){const oi=Mr/Math.max(Gr-1,1),Hr=Qe.lerp(oi),Js=Hr.x+Pi,Qs=Hr.y+Pi;Q.push(Js,Qs,ft,0);const fs=Js-ft,pa=Qs-ft,gi=Js+ft,si=Qs+ft;if(et=et&&this.isOffscreen(fs,pa,gi,si),It=It||this.isInsideGrid(fs,pa,gi,si),!l&&this.grid.hitTestCircle(Js,Qs,ft,O)&&(nt=!0,!D))return{circles:[],offscreen:!1,collisionDetected:nt,occluded:!1}}}}return{circles:!D&&nt||!It?[]:Q,offscreen:et,collisionDetected:nt,occluded:He.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let m=1/0,x=1/0,E=-1/0,p=-1/0;for(const D of r){const A=new c.pointGeometry(D.x+Pi,D.y+Pi);m=Math.min(m,A.x),x=Math.min(x,A.y),E=Math.max(E,A.x),p=Math.max(p,A.y),l.push(A)}const _=this.grid.query(m,x,E,p).concat(this.ignoredGrid.query(m,x,E,p)),g={},w={};for(const D of _){const A=D.key;if(void 0===g[A.bucketInstanceId]&&(g[A.bucketInstanceId]={}),g[A.bucketInstanceId][A.featureIndex])continue;const O=[new c.pointGeometry(D.x1,D.y1),new c.pointGeometry(D.x2,D.y1),new c.pointGeometry(D.x2,D.y2),new c.pointGeometry(D.x1,D.y2)];c.polygonIntersectsPolygon(l,O)&&(g[A.bucketInstanceId][A.featureIndex]=!0,void 0===w[A.bucketInstanceId]&&(w[A.bucketInstanceId]=[]),w[A.bucketInstanceId].push(A.featureIndex))}return w}insertCollisionBox(r,l,m,x,E){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:x,collisionGroupID:E},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,m,x,E){const p=l?this.ignoredGrid:this.grid,_={bucketInstanceId:m,featureIndex:x,collisionGroupID:E};for(let g=0;g<r.length;g+=4)p.insertCircle(_,r[g],r[g+1],r[g+2])}projectAndGetPerspectiveRatio(r,l,m,x,E,p,_){const g=[l,m,x,1];let w=!1;x||this.transform.pitch>0?(c.transformMat4$1(g,g,r),this.fogState&&E&&"globe"!==_.name&&(w=function(G,K,re,Q,oe,fe){const de=fe.calculateFogTileMatrix(oe),ve=[K,re,Q];return c.transformMat4(ve,ve,de),hn(G,ve,fe.pitch,fe._fov)}(this.fogState,l,m,x,E.toUnwrapped(),this.transform)>.9)):Qn(g,g,r);const D=g[3];return{point:new c.pointGeometry((g[0]/D+1)/2*this.transform.width+Pi,(-g[1]/D+1)/2*this.transform.height+Pi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(_)/D*.5,1.5),signedDistanceFromCamera:D,occluded:p&&g[2]>D||w}}isOffscreen(r,l,m,x){return m<Pi||r>=this.screenRightBoundary||x<Pi||l>this.screenBottomBoundary}isInsideGrid(r,l,m,x){return m>=0&&r<this.gridRightBoundary&&x>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=c.identity([]);return c.translate(r,r,[-100,-100,0]),r}}function xs(h,r,l){const m=r.createTileMatrix(h,h.worldSize,l.toUnwrapped());return c.multiply(new Float32Array(16),h.projMatrix,m)}function bo(h,r,l){if(r.projection.name===l.projection.name)return h.projMatrix;const m=l.clone();return m.setProjection(r.projection),xs(m,r.getProjection(),h)}function An(h,r,l){return r.name===l.projection.name?h.projMatrix:xs(l,r,h)}class Uo{constructor(r,l,m,x){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):x&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class Ri{constructor(r,l,m,x,E,p=!1){this.text=new Uo(r?r.text:null,l,m,E),this.icon=new Uo(r?r.icon:null,l,x,E),this.clipped=p}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class is{constructor(r,l,m,x=!1){this.text=r,this.icon=l,this.skipFade=m,this.clipped=x}}class hi{constructor(){this.invProjMatrix=c.create(),this.viewportMatrix=c.create(),this.circles=[]}}class di{constructor(r,l,m,x,E){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=m,this.bucketIndex=x,this.tileID=E}}class Si{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:m=>m.collisionGroupID===l}}return this.collisionGroups[r]}}function kr(h,r,l,m,x){const{horizontalAlign:E,verticalAlign:p}=c.getAnchorAlignment(h),_=-(E-.5)*r,g=-(p-.5)*l,w=c.evaluateVariableOffset(h,m);return new c.pointGeometry(_+w[0]*x,g+w[1]*x)}function mo(h,r,l,m,x){const E=new c.pointGeometry(h,r);return l&&E._rotate(m?x:-x),E}class js{constructor(r,l,m,x,E){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Vr(this.transform,E),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Si(m),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,m,x){const E=m.getBucket(l),p=m.latestFeatureIndex;if(!E||!p||l.id!==E.layerIds[0])return;const _=E.layers[0].layout,g=m.collisionBoxArray,w=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),D=m.tileSize/c.EXTENT,A=m.tileID.toUnwrapped();this.transform.setProjection(E.projection);const O=(G=m.tileID,K=E.getProjection(),re=this.transform,K.name===this.projection?re.calculateProjMatrix(G.toUnwrapped()):xs(re,K,G));var G,K,re;const Q="map"===_.get("text-pitch-alignment"),oe="map"===_.get("text-rotation-alignment");l.compileFilter();const fe=l.dynamicFilter(),de=l.dynamicFilterNeedsFeature(),ve=this.transform.calculatePixelsToTileUnitsMatrix(m),Se=Qr(O,m.tileID.canonical,Q,oe,this.transform,E.getProjection(),ve);let Ce=null;if(Q){const He=ui(O,m.tileID.canonical,Q,oe,this.transform,E.getProjection(),ve);Ce=c.multiply([],this.transform.labelPlaneMatrix,He)}let ke=null;fe&&m.latestFeatureIndex&&(ke={unwrappedTileID:A,dynamicFilter:fe,dynamicFilterNeedsFeature:de,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[E.bucketInstanceId]=new di(E.bucketInstanceId,p,E.sourceLayerIndex,E.index,m.tileID);const Ze={bucket:E,layout:_,posMatrix:O,textLabelPlaneMatrix:Se,labelToScreenMatrix:Ce,clippingData:ke,scale:w,textPixelRatio:D,holdingForFade:m.holdingForFade(),collisionBoxArray:g,partiallyEvaluatedTextSize:c.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:c.evaluateSizeForZoom(E.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(x)for(const He of E.sortKeyRanges){const{sortKey:Be,symbolInstanceStart:Lt,symbolInstanceEnd:Ve}=He;r.push({sortKey:Be,symbolInstanceStart:Lt,symbolInstanceEnd:Ve,parameters:Ze})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ze})}attemptAnchorPlacement(r,l,m,x,E,p,_,g,w,D,A,O,G,K,re,Q,oe,fe){const{textOffset0:de,textOffset1:ve,crossTileID:Se}=O,Ce=[de,ve],ke=kr(r,m,x,Ce,E),Ze=this.collisionIndex.placeCollisionBox(K,E,l,mo(ke.x,ke.y,p,_,this.transform.angle),A,g,w,D.predicate);if(Q){const He=K.getSymbolInstanceIconSize(fe,this.transform.zoom,O.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(K,He,Q,mo(ke.x,ke.y,p,_,this.transform.angle),A,g,w,D.predicate).box.length)return}if(Ze.box.length>0){let He;return this.prevPlacement&&this.prevPlacement.variableOffsets[Se]&&this.prevPlacement.placements[Se]&&this.prevPlacement.placements[Se].text&&(He=this.prevPlacement.variableOffsets[Se].anchor),this.variableOffsets[Se]={textOffset:Ce,width:m,height:x,anchor:r,textScale:E,prevAnchor:He},this.markUsedJustification(K,r,O,re),K.allowVerticalPlacement&&(this.markUsedOrientation(K,re,O),this.placedOrientations[Se]=re),{shift:ke,placedGlyphBoxes:Ze}}}placeLayerBucketPart(r,l,m,x){const{bucket:E,layout:p,posMatrix:_,textLabelPlaneMatrix:g,labelToScreenMatrix:w,clippingData:D,textPixelRatio:A,holdingForFade:O,collisionBoxArray:G,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:re,collisionGroup:Q}=r.parameters,oe=p.get("text-optional"),fe=p.get("icon-optional"),de=p.get("text-allow-overlap"),ve=p.get("icon-allow-overlap"),Se="map"===p.get("text-rotation-alignment"),Ce="map"===p.get("text-pitch-alignment"),ke="none"!==p.get("icon-text-fit"),Ze="viewport-y"===p.get("symbol-z-order");this.transform.setProjection(E.projection);let He=de&&(ve||!E.hasIconData()||fe),Be=ve&&(de||!E.hasTextData()||oe);!E.collisionArrays&&G&&E.deserializeCollisionBoxes(G),m&&x&&E.updateCollisionDebugBuffers(this.transform.zoom,G);const Lt=(Ve,at,nt)=>{const{crossTileID:It,numVerticalGlyphVertices:et}=Ve;if(D){const gi={zoom:this.transform.zoom,pitch:this.transform.pitch};let si=null;if(D.dynamicFilterNeedsFeature){const Cr=this.retainedQueryData[E.bucketInstanceId];si=D.featureIndex.loadFeature({featureIndex:Ve.featureIndex,bucketIndex:Cr.bucketIndex,sourceLayerIndex:Cr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,D.dynamicFilter)(gi,si,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new c.pointGeometry(Ve.tileAnchorX,Ve.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[It]=new is(!1,!1,!1,!0),void(l[It]=!0)}if(l[It])return;if(O)return void(this.placements[It]=new is(!1,!1,!1));let ft=!1,Nt=!1,je=!0,Qe=!1,_n=!1,In=null,yn={box:null,offscreen:null,occluded:null},Nn={box:null,offscreen:null,occluded:null},ir=null,Tn=null,an=null,Gr=0,Mr=0,oi=0;nt.textFeatureIndex?Gr=nt.textFeatureIndex:Ve.useRuntimeCollisionCircles&&(Gr=Ve.featureIndex),nt.verticalTextFeatureIndex&&(Mr=nt.verticalTextFeatureIndex);const Hr=gi=>{gi.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const si=this.transform.elevation;(si||gi.elevation)&&(gi.elevation=si?si.getAtTileOffset(gi.tileID,gi.tileAnchorX,gi.tileAnchorY):0)},Js=nt.textBox;if(Js){Hr(Js);const gi=Cr=>{let so=c.WritingMode.horizontal;if(E.allowVerticalPlacement&&!Cr&&this.prevPlacement){const ps=this.prevPlacement.placedOrientations[It];ps&&(this.placedOrientations[It]=ps,so=ps,this.markUsedOrientation(E,so,Ve))}return so},si=(Cr,so)=>{if(E.allowVerticalPlacement&&et>0&&nt.verticalTextBox){for(const ps of E.writingModes)if(ps===c.WritingMode.vertical?(yn=so(),Nn=yn):yn=Cr(),yn&&yn.box&&yn.box.length)break}else yn=Cr()};if(p.get("text-variable-anchor")){let Cr=p.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[It]){const fi=this.prevPlacement.variableOffsets[It];Cr.indexOf(fi.anchor)>0&&(Cr=Cr.filter(Ps=>Ps!==fi.anchor),Cr.unshift(fi.anchor))}const so=(fi,Ps,Du)=>{const yl=E.getSymbolInstanceTextSize(K,Ve,this.transform.zoom,at),Ho=(fi.x2-fi.x1)*yl+2*fi.padding,Rs=(fi.y2-fi.y1)*yl+2*fi.padding,Aa=ke&&!ve?Ps:null;Aa&&Hr(Aa);let Pa={box:[],offscreen:!1,occluded:!1};const Ic=de?2*Cr.length:Cr.length;for(let ms=0;ms<Ic;++ms){const il=this.attemptAnchorPlacement(Cr[ms%Cr.length],fi,Ho,Rs,yl,Se,Ce,A,_,Q,ms>=Cr.length,Ve,at,E,Du,Aa,K,re);if(il&&(Pa=il.placedGlyphBoxes,Pa&&Pa.box&&Pa.box.length)){ft=!0,In=il.shift;break}}return Pa};si(()=>so(Js,nt.iconBox,c.WritingMode.horizontal),()=>{const fi=nt.verticalTextBox;return fi&&Hr(fi),E.allowVerticalPlacement&&!(yn&&yn.box&&yn.box.length)&&et>0&&fi?so(fi,nt.verticalIconBox,c.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),yn&&(ft=yn.box,je=yn.offscreen,Qe=yn.occluded);const ps=gi(yn&&yn.box);if(!ft&&this.prevPlacement){const fi=this.prevPlacement.variableOffsets[It];fi&&(this.variableOffsets[It]=fi,this.markUsedJustification(E,fi.anchor,Ve,ps))}}else{const Cr=(so,ps)=>{const fi=E.getSymbolInstanceTextSize(K,Ve,this.transform.zoom,at),Ps=this.collisionIndex.placeCollisionBox(E,fi,so,new c.pointGeometry(0,0),de,A,_,Q.predicate);return Ps&&Ps.box&&Ps.box.length&&(this.markUsedOrientation(E,ps,Ve),this.placedOrientations[It]=ps),Ps};si(()=>Cr(Js,c.WritingMode.horizontal),()=>{const so=nt.verticalTextBox;return E.allowVerticalPlacement&&et>0&&so?(Hr(so),Cr(so,c.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),gi(yn&&yn.box&&yn.box.length)}}if(ir=yn,ft=ir&&ir.box&&ir.box.length>0,je=ir&&ir.offscreen,Qe=ir&&ir.occluded,Ve.useRuntimeCollisionCircles){const gi=E.text.placedSymbolArray.get(Ve.centerJustifiedTextSymbolIndex>=0?Ve.centerJustifiedTextSymbolIndex:Ve.verticalPlacedTextSymbolIndex),si=c.evaluateSizeForFeature(E.textSizeData,K,gi),Cr=p.get("text-padding");Tn=this.collisionIndex.placeCollisionCircles(E,de,gi,E.lineVertexArray,E.glyphOffsetArray,si,_,g,w,m,Ce,Q.predicate,Ve.collisionCircleDiameter*si/c.ONE_EM,Cr,this.retainedQueryData[E.bucketInstanceId].tileID),ft=de||Tn.circles.length>0&&!Tn.collisionDetected,je=je&&Tn.offscreen,Qe=Tn.occluded}if(nt.iconFeatureIndex&&(oi=nt.iconFeatureIndex),nt.iconBox){const gi=si=>{Hr(si);const Cr=ke&&In?mo(In.x,In.y,Se,Ce,this.transform.angle):new c.pointGeometry(0,0),so=E.getSymbolInstanceIconSize(re,this.transform.zoom,Ve.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,so,si,Cr,ve,A,_,Q.predicate)};Nn&&Nn.box&&Nn.box.length&&nt.verticalIconBox?(an=gi(nt.verticalIconBox),Nt=an.box.length>0):(an=gi(nt.iconBox),Nt=an.box.length>0),je=je&&an.offscreen,_n=an.occluded}const Qs=oe||0===Ve.numHorizontalGlyphVertices&&0===et,fs=fe||0===Ve.numIconVertices;if(Qs||fs?fs?Qs||(Nt=Nt&&ft):ft=Nt&&ft:Nt=ft=Nt&&ft,ft&&ir&&ir.box&&this.collisionIndex.insertCollisionBox(ir.box,p.get("text-ignore-placement"),E.bucketInstanceId,Nn&&Nn.box&&Mr?Mr:Gr,Q.ID),Nt&&an&&this.collisionIndex.insertCollisionBox(an.box,p.get("icon-ignore-placement"),E.bucketInstanceId,oi,Q.ID),Tn&&(ft&&this.collisionIndex.insertCollisionCircles(Tn.circles,p.get("text-ignore-placement"),E.bucketInstanceId,Gr,Q.ID),m)){const gi=E.bucketInstanceId;let si=this.collisionCircleArrays[gi];void 0===si&&(si=this.collisionCircleArrays[gi]=new hi);for(let Cr=0;Cr<Tn.circles.length;Cr+=4)si.circles.push(Tn.circles[Cr+0]),si.circles.push(Tn.circles[Cr+1]),si.circles.push(Tn.circles[Cr+2]),si.circles.push(Tn.collisionDetected?1:0)}const pa="globe"!==E.projection.name;He=He&&(pa||!Qe),Be=Be&&(pa||!_n),this.placements[It]=new is(ft||He,Nt||Be,je||E.justReloaded),l[It]=!0};if(Ze){const Ve=E.getSortedSymbolIndexes(this.transform.angle);for(let at=Ve.length-1;at>=0;--at){const nt=Ve[at];Lt(E.symbolInstances.get(nt),nt,E.collisionArrays[nt])}}else for(let Ve=r.symbolInstanceStart;Ve<r.symbolInstanceEnd;Ve++)Lt(E.symbolInstances.get(Ve),Ve,E.collisionArrays[Ve]);if(m&&E.bucketInstanceId in this.collisionCircleArrays){const Ve=this.collisionCircleArrays[E.bucketInstanceId];c.invert(Ve.invProjMatrix,_),Ve.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(r,l,m,x){const{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:p,rightJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:g,crossTileID:w}=m,D=c.getAnchorJustification(l),A=x===c.WritingMode.vertical?g:"left"===D?E:"center"===D?p:"right"===D?_:-1;E>=0&&(r.text.placedSymbolArray.get(E).crossTileID=A>=0&&E!==A?0:w),p>=0&&(r.text.placedSymbolArray.get(p).crossTileID=A>=0&&p!==A?0:w),_>=0&&(r.text.placedSymbolArray.get(_).crossTileID=A>=0&&_!==A?0:w),g>=0&&(r.text.placedSymbolArray.get(g).crossTileID=A>=0&&g!==A?0:w)}markUsedOrientation(r,l,m){const x=l===c.WritingMode.horizontal||l===c.WritingMode.horizontalOnly?l:0,E=l===c.WritingMode.vertical?l:0,{leftJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:_,rightJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:w}=m,D=r.text.placedSymbolArray;p>=0&&(D.get(p).placedOrientation=x),_>=0&&(D.get(_).placedOrientation=x),g>=0&&(D.get(g).placedOrientation=x),w>=0&&(D.get(w).placedOrientation=E)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let m=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const x=l?l.symbolFadeChange(r):1,E=l?l.opacities:{},p=l?l.variableOffsets:{},_=l?l.placedOrientations:{};for(const g in this.placements){const w=this.placements[g],D=E[g];D?(this.opacities[g]=new Ri(D,x,w.text,w.icon,null,w.clipped),m=m||w.text!==D.text.placed||w.icon!==D.icon.placed):(this.opacities[g]=new Ri(null,x,w.text,w.icon,w.skipFade,w.clipped),m=m||w.text||w.icon)}for(const g in E){const w=E[g];if(!this.opacities[g]){const D=new Ri(w,x,!1,!1);D.isHidden()||(this.opacities[g]=D,m=m||w.text.placed||w.icon.placed)}}for(const g in p)this.variableOffsets[g]||!this.opacities[g]||this.opacities[g].isHidden()||(this.variableOffsets[g]=p[g]);for(const g in _)this.placedOrientations[g]||!this.opacities[g]||this.opacities[g].isHidden()||(this.placedOrientations[g]=_[g]);m?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const m={};for(const x of l){const E=x.getBucket(r);E&&x.latestFeatureIndex&&r.id===E.layerIds[0]&&this.updateBucketOpacities(E,m,x.collisionBoxArray)}}updateBucketOpacities(r,l,m){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const x=r.layers[0].layout,E=!!r.layers[0].dynamicFilter(),p=new Ri(null,0,!1,!1,!0),_=x.get("text-allow-overlap"),g=x.get("icon-allow-overlap"),w=x.get("text-variable-anchor"),D="map"===x.get("text-rotation-alignment"),A="map"===x.get("text-pitch-alignment"),O="none"!==x.get("icon-text-fit"),G=new Ri(null,0,_&&(g||!r.hasIconData()||x.get("icon-optional")),g&&(_||!r.hasTextData()||x.get("text-optional")),!0);!r.collisionArrays&&m&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(m);const K=(Q,oe,fe)=>{for(let de=0;de<oe/4;de++)Q.opacityVertexArray.emplaceBack(fe)};let re=0;for(let Q=0;Q<r.symbolInstances.length;Q++){const oe=r.symbolInstances.get(Q),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:de,crossTileID:ve,numIconVertices:Se}=oe;let Ce=this.opacities[ve];l[ve]?Ce=p:Ce||(Ce=G,this.opacities[ve]=Ce),l[ve]=!0;const ke=fe>0||de>0,Ze=Se>0,He=this.placedOrientations[ve],Be=He===c.WritingMode.vertical,Lt=He===c.WritingMode.horizontal||He===c.WritingMode.horizontalOnly;if(!ke&&!Ze||Ce.isHidden()||re++,ke){const Ve=Dr(Ce.text);K(r.text,fe,Be?ga:Ve),K(r.text,de,Lt?ga:Ve);const at=Ce.text.isHidden(),{leftJustifiedTextSymbolIndex:nt,centerJustifiedTextSymbolIndex:It,rightJustifiedTextSymbolIndex:et,verticalPlacedTextSymbolIndex:ft}=oe,Nt=r.text.placedSymbolArray,je=at||Be?1:0;nt>=0&&(Nt.get(nt).hidden=je),It>=0&&(Nt.get(It).hidden=je),et>=0&&(Nt.get(et).hidden=je),ft>=0&&(Nt.get(ft).hidden=at||Lt?1:0);const Qe=this.variableOffsets[ve];Qe&&this.markUsedJustification(r,Qe.anchor,oe,He);const _n=this.placedOrientations[ve];_n&&(this.markUsedJustification(r,"left",oe,_n),this.markUsedOrientation(r,_n,oe))}if(Ze){const Ve=Dr(Ce.icon),{placedIconSymbolIndex:at,verticalPlacedIconSymbolIndex:nt}=oe,It=r.icon.placedSymbolArray,et=Ce.icon.isHidden()?1:0;at>=0&&(K(r.icon,Se,Be?ga:Ve),It.get(at).hidden=et),nt>=0&&(K(r.icon,oe.numVerticalIconVertices,Lt?ga:Ve),It.get(nt).hidden=et)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Ve=r.collisionArrays[Q];if(Ve){let at=new c.pointGeometry(0,0),nt=!0;if(Ve.textBox||Ve.verticalTextBox){if(w){const et=this.variableOffsets[ve];et?(at=kr(et.anchor,et.width,et.height,et.textOffset,et.textScale),D&&at._rotate(A?this.transform.angle:-this.transform.angle)):nt=!1}E&&(nt=!Ce.clipped),Ve.textBox&&Li(r.textCollisionBox.collisionVertexArray,Ce.text.placed,!nt||Be,at.x,at.y),Ve.verticalTextBox&&Li(r.textCollisionBox.collisionVertexArray,Ce.text.placed,!nt||Lt,at.x,at.y)}const It=nt&&Boolean(!Lt&&Ve.verticalIconBox);Ve.iconBox&&Li(r.iconCollisionBox.collisionVertexArray,Ce.icon.placed,It,O?at.x:0,O?at.y:0),Ve.verticalIconBox&&Li(r.iconCollisionBox.collisionVertexArray,Ce.icon.placed,!It,O?at.x:0,O?at.y:0)}}}if(r.fullyClipped=0===re,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const Q=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=Q.invProjMatrix,r.placementViewportMatrix=Q.viewportMatrix,r.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const m=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*m>r}setStale(){this.stale=!0}}function Li(h,r,l,m,x){h.emplaceBack(r?1:0,l?1:0,m||0,x||0),h.emplaceBack(r?1:0,l?1:0,m||0,x||0),h.emplaceBack(r?1:0,l?1:0,m||0,x||0),h.emplaceBack(r?1:0,l?1:0,m||0,x||0)}const gr=Math.pow(2,25),Ll=Math.pow(2,24),wo=Math.pow(2,17),ri=Math.pow(2,16),Qo=Math.pow(2,9),os=Math.pow(2,8),jo=Math.pow(2,1);function Dr(h){if(0===h.opacity&&!h.placed)return 0;if(1===h.opacity&&h.placed)return 4294967295;const r=h.placed?1:0,l=Math.floor(127*h.opacity);return l*gr+r*Ll+l*wo+r*ri+l*Qo+r*os+l*jo+r}const ga=0;class to{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,l,m,x,E){const p=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(p,x,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,p.sort((_,g)=>_.sortKey-g.sortKey));this._currentPartIndex<p.length;){const _=p[this._currentPartIndex];if(l.placeLayerBucketPart(_,this._seenCrossTileIDs,m,0===_.symbolInstanceStart),this._currentPartIndex++,E())return!0}return!1}}class vi{constructor(r,l,m,x,E,p,_,g){this.placement=new js(r,E,p,_,g),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(r,l,m){const x=c.exported.now(),E=()=>{const p=c.exported.now()-x;return!this._forceFullPlacement&&p>2};for(;this._currentPlacementIndex>=0;){const p=l[r[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if("symbol"===p.type&&(!p.minzoom||p.minzoom<=_)&&(!p.maxzoom||p.maxzoom>_)){if(this._inProgressLayer||(this._inProgressLayer=new to(p)),this._inProgressLayer.continuePlacement(m[p.source],this.placement,this._showCollisionBoxes,p,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const ss=512/c.EXTENT/2;class as{constructor(r,l,m){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let x=0;x<l.length;x++){const E=l.get(x),p=E.key;this.indexedSymbolInstances[p]||(this.indexedSymbolInstances[p]=[]),this.indexedSymbolInstances[p].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,r)})}}getScaledCoordinates(r,l){const m=ss/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*c.EXTENT+r.tileAnchorX)*m),y:Math.floor((l.canonical.y*c.EXTENT+r.tileAnchorY)*m)}}findMatches(r,l,m){const x=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let E=0;E<r.length;E++){const p=r.get(E);if(p.crossTileID)continue;const _=this.indexedSymbolInstances[p.key];if(!_)continue;const g=this.getScaledCoordinates(p,l);for(const w of _)if(Math.abs(w.coord.x-g.x)<=x&&Math.abs(w.coord.y-g.y)<=x&&!m[w.crossTileID]){m[w.crossTileID]=!0,p.crossTileID=w.crossTileID;break}}}}class es{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ki{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(0!==l)for(const m in this.indexes){const x=this.indexes[m],E={};for(const p in x){const _=x[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+l),E[_.tileID.key]=_}this.indexes[m]=E}this.lng=r}addBucket(r,l,m){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let E=0;E<l.symbolInstances.length;E++)l.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const x=this.usedCrossTileIDs[r.overscaledZ];for(const E in this.indexes){const p=this.indexes[E];if(Number(E)>r.overscaledZ)for(const _ in p){const g=p[_];g.tileID.isChildOf(r)&&g.findMatches(l.symbolInstances,r,x)}else{const _=p[r.scaledTo(Number(E)).key];_&&_.findMatches(l.symbolInstances,r,x)}}for(let E=0;E<l.symbolInstances.length;E++){const p=l.symbolInstances.get(E);p.crossTileID||(p.crossTileID=m.generate(),x[p.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new as(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const m in l.indexedSymbolInstances)for(const x of l.indexedSymbolInstances[m])delete this.usedCrossTileIDs[r][x.crossTileID]}removeStaleBuckets(r){let l=!1;for(const m in this.indexes){const x=this.indexes[m];for(const E in x)r[x[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,x[E]),delete x[E],l=!0)}return l}}class Oi{constructor(){this.layerIndexes={},this.crossTileIDs=new es,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,m,x){let E=this.layerIndexes[r.id];void 0===E&&(E=this.layerIndexes[r.id]=new ki);let p=!1;const _={};"globe"!==x.name&&E.handleWrapJump(m);for(const g of l){const w=g.getBucket(r);w&&r.id===w.layerIds[0]&&(w.bucketInstanceId||(w.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(g.tileID,w,this.crossTileIDs)&&(p=!0),_[w.bucketInstanceId]=!0)}return E.removeStaleBuckets(_)&&(p=!0),p}pruneUnusedLayers(r){const l={};r.forEach(m=>{l[m]=!0});for(const m in this.layerIndexes)l[m]||delete this.layerIndexes[m]}}const bs=(h,r)=>c.emitValidationErrors(h,r&&r.filter(l=>"source.canvas"!==l.identifier)),ia=c.pick(fn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ls=c.pick(fn,["setCenter","setZoom","setBearing","setPitch"]),_a={version:8,layers:[],sources:{}},ts={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Zi extends c.Evented{constructor(r,l={}){super(),this.map=r,this.dispatcher=new Pt(vn(),this),this.imageManager=new ur,this.imageManager.setEventedParent(this),this.glyphManager=new c.GlyphManager(r._requestManager,l.localFontFamily?c.LocalGlyphMode.all:l.localIdeographFontFamily?c.LocalGlyphMode.ideographs:c.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new Oi,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.getReferrer());const m=this;this._rtlTextPluginCallback=Zi.registerForPluginStateChange(x=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(E,p)=>{if(c.triggerPluginCompletionEvent(E),p&&p.every(_=>_))for(const _ in m._sourceCaches){const g=m._sourceCaches[_],w=g.getSource().type;"vector"!==w&&"geojson"!==w||g.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const E=this.getSource(x.sourceId);if(E&&E.vectorLayerIds)for(const p in this._layers){const _=this._layers[p];_.source===E.id&&this._validateLayer(_)}})}loadURL(r,l={}){this.fire(new c.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof l.validate?l.validate:!c.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,l.accessToken);const x=this.map._requestManager.transformRequest(r,c.ResourceType.Style);this._request=c.getJSON(x,(E,p)=>{this._request=null,E?this.fire(new c.ErrorEvent(E)):p&&this._load(p,m)})}loadJSON(r,l={}){this.fire(new c.Event("dataloading",{dataType:"style"})),this._request=c.exported.frame(()=>{this._request=null,this._load(r,!1!==l.validate)})}loadEmpty(){this.fire(new c.Event("dataloading",{dataType:"style"})),this._load(_a,!1)}_updateLayerCount(r,l){const m=l?1:-1;r.is3D()&&(this._num3DLayers+=m),"circle"===r.type&&(this._numCircleLayers+=m),"symbol"===r.type&&(this._numSymbolLayers+=m)}_load(r,l){if(l&&bs(this,c.validateStyle(r)))return;this._loaded=!0,this.stylesheet=c.clone$1(r),this._updateMapProjection();for(const x in r.sources)this.addSource(x,r.sources[x],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const m=nr(this.stylesheet.layers);this._order=m.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of m)x=c.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _t(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new c.Event("data",{dataType:"style"})),this.fire(new c.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(l,m,x){let E,p,_;const g=c.exported.devicePixelRatio>1?"@2x":"";let w=c.getJSON(m.transformRequest(m.normalizeSpriteURL(l,g,".json"),c.ResourceType.SpriteJSON),(O,G)=>{w=null,_||(_=O,E=G,A())}),D=c.getImage(m.transformRequest(m.normalizeSpriteURL(l,g,".png"),c.ResourceType.SpriteImage),(O,G)=>{D=null,_||(_=O,p=G,A())});function A(){if(_)x(_);else if(E&&p){const O=c.exported.getImageData(p),G={};for(const K in E){const{width:re,height:Q,x:oe,y:fe,sdf:de,pixelRatio:ve,stretchX:Se,stretchY:Ce,content:ke}=E[K],Ze=new c.RGBAImage({width:re,height:Q});c.RGBAImage.copy(O,Ze,{x:oe,y:fe},{x:0,y:0},{width:re,height:Q}),G[K]={data:Ze,pixelRatio:ve,sdf:de,stretchX:Se,stretchY:Ce,content:ke}}x(null,G)}}return{cancel(){w&&(w.cancel(),w=null),D&&(D.cancel(),D=null)}}}(r,this.map._requestManager,(l,m)=>{if(this._spriteRequest=null,l)this.fire(new c.ErrorEvent(l));else if(m)for(const x in m)this.imageManager.addImage(x,m[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new c.Event("data",{dataType:"style"}))})}_validateLayer(r){const l=this.getSource(r.source);if(!l)return;const m=r.sourceLayer;m&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(m))&&this.fire(new c.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const l=[];for(const m of r){const x=this._layers[m];"custom"!==x.type&&l.push(x.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&ts[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(x.length||E.length)&&this._updateWorkerLayers(x,E);for(const p in this._updatedSources){const _=this._updatedSources[p];"reload"===_?this._reloadSource(p):"clear"===_&&this._clearSource(p)}this._updateTilesForChangedImages();for(const p in this._updatedPaintProps)this._layers[p].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const m={};for(const x in this._sourceCaches){const E=this._sourceCaches[x];m[x]=E.used,E.used=!1}for(const x of this._order){const E=this._layers[x];if(E.recalculate(r,this._availableImages),!E.isHidden(r.zoom)){const _=this._getLayerSourceCache(E);_&&(_.used=!0)}const p=this.map.painter;if(p){const _=E.getProgramIds();if(!_)continue;const g=E.getProgramConfiguration(r.zoom);for(const w of _)p.useProgram(w,g)}}for(const x in m){const E=this._sourceCaches[x];m[x]!==E.used&&E.getSource().fire(new c.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new c.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),bs(this,c.validateStyle(r)))return!1;(r=c.clone$1(r)).layers=nr(r.layers);const l=function(x,E){if(!x)return[{command:fn.setStyle,args:[E]}];let p=[];try{if(!Pe(x.version,E.version))return[{command:fn.setStyle,args:[E]}];Pe(x.center,E.center)||p.push({command:fn.setCenter,args:[E.center]}),Pe(x.zoom,E.zoom)||p.push({command:fn.setZoom,args:[E.zoom]}),Pe(x.bearing,E.bearing)||p.push({command:fn.setBearing,args:[E.bearing]}),Pe(x.pitch,E.pitch)||p.push({command:fn.setPitch,args:[E.pitch]}),Pe(x.sprite,E.sprite)||p.push({command:fn.setSprite,args:[E.sprite]}),Pe(x.glyphs,E.glyphs)||p.push({command:fn.setGlyphs,args:[E.glyphs]}),Pe(x.transition,E.transition)||p.push({command:fn.setTransition,args:[E.transition]}),Pe(x.light,E.light)||p.push({command:fn.setLight,args:[E.light]}),Pe(x.fog,E.fog)||p.push({command:fn.setFog,args:[E.fog]}),Pe(x.projection,E.projection)||p.push({command:fn.setProjection,args:[E.projection]});const _={},g=[];!function(A,O,G,K){let re;for(re in O=O||{},A=A||{})A.hasOwnProperty(re)&&(O.hasOwnProperty(re)||Tr(re,G,K));for(re in O)O.hasOwnProperty(re)&&(A.hasOwnProperty(re)?Pe(A[re],O[re])||("geojson"===A[re].type&&"geojson"===O[re].type&&ji(A,O,re)?G.push({command:fn.setGeoJSONSourceData,args:[re,O[re].data]}):po(re,O,G,K)):sr(re,O,G))}(x.sources,E.sources,g,_);const w=[];x.layers&&x.layers.forEach(A=>{A.source&&_[A.source]?p.push({command:fn.removeLayer,args:[A.id]}):w.push(A)});let D=x.terrain;D&&_[D.source]&&(p.push({command:fn.setTerrain,args:[void 0]}),D=void 0),p=p.concat(g),Pe(D,E.terrain)||p.push({command:fn.setTerrain,args:[E.terrain]}),function(A,O,G){O=O||[];const K=(A=A||[]).map(it),re=O.map(it),Q=A.reduce(rs,{}),oe=O.reduce(rs,{}),fe=K.slice(),de=Object.create(null);let ve,Se,Ce,ke,Ze,He,Be;for(ve=0,Se=0;ve<K.length;ve++)Ce=K[ve],oe.hasOwnProperty(Ce)?Se++:(G.push({command:fn.removeLayer,args:[Ce]}),fe.splice(fe.indexOf(Ce,Se),1));for(ve=0,Se=0;ve<re.length;ve++)Ce=re[re.length-1-ve],fe[fe.length-1-ve]!==Ce&&(Q.hasOwnProperty(Ce)?(G.push({command:fn.removeLayer,args:[Ce]}),fe.splice(fe.lastIndexOf(Ce,fe.length-Se),1)):Se++,He=fe[fe.length-ve],G.push({command:fn.addLayer,args:[oe[Ce],He]}),fe.splice(fe.length-ve,0,Ce),de[Ce]=!0);for(ve=0;ve<re.length;ve++)if(Ce=re[ve],ke=Q[Ce],Ze=oe[Ce],!de[Ce]&&!Pe(ke,Ze))if(Pe(ke.source,Ze.source)&&Pe(ke["source-layer"],Ze["source-layer"])&&Pe(ke.type,Ze.type)){for(Be in jr(ke.layout,Ze.layout,G,Ce,null,fn.setLayoutProperty),jr(ke.paint,Ze.paint,G,Ce,null,fn.setPaintProperty),Pe(ke.filter,Ze.filter)||G.push({command:fn.setFilter,args:[Ce,Ze.filter]}),Pe(ke.minzoom,Ze.minzoom)&&Pe(ke.maxzoom,Ze.maxzoom)||G.push({command:fn.setLayerZoomRange,args:[Ce,Ze.minzoom,Ze.maxzoom]}),ke)ke.hasOwnProperty(Be)&&"layout"!==Be&&"paint"!==Be&&"filter"!==Be&&"metadata"!==Be&&"minzoom"!==Be&&"maxzoom"!==Be&&(0===Be.indexOf("paint.")?jr(ke[Be],Ze[Be],G,Ce,Be.slice(6),fn.setPaintProperty):Pe(ke[Be],Ze[Be])||G.push({command:fn.setLayerProperty,args:[Ce,Be,Ze[Be]]}));for(Be in Ze)Ze.hasOwnProperty(Be)&&!ke.hasOwnProperty(Be)&&"layout"!==Be&&"paint"!==Be&&"filter"!==Be&&"metadata"!==Be&&"minzoom"!==Be&&"maxzoom"!==Be&&(0===Be.indexOf("paint.")?jr(ke[Be],Ze[Be],G,Ce,Be.slice(6),fn.setPaintProperty):Pe(ke[Be],Ze[Be])||G.push({command:fn.setLayerProperty,args:[Ce,Be,Ze[Be]]}))}else G.push({command:fn.removeLayer,args:[Ce]}),He=fe[fe.lastIndexOf(Ce)+1],G.push({command:fn.addLayer,args:[Ze,He]})}(w,E.layers,p)}catch(_){console.warn("Unable to compute style diff:",_),p=[{command:fn.setStyle,args:[E]}]}return p}(this.serialize(),r).filter(x=>!(x.command in ls));if(0===l.length)return!1;const m=l.filter(x=>!(x.command in ia));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);return l.forEach(x=>{"setTransition"!==x.command&&"setProjection"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,l){return this.getImage(r)?this.fire(new c.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,l),this._afterImageUpdated(r),this)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new c.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,l,m={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(c.validateSource,`sources.${r}`,l,null,m))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const x=ne(r,l,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:x.serialize(),sourceId:r}));const E=p=>{const _=(p?"symbol:":"other:")+r,g=this._sourceCaches[_]=new c.SourceCache(_,x,p);(p?this._symbolSourceCaches:this._otherSourceCaches)[r]=g,g.style=this,g.onAdd(this.map)};E(!1),"vector"!==l.type&&"geojson"!==l.type||E(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const l=this.getSource(r);if(!l)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===r)return this.fire(new c.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new c.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(r);for(const x of m)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new c.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getSource(r).setData(l),this._changed=!0}getSource(r){const l=this._getSourceCache(r);return l&&l.getSource()}_getSources(){const r=[];for(const l in this._otherSourceCaches){const m=this._getSourceCache(l);m&&r.push(m.getSource())}return r}addLayer(r,l,m={}){this._checkLoaded();const x=r.id;if(this.getLayer(x))return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let E;if("custom"===r.type){if(bs(this,c.validateCustomStyleLayer(r)))return;E=c.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(x,r.source),r=c.clone$1(r),r=c.extend(r,{source:x})),this._validate(c.validateLayer,`layers.${x}`,r,{arrayIndex:-1},m))return;E=c.createStyleLayer(r),this._validateLayer(E),E.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}const p=l?this._order.indexOf(l):this._order.length;if(l&&-1===p)return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(p,0,x),this._layerOrderChanged=!0,this._layers[x]=E;const _=this._getLayerSourceCache(E);if(this._removedLayers[x]&&E.source&&_&&"custom"!==E.type){const g=this._removedLayers[x];delete this._removedLayers[x],g.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",_.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const m=this._order.indexOf(r);this._order.splice(m,1);const x=l?this._order.indexOf(l):this._order.length;l&&-1===x?this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(x,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const m=this._order.indexOf(r);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,m){this._checkLoaded();const x=this.getLayer(r);x?x.minzoom===l&&x.maxzoom===m||(null!=l&&(x.minzoom=l),null!=m&&(x.maxzoom=m),this._updateLayer(x)):this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,l,m={}){this._checkLoaded();const x=this.getLayer(r);if(x){if(!Pe(x.filter,l))return null==l?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(c.validateFilter,`layers.${x.id}.filter`,l,{layerType:x.type},m)||(x.filter=c.clone$1(l),this._updateLayer(x)))}else this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const l=this.getLayer(r);return l&&c.clone$1(l.filter)}setLayoutProperty(r,l,m,x={}){this._checkLoaded();const E=this.getLayer(r);E?Pe(E.getLayoutProperty(l),m)||(E.setLayoutProperty(l,m,x),this._updateLayer(E)):this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,l){const m=this.getLayer(r);if(m)return m.getLayoutProperty(l);this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,l,m,x={}){this._checkLoaded();const E=this.getLayer(r);E?Pe(E.getPaintProperty(l),m)||(E.setPaintProperty(l,m,x)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,l){const m=this.getLayer(r);return m&&m.getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const m=r.source,x=r.sourceLayer,E=this.getSource(m);if(!E)return void this.fire(new c.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const p=E.type;if("geojson"===p&&x)return void this.fire(new c.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===p&&!x)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided.")));const _=this._getSourceCaches(m);for(const g of _)g.setFeatureState(x,r.id,l)}removeFeatureState(r,l){this._checkLoaded();const m=r.source,x=this.getSource(m);if(!x)return void this.fire(new c.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const E=x.type,p="vector"===E?r.sourceLayer:void 0;if("vector"===E&&!p)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new c.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const _=this._getSourceCaches(m);for(const g of _)g.removeFeatureState(p,r.id,l)}getFeatureState(r){this._checkLoaded();const l=r.source,m=r.sourceLayer,x=this.getSource(l);if(x){if("vector"!==x.type||m)return void 0===r.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(m,r.id);this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new c.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const l in this._sourceCaches){const m=this._sourceCaches[l].getSource();r[m.id]||(r[m.id]=m.serialize())}return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(r){this._updatedLayers[r.id]=!0;const l=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&l&&"raster"!==l.getSource().type&&(this._updatedSources[r.source]="reload",l.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const l=p=>"fill-extrusion"===this._layers[p].type,m={},x=[];for(let p=this._order.length-1;p>=0;p--){const _=this._order[p];if(l(_)){m[_]=p;for(const g of r){const w=g[_];if(w)for(const D of w)x.push(D)}}}x.sort((p,_)=>_.intersectionZ-p.intersectionZ);const E=[];for(let p=this._order.length-1;p>=0;p--){const _=this._order[p];if(l(_))for(let g=x.length-1;g>=0;g--){const w=x[g].feature;if(m[w.layer.id]<p)break;E.push(w),x.pop()}else for(const g of r){const w=g[_];if(w)for(const D of w)E.push(D.feature)}}return E}queryRenderedFeatures(r,l,m){l&&l.filter&&this._validate(c.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const x={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new c.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const g of l.layers){const w=this._layers[g];if(!w)return this.fire(new c.ErrorEvent(new Error(`The layer '${g}' does not exist in the map's style and cannot be queried for features.`))),[];x[w.source]=!0}}const E=[];l.availableImages=this._availableImages;const p=l&&l.layers?l.layers.some(g=>{const w=this.getLayer(g);return w&&w.is3D()}):this.has3DLayers(),_=kt.createFromScreenPoints(r,m);for(const g in this._sourceCaches){const w=this._sourceCaches[g].getSource().id;l.layers&&!x[w]||E.push(ae(this._sourceCaches[g],this._layers,this._serializedLayers,_,l,m,p,!!this.map._showQueryGeometry))}return this.placement&&E.push(function(g,w,D,A,O,G,K){const re={},Q=G.queryRenderedSymbols(A),oe=[];for(const fe of Object.keys(Q).map(Number))oe.push(K[fe]);oe.sort(We);for(const fe of oe){const de=fe.featureIndex.lookupSymbolFeatures(Q[fe.bucketInstanceId],w,fe.bucketIndex,fe.sourceLayerIndex,O.filter,O.layers,O.availableImages,g);for(const ve in de){const Se=re[ve]=re[ve]||[],Ce=de[ve];Ce.sort((ke,Ze)=>{const He=fe.featureSortOrder;if(He){const Be=He.indexOf(ke.featureIndex);return He.indexOf(Ze.featureIndex)-Be}return Ze.featureIndex-ke.featureIndex});for(const ke of Ce)Se.push(ke)}}for(const fe in re)re[fe].forEach(de=>{const ve=de.feature,Se=D(g[fe]).getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=Se});return re}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),_.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(r,l){l&&l.filter&&this._validate(c.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const m=this._getSourceCaches(r);let x=[];for(const E of m)x=x.concat(De(E,l));return x}addSourceType(r,l,m){return Zi.getSourceType(r)?m(new Error(`A source type called "${r}" already exists.`)):(Zi.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const m=this.light.getLight();let x=!1;for(const p in r)if(!Pe(r[p],m[p])){x=!0;break}if(!x)return;const E=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,l),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,l=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===l){if("object"==typeof r.source){const m="terrain-dem-src";this.addSource(m,r.source),r=c.clone$1(r),r=c.extend(r,{source:m})}if(this._validate(c.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(r,l);else{const m=this.terrain,x=m.get();for(const E of Object.keys(c.spec.terrain))!r.hasOwnProperty(E)&&c.spec.terrain[E].default&&(r[E]=c.spec.terrain[E].default);for(const E in r)if(!Pe(r[E],x[E])){m.set(r),this.stylesheet.terrain=r;const p=this._setTransitionParameters({duration:0});m.updateTransitions(p);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const l=this.fog=new xt(r,this.map.transform);this.stylesheet.fog=r;const m=this._setTransitionParameters({duration:0});l.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,m=l.get();0===Object.keys(r).length&&l.set(r);for(const x in r)if(!Pe(r[x],m[x])){l.set(r),this.stylesheet.fog=r;const E=this._setTransitionParameters({duration:0});l.updateTransitions(E);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:c.exported.now(),transition:c.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(m=>this.isLayerDraped(this._layers[m])),l=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){const m=this.terrain=new Kn(r,l);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});m.updateTransitions(x)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];"fill-extrusion"===l.type&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const l=this._layers[r];"symbol"===l.type&&this._updateLayer(l)}}_validate(r,l,m,x,E={}){return(!E||!1!==E.validate)&&bs(this,r.call(c.validateStyle,c.extend({key:l,style:this.serialize(),value:m,styleSpec:c.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const l=this._getSourceCaches(r);for(const m of l)m.clearTiles()}_reloadSource(r){const l=this._getSourceCaches(r);for(const m of l)m.resume(),m.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const l in this._sourceCaches)this._sourceCaches[l].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,m,x,E=!1){let p=!1,_=!1;const g={};for(const w of this._order){const D=this._layers[w];if("symbol"!==D.type)continue;if(!g[D.source]){const O=this._getLayerSourceCache(D);if(!O)continue;g[D.source]=O.getRenderableIds(!0).map(G=>O.getTileByID(G)).sort((G,K)=>K.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(K.tileID)?-1:1))}const A=this.crossTileSymbolIndex.addLayer(D,g[D.source],r.center.lng,r.projection);p=p||A}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),E=E||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new c.Event("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.exported.now(),r.zoom))&&(this.pauseablePlacement=new vi(r,this._order,E,l,m,x,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,g),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.exported.now()),_=!0),p&&this.pauseablePlacement.placement.setStale()),_||p)for(const w of this._order){const D=this._layers[w];"symbol"===D.type&&this.placement.updateLayerOpacities(D,g[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,m){this.imageManager.getImages(l.icons,m),this._updateTilesForChangedImages();const x=E=>{E&&E.setDependencies(l.tileID.key,l.type,l.icons)};x(this._otherSourceCaches[l.source]),x(this._symbolSourceCaches[l.source])}getGlyphs(r,l,m){this.glyphManager.getGlyphs(l.stacks,m)}getResource(r,l,m){return c.makeRequest(l,m)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){const l=this._getSourceCaches(r);return 0===l.length?(this.fire(new c.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):l.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Zi.getSourceType=function(h){return ue[h]},Zi.setSourceType=function(h,r){ue[h]=r},Zi.registerForPluginStateChange=c.registerForPluginStateChange;var Ha="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Vs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",dl="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ya="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",qa="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let ec={},Wa={};const fl=[];ws(Ha,fl),ws(dl,fl),ws(ya,fl),ws(qa,fl),ec=wr("",dl),Wa=wr(qa,ya);const va=wr("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),pl=Ha,oa="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var xa={background:wr("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:wr("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:wr("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:wr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:wr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:wr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:wr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:wr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:wr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:wr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:wr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:wr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:wr("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:wr("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:wr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:wr("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:wr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:wr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:wr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:wr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:wr("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:wr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:wr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:wr("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Vs),skyboxGradient:wr("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Vs),skyboxCapture:wr("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:wr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:wr("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ws(h,r){const l=h.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let m of l)if(m=m.trim(),"#"===m[0]&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=m.split(" ");for(const E of x)r.includes(E)||r.push(E)}}function wr(h,r){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},E=[...fl];return ws(h,E),ws(r,E),{fragmentSource:h=h.replace(l,(p,_,g,w,D)=>(x[D]=!0,"define"===_?`\n#ifndef HAS_UNIFORM_u_${D}\nvarying ${g} ${w} ${D};\n#else\nuniform ${g} ${w} u_${D};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${D}\n    ${g} ${w} ${D} = u_${D};\n#endif\n`)),vertexSource:r=r.replace(l,(p,_,g,w,D)=>{const A="float"===w?"vec2":"vec4",O=D.match(/color/)?"color":A;return x[D]?"define"===_?`\n#ifndef HAS_UNIFORM_u_${D}\nuniform lowp float u_${D}_t;\nattribute ${g} ${A} a_${D};\nvarying ${g} ${w} ${D};\n#else\nuniform ${g} ${w} u_${D};\n#endif\n`:"vec4"===O?`\n#ifndef HAS_UNIFORM_u_${D}\n    ${D} = a_${D};\n#else\n    ${g} ${w} ${D} = u_${D};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${D}\n    ${D} = unpack_mix_${O}(a_${D}, u_${D}_t);\n#else\n    ${g} ${w} ${D} = u_${D};\n#endif\n`:"define"===_?`\n#ifndef HAS_UNIFORM_u_${D}\nuniform lowp float u_${D}_t;\nattribute ${g} ${A} a_${D};\n#else\nuniform ${g} ${w} u_${D};\n#endif\n`:"vec4"===O?`\n#ifndef HAS_UNIFORM_u_${D}\n    ${g} ${w} ${D} = a_${D};\n#else\n    ${g} ${w} ${D} = u_${D};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${D}\n    ${g} ${w} ${D} = unpack_mix_${O}(a_${D}, u_${D}_t);\n#else\n    ${g} ${w} ${D} = u_${D};\n#endif\n`}),staticAttributes:m,usedDefines:E}}class cs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,m,x,E,p,_){this.context=r;let g=this.boundPaintVertexBuffers.length!==x.length;for(let D=0;!g&&D<x.length;D++)this.boundPaintVertexBuffers[D]!==x[D]&&(g=!0);let w=this.boundDynamicVertexBuffers.length!==_.length;for(let D=0;!w&&D<_.length;D++)this.boundDynamicVertexBuffers[D]!==_[D]&&(w=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==m||g||w||this.boundIndexBuffer!==E||this.boundVertexOffset!==p)this.freshBind(l,m,x,E,p,_);else{r.bindVertexArrayOES.set(this.vao);for(const D of _)D&&D.bind();E&&E.dynamicDraw&&E.bind()}}freshBind(r,l,m,x,E,p){let _;const g=r.numAttributes,w=this.context,D=w.gl;if(w.extVertexArrayObject)this.vao&&this.destroy(),this.vao=w.extVertexArrayObject.createVertexArrayOES(),w.bindVertexArrayOES.set(this.vao),_=0,this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=x,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=p;else{_=w.currentNumAttributes||0;for(let A=g;A<_;A++)D.disableVertexAttribArray(A)}l.enableAttributes(D,r),l.bind(),l.setVertexAttribPointers(D,r,E);for(const A of m)A.enableAttributes(D,r),A.bind(),A.setVertexAttribPointers(D,r,E);for(const A of p)A&&(A.enableAttributes(D,r),A.bind(),A.setVertexAttribPointers(D,r,E));x&&x.bind(),w.currentNumAttributes=g}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function sa(h,r){const l=Math.pow(2,r.canonical.z),m=r.canonical.y;return[new c.MercatorCoordinate(0,m/l).toLngLat().lat,new c.MercatorCoordinate(0,(m+1)/l).toLngLat().lat]}function $s(h,r,l,m,x,E,p){const _=h.context,g=_.gl,w=l.fbo;if(!w)return;h.prepareDrawTile();const D=h.useProgram("hillshade");_.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,w.colorAttachment.get());const A=((re,Q,oe,fe)=>{const de=oe.paint.get("hillshade-shadow-color"),ve=oe.paint.get("hillshade-highlight-color"),Se=oe.paint.get("hillshade-accent-color");let Ce=oe.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===oe.paint.get("hillshade-illumination-anchor")&&(Ce-=re.transform.angle);const ke=!re.options.moving;return{u_matrix:fe||re.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),ke),u_image:0,u_latrange:sa(0,Q.tileID),u_light:[oe.paint.get("hillshade-exaggeration"),Ce],u_shadow:de,u_highlight:ve,u_accent:Se}})(h,l,m,h.terrain?r.projMatrix:null);h.prepareDrawProgram(_,D,r.toUnwrapped());const{tileBoundsBuffer:O,tileBoundsIndexBuffer:G,tileBoundsSegments:K}=h.getTileBoundsBuffers(l);D.draw(_,g.TRIANGLES,x,E,p,c.CullFaceMode.disabled,A,m.id,O,G,K)}function Lo(h,r,l){if(!r.needsDEMTextureUpload)return;const m=h.context,x=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||h.getTileTexture(l.stride);const E=l.getPixels();r.demTexture?r.demTexture.update(E,{premultiply:!1}):r.demTexture=new c.Texture(m,E,x.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Gs(h,r,l,m,x,E){const p=h.context,_=p.gl;if(!r.dem)return;const g=r.dem;if(p.activeTexture.set(_.TEXTURE1),Lo(h,r,g),!r.demTexture)return;r.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const w=g.dim;p.activeTexture.set(_.TEXTURE0);let D=r.fbo;if(!D){const K=new c.Texture(p,{width:w,height:w,data:null},_.RGBA);K.bind(_.LINEAR,_.CLAMP_TO_EDGE),D=r.fbo=p.createFramebuffer(w,w,!0),D.colorAttachment.set(K.texture)}p.bindFramebuffer.set(D.framebuffer),p.viewport.set([0,0,w,w]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:O,tileBoundsSegments:G}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(p,_.TRIANGLES,m,x,E,c.CullFaceMode.disabled,((K,re)=>{const Q=re.stride,oe=c.create();return c.ortho(oe,0,c.EXTENT,-c.EXTENT,0,0,1),c.translate(oe,oe,[0,-c.EXTENT,0]),{u_matrix:oe,u_image:1,u_dimension:[Q,Q],u_zoom:K.overscaledZ,u_unpack:re.unpackVector}})(r.tileID,g),l.id,A,O,G),r.needsHillshadePrepare=!1}const Hs=h=>({u_matrix:new c.UniformMatrix4f(h),u_image0:new c.Uniform1i(h),u_skirt_height:new c.Uniform1f(h)}),ba=(h,r)=>({u_matrix:h,u_image0:0,u_skirt_height:r}),qs=(h,r,l,m,x,E,p,_,g,w,D,A,O,G)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:l,u_zoom_transition:x,u_merc_center:E,u_image0:0,u_frustum_tl:p,u_frustum_tr:_,u_frustum_br:g,u_frustum_bl:w,u_globe_pos:D,u_globe_radius:A,u_viewport:O,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9)});function Ws(h,r){return null!=h&&null!=r&&!(!h.hasData()||!r.hasData())&&null!=h.demTexture&&null!=r.demTexture&&h.tileID.key!==r.tileID.key}const Eo=new class{constructor(){this.operations={}}newMorphing(h,r,l,m,x){if(h in this.operations){const E=this.operations[h];E.to.tileID.key!==l.tileID.key&&(E.queued=l)}else this.operations[h]={startTime:m,phase:0,duration:x,from:r,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const r=this.operations[h];return{from:r.from,to:r.to,phase:r.phase}}update(h){for(const r in this.operations){const l=this.operations[r];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[r];break}}}_nextOp(h,r){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=r,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Xi={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ki(h,r){const l=1<<h.z;return!r&&(0===h.x||h.x===l-1)||0===h.y||h.y===l-1}const Es=h=>({u_matrix:h});function aa(h,r,l,m,x){if(x>0){const E=c.exported.now(),p=(E-h.timeAdded)/x,_=r?(E-r.timeAdded)/x:-1,g=l.getSource(),w=m.coveringZoomLevel({tileSize:g.tileSize,roundZoom:g.roundZoom}),D=!r||Math.abs(r.tileID.overscaledZ-w)>Math.abs(h.tileID.overscaledZ-w),A=D&&h.refreshedUponExpiration?1:c.clamp(D?p:1-_,0,1);return h.refreshedUponExpiration&&p>=1&&(h.refreshedUponExpiration=!1),r?{opacity:1,mix:1-A}:{opacity:A,mix:0}}return{opacity:1,mix:0}}class Ln extends c.SourceCache{constructor(r){const l={type:"raster-dem",maxzoom:r.transform.maxZoom},m=new Pt(vn(),null),x=ne("mock-dem",l,m,r.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class Za extends c.SourceCache{constructor(r){const l=ne("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Pt(vn(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,m){if(r.freezeTileCoverage)return;this.transform=r;const x=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,p)=>{if(E[p.key]="",!this._tiles[p.key]){const _=new c.Tile(p,this._source.tileSize*p.overscaleFactor(),r.tileZoom);_.state="loaded",this._tiles[p.key]=_}return E},{});for(const E in this._tiles)E in x||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(r){const l=this.proxyCachedFBO[r];if(void 0!==l){const m=Object.values(l);this.renderCachePool.push(...m),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ts extends c.OverscaledTileID{constructor(r,l,m){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=m}}class To extends c.Elevation{constructor(r,l){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,x,E]=function(g){const w=new c.StructArrayLayout4i8,D=new c.StructArrayLayout3ui6,A=131;w.reserve(17161),D.reserve(33800);const O=c.EXTENT/128,G=c.EXTENT+O/2,K=G+O;for(let Q=-O;Q<K;Q+=O)for(let oe=-O;oe<K;oe+=O){const fe=oe<0||oe>G||Q<0||Q>G?24575:0,de=c.clamp(Math.round(oe),0,c.EXTENT),ve=c.clamp(Math.round(Q),0,c.EXTENT);w.emplaceBack(de+fe,ve,de,ve)}const re=(Q,oe)=>{const fe=oe*A+Q;D.emplaceBack(fe+1,fe,fe+A),D.emplaceBack(fe+A,fe+A+1,fe+1)};for(let Q=1;Q<129;Q++)for(let oe=1;oe<129;oe++)re(oe,Q);return[0,129].forEach(Q=>{for(let oe=0;oe<130;oe++)re(oe,Q),re(Q,oe)}),[w,D,32768]}(),p=r.context;this.gridBuffer=p.createVertexBuffer(m,c.boundsAttributes.members),this.gridIndexBuffer=p.createIndexBuffer(x),this.gridSegments=c.SegmentVector.simpleSegment(0,0,m.length,x.length),this.gridNoSkirtSegments=c.SegmentVector.simpleSegment(0,0,m.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Za(l.map),this.orthoMatrix=c.create(),c.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,c.EXTENT,0,c.EXTENT,0,1);const _=p.gl;this._overlapStencilMode=new c.StencilMode({func:_.GEQUAL,mask:255},0,255,_.KEEP,_.KEEP,_.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ln(l.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,l,m){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const x=r.terrain.properties;this.sourceCache=0===r.terrain.drapeRenderMode?this._mockSourceCache:r._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const E=()=>{this.sourceCache.used&&c.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const p=this.getScaledDemTileSize();this.sourceCache.update(l,p,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,E(),this._initializing=!0),E(),l.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&c.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=l.getIds().map(g=>{const w=l.getTileByID(g).tileID;return w.projMatrix=m.calculateProjMatrix(w.toUnwrapped()),w});(function(g,w){const D=w.transform.pointCoordinate(w.transform.getCameraPoint()),A=new c.pointGeometry(D.x,D.y);g.sort((O,G)=>{if(G.overscaledZ-O.overscaledZ)return G.overscaledZ-O.overscaledZ;const K=new c.pointGeometry(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),re=new c.pointGeometry(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),Q=A.mult(1<<O.canonical.z);return Q.x-=.5,Q.y-=.5,Q.distSqr(K)-Q.distSqr(re)})})(x,this.painter),this._previousZoom=m.zoom;const E=this.proxyToSource||{};this.proxyToSource={},x.forEach(g=>{this.proxyToSource[g.key]={}}),this.terrainTileForTile={};const p=this._style._sourceCaches;for(const g in p){const w=p[g];if(!w.used||(w!==this.sourceCache&&this.resetTileLookupCache(w.id),this._setupProxiedCoordsForOrtho(w,r[g],E),w.usedForTerrain))continue;const D=r[g];w.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[l.id]=x.map(g=>new Ts(g,g.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1,this._updateTimestamp=c.exported.now();const _={};this._visibleDemTiles=[];for(const g of this.proxyCoords){const w=this.terrainTileForTile[g.key];if(!w)continue;const D=w.tileID.key;D in _||(this._visibleDemTiles.push(w),_[D]=D)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const m=this._findTileCoveringTileID(l,this.sourceCache);m&&(this.terrainTileForTile[l.key]=m)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const m in this.terrainTileForTile){const x=this.terrainTileForTile[m],E=x.dem;!E||x.demTexture&&!x.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),Lo(this.painter,x,E))}}_prepareDemTileUniforms(r,l,m,x){if(!l||null==l.demTexture)return!1;const E=r.tileID.canonical,p=Math.pow(2,l.tileID.canonical.z-E.z),_=x||"";return m[`u_dem_tl${_}`]=[E.x*p%1,E.y*p%1],m[`u_dem_scale${_}`]=p,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,l=r.gl;if(!this._emptyDepthBufferTexture){const m=new c.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new c.Texture(r,m,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const l=this._visibleDemTiles.reduce((m,x)=>{if(!x.dem)return m;const E=x.dem.tree.minimums[0];return E>0&&r++,m+E},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const m=this._getLoadedAreaMinimum(),x=new c.RGBAImage({width:1,height:1},new Uint8Array(c.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(x,{premultiply:!1}):E=this._emptyDEMTexture=new c.Texture(r,x,l.RGBA,{premultiply:!1}),E}setupElevationDraw(r,l,m){const x=this.painter.context,E=x.gl,p=(_=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:c.DEMData.getUnpackVector(_),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var _;p.u_dem_size=this.sourceCache.getSource().tileSize,p.u_exaggeration=this.exaggeration();let g=null,w=null,D=1;if(m&&m.morphing&&this._useVertexMorphing){const A=m.morphing.srcDemTile,O=m.morphing.dstDemTile;D=m.morphing.phase,A&&O&&(this._prepareDemTileUniforms(r,A,p,"_prev")&&(w=A),this._prepareDemTileUniforms(r,O,p)&&(g=O))}if(w&&g?(x.activeTexture.set(E.TEXTURE2),g.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),x.activeTexture.set(E.TEXTURE4),w.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),p.u_dem_lerp=D):(g=this.terrainTileForTile[r.tileID.key],x.activeTexture.set(E.TEXTURE2),(this._prepareDemTileUniforms(r,g,p)?g.demTexture:this.emptyDEMTexture).bind(E.NEAREST,E.CLAMP_TO_EDGE)),x.activeTexture.set(E.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),this._depthFBO&&(p.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),p.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&g){const A=(1<<g.tileID.canonical.z)*c.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;p.u_meter_to_dem=A}if(m&&m.labelPlaneMatrixInv&&(p.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),l.setTerrainUniformValues(x,p),"globe"===this.painter.transform.projection.name){const A=this.globeUniformValues(this.painter.transform,r.tileID.canonical,m&&m.useDenormalizedUpVectorScale);l.setGlobeUniformValues(x,A)}}globeUniformValues(r,l,m){const x=r.projection;return{u_tile_tl_up:x.upVector(l,0,0),u_tile_tr_up:x.upVector(l,c.EXTENT,0),u_tile_br_up:x.upVector(l,c.EXTENT,c.EXTENT),u_tile_bl_up:x.upVector(l,0,c.EXTENT),u_tile_up_scale:m?c.GLOBE_METERS_TO_ECEF:x.upVectorScale(l,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const l=this.painter,m=this.painter.context;0!==r.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,E,p,_,g){if("globe"===x.transform.projection.name)!function(w,D,A,O,G){const K=w.context,re=K.gl;let Q,oe;const fe=w.options.showTerrainWireframe?2:0,de=w.transform,ve=c.globeUseCustomAntiAliasing(w,K,de),Se=(It,et)=>{if(oe===It)return;const ft=[Xi[It],"PROJECTION_GLOBE_VIEW"];ve&&ft.push("CUSTOM_ANTIALIASING"),et&&ft.push(Xi[fe]),Q=w.useProgram("globeRaster",null,ft),oe=It},Ce=w.colorModeForRenderPass(),ke=new c.DepthMode(re.LEQUAL,c.DepthMode.ReadWrite,w.depthRangeFor3D);Eo.update(G);const Ze=c.calculateGlobeMercatorMatrix(de),He=[c.mercatorXfromLng(de.center.lng),c.mercatorYfromLat(de.center.lat)],Be=fe?[!1,!0]:[!1],Lt=w.globeSharedBuffers,Ve=[de.width*c.exported.devicePixelRatio,de.height*c.exported.devicePixelRatio],at=Float32Array.from(de.globeMatrix),nt={useDenormalizedUpVectorScale:!0};if(Be.forEach(It=>{oe=-1;const et=It?re.LINES:re.TRIANGLES;for(const ft of O){const Nt=A.getTile(ft),je=c.StencilMode.disabled,Qe=D.prevTerrainTileForTile[ft.key],_n=D.terrainTileForTile[ft.key];Ws(Qe,_n)&&Eo.newMorphing(ft.key,Qe,_n,G,250),K.activeTexture.set(re.TEXTURE0),Nt.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE);const In=Eo.getMorphValuesForProxy(ft.key),yn=In?1:0;In&&c.extend$1(nt,{morphing:{srcDemTile:In.from,dstDemTile:In.to,phase:c.easeCubicInOut(In.phase)}});const Nn=c.tileCornersToBounds(ft.canonical),ir=c.getLatitudinalLod(Nn.getCenter().lat),Tn=c.getGridMatrix(ft.canonical,Nn,ir,de.worldSize/de._pixelsPerMercatorPixel),an=c.globeNormalizeECEF(c.globeTileBounds(ft.canonical)),Gr=qs(de.projMatrix,at,Ze,an,c.globeToMercatorTransition(de.zoom),He,de.frustumCorners.TL,de.frustumCorners.TR,de.frustumCorners.BR,de.frustumCorners.BL,de.globeCenterInViewSpace,de.globeRadius,Ve,Tn);if(Se(yn,It),D.setupElevationDraw(Nt,Q,nt),w.prepareDrawProgram(K,Q,ft.toUnwrapped()),Lt){const[Mr,oi,Hr]=It?Lt.getWirefameBuffers(w.context,ir):Lt.getGridBuffers(ir);Q.draw(K,et,ke,je,Ce,c.CullFaceMode.backCCW,Gr,"globe_raster",Mr,oi,Hr)}}}),Lt){const It=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ve&&It.push("CUSTOM_ANTIALIASING"),Q=w.useProgram("globeRaster",null,It);for(const et of O){const{x:ft,y:Nt,z:je}=et.canonical,Qe=0===Nt,_n=Nt===(1<<je)-1,[In,yn,Nn,ir]=Lt.getPoleBuffers(je);if(ir&&(Qe||_n)){const Tn=A.getTile(et);K.activeTexture.set(re.TEXTURE0),Tn.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE);let an=c.globePoleMatrixForTile(je,ft,de);const Gr=c.globeNormalizeECEF(c.globeTileBounds(et.canonical)),Mr=(oi,Hr)=>oi.draw(K,re.TRIANGLES,ke,c.StencilMode.disabled,Ce,c.CullFaceMode.disabled,qs(de.projMatrix,an,an,Gr,0,He,de.frustumCorners.TL,de.frustumCorners.TR,de.frustumCorners.BR,de.frustumCorners.BL,de.globeCenterInViewSpace,de.globeRadius,Ve),"globe_pole_raster",Hr,Nn,ir);D.setupElevationDraw(Tn,Q,nt),w.prepareDrawProgram(K,Q,et.toUnwrapped()),Qe&&Mr(Q,In),_n&&(an=c.scale(c.create(),an,[1,-1,1]),Mr(Q,yn))}}}}(x,E,p,_,g);else{const w=x.context,D=w.gl;let A,O;const G=x.options.showTerrainWireframe?2:0,K=(de,ve)=>{if(O===de)return;const Se=[Xi[de]];ve&&Se.push(Xi[G]),A=x.useProgram("terrainRaster",null,Se),O=de},re=x.colorModeForRenderPass(),Q=new c.DepthMode(D.LEQUAL,c.DepthMode.ReadWrite,x.depthRangeFor3D);Eo.update(g);const oe=x.transform,fe=6*Math.pow(1.5,22-oe.zoom)*E.exaggeration();(G?[!1,!0]:[!1]).forEach(de=>{O=-1;const ve=de?D.LINES:D.TRIANGLES,[Se,Ce]=de?E.getWirefameBuffer():[E.gridIndexBuffer,E.gridSegments];for(const ke of _){const Ze=p.getTile(ke),He=c.StencilMode.disabled,Be=E.prevTerrainTileForTile[ke.key],Lt=E.terrainTileForTile[ke.key];Ws(Be,Lt)&&Eo.newMorphing(ke.key,Be,Lt,g,250),w.activeTexture.set(D.TEXTURE0),Ze.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const Ve=Eo.getMorphValuesForProxy(ke.key),at=Ve?1:0;let nt;Ve&&(nt={morphing:{srcDemTile:Ve.from,dstDemTile:Ve.to,phase:c.easeCubicInOut(Ve.phase)}});const It=ba(ke.projMatrix,Ki(ke.canonical,oe.renderWorldCopies)?fe/10:fe);K(at,de),E.setupElevationDraw(Ze,A,nt),x.prepareDrawProgram(w,A,ke.toUnwrapped()),A.draw(w,ve,Q,He,re,c.CullFaceMode.backCCW,It,"terrain_raster",E.gridBuffer,Se,Ce)}})}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const l=this.painter,m=this.painter.context,x=this.proxySourceCache,E=this.proxiedCoords[x.id],p=this._drapedRenderBatches.shift(),_=[],g=l.style.order;let w=0;for(const D of E){const A=x.getTileByID(D.proxyTileKey),O=x.proxyCachedFBO[D.key]?x.proxyCachedFBO[D.key][r]:void 0,G=void 0!==O?x.renderCache[O]:this.pool[w++],K=void 0!==O;if(A.texture=G.tex,K&&!G.dirty){_.push(A.tileID);continue}let re;m.bindFramebuffer.set(G.fb.framebuffer),this.renderedToTile=!1,G.dirty&&(m.clear({color:c.Color.transparent,stencil:0}),G.dirty=!1);for(let Q=p.start;Q<=p.end;++Q){const oe=l.style._layers[g[Q]];if(oe.isHidden(l.transform.zoom))continue;const fe=l.style._getLayerSourceCache(oe),de=fe?this.proxyToSource[D.key][fe.id]:[D];if(!de)continue;const ve=de;m.viewport.set([0,0,G.fb.width,G.fb.height]),re!==(fe?fe.id:null)&&(this._setupStencil(G,de,oe,fe),re=fe?fe.id:null),l.renderLayer(l,fe,oe,ve)}this.renderedToTile?(G.dirty=!0,_.push(A.tileID)):K||--w,5===w&&(w=0,this.renderToBackBuffer(_))}return this.renderToBackBuffer(_),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),p.end+1}postRender(){}renderCacheEfficiency(r){const l=r.order.length;if(0===l)return{efficiency:100};let m,x=0,E=0,p=!1;for(let _=0;_<l;++_){const g=r._layers[r.order[_]];this._style.isLayerDraped(g)?(p&&++x,++E):p||(p=!0,m=g.id)}return 0===E?{efficiency:100}:{efficiency:100*(1-x/E),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,l,m){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const p=E.tileID,_=1<<p.overscaledZ,{x:g,y:w}=p.canonical,D=g/_,A=(g+1)/_,O=w/_,G=(w+1)/_;return{minx:D,miny:O,maxx:A,maxy:G,t:E.dem.tree.raycastRoot(D,O,A,G,r,l,m),tile:E}});x.sort((E,p)=>(null!==E.t?E.t:Number.MAX_VALUE)-(null!==p.t?p.t:Number.MAX_VALUE));for(const E of x){if(null==E.t)return null;const p=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,r,l,m);if(null!=p)return p}return null}_createFBO(){const r=this.painter.context,l=r.gl,m=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const x=new c.Texture(r,{width:m[0],height:m[1],data:null},l.RGBA);x.bind(l.LINEAR,l.CLAMP_TO_EDGE);const E=r.createFramebuffer(m[0],m[1],!1);return E.colorAttachment.set(x.texture),E.depthAttachment=new Ct(r,E.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:E,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._layers[r],m=l.isHidden(this.painter.transform.zoom);return"custom"!==l.type&&!m&&l.hasTransition()})}_clearRasterFadeFromRenderCache(){let r=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof Y){r=!0;break}if(r)for(let l=0;l<this._style.order.length;++l){const m=this._style._layers[this._style.order[l]],x=m.isHidden(this.painter.transform.zoom),E=this._style._getLayerSourceCache(m);if("raster"!==m.type||x||!E)continue;const p=m.paint.get("raster-fade-duration");for(const _ of this.proxyCoords){const g=this.proxyToSource[_.key][E.id];if(g)for(const w of g){const D=aa(E.getTile(w),E.findLoadedParent(w,0),E,this.painter.transform,p);(1!==D.opacity||0!==D.mix)&&this._clearRenderCacheForTile(E.id,w)}}}}_setupDrapedRenderBatches(){const r=this._style.order,l=r.length;if(0===l)return;const m=[];let x,E=0,p=this._style._layers[r[E]];for(;!this._style.isLayerDraped(p)&&p.isHidden(this.painter.transform.zoom)&&++E<l;)p=this._style._layers[r[E]];for(;E<l;++E){const _=this._style._layers[r[E]];_.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(_)?void 0===x&&(x=E):void 0!==x&&(m.push({start:x,end:E-1}),x=void 0))}void 0!==x&&m.push({start:x,end:E-1}),this._drapedRenderBatches=m}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const p=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let _=0;_<p.length;++_){const g=Object.values(p[_]);l.renderCachePool.push(...g)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,x=this._tilesDirty;for(let p=m.length-1;p>=0;p--){const _=m[p];if(l.getTileByID(_.key),void 0!==l.proxyCachedFBO[_.key]){const g=r[_.key],w=this.proxyToSource[_.key];let D=0;for(const A in w){const O=w[A],G=g[A];if(!G||G.length!==O.length||O.some((K,re)=>K!==G[re]||x[A]&&x[A].hasOwnProperty(K.key))){D=-1;break}++D}for(const A in l.proxyCachedFBO[_.key])l.renderCache[l.proxyCachedFBO[_.key][A]].dirty=D<0||D!==Object.values(g).length}}const E=[...this._drapedRenderBatches];E.sort((p,_)=>_.end-_.start-(p.end-p.start));for(const p of E)for(const _ of m){if(l.proxyCachedFBO[_.key])continue;let g=l.renderCachePool.pop();void 0===g&&l.renderCache.length<50&&(g=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==g&&(l.proxyCachedFBO[_.key]={},l.proxyCachedFBO[_.key][p.start]=g,l.renderCache[g].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,m,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,p=E.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let _;if(m.isTileClipped())_=l.length,this._overlapStencilMode.test={func:p.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);_=1,this._overlapStencilMode.test={func:p.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+_>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=_,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):c.StencilMode.disabled}_renderTileClippingMasks(r,l){const m=this.painter,x=this.painter.context,E=x.gl;m._tileClippingMaskIDs={},x.setColorMode(c.ColorMode.disabled),x.setDepthMode(c.DepthMode.disabled);const p=m.useProgram("clippingMask");for(const _ of r){const g=m._tileClippingMaskIDs[_.key]=--l;p.draw(x,E.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:E.ALWAYS,mask:0},g,255,E.KEEP,E.KEEP,E.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,Es(_.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const m=[r.x,r.y,1,1];c.transformMat4$1(m,m,l.pixelMatrixInverse),c.scale$1(m,m,1/m[3]),m[0]/=l.worldSize,m[1]/=l.worldSize;const x=l._camera.position,E=c.mercatorZfromAltitude(1,l.center.lat),p=[x[0],x[1],x[2]/E,0],_=c.subtract([],m.slice(0,3),p);c.normalize(_,_);const g=this.raycast(p,_,this._exaggeration);return null!==g&&g?(c.scaleAndAdd(p,p,_,g),p[3]=p[2],p[2]*=E,p):null}drawDepth(){const r=this.painter,l=r.context,m=this.proxySourceCache,x=Math.ceil(r.width),E=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===E||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const p=l.gl,_=l.createFramebuffer(x,E,!0);l.activeTexture.set(p.TEXTURE0);const g=new c.Texture(l,{width:x,height:E,data:null},p.RGBA);g.bind(p.NEAREST,p.CLAMP_TO_EDGE),_.colorAttachment.set(g.texture);const w=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,x,E);_.depthAttachment.set(w),this._depthFBO=_,this._depthTexture=g}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,x,E]),function(p,_,g,w){if("globe"===p.transform.projection.name)return;const D=p.context,A=D.gl;D.clear({depth:1});const O=p.useProgram("terrainDepth"),G=new c.DepthMode(A.LESS,c.DepthMode.ReadWrite,p.depthRangeFor3D);for(const K of w){const re=g.getTile(K),Q=ba(K.projMatrix,0);_.setupElevationDraw(re,O),O.draw(D,A.TRIANGLES,G,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.backCCW,Q,"terrain_depth",_.gridBuffer,_.gridIndexBuffer,_.gridNoSkirtSegments)}}(r,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,l,m){if(r.getSource()instanceof Ae)return this._setupProxiedCoordsForImageSource(r,l,m);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const x=this.proxiedCoords[r.id]=[],E=this.proxyCoords;for(let _=0;_<E.length;_++){const g=E[_],w=this._findTileCoveringTileID(g,r);if(w){const D=this._createProxiedId(g,w,m[g.key]&&m[g.key][r.id]);x.push(D),this.proxyToSource[g.key][r.id]=[D]}}let p=!1;for(let _=0;_<l.length;_++){const g=r.getTile(l[_]);if(!g||!g.hasData())continue;const w=this._findTileCoveringTileID(g.tileID,this.proxySourceCache);if(w&&w.tileID.canonical.z!==g.tileID.canonical.z){const D=this.proxyToSource[w.tileID.key][r.id],A=this._createProxiedId(w.tileID,g,m[w.tileID.key]&&m[w.tileID.key][r.id]);D?D.splice(D.length-1,0,A):this.proxyToSource[w.tileID.key][r.id]=[A],x.push(A),p=!0}}this._sourceTilesOverlap[r.id]=p}_setupProxiedCoordsForImageSource(r,l,m){if(!r.getSource().loaded())return;const x=this.proxiedCoords[r.id]=[],E=this.proxyCoords,p=r.getSource(),_=new c.pointGeometry(p.tileID.x,p.tileID.y)._div(1<<p.tileID.z),g=p.coordinates.map(c.MercatorCoordinate.fromLngLat).reduce((D,A)=>(D.min.x=Math.min(D.min.x,A.x-_.x),D.min.y=Math.min(D.min.y,A.y-_.y),D.max.x=Math.max(D.max.x,A.x-_.x),D.max.y=Math.max(D.max.y,A.y-_.y),D),{min:new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),w=(D,A)=>{const O=D.wrap+D.canonical.x/(1<<D.canonical.z),G=D.canonical.y/(1<<D.canonical.z),K=c.EXTENT/(1<<D.canonical.z),re=A.wrap+A.canonical.x/(1<<A.canonical.z),Q=A.canonical.y/(1<<A.canonical.z);return O+K<re+g.min.x||O>re+g.max.x||G+K<Q+g.min.y||G>Q+g.max.y};for(let D=0;D<E.length;D++){const A=E[D];for(let O=0;O<l.length;O++){const G=r.getTile(l[O]);if(!G||!G.hasData()||w(A,G.tileID))continue;const K=this._createProxiedId(A,G,m[A.key]&&m[A.key][r.id]),re=this.proxyToSource[A.key][r.id];re?re.push(K):this.proxyToSource[A.key][r.id]=[K],x.push(K)}}}_createProxiedId(r,l,m){let x=this.orthoMatrix;if(m){const E=m.find(p=>p.key===l.tileID.key);if(E)return E}if(l.tileID.key!==r.key){const E=r.canonical.z-l.tileID.canonical.z;let p,_,g;x=c.create();const w=l.tileID.wrap-r.wrap<<r.overscaledZ;E>0?(p=c.EXTENT>>E,_=p*((l.tileID.canonical.x<<E)-r.canonical.x+w),g=p*((l.tileID.canonical.y<<E)-r.canonical.y)):(p=c.EXTENT<<-E,_=c.EXTENT*(l.tileID.canonical.x-(r.canonical.x+w<<-E)),g=c.EXTENT*(l.tileID.canonical.y-(r.canonical.y<<-E))),c.ortho(x,0,p,0,p,0,1),c.translate(x,x,[_,g,0])}return new Ts(l.tileID,r.key,x)}_findTileCoveringTileID(r,l){let m=l.getTile(r);if(m&&m.hasData())return m;const x=this._findCoveringTileCache[l.id],E=x[r.key];if(m=E?l.getTileByID(E):null,m&&m.hasData()||null===E)return m;let p=m?m.tileID:r,_=p.overscaledZ;const g=l.getSource().minzoom,w=[];if(!E){const A=l.getSource().maxzoom;if(r.canonical.z>=A){const O=r.canonical.z-A;l.getSource().reparseOverscaled?(_=Math.max(r.canonical.z+2,l.transform.tileZoom),p=new c.OverscaledTileID(_,r.wrap,A,r.canonical.x>>O,r.canonical.y>>O)):0!==O&&(_=A,p=new c.OverscaledTileID(_,r.wrap,A,r.canonical.x>>O,r.canonical.y>>O))}p.key!==r.key&&(w.push(p.key),m=l.getTile(p))}const D=A=>{w.forEach(O=>{x[O]=A}),w.length=0};for(_-=1;_>=g&&(!m||!m.hasData());_--){m&&D(m.tileID.key);const A=p.calculateScaledKey(_);if(m=l.getTileByID(A),m&&m.hasData())break;const O=x[A];if(null===O)break;void 0===O?w.push(A):m=l.getTileByID(O)}return D(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let m=this._tilesDirty[r];m||(m=this._tilesDirty[r]={}),m[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(l){let m=0;const x=new c.StructArrayLayout2ui4,E=131;for(let p=1;p<129;p++){for(let _=1;_<129;_++)m=p*E+_,x.emplaceBack(m,m+1),x.emplaceBack(m,m+E),x.emplaceBack(m+1,m+E),128===p&&x.emplaceBack(m+E,m+E+1);x.emplaceBack(m+1,m+1+E)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=c.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class wa{static cacheKey(r,l,m,x){let E=`${l}${x?x.cacheKey:""}`;for(const p of m)r.usedDefines.includes(p)&&(E+=`/${p}`);return E}constructor(r,l,m,x,E,p){const _=r.gl;this.program=_.createProgram();const g=function(Q){const oe=[];for(let fe=0;fe<Q.length;fe++){if(null===Q[fe])continue;const de=Q[fe].split(" ");oe.push(de.pop())}return oe}(m.staticAttributes),w=x?x.getBinderAttributes():[],D=g.concat(w);let A=x?x.defines():[];A=A.concat(p.map(Q=>`#define ${Q}`));const O=A.concat(r.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(oa):oa,oa,pl,va.fragmentSource,Wa.fragmentSource,m.fragmentSource).join("\n"),G=A.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",pl,va.vertexSource,Wa.vertexSource,ec.vertexSource,m.vertexSource).join("\n"),K=_.createShader(_.FRAGMENT_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);_.shaderSource(K,O),_.compileShader(K),_.attachShader(this.program,K);const re=_.createShader(_.VERTEX_SHADER);if(_.isContextLost())this.failedToCreate=!0;else{_.shaderSource(re,G),_.compileShader(re),_.attachShader(this.program,re),this.attributes={},this.numAttributes=D.length;for(let Q=0;Q<this.numAttributes;Q++)D[Q]&&(_.bindAttribLocation(this.program,Q,D[Q]),this.attributes[D[Q]]=Q);_.linkProgram(this.program),_.deleteShader(re),_.deleteShader(K),this.fixedUniforms=E(r),this.binderUniforms=x?x.getUniforms(r):[],p.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new c.Uniform1i(Q=r),u_dem_prev:new c.Uniform1i(Q),u_dem_unpack:new c.Uniform4f(Q),u_dem_tl:new c.Uniform2f(Q),u_dem_scale:new c.Uniform1f(Q),u_dem_tl_prev:new c.Uniform2f(Q),u_dem_scale_prev:new c.Uniform1f(Q),u_dem_size:new c.Uniform1f(Q),u_dem_lerp:new c.Uniform1f(Q),u_exaggeration:new c.Uniform1f(Q),u_depth:new c.Uniform1i(Q),u_depth_size_inv:new c.Uniform2f(Q),u_meter_to_dem:new c.Uniform1f(Q),u_label_plane_matrix_inv:new c.UniformMatrix4f(Q)}),p.includes("GLOBE")&&(this.globeUniforms=(Q=>({u_tile_tl_up:new c.Uniform3f(Q),u_tile_tr_up:new c.Uniform3f(Q),u_tile_br_up:new c.Uniform3f(Q),u_tile_bl_up:new c.Uniform3f(Q),u_tile_up_scale:new c.Uniform1f(Q)}))(r)),p.includes("FOG")&&(this.fogUniforms=(Q=>({u_fog_matrix:new c.UniformMatrix4f(Q),u_fog_range:new c.Uniform2f(Q),u_fog_color:new c.Uniform4f(Q),u_fog_horizon_blend:new c.Uniform1f(Q),u_fog_temporal_offset:new c.Uniform1f(Q),u_frustum_tl:new c.Uniform3f(Q),u_frustum_tr:new c.Uniform3f(Q),u_frustum_br:new c.Uniform3f(Q),u_frustum_bl:new c.Uniform3f(Q),u_globe_pos:new c.Uniform3f(Q),u_globe_radius:new c.Uniform1f(Q),u_globe_transition:new c.Uniform1f(Q),u_is_globe:new c.Uniform1i(Q),u_viewport:new c.Uniform2f(Q)}))(r))}var Q}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in l)m[x]&&m[x].set(this.program,x,l[x])}}setGlobeUniformValues(r,l){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in l)m[x]&&m[x].set(this.program,x,l[x])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in l)m[x].set(this.program,x,l[x])}}draw(r,l,m,x,E,p,_,g,w,D,A,O,G,K,re){const Q=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(m),r.setStencilMode(x),r.setColorMode(E),r.setCullFace(p);for(const fe of Object.keys(this.fixedUniforms))this.fixedUniforms[fe].set(this.program,fe,_[fe]);K&&K.setUniforms(this.program,r,this.binderUniforms,O,{zoom:G});const oe={[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[l];for(const fe of A.get()){const de=fe.vaos||(fe.vaos={});(de[g]||(de[g]=new cs)).bind(r,this,w,K?K.getPaintVertexBuffers():[],D,fe.vertexOffset,re||[]),Q.drawElements(l,fe.primitiveLength*oe,Q.UNSIGNED_SHORT,fe.primitiveOffset*oe*2)}}}function Mi(h,r){const l=Math.pow(2,r.tileID.overscaledZ),m=r.tileSize*Math.pow(2,h.transform.tileZoom)/l,x=m*(r.tileID.canonical.x+r.tileID.wrap*l),E=m*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/Ft(r,1,h.transform.tileZoom),u_pixel_coord_upper:[x>>16,E>>16],u_pixel_coord_lower:[65535&x,65535&E]}}const Ds=c.create(),xi=(h,r,l,m,x,E,p,_,g,w,D)=>{const A=r.style.light,O=A.properties.get("position"),G=[O.x,O.y,O.z],K=c.create$1();"viewport"===A.properties.get("anchor")&&(c.fromRotation(K,-r.transform.angle),c.transformMat3(G,G,K));const re=A.properties.get("color"),Q=r.transform,oe={u_matrix:h,u_lightpos:G,u_lightintensity:A.properties.get("intensity"),u_lightcolor:[re.r,re.g,re.b],u_vertical_gradient:+l,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ds,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:E};return"globe"===Q.projection.name&&(oe.u_tile_id=[p.canonical.x,p.canonical.y,1<<p.canonical.z],oe.u_zoom_transition=g,oe.u_inv_rot_matrix=D,oe.u_merc_center=w,oe.u_up_dir=Q.projection.upVector(new c.CanonicalTileID(0,0,0),w[0]*c.EXTENT,w[1]*c.EXTENT),oe.u_height_lift=_),oe},tc=(h,r,l,m,x,E,p,_,g,w,D,A)=>{const O=xi(h,r,l,m,x,E,p,g,w,D,A),G={u_height_factor:-Math.pow(2,p.overscaledZ)/_.tileSize/8};return c.extend(O,Mi(r,_),G)},Cs=h=>({u_matrix:h}),Yi=(h,r,l)=>c.extend(Cs(h),Mi(r,l)),Fi=(h,r)=>({u_matrix:h,u_world:r}),Xa=(h,r,l,m)=>c.extend(Yi(h,r,l),{u_world:m}),ml=c.create(),Vn=(h,r,l,m,x,E)=>{const p=h.transform,_="globe"===p.projection.name;let g;if("map"===E.paint.get("circle-pitch-alignment"))if(_){const D=c.globePixelsToTileUnits(p.zoom,r.canonical)*p._pixelsPerMercatorPixel;g=Float32Array.from([D,0,0,D])}else g=p.calculatePixelsToTileUnitsMatrix(l);else g=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const w={u_camera_to_center_distance:p.cameraToCenterDistance,u_matrix:h.translatePosMatrix(r.projMatrix,l,E.paint.get("circle-translate"),E.paint.get("circle-translate-anchor")),u_device_pixel_ratio:c.exported.devicePixelRatio,u_extrude_scale:g,u_inv_rot_matrix:ml,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(_){w.u_inv_rot_matrix=m,w.u_merc_center=x,w.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],w.u_zoom_transition=c.globeToMercatorTransition(p.zoom);const D=x[0]*c.EXTENT,A=x[1]*c.EXTENT;w.u_up_dir=p.projection.upVector(new c.CanonicalTileID(0,0,0),D,A)}return w},$r=h=>{const r=[];return"map"===h.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===h.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},Ka=(h,r,l,m)=>{const x=c.EXTENT/l.tileSize;return{u_matrix:h,u_camera_to_center_distance:r.getCameraToCenterDistance(m),u_extrude_scale:[r.pixelsToGLUnits[0]/x,r.pixelsToGLUnits[1]/x]}},Ss=(h,r,l=1)=>({u_matrix:h,u_color:r,u_overlay:0,u_overlay_scale:l}),Ea=c.create(),Zs=(h,r,l,m,x,E,p)=>{const _=h.transform,g="globe"===_.projection.name,w=g?c.globePixelsToTileUnits(_.zoom,r.canonical)*_._pixelsPerMercatorPixel:Ft(l,1,E),D={u_matrix:r.projMatrix,u_extrude_scale:w,u_intensity:p,u_inv_rot_matrix:Ea,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(g){D.u_inv_rot_matrix=m,D.u_merc_center=x,D.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],D.u_zoom_transition=c.globeToMercatorTransition(_.zoom);const A=x[0]*c.EXTENT,O=x[1]*c.EXTENT;D.u_up_dir=_.projection.upVector(new c.CanonicalTileID(0,0,0),A,O)}return D},Ta=(h,r,l,m,x,E,p)=>{const _=h.transform,g=_.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:Rt(h,r,l,m),u_pixels_to_tile_units:g,u_device_pixel_ratio:E,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:dr(l)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Da(r,h.transform),u_alpha_discard_threshold:0,u_trim_offset:p}},us=(h,r,l,m,x)=>{const E=h.transform;return{u_matrix:Rt(h,r,l,m),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:Da(r,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Da(h,r){return 1/Ft(h,1,r.tileZoom)}function Rt(h,r,l,m){return h.translatePosMatrix(m||r.tileID.projMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function dr(h){const r=h.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const kl=(h,r,l,m,x,E)=>{return{u_matrix:h,u_tl_parent:r,u_scale_parent:l,u_fade_t:m.mix,u_opacity:m.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(_=x.paint.get("raster-saturation"),_>0?1-1/(1.001-_):-_),u_contrast_factor:(p=x.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:Ya(x.paint.get("raster-hue-rotate")),u_perspective_transform:E};var p,_};function Ya(h){h*=Math.PI/180;const r=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const zi=c.create(),Ms=(h,r,l,m,x,E,p,_,g,w,D,A,O,G,K,re)=>{const Q=x.transform,oe={u_is_size_zoom_constant:+("constant"===h||"source"===h),u_is_size_feature_constant:+("constant"===h||"camera"===h),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Q.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:Q.width/Q.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:p,u_coord_matrix:_,u_is_text:+g,u_pitch_with_map:+m,u_texsize:w,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:zi,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:zi,u_up_vector:[0,-1,0]};return"globe"===re.name&&(oe.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],oe.u_zoom_transition=A,oe.u_inv_rot_matrix=G,oe.u_merc_center=O,oe.u_camera_forward=Q._camera.forward(),oe.u_ecef_origin=c.globeECEFOrigin(Q.globeMatrix,D.toUnwrapped()),oe.u_tile_matrix=Float32Array.from(Q.globeMatrix),oe.u_up_vector=K),oe},go=(h,r,l,m,x,E,p,_,g,w,D,A,O,G,K,re,Q)=>c.extend(Ms(h,r,l,m,x,E,p,_,g,w,A,O,G,K,re,Q),{u_gamma_scale:m?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:c.exported.devicePixelRatio,u_is_halo:+D}),ii=(h,r,l,m,x,E,p,_,g,w,D,A,O,G,K,re)=>c.extend(go(h,r,l,m,x,E,p,_,!0,g,!0,D,A,O,G,K,re),{u_texsize_icon:w,u_texture_icon:1}),Ol=(h,r,l)=>({u_matrix:h,u_opacity:r,u_color:l}),Ca=(h,r,l,m,x)=>c.extend(function(E,p,_){const g=p.imageManager.getPattern(E.toString()),{width:w,height:D}=p.imageManager.getPixelSize(),A=Math.pow(2,_.tileID.overscaledZ),O=_.tileSize*Math.pow(2,p.transform.tileZoom)/A,G=O*(_.tileID.canonical.x+_.tileID.wrap*A),K=O*_.tileID.canonical.y;return{u_image:0,u_pattern_tl:g.tl,u_pattern_br:g.br,u_texsize:[w,D],u_pattern_size:g.displaySize,u_tile_units_to_pixels:1/Ft(_,1,p.transform.tileZoom),u_pixel_coord_upper:[G>>16,K>>16],u_pixel_coord_lower:[65535&G,65535&K]}}(m,l,x),{u_matrix:h,u_opacity:r}),Fl={fillExtrusion:h=>({u_matrix:new c.UniformMatrix4f(h),u_lightpos:new c.Uniform3f(h),u_lightintensity:new c.Uniform1f(h),u_lightcolor:new c.Uniform3f(h),u_vertical_gradient:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h),u_edge_radius:new c.Uniform1f(h),u_ao:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_up_dir:new c.Uniform3f(h),u_height_lift:new c.Uniform1f(h)}),fillExtrusionPattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_lightpos:new c.Uniform3f(h),u_lightintensity:new c.Uniform1f(h),u_lightcolor:new c.Uniform3f(h),u_vertical_gradient:new c.Uniform1f(h),u_height_factor:new c.Uniform1f(h),u_edge_radius:new c.Uniform1f(h),u_ao:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_up_dir:new c.Uniform3f(h),u_height_lift:new c.Uniform1f(h),u_image:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h)}),fill:h=>({u_matrix:new c.UniformMatrix4f(h)}),fillPattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_image:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h)}),fillOutline:h=>({u_matrix:new c.UniformMatrix4f(h),u_world:new c.Uniform2f(h)}),fillOutlinePattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_world:new c.Uniform2f(h),u_image:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h)}),circle:h=>({u_camera_to_center_distance:new c.Uniform1f(h),u_extrude_scale:new c.UniformMatrix2f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_up_dir:new c.Uniform3f(h)}),collisionBox:h=>({u_matrix:new c.UniformMatrix4f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_extrude_scale:new c.Uniform2f(h)}),collisionCircle:h=>({u_matrix:new c.UniformMatrix4f(h),u_inv_matrix:new c.UniformMatrix4f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_viewport_size:new c.Uniform2f(h)}),debug:h=>({u_color:new c.UniformColor(h),u_matrix:new c.UniformMatrix4f(h),u_overlay:new c.Uniform1i(h),u_overlay_scale:new c.Uniform1f(h)}),clippingMask:h=>({u_matrix:new c.UniformMatrix4f(h)}),heatmap:h=>({u_extrude_scale:new c.Uniform1f(h),u_intensity:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_up_dir:new c.Uniform3f(h)}),heatmapTexture:h=>({u_image:new c.Uniform1i(h),u_color_ramp:new c.Uniform1i(h),u_opacity:new c.Uniform1f(h)}),hillshade:h=>({u_matrix:new c.UniformMatrix4f(h),u_image:new c.Uniform1i(h),u_latrange:new c.Uniform2f(h),u_light:new c.Uniform2f(h),u_shadow:new c.UniformColor(h),u_highlight:new c.UniformColor(h),u_accent:new c.UniformColor(h)}),hillshadePrepare:h=>({u_matrix:new c.UniformMatrix4f(h),u_image:new c.Uniform1i(h),u_dimension:new c.Uniform2f(h),u_zoom:new c.Uniform1f(h),u_unpack:new c.Uniform4f(h)}),line:h=>({u_matrix:new c.UniformMatrix4f(h),u_pixels_to_tile_units:new c.UniformMatrix2f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_units_to_pixels:new c.Uniform2f(h),u_dash_image:new c.Uniform1i(h),u_gradient_image:new c.Uniform1i(h),u_image_height:new c.Uniform1f(h),u_texsize:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h),u_alpha_discard_threshold:new c.Uniform1f(h),u_trim_offset:new c.Uniform2f(h)}),linePattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_texsize:new c.Uniform2f(h),u_pixels_to_tile_units:new c.UniformMatrix2f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_image:new c.Uniform1i(h),u_units_to_pixels:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h),u_alpha_discard_threshold:new c.Uniform1f(h)}),raster:h=>({u_matrix:new c.UniformMatrix4f(h),u_tl_parent:new c.Uniform2f(h),u_scale_parent:new c.Uniform1f(h),u_fade_t:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h),u_image0:new c.Uniform1i(h),u_image1:new c.Uniform1i(h),u_brightness_low:new c.Uniform1f(h),u_brightness_high:new c.Uniform1f(h),u_saturation_factor:new c.Uniform1f(h),u_contrast_factor:new c.Uniform1f(h),u_spin_weights:new c.Uniform3f(h),u_perspective_transform:new c.Uniform2f(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new c.Uniform1i(h),u_is_size_feature_constant:new c.Uniform1i(h),u_size_t:new c.Uniform1f(h),u_size:new c.Uniform1f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_rotate_symbol:new c.Uniform1i(h),u_aspect_ratio:new c.Uniform1f(h),u_fade_change:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_label_plane_matrix:new c.UniformMatrix4f(h),u_coord_matrix:new c.UniformMatrix4f(h),u_is_text:new c.Uniform1i(h),u_pitch_with_map:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_camera_forward:new c.Uniform3f(h),u_tile_matrix:new c.UniformMatrix4f(h),u_up_vector:new c.Uniform3f(h),u_ecef_origin:new c.Uniform3f(h),u_texture:new c.Uniform1i(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new c.Uniform1i(h),u_is_size_feature_constant:new c.Uniform1i(h),u_size_t:new c.Uniform1f(h),u_size:new c.Uniform1f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_rotate_symbol:new c.Uniform1i(h),u_aspect_ratio:new c.Uniform1f(h),u_fade_change:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_label_plane_matrix:new c.UniformMatrix4f(h),u_coord_matrix:new c.UniformMatrix4f(h),u_is_text:new c.Uniform1i(h),u_pitch_with_map:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_texture:new c.Uniform1i(h),u_gamma_scale:new c.Uniform1f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_camera_forward:new c.Uniform3f(h),u_tile_matrix:new c.UniformMatrix4f(h),u_up_vector:new c.Uniform3f(h),u_ecef_origin:new c.Uniform3f(h),u_is_halo:new c.Uniform1i(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new c.Uniform1i(h),u_is_size_feature_constant:new c.Uniform1i(h),u_size_t:new c.Uniform1f(h),u_size:new c.Uniform1f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_rotate_symbol:new c.Uniform1i(h),u_aspect_ratio:new c.Uniform1f(h),u_fade_change:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_label_plane_matrix:new c.UniformMatrix4f(h),u_coord_matrix:new c.UniformMatrix4f(h),u_is_text:new c.Uniform1i(h),u_pitch_with_map:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_texsize_icon:new c.Uniform2f(h),u_texture:new c.Uniform1i(h),u_texture_icon:new c.Uniform1i(h),u_gamma_scale:new c.Uniform1f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_is_halo:new c.Uniform1i(h)}),background:h=>({u_matrix:new c.UniformMatrix4f(h),u_opacity:new c.Uniform1f(h),u_color:new c.UniformColor(h)}),backgroundPattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_opacity:new c.Uniform1f(h),u_image:new c.Uniform1i(h),u_pattern_tl:new c.Uniform2f(h),u_pattern_br:new c.Uniform2f(h),u_texsize:new c.Uniform2f(h),u_pattern_size:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h)}),terrainRaster:Hs,terrainDepth:Hs,skybox:h=>({u_matrix:new c.UniformMatrix4f(h),u_sun_direction:new c.Uniform3f(h),u_cubemap:new c.Uniform1i(h),u_opacity:new c.Uniform1f(h),u_temporal_offset:new c.Uniform1f(h)}),skyboxGradient:h=>({u_matrix:new c.UniformMatrix4f(h),u_color_ramp:new c.Uniform1i(h),u_center_direction:new c.Uniform3f(h),u_radius:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h),u_temporal_offset:new c.Uniform1f(h)}),skyboxCapture:h=>({u_matrix_3f:new c.UniformMatrix3f(h),u_sun_direction:new c.Uniform3f(h),u_sun_intensity:new c.Uniform1f(h),u_color_tint_r:new c.Uniform4f(h),u_color_tint_m:new c.Uniform4f(h),u_luminance:new c.Uniform1f(h)}),globeRaster:h=>({u_proj_matrix:new c.UniformMatrix4f(h),u_globe_matrix:new c.UniformMatrix4f(h),u_normalize_matrix:new c.UniformMatrix4f(h),u_merc_matrix:new c.UniformMatrix4f(h),u_zoom_transition:new c.Uniform1f(h),u_merc_center:new c.Uniform2f(h),u_image0:new c.Uniform1i(h),u_grid_matrix:new c.UniformMatrix3f(h),u_frustum_tl:new c.Uniform3f(h),u_frustum_tr:new c.Uniform3f(h),u_frustum_br:new c.Uniform3f(h),u_frustum_bl:new c.Uniform3f(h),u_globe_pos:new c.Uniform3f(h),u_globe_radius:new c.Uniform1f(h),u_viewport:new c.Uniform2f(h)}),globeAtmosphere:h=>({u_frustum_tl:new c.Uniform3f(h),u_frustum_tr:new c.Uniform3f(h),u_frustum_br:new c.Uniform3f(h),u_frustum_bl:new c.Uniform3f(h),u_horizon:new c.Uniform1f(h),u_transition:new c.Uniform1f(h),u_fadeout_range:new c.Uniform1f(h),u_color:new c.Uniform4f(h),u_high_color:new c.Uniform4f(h),u_space_color:new c.Uniform4f(h),u_star_intensity:new c.Uniform1f(h),u_star_density:new c.Uniform1f(h),u_star_size:new c.Uniform1f(h),u_temporal_offset:new c.Uniform1f(h),u_horizon_angle:new c.Uniform1f(h),u_rotation_matrix:new c.UniformMatrix4f(h)})};let la;function zl(h,r,l,m,x,E,p){const _=h.context,g=_.gl,w=h.transform,D=h.useProgram("collisionBox"),A=[];let O=0,G=0;for(let ve=0;ve<m.length;ve++){const Se=m[ve],Ce=r.getTile(Se),ke=Ce.getBucket(l);if(!ke)continue;const Ze=bo(Se,ke,w);let He=Ze;0===x[0]&&0===x[1]||(He=h.translatePosMatrix(Ze,Ce,x,E));const Be=p?ke.textCollisionBox:ke.iconCollisionBox,Lt=ke.collisionCircleArray;if(Lt.length>0){const Ve=c.create(),at=He;c.mul(Ve,ke.placementInvProjMatrix,w.glCoordMatrix),c.mul(Ve,Ve,ke.placementViewportMatrix),A.push({circleArray:Lt,circleOffset:G,transform:at,invTransform:Ve,projection:ke.getProjection()}),O+=Lt.length/4,G=O}Be&&(h.terrain&&h.terrain.setupElevationDraw(Ce,D),D.draw(_,g.LINES,c.DepthMode.disabled,c.StencilMode.disabled,h.colorModeForRenderPass(),c.CullFaceMode.disabled,Ka(He,w,Ce,ke.getProjection()),l.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,w.zoom,null,[Be.collisionVertexBuffer,Be.collisionVertexBufferExt]))}if(!p||!A.length)return;const K=h.useProgram("collisionCircle"),re=new c.StructArrayLayout2f1f2i16;re.resize(4*O),re._trim();let Q=0;for(const ve of A)for(let Se=0;Se<ve.circleArray.length/4;Se++){const Ce=4*Se,ke=ve.circleArray[Ce+0],Ze=ve.circleArray[Ce+1],He=ve.circleArray[Ce+2],Be=ve.circleArray[Ce+3];re.emplace(Q++,ke,Ze,He,Be,0),re.emplace(Q++,ke,Ze,He,Be,1),re.emplace(Q++,ke,Ze,He,Be,2),re.emplace(Q++,ke,Ze,He,Be,3)}(!la||la.length<2*O)&&(la=function(ve){const Se=2*ve,Ce=new c.StructArrayLayout3ui6;Ce.resize(Se),Ce._trim();for(let ke=0;ke<Se;ke++){const Ze=6*ke;Ce.uint16[Ze+0]=4*ke+0,Ce.uint16[Ze+1]=4*ke+1,Ce.uint16[Ze+2]=4*ke+2,Ce.uint16[Ze+3]=4*ke+2,Ce.uint16[Ze+4]=4*ke+3,Ce.uint16[Ze+5]=4*ke+0}return Ce}(O));const oe=_.createIndexBuffer(la,!0),fe=_.createVertexBuffer(re,c.collisionCircleLayout.members,!0);for(const ve of A){const Se={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(de=w).getCameraToCenterDistance(ve.projection),u_viewport_size:[de.width,de.height]};K.draw(_,g.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,h.colorModeForRenderPass(),c.CullFaceMode.disabled,Se,l.id,fe,oe,c.SegmentVector.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,w.zoom)}var de;fe.destroy(),oe.destroy()}const Ni=c.create();function hs({width:h,height:r,anchor:l,textOffset:m,textScale:x},E){const{horizontalAlign:p,verticalAlign:_}=c.getAnchorAlignment(l),g=-(p-.5)*h,w=-(_-.5)*r,D=c.evaluateVariableOffset(l,m);return new c.pointGeometry((g/x+D[0])*E,(w/x+D[1])*E)}function Ja(h,r,l,m,x,E,p,_,g,w,D){const A=h.text.placedSymbolArray,O=h.text.dynamicLayoutVertexArray,G=h.icon.dynamicLayoutVertexArray,K={},re=h.getProjection(),Q=An(_,re,E),oe=E.elevation,fe=re.upVectorScale(_.canonical,E.center.lat,E.worldSize).metersToTile;O.clear();for(let de=0;de<A.length;de++){const ve=A.get(de),{tileAnchorX:Se,tileAnchorY:Ce,numGlyphs:ke}=ve,He=ve.hidden||!ve.crossTileID||h.allowVerticalPlacement&&!ve.placedOrientation?null:m[ve.crossTileID];if(He){let Be=0,Lt=0,Ve=0;if(oe){const _n=oe?oe.getAtTileOffset(_,Se,Ce):0,[In,yn,Nn]=re.upVector(_.canonical,Se,Ce);Be=_n*In*fe,Lt=_n*yn*fe,Ve=_n*Nn*fe}let[at,nt,It,et]=mi(ve.projectedAnchorX+Be,ve.projectedAnchorY+Lt,ve.projectedAnchorZ+Ve,l?Q:p);const ft=Ut(E.getCameraToCenterDistance(re),et);let Nt=x.evaluateSizeForFeature(h.textSizeData,w,ve)*ft/c.ONE_EM;l&&(Nt*=h.tilePixelRatio/g);const je=hs(He,Nt);l?(({x:at,y:nt,z:It}=re.projectTilePoint(Se+je.x,Ce+je.y,_.canonical)),[at,nt,It]=mi(at+Be,nt+Lt,It+Ve,p)):(r&&je._rotate(-E.angle),at+=je.x,nt+=je.y,It=0);const Qe=h.allowVerticalPlacement&&ve.placedOrientation===c.WritingMode.vertical?Math.PI/2:0;for(let _n=0;_n<ke;_n++)c.addDynamicAttributes(O,at,nt,It,Qe);D&&ve.associatedIconIndex>=0&&(K[ve.associatedIconIndex]={x:at,y:nt,z:It,angle:Qe})}else ti(ke,O)}if(D){G.clear();const de=h.icon.placedSymbolArray;for(let ve=0;ve<de.length;ve++){const Se=de.get(ve),{numGlyphs:Ce}=Se,ke=K[ve];if(Se.hidden||!ke)ti(Ce,G);else{const{x:Ze,y:He,z:Be,angle:Lt}=ke;for(let Ve=0;Ve<Ce;Ve++)c.addDynamicAttributes(G,Ze,He,Be,Lt)}}h.icon.dynamicLayoutVertexBuffer.updateData(G)}h.text.dynamicLayoutVertexBuffer.updateData(O)}function Xs(h,r,l){return l.iconsInText&&r?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Vi(h,r,l,m,x,E,p,_,g,w,D,A){const O=h.context,G=O.gl,K=h.transform,re="map"===_,Q="map"===g,oe=re&&"point"!==l.layout.get("symbol-placement"),fe=re&&!Q&&!oe,de=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let ve=!1;const Se=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),Ce=[c.mercatorXfromLng(K.center.lng),c.mercatorYfromLat(K.center.lat)],ke=l.layout.get("text-variable-anchor"),Ze="globe"===K.projection.name,He=[],Be=[0,-1,0];let Lt=Be;!Ze&&!K.mercatorFromTransition||re||(Lt=function(Ve){const at=Ve._camera.getWorldToCamera(Ve.worldSize,1),nt=c.multiply([],at,Ve.globeMatrix);c.invert(nt,nt);const It=[0,0,0],et=[0,1,0,0];return c.transformMat4$1(et,et,nt),It[0]=et[0],It[1]=et[1],It[2]=et[2],c.normalize(It,It),It}(K));for(const Ve of m){const at=r.getTile(Ve),nt=at.getBucket(l);if(!nt||"mercator"===nt.projection.name&&Ze)continue;const It=x?nt.text:nt.icon;if(!It||nt.fullyClipped||!It.segments.get().length)continue;const et=It.programConfigurations.get(l.id),ft=x||nt.sdfIcons,Nt=x?nt.textSizeData:nt.iconSizeData,je=Q||0!==K.pitch,Qe=c.evaluateSizeForZoom(Nt,K.zoom);let _n,In,yn,Nn,ir=[0,0],Tn=null;if(x)In=at.glyphAtlasTexture,yn=G.LINEAR,_n=at.glyphAtlasTexture.size,nt.iconsInText&&(ir=at.imageAtlasTexture.size,Tn=at.imageAtlasTexture,Nn=je||h.options.rotating||h.options.zooming||"composite"===Nt.kind||"camera"===Nt.kind?G.LINEAR:G.NEAREST);else{const Rs=1!==l.layout.get("icon-size").constantOr(0)||nt.iconsNeedLinear;In=at.imageAtlasTexture,yn=ft||h.options.rotating||h.options.zooming||Rs||je?G.LINEAR:G.NEAREST,_n=at.imageAtlasTexture.size}const an="globe"===nt.projection.name,Gr=an?Lt:Be,Mr=an?c.globeToMercatorTransition(K.zoom):0,oi=An(Ve,nt.getProjection(),K),Hr=K.calculatePixelsToTileUnitsMatrix(at),Js=jn(oi,at.tileID.canonical,Q,re,K,nt.getProjection(),Hr),Qs=h.terrain&&Q&&oe?c.invert(c.create(),Js):Ni,fs=ui(oi,at.tileID.canonical,Q,re,K,nt.getProjection(),Hr),pa=ke&&nt.hasTextData(),gi="none"!==l.layout.get("icon-text-fit")&&pa&&nt.hasIconData();if(oe){const Rs=K.elevation,Aa=Rs?Rs.getAtTileOffsetFunc(Ve,K.center.lat,K.worldSize,nt.getProjection()):null,Pa=Qr(oi,at.tileID.canonical,Q,re,K,nt.getProjection(),Hr);Dn(nt,oi,h,x,Pa,fs,Q,w,Aa,Ve)}const si=oe||x&&ke||gi,Cr=h.translatePosMatrix(oi,at,E,p),so=si?Ni:Js,ps=h.translatePosMatrix(fs,at,E,p,!0),fi=nt.getProjection().createInversionMatrix(K,Ve.canonical),Ps=[];h.terrainRenderModeElevated()&&Q&&Ps.push("PITCH_WITH_MAP_TERRAIN"),an&&Ps.push("PROJECTION_GLOBE_VIEW"),si&&Ps.push("PROJECTED_POS_ON_VIEWPORT");const Du=ft&&0!==l.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let yl;yl=ft?nt.iconsInText?ii(Nt.kind,Qe,fe,Q,h,Cr,so,ps,_n,ir,Ve,Mr,Ce,fi,Gr,nt.getProjection()):go(Nt.kind,Qe,fe,Q,h,Cr,so,ps,x,_n,!0,Ve,Mr,Ce,fi,Gr,nt.getProjection()):Ms(Nt.kind,Qe,fe,Q,h,Cr,so,ps,x,_n,Ve,Mr,Ce,fi,Gr,nt.getProjection());const Ho={program:h.useProgram(Xs(ft,x,nt),et,Ps),buffers:It,uniformValues:yl,atlasTexture:In,atlasTextureIcon:Tn,atlasInterpolation:yn,atlasInterpolationIcon:Nn,isSDF:ft,hasHalo:Du,tile:at,labelPlaneMatrixInv:Qs};if(de&&nt.canOverlap){ve=!0;const Rs=It.segments.get();for(const Aa of Rs)He.push({segments:new c.SegmentVector([Aa]),sortKey:Aa.sortKey,state:Ho})}else He.push({segments:It.segments,sortKey:0,state:Ho})}ve&&He.sort((Ve,at)=>Ve.sortKey-at.sortKey);for(const Ve of He){const at=Ve.state;if(h.terrain&&h.terrain.setupElevationDraw(at.tile,at.program,{useDepthForOcclusion:!Ze,labelPlaneMatrixInv:at.labelPlaneMatrixInv}),O.activeTexture.set(G.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,G.CLAMP_TO_EDGE),at.atlasTextureIcon&&(O.activeTexture.set(G.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),at.isSDF){const nt=at.uniformValues;at.hasHalo&&(nt.u_is_halo=1,Nl(at.buffers,Ve.segments,l,h,at.program,Se,D,A,nt)),nt.u_is_halo=0}Nl(at.buffers,Ve.segments,l,h,at.program,Se,D,A,at.uniformValues)}}function Nl(h,r,l,m,x,E,p,_,g){const w=m.context,D=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer];x.draw(w,w.gl.TRIANGLES,E,p,_,c.CullFaceMode.disabled,g,l.id,h.layoutVertexBuffer,h.indexBuffer,r,l.paint,m.transform.zoom,h.programConfigurations.get(l.id),D)}function Qa(h,r,l,m,x,E,p){const _=h.context.gl,g=l.paint.get("fill-pattern"),w=g&&g.constantOr(1);let D,A,O,G,K;p?(A=w&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=_.LINES):(A=w?"fillPattern":"fill",D=_.TRIANGLES);for(const re of m){const Q=r.getTile(re);if(w&&!Q.patternsLoaded())continue;const oe=Q.getBucket(l);if(!oe)continue;h.prepareDrawTile();const fe=oe.programConfigurations.get(l.id),de=h.useProgram(A,fe);w&&(h.context.activeTexture.set(_.TEXTURE0),Q.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),fe.updatePaintBuffers());const ve=g.constantOr(null);if(ve&&Q.imageAtlas){const Ce=Q.imageAtlas.patternPositions[ve.toString()];Ce&&fe.setConstantPatternPositions(Ce)}const Se=h.translatePosMatrix(re.projMatrix,Q,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(p){G=oe.indexBuffer2,K=oe.segments2;const Ce=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[_.drawingBufferWidth,_.drawingBufferHeight];O="fillOutlinePattern"===A&&w?Xa(Se,h,Q,Ce):Fi(Se,Ce)}else G=oe.indexBuffer,K=oe.segments,O=w?Yi(Se,h,Q):Cs(Se);h.prepareDrawProgram(h.context,de,re.toUnwrapped()),de.draw(h.context,D,x,h.stencilModeForClipping(re),E,c.CullFaceMode.disabled,O,l.id,oe.layoutVertexBuffer,G,K,l.paint,h.transform.zoom,fe)}}function Bl(h,r,l,m,x,E,p){const _=h.context,g=_.gl,w=h.transform,D=l.paint.get("fill-extrusion-pattern"),A=D.constantOr(1),O=l.paint.get("fill-extrusion-opacity"),G=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],K=l.layout.get("fill-extrusion-edge-radius"),re="globe"===w.projection.name?c.fillExtrusionHeightLift():0,Q="globe"===w.projection.name,oe=Q?c.globeToMercatorTransition(w.zoom):0,fe=[c.mercatorXfromLng(w.center.lng),c.mercatorYfromLat(w.center.lat)],de=[];Q&&(de.push("PROJECTION_GLOBE_VIEW"),h.style.terrainSetForDrapingOnly()&&de.push("TERRAIN")),G[0]>0&&de.push("FAUX_AO");for(const ve of m){const Se=r.getTile(ve),Ce=Se.getBucket(l);if(!Ce||Ce.projection.name!==w.projection.name)continue;const ke=Ce.programConfigurations.get(l.id),Ze=h.useProgram(A?"fillExtrusionPattern":"fillExtrusion",ke,de);if(h.terrain){const It=h.terrain;if(h.style.terrainSetForDrapingOnly())It.setupElevationDraw(Se,Ze,{useMeterToDem:!0});else{if(!Ce.enableTerrain)continue;if(It.setupElevationDraw(Se,Ze,{useMeterToDem:!0}),nc(_,r,ve,Ce,l,It),!Ce.centroidVertexBuffer){const et=Ze.attributes.a_centroid_pos;void 0!==et&&g.vertexAttrib2f(et,0,0)}}}A&&(h.context.activeTexture.set(g.TEXTURE0),Se.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),ke.updatePaintBuffers());const He=D.constantOr(null);if(He&&Se.imageAtlas){const It=Se.imageAtlas.patternPositions[He.toString()];It&&ke.setConstantPatternPositions(It)}const Be=h.translatePosMatrix(ve.projMatrix,Se,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Lt=w.projection.createInversionMatrix(w,ve.canonical),Ve=l.paint.get("fill-extrusion-vertical-gradient"),at=A?tc(Be,h,Ve,O,G,K,ve,Se,re,oe,fe,Lt):xi(Be,h,Ve,O,G,K,ve,re,oe,fe,Lt);h.prepareDrawProgram(_,Ze,ve.toUnwrapped());const nt=[];h.terrain&&nt.push(Ce.centroidVertexBuffer),Q&&nt.push(Ce.layoutVertexExtBuffer),Ze.draw(_,_.gl.TRIANGLES,x,E,p,c.CullFaceMode.backCCW,at,l.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,l.paint,h.transform.zoom,ke,nt)}}function nc(h,r,l,m,x,E){const p=[oe=>{let fe=oe.canonical.x-1,de=oe.wrap;return fe<0&&(fe=(1<<oe.canonical.z)-1,de--),new c.OverscaledTileID(oe.overscaledZ,de,oe.canonical.z,fe,oe.canonical.y)},oe=>{let fe=oe.canonical.x+1,de=oe.wrap;return fe===1<<oe.canonical.z&&(fe=0,de++),new c.OverscaledTileID(oe.overscaledZ,de,oe.canonical.z,fe,oe.canonical.y)},oe=>new c.OverscaledTileID(oe.overscaledZ,oe.wrap,oe.canonical.z,oe.canonical.x,(0===oe.canonical.y?1<<oe.canonical.z:oe.canonical.y)-1),oe=>new c.OverscaledTileID(oe.overscaledZ,oe.wrap,oe.canonical.z,oe.canonical.x,oe.canonical.y===(1<<oe.canonical.z)-1?0:oe.canonical.y+1)],_=oe=>{const fe=r.getSource().minzoom,de=Se=>{const Ce=r.getTileByID(Se);if(Ce&&Ce.hasData())return Ce.getBucket(x)},ve=[0,-1,1];for(const Se of ve){if(oe.overscaledZ+Se<fe)continue;const Ce=de(oe.calculateScaledKey(oe.overscaledZ+Se));if(Ce)return Ce}},g=[0,0,0],w=(oe,fe)=>(g[0]=Math.min(oe.min.y,fe.min.y),g[1]=Math.max(oe.max.y,fe.max.y),g[2]=c.EXTENT-fe.min.x>oe.max.x?fe.min.x-c.EXTENT:oe.max.x,g),D=(oe,fe)=>(g[0]=Math.min(oe.min.x,fe.min.x),g[1]=Math.max(oe.max.x,fe.max.x),g[2]=c.EXTENT-fe.min.y>oe.max.y?fe.min.y-c.EXTENT:oe.max.y,g),A=[(oe,fe)=>w(oe,fe),(oe,fe)=>w(fe,oe),(oe,fe)=>D(oe,fe),(oe,fe)=>D(fe,oe)],O=new c.pointGeometry(0,0);let G,K,re;const Q=(oe,fe,de,ve,Se)=>{const Ce=[[ve?de:oe,ve?oe:de,0],[ve?de:fe,ve?fe:de,0]],ke=Se<0?c.EXTENT+Se:Se,Ze=[ve?ke:(oe+fe)/2,ve?(oe+fe)/2:ke,0];return 0===de&&Se<0||0!==de&&Se>0?E.getForTilePoints(re,[Ze],!0,K):Ce.push(Ze),E.getForTilePoints(l,Ce,!0,G),Math.max(Ce[0][2],Ce[1][2],Ze[2])/E.exaggeration()};for(let oe=0;oe<4;oe++){const fe=(oe<2?1:5)-oe,de=m.borders[oe];if(0===de.length)continue;const ve=re=p[oe](l),Se=_(ve);if(!(Se&&Se instanceof c.FillExtrusionBucket&&Se.enableTerrain)||m.borderDoneWithNeighborZ[oe]===Se.canonical.z&&Se.borderDoneWithNeighborZ[fe]===m.canonical.z||(K=E.findDEMTileFor(ve),!K||!K.dem))continue;if(!G){const He=E.findDEMTileFor(l);if(!He||!He.dem)return;G=He}const Ce=Se.borders[fe];let ke=0;const Ze=Se.borderDoneWithNeighborZ[fe]!==m.canonical.z;if(m.canonical.z===Se.canonical.z){for(let He=0;He<de.length;He++){const Be=m.featuresOnBorder[de[He]],Lt=Be.borders[oe];let Ve;for(;ke<Ce.length&&(Ve=Se.featuresOnBorder[Ce[ke]],!(Ve.borders[fe][1]>Lt[0]+3));)Ze&&Se.encodeCentroid(void 0,Ve,!1),ke++;if(Ve&&ke<Ce.length){const at=ke;let nt=0;for(;!(Ve.borders[fe][0]>Lt[1]-3)&&(nt++,++ke!==Ce.length);)Ve=Se.featuresOnBorder[Ce[ke]];if(Ve=Se.featuresOnBorder[Ce[at]],Be.intersectsCount()>1||Ve.intersectsCount()>1||1!==nt){1!==nt&&(ke=at),m.encodeCentroid(void 0,Be,!1),Ze&&Se.encodeCentroid(void 0,Ve,!1);continue}const It=A[oe](Be,Ve),et=oe%2?c.EXTENT-1:0;O.x=Q(It[0],Math.min(c.EXTENT-1,It[1]),et,oe<2,It[2]),O.y=0,m.encodeCentroid(O,Be,!1),Ze&&Se.encodeCentroid(O,Ve,!1)}else m.encodeCentroid(void 0,Be,!1)}m.borderDoneWithNeighborZ[oe]=Se.canonical.z,m.needsCentroidUpdate=!0,Ze&&(Se.borderDoneWithNeighborZ[fe]=m.canonical.z,Se.needsCentroidUpdate=!0)}else{for(const He of de)m.encodeCentroid(void 0,m.featuresOnBorder[He],!1);if(Ze){for(const He of Ce)Se.encodeCentroid(void 0,Se.featuresOnBorder[He],!1);Se.borderDoneWithNeighborZ[fe]=m.canonical.z,Se.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[oe]=Se.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(h)}const el=new c.Color(1,0,0,1),tl=new c.Color(0,1,0,1),gl=new c.Color(0,0,1,1),nl=new c.Color(1,0,1,1),Ul=new c.Color(0,1,1,1);function Sa(h,r,l){const m=h.context,x=h.transform,E=m.gl,p="globe"===x.projection.name,_=p?["PROJECTION_GLOBE_VIEW"]:null;let g=l.projMatrix;if(p&&c.globeToMercatorTransition(x.zoom)>0){const Be=c.transitionTileAABBinECEF(l.canonical,x),Lt=c.globeDenormalizeECEF(Be);g=c.multiply(new Float32Array(16),x.globeMatrix,Lt),c.multiply(g,x.projMatrix,g)}const w=h.useProgram("debug",null,_),D=r.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(D,w);const A=c.DepthMode.disabled,O=c.StencilMode.disabled,G=h.colorModeForRenderPass(),K="$debug";m.activeTexture.set(E.TEXTURE0),h.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),p?D._makeGlobeTileDebugBuffers(h.context,x):D._makeDebugTileBoundsBuffers(h.context,x.projection);const re=D._tileDebugBuffer||h.debugBuffer,Q=D._tileDebugIndexBuffer||h.debugIndexBuffer,oe=D._tileDebugSegments||h.debugSegments;w.draw(m,E.LINE_STRIP,A,O,G,c.CullFaceMode.disabled,Ss(g,c.Color.red),K,re,Q,oe,null,null,null,[D._globeTileDebugBorderBuffer]);const fe=D.latestRawTileData,de=Math.floor((fe&&fe.byteLength||0)/1024),ve=r.getTile(l).tileSize,Se=512/Math.min(ve,512)*(l.overscaledZ/x.zoom)*.5;let Ce=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Ce+=` => ${l.overscaledZ}`),Ce+=` ${de}kb`,function(Be,Lt){Be.initDebugOverlayCanvas();const Ve=Be.debugOverlayCanvas,at=Be.context.gl,nt=Be.debugOverlayCanvas.getContext("2d");nt.clearRect(0,0,Ve.width,Ve.height),nt.shadowColor="white",nt.shadowBlur=2,nt.lineWidth=1.5,nt.strokeStyle="white",nt.textBaseline="top",nt.font="bold 36px Open Sans, sans-serif",nt.fillText(Lt,5,5),nt.strokeText(Lt,5,5),Be.debugOverlayTexture.update(Ve),Be.debugOverlayTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE)}(h,Ce);const ke=D._tileDebugTextBuffer||h.debugBuffer,Ze=D._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,He=D._tileDebugTextSegments||h.debugSegments;w.draw(m,E.TRIANGLES,A,O,c.ColorMode.alphaBlended,c.CullFaceMode.disabled,Ss(g,c.Color.transparent,Se),K,ke,Ze,He,null,null,null,[D._globeTileDebugTextBuffer])}function ca(h,r,l,m){Do(h,0,r+l/2,h.transform.width,l,m)}function ua(h,r,l,m){Do(h,r-l/2,0,l,h.transform.height,m)}function Do(h,r,l,m,x,E){const p=h.context,_=p.gl;_.enable(_.SCISSOR_TEST),_.scissor(r*c.exported.devicePixelRatio,l*c.exported.devicePixelRatio,m*c.exported.devicePixelRatio,x*c.exported.devicePixelRatio),p.clear({color:E}),_.disable(_.SCISSOR_TEST)}const Z=c.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:M}=Z;function P(h,r,l,m){h.emplaceBack(r,l,m)}class U{constructor(r){this.vertexArray=new c.StructArrayLayout3f12,this.indices=new c.StructArrayLayout3ui6,P(this.vertexArray,-1,-1,1),P(this.vertexArray,1,-1,1),P(this.vertexArray,-1,1,1),P(this.vertexArray,1,1,1),P(this.vertexArray,-1,-1,-1),P(this.vertexArray,1,-1,-1),P(this.vertexArray,-1,1,-1),P(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,M),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=c.SegmentVector.simpleSegment(0,0,36,12)}}function ee(h,r,l,m,x,E){const p=h.gl,_=r.paint.get("sky-atmosphere-color"),g=r.paint.get("sky-atmosphere-halo-color"),w=r.paint.get("sky-atmosphere-sun-intensity"),D={u_matrix_3f:c.fromMat4(c.create$1(),m),u_sun_direction:x,u_sun_intensity:w,u_color_tint_r:[(K=_).r,K.g,K.b,K.a],u_color_tint_m:[(re=g).r,re.g,re.b,re.a],u_luminance:5e-5};var K,re;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_CUBE_MAP_POSITIVE_X+E,r.skyboxTexture,0),l.draw(h,p.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.frontCW,D,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const he=c.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class be{constructor(r){const l=new c.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const m=new c.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,he.members),this.indexBuffer=r.createIndexBuffer(m),this.segments=c.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ie={symbol:function(h,r,l,m,x){if("translucent"!==h.renderPass)return;const E=c.StencilMode.disabled,p=h.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(_,g,w,D,A,O,G){const K=g.transform,re="map"===A,Q="map"===O;for(const oe of _){const fe=D.getTile(oe),de=fe.getBucket(w);if(!de||!de.text||!de.text.segments.get().length)continue;const ve=c.evaluateSizeForZoom(de.textSizeData,K.zoom),Se=An(oe,de.getProjection(),K),Ce=K.calculatePixelsToTileUnitsMatrix(fe),ke=jn(Se,fe.tileID.canonical,Q,re,K,de.getProjection(),Ce),Ze="none"!==w.layout.get("icon-text-fit")&&de.hasIconData();if(ve){const He=Math.pow(2,K.zoom-fe.tileID.overscaledZ);Ja(de,re,Q,G,c.symbolSize,K,ke,oe,He,ve,Ze)}}}(m,h,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),x),0!==l.paint.get("icon-opacity").constantOr(1)&&Vi(h,r,l,m,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),E,p),0!==l.paint.get("text-opacity").constantOr(1)&&Vi(h,r,l,m,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),E,p),r.map.showCollisionBoxes&&(zl(h,r,l,m,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),zl(h,r,l,m,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,r,l,m){if("translucent"!==h.renderPass)return;const x=l.paint.get("circle-opacity"),E=l.paint.get("circle-stroke-width"),p=l.paint.get("circle-stroke-opacity"),_=void 0!==l.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===E.constantOr(1)||0===p.constantOr(1)))return;const g=h.context,w=g.gl,D=h.transform,A=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),O=c.StencilMode.disabled,G=h.colorModeForRenderPass(),K="globe"===D.projection.name,re=[c.mercatorXfromLng(D.center.lng),c.mercatorYfromLat(D.center.lat)],Q=[];for(let fe=0;fe<m.length;fe++){const de=m[fe],ve=r.getTile(de),Se=ve.getBucket(l);if(!Se||Se.projection.name!==D.projection.name)continue;const Ce=Se.programConfigurations.get(l.id),ke=$r(l);K&&ke.push("PROJECTION_GLOBE_VIEW");const Ze=h.useProgram("circle",Ce,ke),He=Se.layoutVertexBuffer,Be=Se.globeExtVertexBuffer,Lt=Se.indexBuffer,Ve=D.projection.createInversionMatrix(D,de.canonical),at={programConfiguration:Ce,program:Ze,layoutVertexBuffer:He,globeExtVertexBuffer:Be,indexBuffer:Lt,uniformValues:Vn(h,de,ve,Ve,re,l),tile:ve};if(_){const nt=Se.segments.get();for(const It of nt)Q.push({segments:new c.SegmentVector([It]),sortKey:It.sortKey,state:at})}else Q.push({segments:Se.segments,sortKey:0,state:at})}_&&Q.sort((fe,de)=>fe.sortKey-de.sortKey);const oe={useDepthForOcclusion:!K};for(const fe of Q){const{programConfiguration:de,program:ve,layoutVertexBuffer:Se,globeExtVertexBuffer:Ce,indexBuffer:ke,uniformValues:Ze,tile:He}=fe.state,Be=fe.segments;h.terrain&&h.terrain.setupElevationDraw(He,ve,oe),h.prepareDrawProgram(g,ve,He.tileID.toUnwrapped()),ve.draw(g,w.TRIANGLES,A,O,G,c.CullFaceMode.disabled,Ze,l.id,Se,ke,Be,l.paint,D.zoom,de,[Ce])}},heatmap:function(h,r,l,m){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===h.renderPass){const x=h.context,E=x.gl,p=c.StencilMode.disabled,_=new c.ColorMode([E.ONE,E.ONE],c.Color.transparent,[!0,!0,!0,!0]);(function(G,K,re,Q){const oe=G.gl,fe=K.width*Q,de=K.height*Q;G.activeTexture.set(oe.TEXTURE1),G.viewport.set([0,0,fe,de]);let ve=re.heatmapFbo;if(!ve||ve&&(ve.width!==fe||ve.height!==de)){ve&&ve.destroy();const Se=oe.createTexture();oe.bindTexture(oe.TEXTURE_2D,Se),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_S,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_T,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MIN_FILTER,oe.LINEAR),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MAG_FILTER,oe.LINEAR),ve=re.heatmapFbo=G.createFramebuffer(fe,de,!1),function(Ce,ke,Ze,He,Be,Lt){const Ve=Ce.gl;Ve.texImage2D(Ve.TEXTURE_2D,0,Ve.RGBA,Be,Lt,0,Ve.RGBA,Ce.extRenderToTextureHalfFloat?Ce.extTextureHalfFloat.HALF_FLOAT_OES:Ve.UNSIGNED_BYTE,null),He.colorAttachment.set(Ze)}(G,0,Se,ve,fe,de)}else oe.bindTexture(oe.TEXTURE_2D,ve.colorAttachment.get()),G.bindFramebuffer.set(ve.framebuffer)})(x,h,l,"globe"===h.transform.projection.name?.5:.25),x.clear({color:c.Color.transparent});const g=h.transform,w="globe"===g.projection.name,D=w?["PROJECTION_GLOBE_VIEW"]:null,A=w?c.CullFaceMode.frontCCW:c.CullFaceMode.disabled,O=[c.mercatorXfromLng(g.center.lng),c.mercatorYfromLat(g.center.lat)];for(let G=0;G<m.length;G++){const K=m[G];if(r.hasRenderableParent(K))continue;const re=r.getTile(K),Q=re.getBucket(l);if(!Q||Q.projection.name!==g.projection.name)continue;const oe=Q.programConfigurations.get(l.id),fe=h.useProgram("heatmap",oe,D),{zoom:de}=h.transform;h.terrain&&h.terrain.setupElevationDraw(re,fe),h.prepareDrawProgram(x,fe,K.toUnwrapped());const ve=g.projection.createInversionMatrix(g,K.canonical);fe.draw(x,E.TRIANGLES,c.DepthMode.disabled,p,_,A,Zs(h,K,re,ve,O,de,l.paint.get("heatmap-intensity")),l.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,l.paint,h.transform.zoom,oe,w?[Q.globeExtVertexBuffer]:null)}x.viewport.set([0,0,h.width,h.height])}else"translucent"===h.renderPass&&(h.context.setColorMode(h.colorModeForRenderPass()),function(x,E){const p=x.context,_=p.gl,g=E.heatmapFbo;if(!g)return;p.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,g.colorAttachment.get()),p.activeTexture.set(_.TEXTURE1);let w=E.colorRampTexture;w||(w=E.colorRampTexture=new c.Texture(p,E.colorRamp,_.RGBA)),w.bind(_.LINEAR,_.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(p,_.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,x.colorModeForRenderPass(),c.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:E.paint.get("heatmap-opacity")},E.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,E.paint,x.transform.zoom)}(h,l))},line:function(h,r,l,m){if("translucent"!==h.renderPass)return;const x=l.paint.get("line-opacity"),E=l.paint.get("line-width");if(0===x.constantOr(1)||0===E.constantOr(1))return;const p=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),_=h.colorModeForRenderPass(),g=h.terrain&&h.terrain.renderingToTexture?1:c.exported.devicePixelRatio,w=l.paint.get("line-dasharray"),D=w.constantOr(1),A=l.layout.get("line-cap"),O=l.paint.get("line-pattern"),G=O.constantOr(1),K=l.paint.get("line-gradient"),re=G?"linePattern":"line",Q=h.context,oe=Q.gl,fe=(ve=>{const Se=[];dr(ve)&&Se.push("RENDER_LINE_DASH"),ve.paint.get("line-gradient")&&Se.push("RENDER_LINE_GRADIENT");const Ce=ve.paint.get("line-trim-offset");0===Ce[0]&&0===Ce[1]||Se.push("RENDER_LINE_TRIM_OFFSET");const ke=ve.paint.get("line-pattern").constantOr(1),Ze=1!==ve.paint.get("line-opacity").constantOr(1);return!ke&&Ze&&Se.push("RENDER_LINE_ALPHA_DISCARD"),Se})(l);let de=fe.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(de=!1);for(const ve of m){const Se=r.getTile(ve);if(G&&!Se.patternsLoaded())continue;const Ce=Se.getBucket(l);if(!Ce)continue;h.prepareDrawTile();const ke=Ce.programConfigurations.get(l.id),Ze=h.useProgram(re,ke,fe),He=O.constantOr(null);if(He&&Se.imageAtlas){const ft=Se.imageAtlas.patternPositions[He.toString()];ft&&ke.setConstantPatternPositions(ft)}const Be=w.constantOr(null),Lt=A.constantOr(null);if(!G&&Be&&Lt&&Se.lineAtlas){const ft=Se.lineAtlas.getDash(Be,Lt);ft&&ke.setConstantPatternPositions(ft)}let[Ve,at]=l.paint.get("line-trim-offset");("round"===Lt||"square"===Lt)&&Ve!==at&&(0===Ve&&(Ve-=1),1===at&&(at+=1));const nt=h.terrain?ve.projMatrix:null,It=G?us(h,Se,l,nt,g):Ta(h,Se,l,nt,Ce.lineClipsArray.length,g,[Ve,at]);if(K){const ft=Ce.gradients[l.id];let Nt=ft.texture;if(l.gradientVersion!==ft.version){let je=256;if(l.stepInterpolant){const Qe=r.getSource().maxzoom,_n=ve.canonical.z===Qe?Math.ceil(1<<h.transform.maxZoom-ve.canonical.z):1;je=c.clamp(c.nextPowerOfTwo(Ce.maxLineLength/c.EXTENT*1024*_n),256,Q.maxTextureSize)}ft.gradient=c.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:je,image:ft.gradient||void 0,clips:Ce.lineClipsArray}),ft.texture?ft.texture.update(ft.gradient):ft.texture=new c.Texture(Q,ft.gradient,oe.RGBA),ft.version=l.gradientVersion,Nt=ft.texture}Q.activeTexture.set(oe.TEXTURE1),Nt.bind(l.stepInterpolant?oe.NEAREST:oe.LINEAR,oe.CLAMP_TO_EDGE)}D&&(Q.activeTexture.set(oe.TEXTURE0),Se.lineAtlasTexture.bind(oe.LINEAR,oe.REPEAT),ke.updatePaintBuffers()),G&&(Q.activeTexture.set(oe.TEXTURE0),Se.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),ke.updatePaintBuffers()),h.prepareDrawProgram(Q,Ze,ve.toUnwrapped());const et=ft=>{Ze.draw(Q,oe.TRIANGLES,p,ft,_,c.CullFaceMode.disabled,It,l.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,l.paint,h.transform.zoom,ke,[Ce.layoutVertexBuffer2])};if(de){const ft=h.stencilModeForClipping(ve).ref;0===ft&&h.terrain&&Q.clear({stencil:0});const Nt={func:oe.EQUAL,mask:255};It.u_alpha_discard_threshold=.8,et(new c.StencilMode(Nt,ft,255,oe.KEEP,oe.KEEP,oe.INVERT)),It.u_alpha_discard_threshold=0,et(new c.StencilMode(Nt,ft,255,oe.KEEP,oe.KEEP,oe.KEEP))}else et(h.stencilModeForClipping(ve))}de&&(h.resetStencilClippingMasks(),h.terrain&&Q.clear({stencil:0}))},fill:function(h,r,l,m){const x=l.paint.get("fill-color"),E=l.paint.get("fill-opacity");if(0===E.constantOr(1))return;const p=h.colorModeForRenderPass(),_=l.paint.get("fill-pattern"),g=h.opaquePassEnabledForLayer()&&!_.constantOr(1)&&1===x.constantOr(c.Color.transparent).a&&1===E.constantOr(0)?"opaque":"translucent";if(h.renderPass===g){const w=h.depthModeForSublayer(1,"opaque"===h.renderPass?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly);Qa(h,r,l,m,w,p,!1)}if("translucent"===h.renderPass&&l.paint.get("fill-antialias")){const w=h.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,c.DepthMode.ReadOnly);Qa(h,r,l,m,w,p,!0)}},"fill-extrusion":function(h,r,l,m){const x=l.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===h.renderPass){const E=new c.DepthMode(h.context.gl.LEQUAL,c.DepthMode.ReadWrite,h.depthRangeFor3D);if(1!==x||l.paint.get("fill-extrusion-pattern").constantOr(1))Bl(h,r,l,m,E,c.StencilMode.disabled,c.ColorMode.disabled),Bl(h,r,l,m,E,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const p=h.colorModeForRenderPass();Bl(h,r,l,m,E,c.StencilMode.disabled,p)}}},hillshade:function(h,r,l,m){if("offscreen"!==h.renderPass&&"translucent"!==h.renderPass)return;const x=h.context,E=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),p=h.colorModeForRenderPass(),_=h.terrain&&h.terrain.renderingToTexture,[g,w]="translucent"!==h.renderPass||_?[{},m]:h.stencilConfigForOverlap(m);for(const D of w){const A=r.getTile(D);if(A.needsHillshadePrepare&&"offscreen"===h.renderPass)Gs(h,A,l,E,c.StencilMode.disabled,p);else if("translucent"===h.renderPass){const O=_&&h.terrain?h.terrain.stencilModeForRTTOverlap(D):g[D.overscaledZ];$s(h,D,A,l,E,O,p)}}x.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,r,l,m,x,E){if("translucent"!==h.renderPass||0===l.paint.get("raster-opacity")||!m.length)return;const p=h.context,_=p.gl,g=r.getSource(),w=h.useProgram("raster"),D=h.colorModeForRenderPass(),A=h.terrain&&h.terrain.renderingToTexture,[O,G]=g instanceof Ae||A?[{},m]:h.stencilConfigForOverlap(m),K=G[G.length-1].overscaledZ,re=!h.options.moving;for(const Q of G){const oe=A?c.DepthMode.disabled:h.depthModeForSublayer(Q.overscaledZ-K,1===l.paint.get("raster-opacity")?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly,_.LESS),fe=Q.toUnwrapped(),de=r.getTile(Q);if(A&&(!de||!de.hasData()))continue;const ve=A?Q.projMatrix:h.transform.calculateProjMatrix(fe,re),Se=h.terrain&&A?h.terrain.stencilModeForRTTOverlap(Q):O[Q.overscaledZ],Ce=E?0:l.paint.get("raster-fade-duration");de.registerFadeDuration(Ce);const ke=r.findLoadedParent(Q,0),Ze=aa(de,ke,r,h.transform,Ce);let He,Be;h.terrain&&h.terrain.prepareDrawTile();const Lt="nearest"===l.paint.get("raster-resampling")?_.NEAREST:_.LINEAR;p.activeTexture.set(_.TEXTURE0),de.texture.bind(Lt,_.CLAMP_TO_EDGE),p.activeTexture.set(_.TEXTURE1),ke?(ke.texture.bind(Lt,_.CLAMP_TO_EDGE),He=Math.pow(2,ke.tileID.overscaledZ-de.tileID.overscaledZ),Be=[de.tileID.canonical.x*He%1,de.tileID.canonical.y*He%1]):de.texture.bind(Lt,_.CLAMP_TO_EDGE);const Ve=kl(ve,Be||[0,0],He||1,Ze,l,g instanceof Ae?g.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(p,w,fe),g instanceof Ae)g.boundsBuffer&&g.boundsSegments&&w.draw(p,_.TRIANGLES,oe,c.StencilMode.disabled,D,c.CullFaceMode.disabled,Ve,l.id,g.boundsBuffer,h.quadTriangleIndexBuffer,g.boundsSegments);else{const{tileBoundsBuffer:at,tileBoundsIndexBuffer:nt,tileBoundsSegments:It}=h.getTileBoundsBuffers(de);w.draw(p,_.TRIANGLES,oe,Se,D,c.CullFaceMode.disabled,Ve,l.id,at,nt,It)}}h.resetStencilClippingMasks()},background:function(h,r,l,m){const x=l.paint.get("background-color"),E=l.paint.get("background-opacity");if(0===E)return;const p=h.context,_=p.gl,g=h.transform,w=g.tileSize,D=l.paint.get("background-pattern");if(h.isPatternMissing(D))return;const A=!D&&1===x.a&&1===E&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==A)return;const O=c.StencilMode.disabled,G=h.depthModeForSublayer(0,"opaque"===A?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly),K=h.colorModeForRenderPass(),re=h.useProgram(D?"backgroundPattern":"background");let Q,oe=m;oe||(Q=h.getBackgroundTiles(),oe=Object.values(Q).map(fe=>fe.tileID)),D&&(p.activeTexture.set(_.TEXTURE0),h.imageManager.bind(h.context));for(const fe of oe){const de=fe.toUnwrapped(),ve=m?fe.projMatrix:h.transform.calculateProjMatrix(de);h.prepareDrawTile();const Se=r?r.getTile(fe):Q?Q[fe.key]:new c.Tile(fe,w,g.zoom,h),Ce=D?Ca(ve,E,h,D,{tileID:fe,tileSize:w}):Ol(ve,E,x);h.prepareDrawProgram(p,re,de);const{tileBoundsBuffer:ke,tileBoundsIndexBuffer:Ze,tileBoundsSegments:He}=h.getTileBoundsBuffers(Se);re.draw(p,_.TRIANGLES,G,O,K,c.CullFaceMode.disabled,Ce,l.id,ke,Ze,He)}},sky:function(h,r,l){const m=h.transform,x="mercator"===m.projection.name||"globe"===m.projection.name?1:c.smoothstep(7,8,m.zoom),E=l.paint.get("sky-opacity")*x;if(0===E)return;const p=h.context,_=l.paint.get("sky-type"),g=new c.DepthMode(p.gl.LEQUAL,c.DepthMode.ReadOnly,[0,1]),w=h.frameCounter/1e3%1;"atmosphere"===_?"offscreen"===h.renderPass?l.needsSkyboxCapture(h)&&(function(D,A,O,G){const K=D.context,re=K.gl;let Q=A.skyboxFbo;if(!Q){Q=A.skyboxFbo=K.createFramebuffer(32,32,!1),A.skyboxGeometry=new U(K),A.skyboxTexture=K.gl.createTexture(),re.bindTexture(re.TEXTURE_CUBE_MAP,A.skyboxTexture),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MAG_FILTER,re.LINEAR);for(let ve=0;ve<6;++ve)re.texImage2D(re.TEXTURE_CUBE_MAP_POSITIVE_X+ve,0,re.RGBA,32,32,0,re.RGBA,re.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(Q.framebuffer),K.viewport.set([0,0,32,32]);const oe=A.getCenter(D,!0),fe=D.useProgram("skyboxCapture"),de=new Float64Array(16);c.identity(de),c.rotateY(de,de,.5*-Math.PI),ee(K,A,fe,de,oe,0),c.identity(de),c.rotateY(de,de,.5*Math.PI),ee(K,A,fe,de,oe,1),c.identity(de),c.rotateX(de,de,.5*-Math.PI),ee(K,A,fe,de,oe,2),c.identity(de),c.rotateX(de,de,.5*Math.PI),ee(K,A,fe,de,oe,3),c.identity(de),ee(K,A,fe,de,oe,4),c.identity(de),c.rotateY(de,de,Math.PI),ee(K,A,fe,de,oe,5),K.viewport.set([0,0,D.width,D.height])}(h,l),l.markSkyboxValid(h)):"sky"===h.renderPass&&function(D,A,O,G,K){const re=D.context,Q=re.gl,oe=D.transform,fe=D.useProgram("skybox");re.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,A.skyboxTexture);const de={u_matrix:oe.skyboxMatrix,u_sun_direction:A.getCenter(D,!1),u_cubemap:0,u_opacity:G,u_temporal_offset:K};D.prepareDrawProgram(re,fe),fe.draw(re,Q.TRIANGLES,O,c.StencilMode.disabled,D.colorModeForRenderPass(),c.CullFaceMode.backCW,de,"skybox",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)}(h,l,g,E,w):"gradient"===_&&"sky"===h.renderPass&&function(D,A,O,G,K){const re=D.context,Q=re.gl,oe=D.transform,fe=D.useProgram("skyboxGradient");A.skyboxGeometry||(A.skyboxGeometry=new U(re)),re.activeTexture.set(Q.TEXTURE0);let de=A.colorRampTexture;de||(de=A.colorRampTexture=new c.Texture(re,A.colorRamp,Q.RGBA)),de.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const ve=(Se=oe.skyboxMatrix,Ce=A.getCenter(D,!1),ke=A.paint.get("sky-gradient-radius"),Ze=G,He=K,{u_matrix:Se,u_color_ramp:0,u_center_direction:Ce,u_radius:c.degToRad(ke),u_opacity:Ze,u_temporal_offset:He});var Se,Ce,ke,Ze,He;D.prepareDrawProgram(re,fe),fe.draw(re,Q.TRIANGLES,O,c.StencilMode.disabled,D.colorModeForRenderPass(),c.CullFaceMode.backCW,ve,"skyboxGradient",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)}(h,l,g,E,w)},debug:function(h,r,l){for(let m=0;m<l.length;m++)Sa(h,r,l[m])},custom:function(h,r,l){const m=h.context,x=l.implementation;if(h.transform.projection.unsupportedLayers&&h.transform.projection.unsupportedLayers.includes("custom"))c.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===h.renderPass){const E=x.prerender;E&&(h.setCustomLayerDefaults(),m.setColorMode(h.colorModeForRenderPass()),E.call(x,m.gl,h.transform.customLayerMatrix()),m.setDirty(),h.setBaseState())}else if("translucent"===h.renderPass){h.setCustomLayerDefaults(),m.setColorMode(h.colorModeForRenderPass()),m.setStencilMode(c.StencilMode.disabled);const E="3d"===x.renderingMode?new c.DepthMode(h.context.gl.LEQUAL,c.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,c.DepthMode.ReadOnly);m.setDepthMode(E),x.render(m.gl,h.transform.customLayerMatrix()),m.setDirty(),h.setBaseState(),m.bindFramebuffer.set(null)}}};class tt{constructor(r,l){this.context=new H(r),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=c.SourceCache.maxUnderzooming+c.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Oi,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,l){const m=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new To(this,r));const x=this._terrain;this.transform.elevation=m?x:null,x.update(r,this.transform,l)}_updateFog(r){const l=r.fog;if(!l||"globe"===this.transform.projection.name||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,x]=l.getFovAdjustedRange(this.transform._fov);if(m>x)return void(this.transform.fogCullDistSq=null);const E=m+.78*(x-m);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,l){if(this.width=r*c.exported.devicePixelRatio,this.height=l*c.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const r=this.context,l=new c.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(c.EXTENT,0),l.emplaceBack(0,c.EXTENT),l.emplaceBack(c.EXTENT,c.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(l,c.posAttributes.members),this.tileExtentSegments=c.SegmentVector.simpleSegment(0,0,4,2);const m=new c.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(c.EXTENT,0),m.emplaceBack(0,c.EXTENT),m.emplaceBack(c.EXTENT,c.EXTENT),this.debugBuffer=r.createVertexBuffer(m,c.posAttributes.members),this.debugSegments=c.SegmentVector.simpleSegment(0,0,4,5);const x=new c.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(x,c.posAttributes.members),this.viewportSegments=c.SegmentVector.simpleSegment(0,0,4,2);const E=new c.StructArrayLayout4i8;E.emplaceBack(0,0,0,0),E.emplaceBack(c.EXTENT,0,c.EXTENT,0),E.emplaceBack(0,c.EXTENT,0,c.EXTENT),E.emplaceBack(c.EXTENT,c.EXTENT,c.EXTENT,c.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(E,c.boundsAttributes.members),this.mercatorBoundsSegments=c.SegmentVector.simpleSegment(0,0,4,2);const p=new c.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(p);const _=new c.StructArrayLayout1ui2;for(const w of[0,1,3,2,0])_.emplaceBack(w);this.debugIndexBuffer=r.createIndexBuffer(_),this.emptyTexture=new c.Texture(r,new c.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=c.create();const g=this.context.gl;this.stencilClearMode=new c.StencilMode({func:g.ALWAYS,mask:0},0,255,g.ZERO,g.ZERO,g.ZERO),this.loadTimeStamps.push(c.window.performance.now()),this.atmosphereBuffer=new be(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,l.TRIANGLES,c.DepthMode.disabled,this.stencilClearMode,c.ColorMode.disabled,c.CullFaceMode.disabled,Es(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,m){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let _=!1;for(const g of m)if(void 0===this._tileClippingMaskIDs[g.key]){_=!0;break}if(!_)return}this.currentStencilSource=l.id;const x=this.context,E=x.gl;this.nextStencilID+m.length>256&&this.clearStencil(),x.setColorMode(c.ColorMode.disabled),x.setDepthMode(c.DepthMode.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const _ of m){const g=l.getTile(_),w=this._tileClippingMaskIDs[_.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:A,tileBoundsSegments:O}=this.getTileBoundsBuffers(g);p.draw(x,E.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:E.ALWAYS,mask:0},w,255,E.KEEP,E.KEEP,E.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,Es(_.projMatrix),"$clipping",D,A,O)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new c.StencilMode({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new c.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,m=r.sort((p,_)=>_.overscaledZ-p.overscaledZ),x=m[m.length-1].overscaledZ,E=m[0].overscaledZ-x+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const p={};for(let _=0;_<E;_++)p[_+x]=new c.StencilMode({func:l.GEQUAL,mask:255},_+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=E,[p,m]}return[{[x]:c.StencilMode.disabled},m]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new c.ColorMode([r.CONSTANT_COLOR,r.ONE],new c.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?c.ColorMode.unblended:c.ColorMode.alphaBlended}depthModeForSublayer(r,l,m){if(!this.opaquePassEnabledForLayer())return c.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new c.DepthMode(m||this.context.gl.LEQUAL,l,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(c.exported.now()),this.imageManager.beginFrame();const m=this.style.order,x=this.style._sourceCaches;for(const g in x){const w=x[g];w.used&&w.prepare(this.context)}const E={},p={},_={};for(const g in x){const w=x[g];E[g]=w.getVisibleCoordinates(),p[g]=E[g].slice().reverse(),_[g]=w.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let g=0;g<m.length;g++)if(this.style._layers[m[g]].is3D()){this.opaquePassCutoff=g;break}if(this.terrain&&(this.terrain.updateTileBinding(_),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new c.GlobeSharedBuffers(this.context)),c.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const g of m){const w=this.style._layers[g],D=r._getLayerSourceCache(w);if(!w.hasOffscreenPass()||w.isHidden(this.transform.zoom))continue;const A=D?p[D.id]:void 0;("custom"===w.type||w.isSky()||A&&A.length)&&this.renderLayer(this,D,w,A)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?c.Color.black:c.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const g=this.style._layers[m[this.currentLayer]],w=r._getLayerSourceCache(g);if(g.isSky())continue;const D=w?p[w.id]:void 0;this._renderTileClippingMasks(g,w,D),this.renderLayer(this,w,g,D)}if(this.style.fog&&this.transform.projection.supportsFog&&function(g,w){const D=g.context,A=D.gl,O=g.transform,G=new c.DepthMode(A.LEQUAL,c.DepthMode.ReadOnly,[0,1]),K=g.useProgram("globeAtmosphere",null,"globe"===O.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),re=c.globeToMercatorTransition(O.zoom),Q=w.properties.get("color").toArray01(),oe=w.properties.get("high-color").toArray01(),fe=w.properties.get("space-color").toArray01PremultipliedAlpha(),de=c.identity$1([]);c.rotateY$1(de,de,-c.degToRad(O._center.lng)),c.rotateX$1(de,de,c.degToRad(O._center.lat)),c.rotateZ$1(de,de,O.angle),c.rotateX$1(de,de,-O._pitch);const ve=c.fromQuat(new Float32Array(16),de),Se=c.mapValue(w.properties.get("star-intensity"),0,1,0,.25),ke=c.mapValue(w.properties.get("horizon-blend"),0,1,5e-4,.25),Ze=c.globeUseCustomAntiAliasing(g,D,O)&&5e-4===ke?O.worldSize/(2*Math.PI*1.025)-1:O.globeRadius,He=g.frameCounter/1e3%1,Be=c.length(O.globeCenterInViewSpace),Lt=Math.sqrt(Math.pow(Be,2)-Math.pow(Ze,2)),Ve=Math.acos(Lt/Be),at={u_frustum_tl:O.frustumCorners.TL,u_frustum_tr:O.frustumCorners.TR,u_frustum_br:O.frustumCorners.BR,u_frustum_bl:O.frustumCorners.BL,u_horizon:O.frustumCorners.horizon,u_transition:re,u_fadeout_range:ke,u_color:Q,u_high_color:oe,u_space_color:fe,u_star_intensity:Se,u_star_size:5*c.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:He,u_horizon_angle:Ve,u_rotation_matrix:ve};g.prepareDrawProgram(D,K);const nt=g.atmosphereBuffer;nt&&K.draw(D,A.TRIANGLES,G,c.StencilMode.disabled,c.ColorMode.alphaBlended,c.CullFaceMode.backCW,at,"skybox",nt.vertexBuffer,nt.indexBuffer,nt.segments)}(this,this.style.fog),this.renderPass="sky",(c.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const g=this.style._layers[m[this.currentLayer]],w=r._getLayerSourceCache(g);g.isSky()&&this.renderLayer(this,w,g,w?p[w.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const g=this.style._layers[m[this.currentLayer]],w=r._getLayerSourceCache(g);if(g.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(g)){if(g.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const D=w?("symbol"===g.type?_:p)[w.id]:void 0;this._renderTileClippingMasks(g,w,w?E[w.id]:void 0),this.renderLayer(this,w,g,D),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let g=null;c.values(this.style._layers).forEach(w=>{const D=r._getLayerSourceCache(w);D&&!w.isHidden(this.transform.zoom)&&(!g||g.getSource().maxzoom<D.getSource().maxzoom)&&(g=D)}),g&&this.options.showTileBoundaries&&Ie.debug(this,g,g.getVisibleCoordinates())}this.options.showPadding&&function(g){const w=g.transform.padding;ca(g,g.transform.height-(w.top||0),3,el),ca(g,w.bottom||0,3,tl),ua(g,w.left||0,3,gl),ua(g,g.transform.width-(w.right||0),3,nl);const D=g.transform.centerPoint;var A,O,G,K;Do(A=g,(O=D.x)-1,(G=g.transform.height-D.y)-10,2,20,K=Ul),Do(A,O-10,G-1,20,2,K)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(c.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,l,m,x){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||x&&x.length)&&(this.id=m.id,this.gpuTimingStart(m),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(m.type)||Ie[m.type](r,l,m,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let m=this.gpuTimers[r.id];m||(m=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),m.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,l=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),r.beginQueryEXT(r.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const l={};for(const m in r){const x=r[m],E=this.context.extTimerQuery,p=E.getQueryObjectEXT(x.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(x.query),l[m]=p}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let m=0;for(const x of r)m+=l.getQueryObjectEXT(x,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(x);return m}translatePosMatrix(r,l,m,x,E){if(!m[0]&&!m[1])return r;const p=E?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(p){const w=Math.sin(p),D=Math.cos(p);m=[m[0]*D-m[1]*w,m[0]*w+m[1]*D]}const _=[E?m[0]:Ft(l,m[0],this.transform.zoom),E?m[1]:Ft(l,m[1],this.transform.zoom),0],g=new Float32Array(16);return c.translate(g,r,_),g}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){return null===r||void 0!==r&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,l=this.terrain&&0===this.terrain.exaggeration(),m=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),"globe"===this.transform.projection.name&&x.push("GLOBE"),l&&x.push("ZERO_EXAGGERATION"),m&&!r&&0!==m.getOpacity(this.transform.pitch)&&x.push("FOG"),r&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(r,l,m){this.cache=this.cache||{};const x=m||[],E=this.currentGlobalDefines().concat(x),p=wa.cacheKey(xa[r],r,E,l);return this.cache[p]||(this.cache[p]=new wa(this.context,r,xa[r],l,Fl[r],E)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=c.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,l,m){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const E=x.getOpacity(this.transform.pitch),p=((_,g,w,D,A,O,G,K,re,Q,oe)=>{const fe=_.transform,de=g.properties.get("color").toArray01();de[3]=D;const ve=_.frameCounter/1e3%1;return{u_fog_matrix:w?fe.calculateFogTileMatrix(w):_.identityMat,u_fog_range:g.getFovAdjustedRange(fe._fov),u_fog_color:de,u_fog_horizon_blend:g.properties.get("horizon-blend"),u_fog_temporal_offset:ve,u_frustum_tl:A,u_frustum_tr:O,u_frustum_br:G,u_frustum_bl:K,u_globe_pos:re,u_globe_radius:Q,u_viewport:oe,u_globe_transition:c.globeToMercatorTransition(fe.zoom),u_is_globe:+("globe"===fe.projection.name)}})(this,x,m,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*c.exported.devicePixelRatio,this.transform.height*c.exported.devicePixelRatio]);l.setFogUniformValues(r,p)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,l=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const x of m)l[x.key]=r[x.key]||new c.Tile(x,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class R{constructor(r=0,l=0,m=0,x=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(m)||m<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=m,this.right=x}interpolate(r,l,m){return null!=l.top&&null!=r.top&&(this.top=c.number(r.top,l.top,m)),null!=l.bottom&&null!=r.bottom&&(this.bottom=c.number(r.bottom,l.bottom,m)),null!=l.left&&null!=r.left&&(this.left=c.number(r.left,l.left,m)),null!=l.right&&null!=r.right&&(this.right=c.number(r.right,l.right,m)),this}getCenter(r,l){const m=c.clamp((this.left+r-this.right)/2,0,r),x=c.clamp((this.top+l-this.bottom)/2,0,l);return new c.pointGeometry(m,x)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new R(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function V(h,r){const l=c.getColumn(h,3);c.fromQuat(h,r),c.setColumn(h,3,l)}function z(h,r){const l=c.identity$1([]);return c.rotateZ$1(l,l,-r),c.rotateX$1(l,l,-h),l}function te(h,r){const l=[h[0],h[1],0],m=[r[0],r[1],0];if(c.length(l)>=1e-15){const p=c.normalize([],l);c.scale$2(m,p,c.dot(m,p)),r[0]=m[0],r[1]=m[1]}const x=c.cross([],r,h);if(c.len(x)<1e-15)return null;const E=Math.atan2(-x[1],x[0]);return z(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),E)}class _e{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){const l=r instanceof c.MercatorCoordinate?r:new c.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=c.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(r)):0,x=this.position,E=c.MercatorCoordinate.fromLngLat(r,m),p=[E.x-x.x,E.y-x.y,E.z-x.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=te(p,l)}setPitchBearing(r,l){this.orientation=z(c.degToRad(r),c.degToRad(-l))}}class Fe{constructor(r,l){this._transform=c.identity([]),this.orientation=l,this.position=r}get mercatorPosition(){const r=this.position;return new c.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=c.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&c.setColumn(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||c.identity$1([]),r&&V(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=z(r,l),V(this._transform,this._orientation)}forward(){const r=c.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=c.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=c.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const m=new Float64Array(16);return c.invert(m,this.getWorldToCamera(r,l)),m}getWorldToCameraPosition(r,l,m){const x=this.position;c.scale$2(x,x,-r);const E=new Float64Array(16);return c.fromScaling(E,[m,m,m]),c.translate(E,E,x),E[10]*=l,E}getWorldToCamera(r,l){const m=new Float64Array(16),x=new Float64Array(4),E=this.position;return c.conjugate(x,this._orientation),c.scale$2(E,E,-r),c.fromQuat(m,x),c.translate(m,m,E),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=l,m[9]*=l,m[10]*=l,m[11]*=l,m}getCameraToClipPerspective(r,l,m,x){const E=new Float64Array(16);return c.perspective(E,r,l,m,x),E}getDistanceToElevation(r,l=!1){const m=0===r?0:c.mercatorZfromAltitude(r,l?c.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(m-this.position[2])/x[2]}clone(){return new Fe([...this.position],[...this.orientation])}}function Ge(h,r){const l=bn(h.projection,h.zoom,h.width,h.height),m=function(E,p,_,g,w){const D=new c.LngLat(_.lng-180*zn,_.lat),A=new c.LngLat(_.lng+180*zn,_.lat),O=E.project(D.lng,D.lat),G=E.project(A.lng,A.lat),K=-Math.atan2(G.y-O.y,G.x-O.x),re=c.MercatorCoordinate.fromLngLat(_);re.y=c.clamp(re.y,-.999975,.999975);const Q=re.toLngLat(),oe=E.project(Q.lng,Q.lat),fe=c.MercatorCoordinate.fromLngLat(Q);fe.x+=zn;const de=fe.toLngLat(),ve=E.project(de.lng,de.lat),Se=wn(ve.x-oe.x,ve.y-oe.y,K),Ce=c.MercatorCoordinate.fromLngLat(Q);Ce.y+=zn;const ke=Ce.toLngLat(),Ze=E.project(ke.lng,ke.lat),He=wn(Ze.x-oe.x,Ze.y-oe.y,K),Be=Math.abs(Se.x)/Math.abs(He.y),Lt=c.identity([]);c.rotateZ(Lt,Lt,-K*(1-(w?0:g)));const Ve=c.identity([]);return c.scale(Ve,Ve,[1,1-(1-Be)*g,1]),Ve[4]=-He.x/He.y*g,c.rotateZ(Ve,Ve,K),c.multiply(Ve,Lt,Ve),Ve}(h.projection,0,h.center,l,r),x=jt(h);return c.scale(m,m,[x,x,1]),m}function jt(h){const r=h.projection,l=bn(h.projection,h.zoom,h.width,h.height),m=$n(r,h.center),x=$n(r,c.LngLat.convert(r.center));return Math.pow(2,m*l+(1-l)*x)}function bn(h,r,l,m,x=1/0){const E=h.range;if(!E)return 0;const p=Math.min(x,Math.max(l,m)),_=Math.log(p/1024)/Math.LN2;return c.smoothstep(E[0]+_,E[1]+_,r)}const zn=1/4e4;function $n(h,r){const l=c.clamp(r.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),m=new c.LngLat(r.lng-180*zn,l),x=new c.LngLat(r.lng+180*zn,l),E=h.project(m.lng,l),p=h.project(x.lng,l),_=c.MercatorCoordinate.fromLngLat(m),g=c.MercatorCoordinate.fromLngLat(x),w=p.x-E.x,D=p.y-E.y,A=g.x-_.x,O=g.y-_.y,G=Math.sqrt((A*A+O*O)/(w*w+D*D));return Math.log(G)/Math.LN2}function wn(h,r,l){const m=Math.cos(l),x=Math.sin(l);return{x:h*m-r*x,y:h*x+r*m}}class xr{constructor(r,l,m,x,E,p,_){this.tileSize=512,this._renderWorldCopies=void 0===E||E,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=m??0,this._maxPitch=x??60,this.setProjection(p),this.setMaxBounds(_),this.width=0,this.height=0,this._center=new c.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new R,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Fe,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new xr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,l=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||m)&&this._updateCameraOnTerrain(),(r||m)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return c.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=c.getProjection(this.projectionOptions);const m=!Pe(l,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=c.getProjection({name:"mercator"});const l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return c.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.pointGeometry(this.width,this.height)}get bearing(){return c.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const l=-r*Math.PI/180;var m,x,E,p,_,g,w,D,A,O;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(m=new c.ARRAY_TYPE(4),c.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),x=this.rotationMatrix,p=this.angle,_=(E=this.rotationMatrix)[0],g=E[1],w=E[2],D=E[3],A=Math.sin(p),O=Math.cos(p),x[0]=_*O+w*A,x[1]=g*O+D*A,x[2]=_*-A+w*O,x[3]=g*-A+D*O)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=c.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=c.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let x=0,E=0;for(let p=0;p<l.length;p++){const _=new c.pointGeometry(l[p][0]*this.width,m+l[p][1]*(this.height-m)),g=r.pointCoordinate(_);if(!g)continue;const w=1/Math.hypot(g[0]-this._camera.position[0],g[1]-this._camera.position[1]);x+=g[3]*w,E+=w}return 0===E?NaN:x/E}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*l,x=this._mercatorZfromZoom(r),E=this._mercatorZfromZoom(this._maxZoom),p=Math.max(x-m,E);this._setZoom(this._zoomFromMercatorZ(p))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let m;m=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const x=c.length(c.sub([],this._camera.position,m));return c.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!c.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const m=[r.position.x,r.position.y,r.position.z];c.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new _e;return l.position=new c.MercatorCoordinate(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!c.length$1(r))return!1;c.normalize$1(r,r);const l=c.transformQuat([],[0,0,-1],r),m=c.transformQuat([],[0,-1,0],r);if(m[2]<0)return!1;const x=te(l,m);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;r[2]=c.clamp(r[2],x/m,x/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,m){this._unmodified=!1,this._edgeInsets.interpolate(r,l,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new c.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const m=this.pointCoordinate(new c.pointGeometry(0,0)),x=this.pointCoordinate(new c.pointGeometry(this.width,0)),E=this.pointCoordinate(new c.pointGeometry(this.width,this.height)),p=this.pointCoordinate(new c.pointGeometry(0,this.height)),_=Math.floor(Math.min(m.x,x.x,E.x,p.x)),g=Math.floor(Math.max(m.x,x.x,E.x,p.x)),w=1;for(let D=_-w;D<=g+w;D++)0!==D&&l.push(new c.UnwrappedTileID(D,r))}return l}coveringTiles(r){let l=this.coveringZoomLevel(r);const m=l,x=this.elevation&&!r.isTerrainDEM,E="mercator"===this.projection.name;if(void 0!==r.minzoom&&l<r.minzoom)return[];void 0!==r.maxzoom&&l>r.maxzoom&&(l=r.maxzoom);const p=this.locationCoordinate(this.center),_=this.center.lat,g=1<<l,w=[g*p.x,g*p.y,0],D="globe"===this.projection.name,A=!D,O=c.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,A),G=D?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=g*c.mercatorZfromAltitude(1,this.center.lat),re=this._camera.position[2]/c.mercatorZfromAltitude(1,this.center.lat),Q=[g*G.x,g*G.y,re*(A?1:K)],oe=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),fe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,de=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ve=r.isTerrainDEM?-de:this._elevation?this._elevation.getMinElevationBelowMSL():0,Se=this.projection.isReprojectedInTileSpace?jt(this):1,Ce=et=>{const Nt=new c.MercatorCoordinate(et.x+25e-6,et.y,et.z),je=new c.MercatorCoordinate(et.x,et.y+25e-6,et.z),Qe=et.toLngLat(),_n=Nt.toLngLat(),In=je.toLngLat(),yn=this.locationCoordinate(Qe),Nn=this.locationCoordinate(_n),ir=this.locationCoordinate(In),Tn=Math.hypot(Nn.x-yn.x,Nn.y-yn.y),an=Math.hypot(ir.x-yn.x,ir.y-yn.y);return Math.sqrt(Tn*an)*Se/25e-6},ke=et=>{const ft=de,Nt=ve;return{aabb:c.tileAABB(this,g,0,0,0,et,Nt,ft,this.projection),zoom:0,x:0,y:0,minZ:Nt,maxZ:ft,wrap:et,fullyVisible:!1}},Ze=[];let He=[];const Be=l,Lt=r.reparseOverscaled?m:l,Ve=et=>et*et,at=Ve((re-this._centerAltitude)*K),nt=et=>{if(!this._elevation||!et.tileID||!E)return;const ft=this._elevation.getMinMaxForTile(et.tileID),Nt=et.aabb;ft?(Nt.min[2]=ft.min,Nt.max[2]=ft.max,Nt.center[2]=(Nt.min[2]+Nt.max[2])/2):(et.shouldSplit=It(et),et.shouldSplit||(Nt.min[2]=Nt.max[2]=Nt.center[2]=this._centerAltitude))},It=et=>{if(et.zoom<fe)return!0;if(et.zoom===Be)return!1;if(null!=et.shouldSplit)return et.shouldSplit;const ft=et.aabb.distanceX(Q),Nt=et.aabb.distanceY(Q);let je=at,Qe=1;if(D){je=Ve(et.aabb.distanceZ(Q));const yn=Math.pow(2,et.zoom),Nn=c.latFromMercatorY((et.y+1)/yn),ir=c.latFromMercatorY(et.y/yn),Tn=Math.min(Math.max(_,Nn),ir),an=c.circumferenceAtLatitude(Tn)/c.circumferenceAtLatitude(_);if(Qe=Tn===_?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,an/this._mercatorScaleRatio),this.zoom<=c.GLOBE_ZOOM_THRESHOLD_MIN&&et.zoom===Be-1&&an>=.9)return!0}else if(x&&(je=Ve(et.aabb.distanceZ(Q)*K)),this.projection.isReprojectedInTileSpace&&m<=5){const yn=Math.pow(2,et.zoom),Nn=Ce(new c.MercatorCoordinate((et.x+.5)/yn,(et.y+.5)/yn));Qe=Nn>.85?1:Nn}const _n=ft*ft+Nt*Nt+je;return _n<Ve((1<<Be-et.zoom)*oe*Qe*((yn,Nn)=>{if(Nn*Ve(.707)<yn)return 1;const ir=Math.sqrt(Nn/yn);return ir/(1.4144271570014144+(Math.pow(1.1,ir-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(je,at),_n))};if(this.renderWorldCopies)for(let et=1;et<=3;et++)Ze.push(ke(-et)),Ze.push(ke(et));for(Ze.push(ke(0));Ze.length>0;){const et=Ze.pop(),ft=et.x,Nt=et.y;let je=et.fullyVisible;if(!je){const Qe=et.aabb.intersects(O);if(0===Qe)continue;je=2===Qe}if(et.zoom!==Be&&It(et))for(let Qe=0;Qe<4;Qe++){const _n=(ft<<1)+Qe%2,In=(Nt<<1)+(Qe>>1),yn={aabb:E?et.aabb.quadrant(Qe):c.tileAABB(this,g,et.zoom+1,_n,In,et.wrap,et.minZ,et.maxZ,this.projection),zoom:et.zoom+1,x:_n,y:In,wrap:et.wrap,fullyVisible:je,tileID:void 0,shouldSplit:void 0,minZ:et.minZ,maxZ:et.maxZ};x&&!D&&(yn.tileID=new c.OverscaledTileID(et.zoom+1===Be?Lt:et.zoom+1,et.wrap,et.zoom+1,_n,In),nt(yn)),Ze.push(yn)}else{const Qe=et.zoom===Be?Lt:et.zoom;if(r.minzoom&&r.minzoom>Qe)continue;const _n=w[0]-(.5+ft+(et.wrap<<et.zoom))*(1<<l-et.zoom),In=w[1]-.5-Nt,yn=et.tileID?et.tileID:new c.OverscaledTileID(Qe,et.wrap,et.zoom,ft,Nt);He.push({tileID:yn,distanceSq:_n*_n+In*In})}}if(this.fogCullDistSq){const et=this.fogCullDistSq,ft=this.horizonLineFromTop();He=He.filter(Nt=>{const je=[0,0,0,1],Qe=[c.EXTENT,c.EXTENT,0,1],_n=this.calculateFogTileMatrix(Nt.tileID.toUnwrapped());c.transformMat4$1(je,je,_n),c.transformMat4$1(Qe,Qe,_n);const In=c.getAABBPointSquareDist(je,Qe);if(0===In)return!0;let yn=!1;const Nn=this._elevation;if(Nn&&In>et&&0!==ft){const ir=this.calculateProjMatrix(Nt.tileID.toUnwrapped());let Tn;r.isTerrainDEM||(Tn=Nn.getMinMaxForTile(Nt.tileID)),Tn||(Tn={min:ve,max:de});const an=c.furthestTileCorner(this.rotation),Gr=[an[0]*c.EXTENT,an[1]*c.EXTENT,Tn.max];c.transformMat4(Gr,Gr,ir),yn=(1-Gr[1])*this.height*.5<ft}return In<et||yn})}return He.sort((et,ft)=>et.distanceSq-ft.distanceSq).map(et=>et.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=c.clamp(r.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),m=this.projection.project(r.lng,l);return new c.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,l){let m,x;const E=this.centerPoint;if("globe"===this.projection.name){const _=this.worldSize;m=(l.x-E.x)/_,x=(l.y-E.y)/_}else{const _=this.pointCoordinate(l),g=this.pointCoordinate(E);m=_.x-g.x,x=_.y-g.y}const p=this.locationCoordinate(r);this.setLocation(new c.MercatorCoordinate(p.x-m,p.y-x))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,l){const m=l?c.mercatorZfromAltitude(l,r.lat):void 0,x=this.projection.project(r.lng,r.lat);return new c.MercatorCoordinate(x.x,x.y,m)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){const m=l??this._centerAltitude,x=[r.x,r.y,0,1],E=[r.x,r.y,1,1];c.transformMat4$1(x,x,this.pixelMatrixInverse),c.transformMat4$1(E,E,this.pixelMatrixInverse);const p=E[3];c.scale$1(x,x,1/x[3]),c.scale$1(E,E,1/p);const _=x[2],g=E[2];return{p0:x,p1:E,t:_===g?0:(m-_)/(g-_)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],m=[r.x,r.y,1,1];return c.transformMat4$1(l,l,this.pixelMatrixInverse),c.transformMat4$1(m,m,this.pixelMatrixInverse),c.scale$1(l,l,1/l[3]),c.scale$1(m,m,1/m[3]),l[2]=c.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,m[2]=c.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,c.scale$1(l,l,1/this.worldSize),c.scale$1(m,m,1/this.worldSize),new c.Ray([l[0],l[1],l[2]],c.normalize([],c.sub([],m,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:m,t:x}=r,E=c.mercatorZfromAltitude(l[2],this._center.lat),p=c.mercatorZfromAltitude(m[2],this._center.lat);return new c.MercatorCoordinate(c.number(l[0],m[0],x)/this.worldSize,c.number(l[1],m[1],x)/this.worldSize,c.number(E,p,x))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let l=this.projection.pointCoordinate3D(this,r.x,r.y);if(l)return new c.MercatorCoordinate(l[0],l[1],l[2]);let m=0,x=this.horizonLineFromTop();if(r.y>x)return this.pointCoordinate(r);const E=.02*x,p=r.clone();for(let _=0;_<10&&x-m>E;_++){p.y=c.number(m,x,.66);const g=this.projection.pointCoordinate3D(this,p.x,p.y);g?(x=p.y,l=g):m=p.y}return l?new c.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,l){const m=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,x=[r.x*this.worldSize,r.y*this.worldSize,m+r.toAltitude(),1];return c.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new c.pointGeometry(x[0]/x[3],x[1]/x[3]):new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:r,left:l}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,E=this.pointCoordinate3D(new c.pointGeometry(l,r)),p=this.pointCoordinate3D(new c.pointGeometry(x,r)),_=this.pointCoordinate3D(new c.pointGeometry(x,m)),g=this.pointCoordinate3D(new c.pointGeometry(l,m));let w=Math.min(E.x,g.x),D=Math.max(p.x,_.x),A=Math.min(E.y,p.y),O=Math.max(g.y,_.y);const G=Math.pow(2,-this.zoom)/16,K=(Ce,ke,Ze,He)=>{const Be=(Ce+Ze)/2,Lt=(ke+He)/2,Ve=new c.pointGeometry(Be,Lt),at=this.pointCoordinate3D(Ve),nt=Math.max(0,w-at.x,A-at.y,at.x-D,at.y-O);w=Math.min(w,at.x),D=Math.max(D,at.x),A=Math.min(A,at.y),O=Math.max(O,at.y),nt>G&&(K(Ce,ke,Be,Lt),K(Be,Lt,Ze,He))};K(l,r,x,r),K(x,r,x,m),K(x,m,l,m),K(l,m,l,r);const[re,Q]=c.polesInViewport(this),oe=re||Q,fe=re?90:c.latFromMercatorY(A),de=oe?180:c.lngFromMercatorX(D),ve=Q?-90:c.latFromMercatorY(O),Se=oe?-180:c.lngFromMercatorX(w);return new c.LngLatBounds(new c.LngLat(Se,ve),new c.LngLat(de,fe))}_getBounds(r,l){if("globe"===this.projection.name)return this._getGlobeBounds();const m=new c.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),x=new c.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),E=new c.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),p=new c.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let _=this.pointCoordinate(m,r),g=this.pointCoordinate(x,r);const w=this.pointCoordinate(E,l),D=this.pointCoordinate(p,l),A=(O,G)=>(G.y-O.y)/(G.x-O.x);return _.y>1&&g.y>=0?_=new c.MercatorCoordinate((1-D.y)/A(D,_)+D.x,1):_.y<0&&g.y<=1&&(_=new c.MercatorCoordinate(-D.y/A(D,_)+D.x,0)),g.y>1&&_.y>=0?g=new c.MercatorCoordinate((1-w.y)/A(w,g)+w.x,1):g.y<0&&_.y<=1&&(g=new c.MercatorCoordinate(-w.y/A(w,g)+w.x,0)),(new c.LngLatBounds).extend(this.coordinateLocation(_)).extend(this.coordinateLocation(g)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(w))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBounds(0,0);const l=r.visibleDemTiles.reduce((m,x)=>{if(x.dem){const E=x.dem.tree;m.min=Math.min(m.min,E.minimums[0]),m.max=Math.max(m.max,E.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-c.MAX_MERCATOR_LATITUDE,this.maxLat=c.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=c.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=c.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=c.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){const l=r.key,m=this._distanceTileDataCache;if(m[l])return m[l];const x=r.canonical,E=1/this.height,p=this.cameraWorldSize,_=p/this.zoomScale(x.z),g=(x.x+Math.pow(2,x.z)*r.wrap)*_,w=x.y*_,D=this.point;D.x*=p/this.worldSize,D.y*=p/this.worldSize;const A=this.angle,O=Math.sin(-A),G=-Math.cos(-A);return m[l]={bearing:[O,G],center:[(D.x-g)*E,(D.y-w)*E],scale:_/c.EXTENT*E},m[l]}calculateFogTileMatrix(r){const l=r.key,m=this._fogTileMatrixCache;if(m[l])return m[l];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return c.multiply(x,this.worldToFogMatrix,x),m[l]=new Float32Array(x),m[l]}calculateProjMatrix(r,l=!1){const m=r.key,x=l?this._alignedProjMatrixCache:this._projMatrixCache;if(x[m])return x[m];const E=this.calculatePosMatrix(r,this.worldSize);return c.multiply(E,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,E),x[m]=new Float32Array(E),x[m]}calculatePixelsToTileUnitsMatrix(r){const l=r.tileID.key,m=this._pixelsToTileUnitsCache;if(m[l])return m[l];const x=function(E,p){const{scale:_}=E.tileTransform,g=_*c.EXTENT/(E.tileSize*Math.pow(2,p.zoom-E.tileID.overscaledZ+E.tileID.canonical.z));return w=new Float32Array(4),O=(D=p.inverseAdjustmentMatrix)[1],G=D[2],K=D[3],Q=(A=[g,g])[1],w[0]=D[0]*(re=A[0]),w[1]=O*re,w[2]=G*Q,w[3]=K*Q,w;var w,D,A,O,G,K,re,Q}(r,this);return m[l]=x,m[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const r=this._elevation;this._updateCameraState();const l=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(l),x=this._camera.forward(),E=c.mercatorZfromAltitude(1,this._center.lat);m[2]/=E,x[2]/=E,c.normalize(x,x);const p=r.raycast(m,x,r.exaggeration());if(p){const _=c.scaleAndAdd([],m,x,p),g=new c.MercatorCoordinate(_[0],_[1],c.mercatorZfromAltitude(_[2],c.latFromMercatorY(_[1]))),w=(g.z+c.length([g.x-m[0],g.y-m[1],g.z-m[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(w),this._centerAltitude=g.toAltitude(),this._center=this.coordinateLocation(g),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const l=this._elevation,m=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(m),E=l.getAtPointOrZero(new c.MercatorCoordinate(...x)),p=this.pixelsPerMeter/this.worldSize*E,_=this._minimumHeightOverTerrain(),g=x[2]-p;if(g<=_)if(g<0||r){const w=this.locationCoordinate(this._center,this._centerAltitude),D=[x[0],x[1],w.z-x[2]],A=c.length(D);D[2]-=(_-g)/this._pixelsPerMercatorPixel;const O=c.length(D);if(0===O)return;c.scale$2(D,D,A/O*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],w.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const O=this.center;return O.lat=c.clamp(O.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(O.lng=c.clamp(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}const l=this._unmodified,{x:m,y:x}=this.point;let E=0,p=m,_=x;const g=this.width/2,w=this.height/2,D=this.worldMinY*this.scale,A=this.worldMaxY*this.scale;if(x-w<D&&(_=D+w),x+w>A&&(_=A-w),A-D<this.height&&(E=Math.max(E,this.height/(A-D)),_=(A+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const O=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,K=this.worldSize/2-(O+G)/2;p=(m+K+this.worldSize)%this.worldSize-K,p-g<O&&(p=O+g),p+g>G&&(p=G-g),G-O<this.width&&(E=Math.max(E,this.width/(G-O)),p=(G+O)/2)}p===m&&_===x||(this.center=this.unproject(new c.pointGeometry(p,_))),E&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=c.mercatorZfromAltitude(1,this.center.lat)/c.mercatorZfromAltitude(1,c.GLOBE_SCALE_MATCH_LATITUDE));const m=bn(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?l:1),E=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);E[8]=2*-r.x/this.width,E[9]=2*r.y/this.height;let p=c.mul([],E,x);if(this.projection.isReprojectedInTileSpace){const Se=this.locationCoordinate(this.center),Ce=c.identity([]);c.translate(Ce,Ce,[Se.x*this.worldSize,Se.y*this.worldSize,0]),c.multiply(Ce,Ce,Ge(this)),c.translate(Ce,Ce,[-Se.x*this.worldSize,-Se.y*this.worldSize,0]),c.multiply(p,p,Ce),this.inverseAdjustmentMatrix=function(ke){const Ze=Ge(ke,!0);return ht([],[Ze[0],Ze[1],Ze[4],Ze[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=c.scale([],p,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=p,this.invProjMatrix=c.invert(new Float64Array(16),this.projMatrix);const _=c.invert([],E);this.frustumCorners=c.FrustumCorners.fromInvProjectionMatrix(_,this.horizonLineFromTop(),this.height);const g=new Float32Array(16);c.identity(g),c.scale(g,g,[1,-1,1]),c.rotateX(g,g,this._pitch),c.rotateZ(g,g,this.angle);const w=c.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),D=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;w[8]=2*-r.x/this.width,w[9]=2*(r.y+D)/this.height,this.skyboxMatrix=c.multiply(g,w,g);const A=this.point,O=A.x,G=A.y,K=this.width%2/2,re=this.height%2/2,Q=Math.cos(this.angle),oe=Math.sin(this.angle),fe=O-Math.round(O)+Q*K+oe*re,de=G-Math.round(G)+Q*re+oe*K,ve=new Float64Array(p);if(c.translate(ve,ve,[fe>.5?fe-1:fe,de>.5?de-1:de,0]),this.alignedProjMatrix=ve,p=c.create(),c.scale(p,p,[this.width/2,-this.height/2,1]),c.translate(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=c.create(),c.scale(p,p,[1,-1,1]),c.translate(p,p,[-1,-1,0]),c.scale(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p,this.pixelMatrix=c.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},p=c.invert(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=p,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=c.calculateGlobeMatrix(this);const Se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=c.transformMat4(Se,Se,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=p;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,m=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,E=[r,r,l];c.scale$2(E,E,x),c.scale$2(m,m,-1),c.multiply$2(m,m,E);const p=c.create();c.translate(p,p,m),c.scale(p,p,E),this.mercatorFogMatrix=p,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,x)}_computeCameraPosition(r){const l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),x=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-m[0]*E,x.y/this.worldSize-m[1]*E,r/this.worldSize*this._centerAltitude-m[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],x=r[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(E=Math.min((l-m)/x,1)),this._camera.position=c.scaleAndAdd([],this._camera.position,r,E),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:m,bearing:x}=this._camera.getPitchBearing(),E=c.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,p=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.degToRad(this._maxPitch)),_=Math.max((r[2]-E)/Math.cos(m),p),g=this._zoomFromMercatorZ(_);c.scaleAndAdd(r,r,l,_),this._pitch=c.clamp(m,c.degToRad(this.minPitch),c.degToRad(this.maxPitch)),this.angle=c.wrap(x,-Math.PI,Math.PI),this._setZoom(c.clamp(g,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new c.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){const l=p=>{const _=this.getCameraToCenterDistance(this.projection,p);return this.scaleZoom(_/(r*this.tileSize))};let m,x=l(this.zoom),E=Math.abs(x-l(x));for(;m!==E;)x=l(x),m=E,E=Math.abs(x-l(x));return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(c.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){const m=Math.min(r.x,l.x),x=Math.max(r.x,l.x),E=Math.min(r.y,l.y),p=Math.max(r.y,l.y);if(E<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const _=[new c.pointGeometry(m,E),new c.pointGeometry(x,p),new c.pointGeometry(m,p),new c.pointGeometry(x,E)],g=this.renderWorldCopies?-3:0,w=this.renderWorldCopies?4:1;for(const D of _){const A=this.pointRayIntersection(D);if(A.t<0)return!0;const O=this.rayIntersectionCoordinate(A);if(O.x<g||O.y<0||O.x>w||O.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.pointGeometry(0,0),new c.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,l){const m=c.length(c.sub([],this._camera.position,r)),x=this._zoomFromMercatorZ(m)+l;return m-this._mercatorZfromZoom(x)}getCameraPoint(){if("globe"===this.projection.name){const r=function([l,m,x],E){const p=[l,m,x,1];c.transformMat4$1(p,p,E);const _=p[3]=Math.max(p[3],1e-6);return p[0]/=_,p[1]/=_,p[2]/=_,p}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new c.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.pointGeometry(0,r))}}getCameraToCenterDistance(r,l=this.zoom){const m=bn(r,l,this.width,this.height,1024),x=r.pixelSpaceConversion(this.center.lat,this.worldSize,m);return.5/Math.tan(.5*this._fov)*this.height*x}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&c.multiply(r,r,this.globeMatrix),r}}function rr(h,r){let l=!1,m=null;const x=()=>{m=null,l&&(h(),m=setTimeout(x,r),l=!1)};return()=>(l=!0,m||x(),m)}class Et{constructor(r){this._hashName=r&&encodeURIComponent(r),c.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=rr(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,c.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),c.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const l=Rr(r);if(this._hashName){const m=this._hashName;let x=!1;const E=c.window.location.hash.slice(1).split("&").map(p=>{const _=p.split("=")[0];return _===m?(x=!0,`${_}=${l}`):p}).filter(p=>p);return x||E.push(`${m}=${l}`),`#${E.join("&")}`}return`#${l}`}_getCurrentHash(){const r=c.window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(l=m)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(m=>isNaN(m))){const m=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:m,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=c.window.location.href.replace(/(#.+)?$/,this.getHashString());c.window.history.replaceState(c.window.history.state,null,r)}}function Rr(h,r){const l=h.getCenter(),m=Math.round(100*h.getZoom())/100,x=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,x),p=Math.round(l.lng*E)/E,_=Math.round(l.lat*E)/E,g=h.getBearing(),w=h.getPitch();let D=r?`/${p}/${_}/${m}`:`${m}/${_}/${p}`;return(g||w)&&(D+="/"+Math.round(10*g)/10),w&&(D+=`/${Math.round(w)}`),D}const bi={linearity:.3,easing:c.bezier(0,0,.3,1)},no=c.extend({deceleration:2500,maxSpeed:1400},bi),Co=c.extend({deceleration:20,maxSpeed:1400},bi),ro=c.extend({deceleration:1e3,maxSpeed:360},bi),So=c.extend({deceleration:1e3,maxSpeed:90},bi);class Mo{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=c.exported.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new c.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)l.zoom+=E.zoomDelta||0,l.bearing+=E.bearingDelta||0,l.pitch+=E.pitchDelta||0,E.panDelta&&l.pan._add(E.panDelta),E.around&&(l.around=E.around),E.pinchAround&&(l.pinchAround=E.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(l.pan.mag()){const E=gn(l.pan.mag(),m,c.extend({},no,r||{}));x.offset=l.pan.mult(E.amount/l.pan.mag()),x.center=this._map.transform.center,Is(x,E)}if(l.zoom){const E=gn(l.zoom,m,Co);x.zoom=this._map.transform.zoom+E.amount,Is(x,E)}if(l.bearing){const E=gn(l.bearing,m,ro);x.bearing=this._map.transform.bearing+c.clamp(E.amount,-179,179),Is(x,E)}if(l.pitch){const E=gn(l.pitch,m,So);x.pitch=this._map.transform.pitch+E.amount,Is(x,E)}if(x.zoom||x.bearing){const E=void 0===l.pinchAround?l.around:l.pinchAround;x.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Is(h,r){(!h.duration||h.duration<r.duration)&&(h.duration=r.duration,h.easing=r.easing)}function gn(h,r,l){const{maxSpeed:m,linearity:x,deceleration:E}=l,p=c.clamp(h*x/(r/1e3),-m,m),_=Math.abs(p)/(E*x);return{easing:l.easing,duration:1e3*_,amount:p*(_/2)}}class ln extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,m,x={}){const E=st(l.getCanvasContainer(),m),p=l.unproject(E);super(r,c.extend({point:E,lngLat:p,originalEvent:m},x)),this._defaultPrevented=!1,this.target=l}}class kn extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,m){const x="touchend"===r?m.changedTouches:m.touches,E=tr(l.getCanvasContainer(),x),p=E.map(g=>l.unproject(g)),_=E.reduce((g,w,D,A)=>g.add(w.div(A.length)),new c.pointGeometry(0,0));super(r,{points:E,point:_,lngLats:p,lngLat:l.unproject(_),originalEvent:m}),this._defaultPrevented=!1}}class fr extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,m){super(r,{originalEvent:m}),this._defaultPrevented=!1}}class wi{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new fr(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new ln(r.type,this._map,r))}mouseup(r){this._map.fire(new ln(r.type,this._map,r))}preclick(r){const l=c.extend({},r);l.type="preclick",this._map.fire(new ln(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new ln(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new ln(r.type,this._map,r))}mouseover(r){this._map.fire(new ln(r.type,this._map,r))}mouseout(r){this._map.fire(new ln(r.type,this._map,r))}touchstart(r){return this._firePreventable(new kn(r.type,this._map,r))}touchmove(r){this._map.fire(new kn(r.type,this._map,r))}touchend(r){this._map.fire(new kn(r.type,this._map,r))}touchcancel(r){this._map.fire(new kn(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vo{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new ln(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ln("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new ln(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bi{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&0===r.button&&(ut(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const m=l,x=this._startPos,E=this._lastPos;if(!x||!E||E.equals(m)||!this._box&&m.dist(x)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=pt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const p=Math.min(x.x,m.x),_=Math.max(x.x,m.x),g=Math.min(x.y,m.y),w=Math.max(x.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${p}px,${g}px)`,this._box.style.width=_-p+"px",this._box.style.height=w-g+"px")})}mouseupWindow(r,l){if(!this._active)return;const m=this._startPos,x=l;if(m&&0===r.button){if(this.reset(),Wn(),m.x!==x.x||m.y!==x.y)return this._map.fire(new c.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:E=>E.fitScreenCoordinates(m,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Bt(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new c.Event(r,{originalEvent:l}))}}function _o(h,r){const l={};for(let m=0;m<h.length;m++)l[h[m].identifier]=r[m];return l}class zr{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),m.length===this.numTouches&&(this.centroid=function(x){const E=new c.pointGeometry(0,0);for(const p of x)E._add(p);return E.div(x.length)}(l),this.touches=_o(m,l)))}touchmove(r,l,m){if(this.aborted||!this.centroid)return;const x=_o(m,l);for(const E in this.touches){const _=x[E];(!_||_.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(r,l,m){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class jl{constructor(r){this.singleTap=new zr(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,m){this.singleTap.touchstart(r,l,m)}touchmove(r,l,m){this.singleTap.touchmove(r,l,m)}touchend(r,l,m){const x=this.singleTap.touchend(r,l,m);if(x){const E=r.timeStamp-this.lastTime<500,p=!this.lastTap||this.lastTap.dist(x)<30;if(E&&p||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class rc{constructor(){this._zoomIn=new jl({numTouches:1,numTaps:2}),this._zoomOut=new jl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,m){this._zoomIn.touchstart(r,l,m),this._zoomOut.touchstart(r,l,m)}touchmove(r,l,m){this._zoomIn.touchmove(r,l,m),this._zoomOut.touchmove(r,l,m)}touchend(r,l,m){const x=this._zoomIn.touchend(r,l,m),E=this._zoomOut.touchend(r,l,m);return x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:p=>p.easeTo({duration:300,zoom:p.getZoom()+1,around:p.unproject(x)},{originalEvent:r})}):E?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:p=>p.easeTo({duration:300,zoom:p.getZoom()-1,around:p.unproject(E)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ui={0:1,2:2};class ds{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const m=en(r);this._correctButton(r,m)&&(this._lastPoint=l,this._eventButton=m)}mousemoveWindow(r,l){const m=this._lastPoint;if(m)if(r.preventDefault(),null!=this._eventButton&&function(x,E){const p=Ui[E];return void 0===x.buttons||(x.buttons&p)!==p}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(m,l)}mouseupWindow(r){this._lastPoint&&en(r)===this._eventButton&&(this._moved&&Wn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ei extends ds{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return 0===l&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class Ks extends ds{_correctButton(r,l){return 0===l&&r.ctrlKey||2===l}_move(r,l){const m=.8*(l.x-r.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(r){r.preventDefault()}}class ha extends ds{_correctButton(r,l){return 0===l&&r.ctrlKey||2===l}_move(r,l){const m=-.5*(l.y-r.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(r){r.preventDefault()}}class Dc{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),c.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.pointGeometry(0,0)}touchstart(r,l,m){return this._calculateTransform(r,l,m)}touchmove(r,l,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length&&!c.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,m)}}touchend(r,l,m){this._calculateTransform(r,l,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,m){m.length>0&&(this._active=!0);const x=_o(m,l),E=new c.pointGeometry(0,0),p=new c.pointGeometry(0,0);let _=0;for(const w in x){const D=x[w],A=this._touches[w];A&&(E._add(D),p._add(D.sub(A)),_++,x[w]=D)}if(this._touches=x,_<this._minTouches||!p.mag())return;const g=p.div(_);return this._sum._add(g),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(_),panDelta:g}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=pt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class _l{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,m){return{}}touchstart(r,l,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,m){const x=this._firstTwoTouches;if(!x)return;r.preventDefault();const[E,p]=x,_=Ys(m,l,E),g=Ys(m,l,p);if(!_||!g)return;const w=this._aroundCenter?null:_.add(g).div(2);return this._move([_,g],w,r)}touchend(r,l,m){if(!this._firstTwoTouches)return;const[x,E]=this._firstTwoTouches,p=Ys(m,l,x),_=Ys(m,l,E);p&&_||(this._active&&Wn(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ys(h,r,l){for(let m=0;m<h.length;m++)if(h[m].identifier===l)return r[m]}function ic(h,r){return Math.log(h/r)/Math.LN2}class bu extends _l{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const m=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(ic(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ic(this._distance,m),pinchAround:l}}}function Uc(h,r){return 180*h.angleWith(r)/Math.PI}class $o extends _l{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const m=this._vector;if(this._vector=r[0].sub(r[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Uc(this._vector,m),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const x=Uc(r,m);return Math.abs(x)<l}}function oc(h){return Math.abs(h.y)>Math.abs(h.x)}class Vl extends _l{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,oc(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,m){const x=this._lastPoints;if(!x)return;const E=r[0].sub(x[0]),p=r[1].sub(x[1]);return this._map._cooperativeGestures&&!c.isFullscreen()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(E,p,m.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(E.y+p.y)/2*-.5})}gestureBeginsVertically(r,l,m){if(void 0!==this._valid)return this._valid;const x=r.mag()>=2,E=l.mag()>=2;if(!x&&!E)return;if(!x||!E)return null==this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const p=r.y>0==l.y>0;return oc(r)&&oc(l)&&p}}const jc={panStep:100,bearingStep:15,pitchStep:10};class io{constructor(){const r=jc;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,m=0,x=0,E=0,p=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?m=-1:(r.preventDefault(),E=-1);break;case 39:r.shiftKey?m=1:(r.preventDefault(),E=1);break;case 38:r.shiftKey?x=1:(r.preventDefault(),p=-1);break;case 40:r.shiftKey?x=-1:(r.preventDefault(),p=1);break;default:return}return this._rotationDisabled&&(m=0,x=0),{cameraAnimation:_=>{const g=_.getZoom();_.easeTo({duration:300,easeId:"keyboardHandler",easing:rl,zoom:l?Math.round(g)+l*(r.shiftKey?2:1):g,bearing:_.getBearing()+m*this._bearingStep,pitch:_.getPitch()+x*this._pitchStep,offset:[-E*this._panStep,-p*this._panStep],center:_.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rl(h){return h*(2-h)}const wu=4.000244140625;class uh{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,c.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||c.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===c.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const m=c.exported.now(),x=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==l&&l%wu==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(x*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=st(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;"wheel"===this._type&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const g="wheel"===this._type&&Math.abs(this._delta)>wu?this._wheelZoomRate:this._defaultZoomRate;let w=2/(1+Math.exp(-Math.abs(this._delta*g)));this._delta<0&&0!==w&&(w=1/w);const D=l(),A=Math.pow(2,D),O="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):A;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(O*w))),"wheel"===this._type&&(this._startZoom=D,this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:l(),x=this._startZoom,E=this._easing;let p,_=!1;if("wheel"===this._type&&x&&E){const g=Math.min((c.exported.now()-this._lastWheelEventTime)/200,1),w=E(g);p=c.number(x,m,w),g<1?this._frameId||(this._frameId=!0):_=!0}else p=m,_=!0;return this._active=!0,_&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!_,zoomDelta:p-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=c.ease;if(this._prevEase){const m=this._prevEase,x=(c.exported.now()-m.start)/m.duration,E=m.easing(x+.01)-m.easing(x),p=.27/Math.sqrt(E*E+1e-4)*.01,_=Math.sqrt(.0729-p*p);l=c.bezier(p,_,.25,1)}return this._prevEase={start:c.exported.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=pt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(c.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Eu{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ko{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(r.shiftKey?-1:1),around:m.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vc{constructor(){this._tap=new jl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,m){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=l[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(r,l,m))}touchmove(r,l,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const x=l[0],E=x.y-this._swipePoint.y;return this._swipePoint=x,r.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(r,l,m)}touchend(r,l,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(r,l,m)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oo{constructor(r,l,m){this._el=r,this._mousePan=l,this._touchPan=m}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class As{constructor(r,l,m){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ma{constructor(r,l,m,x){this._el=r,this._touchZoom=l,this._touchRotate=m,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const sn=h=>h.zoom||h.drag||h.pitch||h.rotate;class sc extends c.Event{}class ns{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const m=c.sub([],l,r);this.radius=c.length(m[2]<0?c.div([],m,this.constants):[m[0],m[1],0])}projectRay(r){c.div(r,r,this.constants),c.normalize(r,r),c.mul$1(r,r,this.constants);const l=c.scale$2([],r,this.radius);if(l[2]>0){const m=c.scale$2([],[0,0,1],c.dot(l,[0,0,1])),x=c.scale$2([],c.normalize([],[l[0],l[1],0]),this.radius),E=c.add([],l,c.scale$2([],c.sub([],c.add([],x,m),l),2));l[0]=E[0],l[1]=E[1]}return l}}function Go(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class da{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mo(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ns,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),c.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[c.window.document,"mousemove",{capture:!0}],[c.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[c.window,"blur",void 0]];for(const[x,E,p]of this._listeners)x.addEventListener(E,x===c.window.document?this.handleWindowEvent:this.handleEvent,p)}destroy(){for(const[r,l,m]of this._listeners)r.removeEventListener(l,r===c.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(r){const l=this._map,m=l.getCanvasContainer();this._add("mapEvent",new wi(l,r));const x=l.boxZoom=new Bi(l,r);this._add("boxZoom",x);const E=new rc,p=new ko;l.doubleClickZoom=new Eu(p,E),this._add("tapZoom",E),this._add("clickZoom",p);const _=new Vc;this._add("tapDragZoom",_);const g=l.touchPitch=new Vl(l);this._add("touchPitch",g);const w=new Ks(r),D=new ha(r);l.dragRotate=new As(r,w,D),this._add("mouseRotate",w,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const A=new Ei(r),O=new Dc(l,r);l.dragPan=new oo(m,A,O),this._add("mousePan",A),this._add("touchPan",O,["touchZoom","touchRotate"]);const G=new $o,K=new bu;l.touchZoomRotate=new Ma(m,K,G,_),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Vo(l));const re=l.scrollZoom=new uh(l,this);this._add("scrollZoom",re,["mousePan"]);const Q=l.keyboard=new io;this._add("keyboard",Q);for(const oe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[oe]&&l[oe].enable(r[oe])}_add(r,l,m){this._handlers.push({handlerName:r,handler:l,allowed:m}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!sn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,l,m){for(const x in r)if(x!==m&&(!l||l.indexOf(x)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const m of r)this._el.contains(m.target)&&l.push(m);return l}handleEvent(r,l){this._updatingCamera=!0;const m="renderFrame"===r.type,x=m?void 0:r,E={needsRenderFrame:!1},p={},_={},g=r.touches?this._getMapTouches(r.touches):void 0,w=g?tr(this._el,g):m?void 0:st(this._el,r);for(const{handlerName:O,handler:G,allowed:K}of this._handlers){if(!G.isEnabled())continue;let re;this._blockedByActive(_,K,O)?G.reset():G[l||r.type]&&(re=G[l||r.type](r,w,g),this.mergeHandlerResult(E,p,re,O,x),re&&re.needsRenderFrame&&this._triggerRenderFrame()),(re||G.isActive())&&(_[O]=G)}const D={};for(const O in this._previousActiveHandlers)_[O]||(D[O]=x);this._previousActiveHandlers=_,(Object.keys(D).length||Go(E))&&(this._changes.push([E,p,D]),this._triggerRenderFrame()),(Object.keys(_).length||Go(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:A}=E;A&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],A(this._map))}mergeHandlerResult(r,l,m,x,E){if(!m)return;c.extend(r,m);const p={handlerName:x,originalEvent:m.originalEvent||E};void 0!==m.zoomDelta&&(l.zoom=p),void 0!==m.panDelta&&(l.drag=p),void 0!==m.pitchDelta&&(l.pitch=p),void 0!==m.bearingDelta&&(l.rotate=p)}_applyChanges(){const r={},l={},m={};for(const[x,E,p]of this._changes)x.panDelta&&(r.panDelta=(r.panDelta||new c.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(r.around=x.around),void 0!==x.aroundCoord&&(r.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(r.pinchAround=x.pinchAround),x.noInertia&&(r.noInertia=x.noInertia),c.extend(l,E),c.extend(m,p);this._updateMapTransform(r,l,m),this._changes=[]}_updateMapTransform(r,l,m){const x=this._map,E=x.transform,p=fe=>[fe.x,fe.y,fe.z];if((fe=>{const de=this._eventsInProgress.drag;return de&&!this._handlersById[de.handlerName].isActive()})()&&!Go(r)){const fe=E.zoom;E.cameraElevationReference="sea",E.recenterOnTerrain(),E.cameraElevationReference="ground",fe!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&x._stop(!0),!Go(r))return void this._fireEvents(l,m,!0);let{panDelta:_,zoomDelta:g,bearingDelta:w,pitchDelta:D,around:A,aroundCoord:O,pinchAround:G}=r;E._isCameraConstrained&&(g>0&&(g=0),E._isCameraConstrained=!1),void 0!==G&&(A=G),(fe=>l.drag&&!this._eventsInProgress.drag)()&&A&&(this._dragOrigin=p(E.pointCoordinate3D(A)),this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",x._stop(!0),A=A||x.transform.centerPoint,w&&(E.bearing+=w),D&&(E.pitch+=D),E._updateCameraState();const K=[0,0,0];if(_)if("mercator"===E.projection.name){const fe=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(A).dir),de=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(A.sub(_)).dir);K[0]=de[0]-fe[0],K[1]=de[1]-fe[1]}else{const fe=E.pointCoordinate(A);if("globe"===E.projection.name){_=_.rotate(-E.angle);const de=E._pixelsPerMercatorPixel/E.worldSize;K[0]=-_.x*c.mercatorScale(c.latFromMercatorY(fe.y))*de,K[1]=-_.y*c.mercatorScale(E.center.lat)*de}else{const de=E.pointCoordinate(A.sub(_));fe&&de&&(K[0]=de.x-fe.x,K[1]=de.y-fe.y)}}const re=E.zoom,Q=[0,0,0];if(g){const fe=p(O||E.pointCoordinate3D(A)),de={dir:c.normalize([],c.sub([],fe,E._camera.position))};if(de.dir[2]<0){const ve=E.zoomDeltaToMovement(fe,g);c.scale$2(Q,de.dir,ve)}}const oe=c.add(K,K,Q);E._translateCameraConstrained(oe),g&&Math.abs(E.zoom-re)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,m,!0)}_fireEvents(r,l,m){const x=sn(this._eventsInProgress),E=sn(r),p={};for(const D in r){const{originalEvent:A}=r[D];this._eventsInProgress[D]||(p[`${D}start`]=A),this._eventsInProgress[D]=r[D]}!x&&E&&this._fireEvent("movestart",E.originalEvent);for(const D in p)this._fireEvent(D,p[D]);E&&this._fireEvent("move",E.originalEvent);for(const D in r){const{originalEvent:A}=r[D];this._fireEvent(D,A)}const _={};let g;for(const D in this._eventsInProgress){const{handlerName:A,originalEvent:O}=this._eventsInProgress[D];this._handlersById[A].isActive()||(delete this._eventsInProgress[D],g=l[A]||O,_[`${D}end`]=g)}for(const D in _)this._fireEvent(D,_[D]);const w=sn(this._eventsInProgress);if(m&&(x||E)&&!w){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),A=O=>0!==O&&-this._bearingSnap<O&&O<this._bearingSnap;D?(A(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:g})):(this._map.fire(new c.Event("moveend",{originalEvent:g})),A(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new c.Event(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new sc("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const $c="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Gc extends c.Evented{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,c.bindAll(["_renderFrameCallback"],this)}getCenter(){return new c.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,m){return r=c.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,c.extend({offset:r},l),m)}panTo(r,l,m){return this.easeTo(c.extend({center:r},l),m)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,m){return this.easeTo(c.extend({zoom:r},l),m)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,m){return this.easeTo(c.extend({bearing:r},l),m)}resetNorth(r,l){return this.rotateTo(0,c.extend({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(c.extend({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=c.LngLatBounds.convert(r);const m=l&&l.bearing||0,x=l&&l.pitch||0,E=r.getNorthWest(),p=r.getSouthEast();return this._cameraForBounds(this.transform,E,p,m,x,l)}_extendCameraOptions(r){const l={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=c.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const m=r.padding;r.padding={top:m,bottom:m,right:m,left:m}}return r.padding=c.extend(l,r.padding),r}_minimumAABBFrustumDistance(r,l){const m=l.max[0]-l.min[0],x=l.max[1]-l.min[1];return m/x>r.aspect?m/(2*Math.tan(.5*r.fovX)*r.aspect):x/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,l,m,x,E,p){const _=r.clone(),g=this._extendCameraOptions(p);_.bearing=x,_.pitch=E;const w=c.LngLat.convert(l),D=c.LngLat.convert(m),A=.5*(w.lat+D.lat),O=.5*(w.lng+D.lng),G=c.latLngToECEF(A,O),K=c.normalize([],G),re=c.normalize([],c.cross([],K,[0,1,0])),Q=c.cross([],re,K),oe=[re[0],re[1],re[2],0,Q[0],Q[1],Q[2],0,K[0],K[1],K[2],0,0,0,0,1],fe=[G,c.latLngToECEF(w.lat,w.lng),c.latLngToECEF(D.lat,w.lng),c.latLngToECEF(D.lat,D.lng),c.latLngToECEF(w.lat,D.lng),c.latLngToECEF(A,w.lng),c.latLngToECEF(A,D.lng),c.latLngToECEF(w.lat,O),c.latLngToECEF(D.lat,O)];let de=c.Aabb.fromPoints(fe.map(je=>[c.dot(re,je),c.dot(Q,je),c.dot(K,je)]));const ve=c.transformMat4([],de.center,oe);0===c.squaredLength(ve)&&c.set(ve,0,0,1),c.normalize(ve,ve),c.scale$2(ve,ve,c.GLOBE_RADIUS),_.center=c.ecefToLatLng(ve);const Se=_.getWorldToCameraMatrix(),Ce=c.invert(new Float64Array(16),Se);de=c.Aabb.applyTransform(de,c.multiply([],Se,oe)),c.transformMat4(ve,ve,Se);const ke=.5*(de.max[2]-de.min[2]),Ze=this._minimumAABBFrustumDistance(_,de),He=c.scale$2([],[0,0,1],ke),Be=c.add(He,ve,He),Lt=Ze+(0===_.pitch?0:c.distance(ve,Be)),Ve=_.globeCenterInViewSpace,at=c.sub([],ve,[Ve[0],Ve[1],Ve[2]]);c.normalize(at,at),c.scale$2(at,at,Lt);const nt=c.add([],ve,at);c.transformMat4(nt,nt,Ce);const It=c.earthRadius/c.GLOBE_RADIUS,et=c.length(nt),ft=c.mercatorZfromAltitude(et*It-c.earthRadius,0),Nt=Math.min(_.zoomFromMercatorZAdjusted(ft),g.maxZoom);return Nt>.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(_.setProjection({name:"mercator"}),_.zoom=Nt,this._cameraForBounds(_,l,m,x,E,p)):{center:_.center,zoom:Nt,bearing:x,pitch:E}}queryTerrainElevation(r,l){const m=this.transform.elevation;return m?(l=c.extend({},{exaggerated:!0},l),m.getAtPoint(c.MercatorCoordinate.fromLngLat(r),null,l.exaggerated)):null}_cameraForBounds(r,l,m,x,E,p){if("globe"===r.projection.name)return this._cameraForBoundsOnGlobe(r,l,m,x,E,p);const _=r.clone(),g=this._extendCameraOptions(p),w=_.padding;_.bearing=x,_.pitch=E;const D=c.LngLat.convert(l),A=c.LngLat.convert(m),O=new c.LngLat(D.lng,A.lat),G=new c.LngLat(A.lng,D.lat),K=_.project(D),re=_.project(A),Q=this.queryTerrainElevation(D),oe=this.queryTerrainElevation(A),fe=this.queryTerrainElevation(O),de=this.queryTerrainElevation(G),ve=[[K.x,K.y,Math.min(Q||0,oe||0,fe||0,de||0)],[re.x,re.y,Math.max(Q||0,oe||0,fe||0,de||0)]];let Se=c.Aabb.fromPoints(ve);const Ce=_.getWorldToCameraMatrix(),ke=c.invert(new Float64Array(16),Ce);Se=c.Aabb.applyTransform(Se,Ce);const Ze=c.sub([],Se.max,Se.min),He=w.left||0,Be=w.right||0,Lt=w.bottom||0,Ve=w.top||0,{left:at,right:nt,top:It,bottom:et}=g.padding,ft=.5*(He+Be),Nt=.5*(Ve+Lt),je=Math.min(_.scaleZoom(_.scale*Math.min((_.width-(He+Be+at+nt))/Ze[0],(_.height-(Lt+Ve+et+It))/Ze[1])),g.maxZoom),Qe=_.scale/_.zoomScale(je);Se=new c.Aabb([Se.min[0]-(at+ft)*Qe,Se.min[1]-(et+Nt)*Qe,Se.min[2]],[Se.max[0]+(nt+ft)*Qe,Se.max[1]+(It+Nt)*Qe,Se.max[2]]);const _n=.5*Ze[2],In=this._minimumAABBFrustumDistance(_,Se),yn=[0,0,1,0];c.transformMat4$1(yn,yn,Ce),c.normalize$2(yn,yn);const Nn=c.scale$2([],yn,In+_n),ir=c.add([],Se.center,Nn),Tn=("number"==typeof g.offset.x&&"number"==typeof g.offset.y?new c.pointGeometry(g.offset.x,g.offset.y):c.pointGeometry.convert(g.offset)).rotate(-c.degToRad(x));Se.center[0]-=Tn.x*Qe,Se.center[1]+=Tn.y*Qe,c.transformMat4(Se.center,Se.center,ke),c.transformMat4(ir,ir,ke);const an=[Se.center[0],Se.center[1],ir[2]*_.pixelsPerMeter];c.scale$2(an,an,1/_.worldSize);const Gr=c.lngFromMercatorX(an[0]),Mr=c.latFromMercatorY(an[1]),oi=Math.min(_._zoomFromMercatorZ(an[2]),g.maxZoom),Hr=new c.LngLat(Gr,Mr);return _.mercatorFromTransition&&oi<.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(_.setProjection({name:"globe"}),_.zoom=oi,this._cameraForBounds(_,l,m,x,E,p)):{center:Hr,zoom:oi,bearing:x,pitch:E}}fitBounds(r,l,m){const x=this.cameraForBounds(r,l);return this._fitInternal(x,l,m)}fitScreenCoordinates(r,l,m,x,E){const p=c.pointGeometry.convert(r),_=c.pointGeometry.convert(l),g=new c.pointGeometry(Math.min(p.x,_.x),Math.min(p.y,_.y)),w=new c.pointGeometry(Math.max(p.x,_.x),Math.max(p.y,_.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(p,_))return this;const D=this.transform.pointLocation3D(g),A=this.transform.pointLocation3D(w),O=this.transform.pointLocation3D(new c.pointGeometry(g.x,w.y)),G=this.transform.pointLocation3D(new c.pointGeometry(w.x,g.y)),K=[Math.min(D.lng,A.lng,O.lng,G.lng),Math.min(D.lat,A.lat,O.lat,G.lat)],re=[Math.max(D.lng,A.lng,O.lng,G.lng),Math.max(D.lat,A.lat,O.lat,G.lat)],Q=x&&x.pitch?x.pitch:this.getPitch(),oe=this._cameraForBounds(this.transform,K,re,m,Q,x);return this._fitInternal(oe,x,E)}_fitInternal(r,l,m){return r?(delete(l=c.extend(r,l)).padding,l.linear?this.easeTo(l,m):this.flyTo(l,m)):this}jumpTo(r,l){this.stop();const m=r.preloadOnly?this.transform.clone():this.transform;let x=!1,E=!1,p=!1;return"zoom"in r&&m.zoom!==+r.zoom&&(x=!0,m.zoom=+r.zoom),void 0!==r.center&&(m.center=c.LngLat.convert(r.center)),"bearing"in r&&m.bearing!==+r.bearing&&(E=!0,m.bearing=+r.bearing),"pitch"in r&&m.pitch!==+r.pitch&&(p=!0,m.pitch=+r.pitch),null==r.padding||m.isPaddingEqual(r.padding)||(m.padding=r.padding),r.preloadOnly?(this._preloadTiles(m),this):(this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),x&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),E&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),p&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||c.warnOnce($c),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){const m=this.transform;if(!m.projection.supportsFreeCamera)return c.warnOnce($c),this;this.stop();const x=m.zoom,E=m.pitch,p=m.bearing;m.setFreeCameraOptions(r);const _=x!==m.zoom,g=E!==m.pitch,w=p!==m.bearing;return this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),_&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),w&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),g&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),(!1===(r=c.extend({offset:[0,0],duration:500,easing:c.ease},r)).animate||!r.essential&&c.exported.prefersReducedMotion)&&(r.duration=0);const m=this.transform,x=this.getZoom(),E=this.getBearing(),p=this.getPitch(),_=this.getPadding(),g="zoom"in r?+r.zoom:x,w="bearing"in r?this._normalizeBearing(r.bearing,E):E,D="pitch"in r?+r.pitch:p,A="padding"in r?r.padding:m.padding,O=c.pointGeometry.convert(r.offset);let G,K,re;if("globe"===m.projection.name){const He=c.MercatorCoordinate.fromLngLat(m.center),Be=O.rotate(-m.angle);He.x+=Be.x/m.worldSize,He.y+=Be.y/m.worldSize;const Lt=He.toLngLat(),Ve=c.LngLat.convert(r.center||Lt);this._normalizeCenter(Ve),G=m.centerPoint.add(Be),K=new c.pointGeometry(He.x,He.y).mult(m.worldSize),re=new c.pointGeometry(c.mercatorXfromLng(Ve.lng),c.mercatorYfromLat(Ve.lat)).mult(m.worldSize).sub(K)}else{G=m.centerPoint.add(O);const He=m.pointLocation(G),Be=c.LngLat.convert(r.center||He);this._normalizeCenter(Be),K=m.project(He),re=m.project(Be).sub(K)}const Q=m.zoomScale(g-x);let oe,fe;r.around&&(oe=c.LngLat.convert(r.around),fe=m.locationPoint(oe));const de=this._zooming||g!==x,ve=this._rotating||E!==w,Se=this._pitching||D!==p,Ce=!m.isPaddingEqual(A),ke=He=>Be=>{if(de&&(He.zoom=c.number(x,g,Be)),ve&&(He.bearing=c.number(E,w,Be)),Se&&(He.pitch=c.number(p,D,Be)),Ce&&(He.interpolatePadding(_,A,Be),G=He.centerPoint.add(O)),oe)He.setLocationAtPoint(oe,fe);else{const Lt=He.zoomScale(He.zoom-x),Ve=g>x?Math.min(2,Q):Math.max(.5,Q),at=Math.pow(Ve,1-Be),nt=He.unproject(K.add(re.mult(Be*at)).mult(Lt));He.setLocationAtPoint(He.renderWorldCopies?nt.wrap():nt,G)}return r.preloadOnly||this._fireMoveEvents(l),He};if(r.preloadOnly){const He=this._emulate(ke,r.duration,m);return this._preloadTiles(He),this}const Ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=de,this._rotating=ve,this._pitching=Se,this._padding=Ce,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,Ze),this._ease(ke(m),He=>{m.recenterOnTerrain(),this._afterEase(l,He)},r),this}_prepareEase(r,l,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||m.moving||this.fire(new c.Event("movestart",r)),this._zooming&&!m.zooming&&this.fire(new c.Event("zoomstart",r)),this._rotating&&!m.rotating&&this.fire(new c.Event("rotatestart",r)),this._pitching&&!m.pitching&&this.fire(new c.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new c.Event("move",r)),this._zooming&&this.fire(new c.Event("zoom",r)),this._rotating&&this.fire(new c.Event("rotate",r)),this._pitching&&this.fire(new c.Event("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,x=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new c.Event("zoomend",r)),x&&this.fire(new c.Event("rotateend",r)),E&&this.fire(new c.Event("pitchend",r)),this.fire(new c.Event("moveend",r))}flyTo(r,l){if(!r.essential&&c.exported.prefersReducedMotion){const je=c.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(je,l)}this.stop(),r=c.extend({offset:[0,0],speed:1.2,curve:1.42,easing:c.ease},r);const m=this.transform,x=this.getZoom(),E=this.getBearing(),p=this.getPitch(),_=this.getPadding(),g="zoom"in r?c.clamp(+r.zoom,m.minZoom,m.maxZoom):x,w="bearing"in r?this._normalizeBearing(r.bearing,E):E,D="pitch"in r?+r.pitch:p,A="padding"in r?r.padding:m.padding,O=m.zoomScale(g-x),G=c.pointGeometry.convert(r.offset);let K=m.centerPoint.add(G);const re=m.pointLocation(K),Q=c.LngLat.convert(r.center||re);this._normalizeCenter(Q);const oe=m.project(re),fe=m.project(Q).sub(oe);let de=r.curve;const ve=Math.max(m.width,m.height),Se=ve/O,Ce=fe.mag();if("minZoom"in r){const je=c.clamp(Math.min(r.minZoom,x,g),m.minZoom,m.maxZoom),Qe=ve/m.zoomScale(je-x);de=Math.sqrt(Qe/Ce*2)}const ke=de*de;function Ze(je){const Qe=(Se*Se-ve*ve+(je?-1:1)*ke*ke*Ce*Ce)/(2*(je?Se:ve)*ke*Ce);return Math.log(Math.sqrt(Qe*Qe+1)-Qe)}function He(je){return(Math.exp(je)-Math.exp(-je))/2}function Be(je){return(Math.exp(je)+Math.exp(-je))/2}const Lt=Ze(0);let Ve=function(je){return Be(Lt)/Be(Lt+de*je)},at=function(je){return ve*((Be(Lt)*(He(Qe=Lt+de*je)/Be(Qe))-He(Lt))/ke)/Ce;var Qe},nt=(Ze(1)-Lt)/de;if(Math.abs(Ce)<1e-6||!isFinite(nt)){if(Math.abs(ve-Se)<1e-6)return this.easeTo(r,l);const je=Se<ve?-1:1;nt=Math.abs(Math.log(Se/ve))/de,at=function(){return 0},Ve=function(Qe){return Math.exp(je*de*Qe)}}r.duration="duration"in r?+r.duration:1e3*nt/("screenSpeed"in r?+r.screenSpeed/de:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const It=E!==w,et=D!==p,ft=!m.isPaddingEqual(A),Nt=je=>Qe=>{const _n=Qe*nt,In=1/Ve(_n);je.zoom=1===Qe?g:x+je.scaleZoom(In),It&&(je.bearing=c.number(E,w,Qe)),et&&(je.pitch=c.number(p,D,Qe)),ft&&(je.interpolatePadding(_,A,Qe),K=je.centerPoint.add(G));const yn=1===Qe?Q:je.unproject(oe.add(fe.mult(at(_n))).mult(In));return je.setLocationAtPoint(je.renderWorldCopies?yn.wrap():yn,K),je._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),je};if(r.preloadOnly){const je=this._emulate(Nt,r.duration,m);return this._preloadTiles(je),this}return this._zooming=!0,this._rotating=It,this._pitching=et,this._padding=ft,this._prepareEase(l,!1),this._ease(Nt(m),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,l)}if(!r){const m=this.handlers;m&&m.stop(!1)}return this}_ease(r,l,m){!1===m.animate||0===m.duration?(r(1),l()):(this._easeStart=c.exported.now(),this._easeOptions=m,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((c.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=c.wrap(r,-180,180);const m=Math.abs(r-l);return Math.abs(r-360-l)<m&&(r-=360),Math.abs(r+360-l)<m&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const m=r.lng-l.center.lng;r.lng+=m>180?-360:m<-180?360:0}_emulate(r,l,m){const x=Math.ceil(15*l/1e3),E=[],p=r(m.clone());for(let _=0;_<=x;_++){const g=p(_/x);E.push(g.clone())}return E}}class Ia{constructor(r={}){this.options=r,c.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact;return this._map=r,this._container=pt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=pt("button","mapboxgl-ctrl-attrib-button",this._container),pt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=pt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const m=this._map._getUIString(`AttributionControl.${l}`);r.setAttribute("aria-label",m),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.config.ACCESS_TOKEN}];if(r){const m=l.reduce((x,E,p)=>(E.value&&(x+=`${E.key}=${E.value}${p<l.length-1?"&":""}`),x),"?");r.href=`${c.config.FEEDBACK_URL}/${m}#${Rr(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const l=this._map.style._sourceCaches;for(const x in l){const E=l[x];if(E.used){const p=E.getSource();p.attribution&&r.indexOf(p.attribution)<0&&r.push(p.attribution)}}r.sort((x,E)=>x.length-E.length),r=r.filter((x,E)=>{for(let p=E+1;p<r.length;p++)if(r[p].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const m=r.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,r.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Hc{constructor(){c.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=pt("div","mapboxgl-ctrl");const l=pt("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const l in r){const m=r[l].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class ac{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,m=l?this._queue.concat(l):this._queue;for(const x of m)if(x.id===r)return void(x.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const m of l)if(!m.cancelled&&(m.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ni(h,r,l){if(h=new c.LngLat(h.lng,h.lat),r){const m=new c.LngLat(h.lng-360,h.lat),x=new c.LngLat(h.lng+360,h.lat),E=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),p=l.locationPoint(h).distSqr(r),_=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint(m).distSqr(r)<p&&(_||Math.abs(m.lng-l.center.lng)<E)?h=m:l.locationPoint(x).distSqr(r)<p&&(_||Math.abs(x.lng-l.center.lng)<E)&&(h=x)}for(;Math.abs(h.lng-l.center.lng)>180;){const m=l.locationPoint(h);if(m.x>=0&&m.y>=0&&m.x<=l.width&&m.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}const lc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Cc extends c.Evented{constructor(r,l){if(super(),(r instanceof c.window.HTMLElement||l)&&(r=c.extend({element:r},l)),c.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=c.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=pt("div");const x=41,E=27,p=yt("svg",{display:"block",height:x*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${x}`},this._element),_=yt("radialGradient",{id:"shadowGradient"},yt("defs",{},p));yt("stop",{offset:"10%","stop-opacity":.4},_),yt("stop",{offset:"100%","stop-opacity":.05},_),yt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},p),yt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},p),yt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},p),yt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},p),this._offset=c.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const m=this._element.classList;for(const x in lc)m.remove(`mapboxgl-marker-anchor-${x}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=c.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const l=r.code,m=r.charCode||r.keyCode;"Space"!==l&&"Enter"!==l&&32!==m&&13!==m||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,m=this._element;this._popup&&(l===m||m.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,l=this._pos;if(!r||!l)return!1;const m=r.unproject(l),x=r.getFreeCameraOptions();if(!x.position)return!1;const E=x.position.toLngLat();return E.distanceTo(m)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();const m=r.unproject(l);let x;r._showingGlobe()&&c.isLngLatBehindGlobe(r.transform,this._lngLat)?x=0:(x=1-r._queryFogOpacity(m),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${r.x}px,${r.y}px)\n            ${lc[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${l.x}px,${l.y}px)\n        `}_calculateXYTransform(){const r=this._pos,l=this._map,m=this.getPitchAlignment();if(!l||!r||"map"!==m)return"";if(!l._showingGlobe()){const g=l.getPitch();return g?`rotateX(${g}deg)`:""}const x=c.radToDeg(c.globeTiltAtLngLat(l.transform,this._lngLat)),E=r.sub(c.globeCenterToScreenPoint(l.transform)),p=Math.abs(E.x)+Math.abs(E.y);if(0===p)return"";const _=x/p;return`rotateX(${-E.y*_}deg) rotateY(${E.x*_}deg)`}_calculateZTransform(){const r=this._pos,l=this._map;if(!l||!r)return"";let m=0;const x=this.getRotationAlignment();if("map"===x)if(l._showingGlobe()){const E=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),p=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(E);m=c.radToDeg(Math.atan2(p.y,p.x))-90}else m=-l.getBearing();else if("horizon"===x){const E=c.smoothstep(4,6,l.getZoom()),p=c.globeCenterToScreenPoint(l.transform);p.y+=E*l.transform.height;const _=r.sub(p),g=c.radToDeg(Math.atan2(_.y,_.x));m=(g>90?g-270:g+90)*(1-E)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(r){c.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=ni(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),!0===r?this._updateFrameId=c.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=c.pointGeometry.convert(r),this._update(),this}_onMove(r){const l=this._map;if(!l)return;const m=this._pointerdownPos,x=this._positionDelta;if(m&&x){if(!this._isDragging){const E=this._clickTolerance||l._clickTolerance;if(r.point.dist(m)<E)return;this._isDragging=!0}this._pos=r.point.sub(x),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new c.Event("dragstart"))),this.fire(new c.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new c.Event("dragend")),this._state="inactive"}_addDragHandler(r){const l=this._map,m=this._pos;l&&m&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(m),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Sc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},hh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function dh(h=new c.pointGeometry(0,0),r="bottom"){if("number"==typeof h){const l=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(r){case"top":return new c.pointGeometry(0,h);case"top-left":return new c.pointGeometry(l,l);case"top-right":return new c.pointGeometry(-l,l);case"bottom":return new c.pointGeometry(0,-h);case"bottom-left":return new c.pointGeometry(l,-l);case"bottom-right":return new c.pointGeometry(-l,-l);case"left":return new c.pointGeometry(h,0);case"right":return new c.pointGeometry(-h,0)}return new c.pointGeometry(0,0)}return h instanceof c.pointGeometry||Array.isArray(h)?c.pointGeometry.convert(h):c.pointGeometry.convert(h[r]||[0,0])}class Kh{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=c.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,m){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+m}}const Yh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},fa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Jh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Tu{constructor(r,l,m=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Ks({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,m&&(this.mousePitch=new ha({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),c.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),ut()}move(r,l){const m=this.map,x=this.mouseRotate.mousemoveWindow(r,l),E=x&&x.bearingDelta;if(E&&m.setBearing(m.getBearing()+E),this.mousePitch){const p=this.mousePitch.mousemoveWindow(r,l),_=p&&p.pitchDelta;_&&m.setPitch(m.getPitch()+_)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Bt(),c.window.removeEventListener("mousemove",this.mousemove),c.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(c.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),st(this.element,r)),c.window.addEventListener("mousemove",this.mousemove),c.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,st(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=tr(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=tr(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const $i={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Mc={maxWidth:100,unit:"metric"};function $l(h,r,l){const m=qc(r),x=m/r,E={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[l];this._map._requestDomTask(()=>{this._container.style.width=h*x+"px",this._container.innerHTML=`${m}&nbsp;${E}`})}function qc(h){const r=Math.pow(10,`${Math.floor(h)}`.length-1);let l=h/r;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:l>=1?1:function(m){const x=Math.pow(10,Math.ceil(-Math.log(m)/Math.LN10));return Math.round(m*x)/x}(l),r*l}const Oo={version:c.version,supported:Jt,setRTLTextPlugin:c.setRTLTextPlugin,getRTLTextPluginStatus:c.getRTLTextPluginStatus,Map:class extends Gc{constructor(h){if(c.LivePerformanceUtils.mark(c.PerformanceMarkers.create),null!=(h=c.extend({},fa,h)).minZoom&&null!=h.maxZoom&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=h.minPitch&&null!=h.maxPitch&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=h.minPitch&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=h.maxPitch&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&c.isSafariWithAntialiasingBug(c.window)&&(h.antialias=!1,c.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new xr(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new ac,this._domRenderTaskQueue=new ac,this._controls=[],this._markers=[],this._popups=[],this._mapId=c.uniqueId(),this._locale=c.extend({},Yh,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Kh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new c.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,"string"==typeof h.container){if(this._container=c.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof c.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&c.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),c.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==c.window&&(c.window.addEventListener("online",this._onWindowOnline,!1),c.window.addEventListener("resize",this._onWindowResize,!1),c.window.addEventListener("orientationchange",this._onWindowResize,!1),c.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new da(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new Et("string"==typeof h.hash&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,c.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new Ia({customAttribution:h.customAttribution})),this._logoControl=new Hc,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new c.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new c.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(h,r){if(void 0===r&&(r=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=h.onAdd(this);this._controls.push(h);const m=this._controlPositions[r];return-1!==r.indexOf("bottom")?m.insertBefore(l,m.firstChild):m.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(h);return r>-1&&this._controls.splice(r,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new c.Event("movestart",h)).fire(new c.Event("move",h)),this.fire(new c.Event("resize",h)),r&&this.fire(new c.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(c.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return"auto"===h?c.window.navigator.language:Array.isArray(h)?0===h.length?void 0:h.map(r=>"auto"===r?c.window.navigator.language:r):h}setLanguage(h){const r=this._parseLanguage(h);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(h){return this._lazyInitEmptyStyle(),h?"string"==typeof h&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const h=this.transform,r=h.projection.name;let l;"globe"===r&&h.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?(h.setMercatorFromTransition(),l=!0):"mercator"===r&&h.zoom<c.GLOBE_ZOOM_THRESHOLD_MAX&&(h.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,r){return this._updateProjection(h||r||{name:"mercator"})}_updateProjection(h){let r;if(r="globe"===h.name&&this.transform.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(h){return this.transform.locationPoint3D(c.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(c.pointGeometry.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,r,l){if("mouseenter"===h||"mouseover"===h){let m=!1;const x=p=>{const _=r.filter(w=>this.getLayer(w)),g=_.length?this.queryRenderedFeatures(p.point,{layers:_}):[];g.length?m||(m=!0,l.call(this,new ln(h,this,p.originalEvent,{features:g}))):m=!1},E=()=>{m=!1};return{layers:new Set(r),listener:l,delegates:{mousemove:x,mouseout:E}}}if("mouseleave"===h||"mouseout"===h){let m=!1;const x=p=>{const _=r.filter(g=>this.getLayer(g));(_.length?this.queryRenderedFeatures(p.point,{layers:_}):[]).length?m=!0:m&&(m=!1,l.call(this,new ln(h,this,p.originalEvent)))},E=p=>{m&&(m=!1,l.call(this,new ln(h,this,p.originalEvent)))};return{layers:new Set(r),listener:l,delegates:{mousemove:x,mouseout:E}}}{const m=x=>{const E=r.filter(_=>this.getLayer(_)),p=E.length?this.queryRenderedFeatures(x.point,{layers:E}):[];p.length&&(x.features=p,l.call(this,x),delete x.features)};return{layers:new Set(r),listener:l,delegates:{[h]:m}}}}on(h,r,l){if(void 0===l)return super.on(h,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(h,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(m);for(const x in m.delegates)this.on(x,m.delegates[x]);return this}once(h,r,l){if(void 0===l)return super.once(h,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(h,r,l);for(const x in m.delegates)this.once(x,m.delegates[x]);return this}off(h,r,l){if(void 0===l)return super.off(h,r);r=new Set(Array.isArray(r)?r:[r]);const m=(E,p)=>{if(E.size!==p.size)return!1;for(const _ of E)if(!p.has(_))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[h]:void 0;return x&&(E=>{for(let p=0;p<E.length;p++){const _=E[p];if(_.listener===l&&m(_.layers,r)){for(const g in _.delegates)this.off(g,_.delegates[g]);return E.splice(p,1),this}}})(x),this}queryRenderedFeatures(h,r){return this.style?(void 0!==r||void 0===h||h instanceof c.pointGeometry||Array.isArray(h)||(r=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(h,r){return this.style.querySourceFeatures(h,r)}setStyle(h,r){return!1!==(r=c.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(h,r))}_getUIString(h){const r=this._locale[h];if(null==r)throw new Error(`Missing UI string '${h}'`);return r}_updateStyle(h,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new Zi(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof h?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Zi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,r){if("string"==typeof h){const l=this._requestManager.normalizeStyleURL(h),m=this._requestManager.transformRequest(l,c.ResourceType.Style);c.getJSON(m,(x,E)=>{x?this.fire(new c.ErrorEvent(x)):E&&this._updateDiff(E,r)})}else"object"==typeof h&&this._updateDiff(h,r)}_updateDiff(h,r){try{this.style.setState(h)&&this._update(!0)}catch(l){c.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(h,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(c.warnOnce("There is no style added to the map."),!1)}addSource(h,r){return this._lazyInitEmptyStyle(),this.style.addSource(h,r),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const r in h){const l=h[r]._tiles;for(const m in l){const x=l[m];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(h,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(h,r,l)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,r,{pixelRatio:l=1,sdf:m=!1,stretchX:x,stretchY:E,content:p}={}){if(this._lazyInitEmptyStyle(),r instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&r instanceof c.window.ImageBitmap){const{width:_,height:g,data:w}=c.exported.getImageData(r);this.style.addImage(h,{data:new c.RGBAImage({width:_,height:g},w),pixelRatio:l,stretchX:x,stretchY:E,content:p,sdf:m,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:_,height:g}=r,w=r;this.style.addImage(h,{data:new c.RGBAImage({width:_,height:g},new Uint8Array(w.data)),pixelRatio:l,stretchX:x,stretchY:E,content:p,sdf:m,version:0,userImage:w}),w.onAdd&&w.onAdd(this,h)}}updateImage(h,r){const l=this.style.getImage(h);if(!l)return void this.fire(new c.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=r instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&r instanceof c.window.ImageBitmap?c.exported.getImageData(r):r,{width:x,height:E}=m;void 0!==x&&void 0!==E?x===l.data.width&&E===l.data.height?(l.data.replace(m.data,!(r instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&r instanceof c.window.ImageBitmap)),this.style.updateImage(h,l)):this.fire(new c.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${E})\n                must be that same as the previous version of the image\n                (${l.data.width}, ${l.data.height})`))):this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new c.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,r){c.getImage(this._requestManager.transformRequest(h,c.ResourceType.Image),(l,m)=>{r(l,m instanceof c.window.HTMLImageElement?c.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(h,r){return this._lazyInitEmptyStyle(),this.style.addLayer(h,r),this._update(!0)}moveLayer(h,r){return this.style.moveLayer(h,r),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,r,l){return this.style.setLayerZoomRange(h,r,l),this._update(!0)}setFilter(h,r,l={}){return this.style.setFilter(h,r,l),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,r,l,m={}){return this.style.setPaintProperty(h,r,l,m),this._update(!0)}getPaintProperty(h,r){return this.style.getPaintProperty(h,r)}setLayoutProperty(h,r,l,m={}){return this.style.setLayoutProperty(h,r,l,m),this._update(!0)}getLayoutProperty(h,r){return this.style.getLayoutProperty(h,r)}setLight(h,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.LngLat.convert(h),this.transform):0}setFeatureState(h,r){return this.style.setFeatureState(h,r),this._update()}removeFeatureState(h,r){return this.style.removeFeatureState(h,r),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let l,m,x,E=this._container;for(;E&&(!m||!x);){const p=c.window.getComputedStyle(E).transform;p&&"none"!==p&&(l=p.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&"0"!==l[0]&&"1"!==l[0]&&(m=l[0]),l[3]&&"0"!==l[3]&&"1"!==l[3]&&(x=l[3])),E=E.parentElement}this._containerWidth=m?Math.abs(h/m):h,this._containerHeight=x?Math.abs(r/x):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==c.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&c.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=pt("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=pt("div","mapboxgl-canvas-container",h);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=pt("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=pt("div","mapboxgl-control-container",h),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{m[x]=pt("div",`mapboxgl-ctrl-${x}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,r){const l=c.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${r}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const r=this._markers.indexOf(h);-1!==r&&this._markers.splice(r,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const r=this._popups.indexOf(h);-1!==r&&this._popups.splice(r,1)}_setupPainter(){const h=c.extend({},Jt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);r?(c.storeAuthState(r,!0),this.painter=new tt(r,this.transform),this.on("data",l=>{"source"===l.dataType&&this.painter.setTileLoadedFlag(!0)}),c.exported$1.testSupport(r)):this.fire(new c.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new c.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let r;const l=this.painter.context.extTimerQuery,m=c.exported.now();if(this.listens("gpu-timing-frame")&&(r=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],c.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],c.window.performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const _=this.transform.zoom,g=this.transform.pitch,w=c.exported.now(),D=new c.EvaluationParameters(_,{now:w,fadeDuration:x,pitch:g,transition:this.style.getTransition()});this.style.update(D)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new c.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const _=c.exported.now()-m;l.endQueryEXT(l.TIME_ELAPSED_EXT,r),setTimeout(()=>{const g=l.getQueryObjectEXT(r,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(r),this.fire(new c.Event("gpu-timing-frame",{cpuTime:_,gpuTime:g})),c.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:g}})},50)}if(this.listens("gpu-timing-layer")){const _=this.painter.collectGpuTimers();setTimeout(()=>{const g=this.painter.queryGpuTimers(_);this.fire(new c.Event("gpu-timing-layer",{layerTimes:g}))},50)}if(this.listens("gpu-timing-deferred-render")){const _=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const g=this.painter.queryGpuTimeDeferredRender(_);this.fire(new c.Event("gpu-timing-deferred-render",{gpuTime:g}))},50)}const p=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(p||this._repaint)this.triggerRepaint();else{const _=!this.isMoving()&&this.loaded();if(_&&(E=this._updateAverageElevation(m,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),_&&(this.fire(new c.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const g=this._calculateSpeedIndex();this.fire(new c.Event("speedindexcompleted",{speedIndex:g})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,c.LivePerformanceUtils.mark(c.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&c.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const r of this._markers)h&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!h||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(h,r=!1){const l=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);if((r||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const m=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),E=!1;this.transform.elevation&&(E=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=h;const p=Math.abs(m-x);if(p>1){if(this._isInitialLoad||E)return this._averageElevation.jumpTo(x),l(x);this._averageElevation.easeTo(x,h,300)}else if(p>1e-4)return this._averageElevation.jumpTo(x),l(x)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){c.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===c.AUTH_ERR_MSG||401===h.status)){const r=this.painter.context.gl;c.storeAuthState(r,!1),this._logoControl instanceof Hc&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),c.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,m=l.createFramebuffer();function x(E){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,E,0);const p=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,p),p}return l.bindFramebuffer(l.FRAMEBUFFER,m),this._canvasPixelComparison(x(h),r.canvasCopies.map(x),r.timeStamps)}_canvasPixelComparison(h,r,l){let m=l[1]-l[0];const x=h.length/4;for(let E=0;E<r.length;E++){const p=r[E];let _=0;for(let g=0;g<p.length;g+=4)p[g]===h[g]&&p[g+1]===h[g+1]&&p[g+2]===h[g+2]&&p[g+3]===h[g+3]&&(_+=1);m+=(l[E+2]-l[E+1])*(1-_/x)}return m}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==c.window&&(c.window.removeEventListener("resize",this._onWindowResize,!1),c.window.removeEventListener("orientationchange",this._onWindowResize,!1),c.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.removeEventListener("online",this._onWindowOnline,!1),c.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),c.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new c.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=c.exported.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(h){const r=this.style?Object.values(this.style._sourceCaches):[];return c.asyncAll(r,(l,m)=>l._preloadTiles(h,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){"hidden"===c.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,r){c.setCacheLimits(h,r)}get version(){return c.version}},NavigationControl:class{constructor(h){this.options=c.extend({},Jh,h),this._container=pt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(c.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),pt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),pt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=pt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const r=h.getZoom(),l=r===h.getMaxZoom(),m=r===h.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Tu(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,r){const l=pt("button",h,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(h,r){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${r}`);h.setAttribute("aria-label",l),h.firstElementChild&&h.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends c.Evented{constructor(h){super(),this.options=c.extend({geolocation:c.window.navigator.geolocation},$i,h),c.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=rr(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=pt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const r=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,h(l)};void 0!==this._supportsGeolocation?h(this._supportsGeolocation):void 0!==c.window.navigator.permissions?c.window.navigator.permissions.query({name:"geolocation"}).then(l=>r("denied"!==l.state)).catch(()=>r()):r()}_isOutOfMapMaxBounds(h){const r=this._map.getMaxBounds(),l=h.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new c.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(h),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("geolocate",h)),this._finish()}}_updateCamera(h){const r=new c.LngLat(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,m=this._map.getBearing(),x=c.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),x,{geolocateSource:!0})}_updateMarker(h){if(h){const r=new c.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,r=c.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(1===h.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===h.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=pt("button","mapboxgl-ctrl-geolocate",this._container),pt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===h){c.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=pt("div","mapboxgl-user-location"),this._dotElement.appendChild(pt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(pt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Cc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=pt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.Event("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:!0===h.absolute&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{c.window.addEventListener("ondeviceorientationabsolute"in c.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==c.window.DeviceMotionEvent&&"function"==typeof c.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),c.window.removeEventListener("deviceorientation",this._onDeviceOrientation),c.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ia,ScaleControl:class{constructor(h){this.options=c.extend({},Mc,h),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=$l.bind(this)),c.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,m=r._containerWidth/2-h/2,x=r.unproject([m,l]),E=r.unproject([m+h,l]),p=x.distanceTo(E);if("imperial"===this.options.unit){const _=3.2808*p;_>5280?this._setScale(h,_/5280,"mile"):this._setScale(h,_,"foot")}else"nautical"===this.options.unit?this._setScale(h,p/1852,"nautical-mile"):p>=1e3?this._setScale(h,p/1e3,"kilometer"):this._setScale(h,p,"meter")}_setScale(h,r,l){const m=qc(r),x=m/r;this._map._requestDomTask(()=>{this._container.style.width=h*x+"px",this._container.innerHTML="nautical-mile"!==l?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:l}).format(m):`${m}&nbsp;nm`})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=pt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof c.window.HTMLElement?this._container=h.container:c.warnOnce("Full screen control 'container' must be a DOM element.")),c.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in c.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in c.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=pt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,c.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!c.window.document.fullscreenEnabled&&!c.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=pt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);pt("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),c.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(c.window.document.fullscreenElement||c.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?c.window.document.exitFullscreen?c.window.document.exitFullscreen():c.window.document.webkitCancelFullScreen&&c.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends c.Evented{constructor(h){super(),this.options=c.extend(Object.create(Sc),h),c.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new c.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new c.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=c.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(c.window.document.createTextNode(h))}setHTML(h){const r=c.window.document.createDocumentFragment(),l=c.window.document.createElement("body");let m;for(l.innerHTML=h;m=l.firstChild,m;)r.appendChild(m);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=pt("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(h),this.options.closeButton){const l=this._closeButton=pt("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let r;return this._classList.delete(h)?r=!1:(this._classList.add(h),r=!0),this._updateClassList(),r}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const r=this._map,l=this._container,m=this._pos;if(!r||!l||!m)return"bottom";const x=l.offsetWidth,E=l.offsetHeight,p=m.x<x/2,_=m.x>r.transform.width-x/2;if(m.y+h<E)return p?"top-left":_?"top-right":"top";if(m.y>r.transform.height-E){if(p)return"bottom-left";if(_)return"bottom-right"}return p?"left":_?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),h.className=r.join(" ")}_update(h){const r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let m=this._container;if(m||(m=this._container=pt("div","mapboxgl-popup",r.getContainer()),this._tip=pt("div","mapboxgl-popup-tip",m),m.appendChild(l)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ni(this._lngLat,this._pos,r.transform)),!this._trackPointer||h){const x=this._pos=this._trackPointer&&h?h:r.project(this._lngLat),E=dh(this.options.offset),p=this._anchor=this._getAnchor(E.y),_=dh(this.options.offset,p),g=x.add(_).round();r._requestDomTask(()=>{this._container&&p&&(this._container.style.transform=`${lc[p]} translate(${g.x}px,${g.y}px)`)})}if(!this._marker&&r._showingGlobe()){const x=c.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(hh);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Cc,Style:Zi,LngLat:c.LngLat,LngLatBounds:c.LngLatBounds,Point:c.pointGeometry,MercatorCoordinate:c.MercatorCoordinate,FreeCameraOptions:_e,Evented:c.Evented,config:c.config,prewarm:function(){vn().acquire(bt)},clearPrewarmedResources:function(){const h=on;h&&(h.isPreloaded()&&1===h.numActive()?(h.release(bt),on=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return c.config.ACCESS_TOKEN},set accessToken(h){c.config.ACCESS_TOKEN=h},get baseApiUrl(){return c.config.API_URL},set baseApiUrl(h){c.config.API_URL=h},get workerCount(){return Wt.workerCount},set workerCount(h){Wt.workerCount=h},get maxParallelImageRequests(){return c.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){c.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){c.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:c.exported.setNow,restoreNow:c.exported.restoreNow};return Oo}),W}()},9751:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{y:()=>zt});var W=Ee(2961),me=Ee(727),$e=Ee(8822),c=Ee(9635),Pe=Ee(2416),Jt=Ee(576),Vt=Ee(2806);let zt=(()=>{class $t{constructor(ut){ut&&(this._subscribe=ut)}lift(ut){const Bt=new $t;return Bt.source=this,Bt.operator=ut,Bt}subscribe(ut,Bt,cn){const Wn=function ct($t){return $t&&$t instanceof W.Lv||function yt($t){return $t&&(0,Jt.m)($t.next)&&(0,Jt.m)($t.error)&&(0,Jt.m)($t.complete)}($t)&&(0,me.Nn)($t)}(ut)?ut:new W.Hp(ut,Bt,cn);return(0,Vt.x)(()=>{const{operator:st,source:tr}=this;Wn.add(st?st.call(Wn,tr):tr?this._subscribe(Wn):this._trySubscribe(Wn))}),Wn}_trySubscribe(ut){try{return this._subscribe(ut)}catch(Bt){ut.error(Bt)}}forEach(ut,Bt){return new(Bt=pt(Bt))((cn,Wn)=>{const st=new W.Hp({next:tr=>{try{ut(tr)}catch(en){Wn(en),st.unsubscribe()}},error:Wn,complete:cn});this.subscribe(st)})}_subscribe(ut){var Bt;return null===(Bt=this.source)||void 0===Bt?void 0:Bt.subscribe(ut)}[$e.L](){return this}pipe(...ut){return(0,c.U)(ut)(this)}toPromise(ut){return new(ut=pt(ut))((Bt,cn)=>{let Wn;this.subscribe(st=>Wn=st,st=>cn(st),()=>Bt(Wn))})}}return $t.create=Kt=>new $t(Kt),$t})();function pt($t){var Kt;return null!==(Kt=$t??Pe.v.Promise)&&void 0!==Kt?Kt:Promise}},7579:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{x:()=>Vt});var W=Ee(9751),me=Ee(727);const c=(0,Ee(3888).d)(pt=>function(){pt(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Pe=Ee(8737),Jt=Ee(2806);let Vt=(()=>{class pt extends W.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(ct){const $t=new zt(this,this);return $t.operator=ct,$t}_throwIfClosed(){if(this.closed)throw new c}next(ct){(0,Jt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const $t of this.currentObservers)$t.next(ct)}})}error(ct){(0,Jt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=ct;const{observers:$t}=this;for(;$t.length;)$t.shift().error(ct)}})}complete(){(0,Jt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:ct}=this;for(;ct.length;)ct.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var ct;return(null===(ct=this.observers)||void 0===ct?void 0:ct.length)>0}_trySubscribe(ct){return this._throwIfClosed(),super._trySubscribe(ct)}_subscribe(ct){return this._throwIfClosed(),this._checkFinalizedStatuses(ct),this._innerSubscribe(ct)}_innerSubscribe(ct){const{hasError:$t,isStopped:Kt,observers:ut}=this;return $t||Kt?me.Lc:(this.currentObservers=null,ut.push(ct),new me.w0(()=>{this.currentObservers=null,(0,Pe.P)(ut,ct)}))}_checkFinalizedStatuses(ct){const{hasError:$t,thrownError:Kt,isStopped:ut}=this;$t?ct.error(Kt):ut&&ct.complete()}asObservable(){const ct=new W.y;return ct.source=this,ct}}return pt.create=(yt,ct)=>new zt(yt,ct),pt})();class zt extends Vt{constructor(yt,ct){super(),this.destination=yt,this.source=ct}next(yt){var ct,$t;null===($t=null===(ct=this.destination)||void 0===ct?void 0:ct.next)||void 0===$t||$t.call(ct,yt)}error(yt){var ct,$t;null===($t=null===(ct=this.destination)||void 0===ct?void 0:ct.error)||void 0===$t||$t.call(ct,yt)}complete(){var yt,ct;null===(ct=null===(yt=this.destination)||void 0===yt?void 0:yt.complete)||void 0===ct||ct.call(yt)}_subscribe(yt){var ct,$t;return null!==($t=null===(ct=this.source)||void 0===ct?void 0:ct.subscribe(yt))&&void 0!==$t?$t:me.Lc}}},2961:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{Hp:()=>cn,Lv:()=>$t});var W=Ee(576),me=Ee(727),$e=Ee(2416),c=Ee(7849);function Pe(){}const Jt=pt("C",void 0,void 0);function pt(rn,ht,un){return{kind:rn,value:ht,error:un}}var yt=Ee(3410),ct=Ee(2806);class $t extends me.w0{constructor(ht){super(),this.isStopped=!1,ht?(this.destination=ht,(0,me.Nn)(ht)&&ht.add(this)):this.destination=en}static create(ht,un,ur){return new cn(ht,un,ur)}next(ht){this.isStopped?tr(function zt(rn){return pt("N",rn,void 0)}(ht),this):this._next(ht)}error(ht){this.isStopped?tr(function Vt(rn){return pt("E",void 0,rn)}(ht),this):(this.isStopped=!0,this._error(ht))}complete(){this.isStopped?tr(Jt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(ht){this.destination.next(ht)}_error(ht){try{this.destination.error(ht)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Kt=Function.prototype.bind;function ut(rn,ht){return Kt.call(rn,ht)}class Bt{constructor(ht){this.partialObserver=ht}next(ht){const{partialObserver:un}=this;if(un.next)try{un.next(ht)}catch(ur){Wn(ur)}}error(ht){const{partialObserver:un}=this;if(un.error)try{un.error(ht)}catch(ur){Wn(ur)}else Wn(ht)}complete(){const{partialObserver:ht}=this;if(ht.complete)try{ht.complete()}catch(un){Wn(un)}}}class cn extends $t{constructor(ht,un,ur){let Dt;if(super(),(0,W.m)(ht)||!ht)Dt={next:ht??void 0,error:un??void 0,complete:ur??void 0};else{let Yt;this&&$e.v.useDeprecatedNextContext?(Yt=Object.create(ht),Yt.unsubscribe=()=>this.unsubscribe(),Dt={next:ht.next&&ut(ht.next,Yt),error:ht.error&&ut(ht.error,Yt),complete:ht.complete&&ut(ht.complete,Yt)}):Dt=ht}this.destination=new Bt(Dt)}}function Wn(rn){$e.v.useDeprecatedSynchronousErrorHandling?(0,ct.O)(rn):(0,c.h)(rn)}function tr(rn,ht){const{onStoppedNotification:un}=$e.v;un&&yt.z.setTimeout(()=>un(rn,ht))}const en={closed:!0,next:Pe,error:function st(rn){throw rn},complete:Pe}},727:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{Lc:()=>Jt,w0:()=>Pe,Nn:()=>Vt});var W=Ee(576);const $e=(0,Ee(3888).d)(pt=>function(ct){pt(this),this.message=ct?`${ct.length} errors occurred during unsubscription:\n${ct.map(($t,Kt)=>`${Kt+1}) ${$t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=ct});var c=Ee(8737);class Pe{constructor(yt){this.initialTeardown=yt,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let yt;if(!this.closed){this.closed=!0;const{_parentage:ct}=this;if(ct)if(this._parentage=null,Array.isArray(ct))for(const ut of ct)ut.remove(this);else ct.remove(this);const{initialTeardown:$t}=this;if((0,W.m)($t))try{$t()}catch(ut){yt=ut instanceof $e?ut.errors:[ut]}const{_finalizers:Kt}=this;if(Kt){this._finalizers=null;for(const ut of Kt)try{zt(ut)}catch(Bt){yt=yt??[],Bt instanceof $e?yt=[...yt,...Bt.errors]:yt.push(Bt)}}if(yt)throw new $e(yt)}}add(yt){var ct;if(yt&&yt!==this)if(this.closed)zt(yt);else{if(yt instanceof Pe){if(yt.closed||yt._hasParent(this))return;yt._addParent(this)}(this._finalizers=null!==(ct=this._finalizers)&&void 0!==ct?ct:[]).push(yt)}}_hasParent(yt){const{_parentage:ct}=this;return ct===yt||Array.isArray(ct)&&ct.includes(yt)}_addParent(yt){const{_parentage:ct}=this;this._parentage=Array.isArray(ct)?(ct.push(yt),ct):ct?[ct,yt]:yt}_removeParent(yt){const{_parentage:ct}=this;ct===yt?this._parentage=null:Array.isArray(ct)&&(0,c.P)(ct,yt)}remove(yt){const{_finalizers:ct}=this;ct&&(0,c.P)(ct,yt),yt instanceof Pe&&yt._removeParent(this)}}Pe.EMPTY=(()=>{const pt=new Pe;return pt.closed=!0,pt})();const Jt=Pe.EMPTY;function Vt(pt){return pt instanceof Pe||pt&&"closed"in pt&&(0,W.m)(pt.remove)&&(0,W.m)(pt.add)&&(0,W.m)(pt.unsubscribe)}function zt(pt){(0,W.m)(pt)?pt():pt.unsubscribe()}},2416:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{v:()=>W});const W={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},515:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{E:()=>me});const me=new(Ee(9751).y)(Pe=>Pe.complete())},2076:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{D:()=>ur});var W=Ee(8421),me=Ee(9672),$e=Ee(4482),c=Ee(5403);function Pe(Dt,Yt=0){return(0,$e.e)((_t,gt)=>{_t.subscribe((0,c.x)(gt,dn=>(0,me.f)(gt,Dt,()=>gt.next(dn),Yt),()=>(0,me.f)(gt,Dt,()=>gt.complete(),Yt),dn=>(0,me.f)(gt,Dt,()=>gt.error(dn),Yt)))})}function Jt(Dt,Yt=0){return(0,$e.e)((_t,gt)=>{gt.add(Dt.schedule(()=>_t.subscribe(gt),Yt))})}var pt=Ee(9751),ct=Ee(2202),$t=Ee(576);function ut(Dt,Yt){if(!Dt)throw new Error("Iterable cannot be null");return new pt.y(_t=>{(0,me.f)(_t,Yt,()=>{const gt=Dt[Symbol.asyncIterator]();(0,me.f)(_t,Yt,()=>{gt.next().then(dn=>{dn.done?_t.complete():_t.next(dn.value)})},0,!0)})})}var Bt=Ee(3670),cn=Ee(8239),Wn=Ee(1144),st=Ee(6495),tr=Ee(2206),en=Ee(4532),rn=Ee(3260);function ur(Dt,Yt){return Yt?function un(Dt,Yt){if(null!=Dt){if((0,Bt.c)(Dt))return function Vt(Dt,Yt){return(0,W.Xf)(Dt).pipe(Jt(Yt),Pe(Yt))}(Dt,Yt);if((0,Wn.z)(Dt))return function yt(Dt,Yt){return new pt.y(_t=>{let gt=0;return Yt.schedule(function(){gt===Dt.length?_t.complete():(_t.next(Dt[gt++]),_t.closed||this.schedule())})})}(Dt,Yt);if((0,cn.t)(Dt))return function zt(Dt,Yt){return(0,W.Xf)(Dt).pipe(Jt(Yt),Pe(Yt))}(Dt,Yt);if((0,tr.D)(Dt))return ut(Dt,Yt);if((0,st.T)(Dt))return function Kt(Dt,Yt){return new pt.y(_t=>{let gt;return(0,me.f)(_t,Yt,()=>{gt=Dt[ct.h](),(0,me.f)(_t,Yt,()=>{let dn,Kn;try{({value:dn,done:Kn}=gt.next())}catch(hn){return void _t.error(hn)}Kn?_t.complete():_t.next(dn)},0,!0)}),()=>(0,$t.m)(gt?.return)&&gt.return()})}(Dt,Yt);if((0,rn.L)(Dt))return function ht(Dt,Yt){return ut((0,rn.Q)(Dt),Yt)}(Dt,Yt)}throw(0,en.z)(Dt)}(Dt,Yt):(0,W.Xf)(Dt)}},8421:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{Xf:()=>Kt});var W=Ee(7582),me=Ee(1144),$e=Ee(8239),c=Ee(9751),Pe=Ee(3670),Jt=Ee(2206),Vt=Ee(4532),zt=Ee(6495),pt=Ee(3260),yt=Ee(576),ct=Ee(7849),$t=Ee(8822);function Kt(rn){if(rn instanceof c.y)return rn;if(null!=rn){if((0,Pe.c)(rn))return function ut(rn){return new c.y(ht=>{const un=rn[$t.L]();if((0,yt.m)(un.subscribe))return un.subscribe(ht);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(rn);if((0,me.z)(rn))return function Bt(rn){return new c.y(ht=>{for(let un=0;un<rn.length&&!ht.closed;un++)ht.next(rn[un]);ht.complete()})}(rn);if((0,$e.t)(rn))return function cn(rn){return new c.y(ht=>{rn.then(un=>{ht.closed||(ht.next(un),ht.complete())},un=>ht.error(un)).then(null,ct.h)})}(rn);if((0,Jt.D)(rn))return st(rn);if((0,zt.T)(rn))return function Wn(rn){return new c.y(ht=>{for(const un of rn)if(ht.next(un),ht.closed)return;ht.complete()})}(rn);if((0,pt.L)(rn))return function tr(rn){return st((0,pt.Q)(rn))}(rn)}throw(0,Vt.z)(rn)}function st(rn){return new c.y(ht=>{(function en(rn,ht){var un,ur,Dt,Yt;return(0,W.mG)(this,void 0,void 0,function*(){try{for(un=(0,W.KL)(rn);!(ur=yield un.next()).done;)if(ht.next(ur.value),ht.closed)return}catch(_t){Dt={error:_t}}finally{try{ur&&!ur.done&&(Yt=un.return)&&(yield Yt.call(un))}finally{if(Dt)throw Dt.error}}ht.complete()})})(rn,ht).catch(un=>ht.error(un))})}},9646:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{of:()=>$e});var W=Ee(7669),me=Ee(2076);function $e(...c){const Pe=(0,W.yG)(c);return(0,me.D)(c,Pe)}},5403:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{x:()=>me});var W=Ee(2961);function me(c,Pe,Jt,Vt,zt){return new $e(c,Pe,Jt,Vt,zt)}class $e extends W.Lv{constructor(Pe,Jt,Vt,zt,pt,yt){super(Pe),this.onFinalize=pt,this.shouldUnsubscribe=yt,this._next=Jt?function(ct){try{Jt(ct)}catch($t){Pe.error($t)}}:super._next,this._error=zt?function(ct){try{zt(ct)}catch($t){Pe.error($t)}finally{this.unsubscribe()}}:super._error,this._complete=Vt?function(){try{Vt()}catch(ct){Pe.error(ct)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var Pe;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:Jt}=this;super.unsubscribe(),!Jt&&(null===(Pe=this.onFinalize)||void 0===Pe||Pe.call(this))}}}},4351:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{b:()=>$e});var W=Ee(5577),me=Ee(576);function $e(c,Pe){return(0,me.m)(Pe)?(0,W.z)(c,Pe,1):(0,W.z)(c,1)}},9300:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{h:()=>$e});var W=Ee(4482),me=Ee(5403);function $e(c,Pe){return(0,W.e)((Jt,Vt)=>{let zt=0;Jt.subscribe((0,me.x)(Vt,pt=>c.call(Pe,pt,zt++)&&Vt.next(pt)))})}},4004:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{U:()=>$e});var W=Ee(4482),me=Ee(5403);function $e(c,Pe){return(0,W.e)((Jt,Vt)=>{let zt=0;Jt.subscribe((0,me.x)(Vt,pt=>{Vt.next(c.call(Pe,pt,zt++))}))})}},8189:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{J:()=>$e});var W=Ee(5577),me=Ee(4671);function $e(c=1/0){return(0,W.z)(me.y,c)}},5577:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{z:()=>zt});var W=Ee(4004),me=Ee(8421),$e=Ee(4482),c=Ee(9672),Pe=Ee(5403),Vt=Ee(576);function zt(pt,yt,ct=1/0){return(0,Vt.m)(yt)?zt(($t,Kt)=>(0,W.U)((ut,Bt)=>yt($t,ut,Kt,Bt))((0,me.Xf)(pt($t,Kt))),ct):("number"==typeof yt&&(ct=yt),(0,$e.e)(($t,Kt)=>function Jt(pt,yt,ct,$t,Kt,ut,Bt,cn){const Wn=[];let st=0,tr=0,en=!1;const rn=()=>{en&&!Wn.length&&!st&&yt.complete()},ht=ur=>st<$t?un(ur):Wn.push(ur),un=ur=>{ut&&yt.next(ur),st++;let Dt=!1;(0,me.Xf)(ct(ur,tr++)).subscribe((0,Pe.x)(yt,Yt=>{Kt?.(Yt),ut?ht(Yt):yt.next(Yt)},()=>{Dt=!0},void 0,()=>{if(Dt)try{for(st--;Wn.length&&st<$t;){const Yt=Wn.shift();Bt?(0,c.f)(yt,Bt,()=>un(Yt)):un(Yt)}rn()}catch(Yt){yt.error(Yt)}}))};return pt.subscribe((0,Pe.x)(yt,ht,()=>{en=!0,rn()})),()=>{cn?.()}}($t,Kt,pt,ct)))}},3900:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{w:()=>c});var W=Ee(8421),me=Ee(4482),$e=Ee(5403);function c(Pe,Jt){return(0,me.e)((Vt,zt)=>{let pt=null,yt=0,ct=!1;const $t=()=>ct&&!pt&&zt.complete();Vt.subscribe((0,$e.x)(zt,Kt=>{pt?.unsubscribe();let ut=0;const Bt=yt++;(0,W.Xf)(Pe(Kt,Bt)).subscribe(pt=(0,$e.x)(zt,cn=>zt.next(Jt?Jt(Kt,cn,Bt,ut++):cn),()=>{pt=null,$t()}))},()=>{ct=!0,$t()}))})}},8505:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{b:()=>Pe});var W=Ee(576),me=Ee(4482),$e=Ee(5403),c=Ee(4671);function Pe(Jt,Vt,zt){const pt=(0,W.m)(Jt)||Vt||zt?{next:Jt,error:Vt,complete:zt}:Jt;return pt?(0,me.e)((yt,ct)=>{var $t;null===($t=pt.subscribe)||void 0===$t||$t.call(pt);let Kt=!0;yt.subscribe((0,$e.x)(ct,ut=>{var Bt;null===(Bt=pt.next)||void 0===Bt||Bt.call(pt,ut),ct.next(ut)},()=>{var ut;Kt=!1,null===(ut=pt.complete)||void 0===ut||ut.call(pt),ct.complete()},ut=>{var Bt;Kt=!1,null===(Bt=pt.error)||void 0===Bt||Bt.call(pt,ut),ct.error(ut)},()=>{var ut,Bt;Kt&&(null===(ut=pt.unsubscribe)||void 0===ut||ut.call(pt)),null===(Bt=pt.finalize)||void 0===Bt||Bt.call(pt)}))}):c.y}},3410:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{z:()=>W});const W={setTimeout(me,$e,...c){const{delegate:Pe}=W;return Pe?.setTimeout?Pe.setTimeout(me,$e,...c):setTimeout(me,$e,...c)},clearTimeout(me){const{delegate:$e}=W;return($e?.clearTimeout||clearTimeout)(me)},delegate:void 0}},2202:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{h:()=>me});const me=function W(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},8822:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{L:()=>W});const W="function"==typeof Symbol&&Symbol.observable||"@@observable"},7669:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{_6:()=>Jt,jO:()=>c,yG:()=>Pe});var W=Ee(576);function $e(Vt){return Vt[Vt.length-1]}function c(Vt){return(0,W.m)($e(Vt))?Vt.pop():void 0}function Pe(Vt){return function me(Vt){return Vt&&(0,W.m)(Vt.schedule)}($e(Vt))?Vt.pop():void 0}function Jt(Vt,zt){return"number"==typeof $e(Vt)?Vt.pop():zt}},4742:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{D:()=>Pe});const{isArray:W}=Array,{getPrototypeOf:me,prototype:$e,keys:c}=Object;function Pe(Vt){if(1===Vt.length){const zt=Vt[0];if(W(zt))return{args:zt,keys:null};if(function Jt(Vt){return Vt&&"object"==typeof Vt&&me(Vt)===$e}(zt)){const pt=c(zt);return{args:pt.map(yt=>zt[yt]),keys:pt}}}return{args:Vt,keys:null}}},8737:(er,Ht,Ee)=>{"use strict";function W(me,$e){if(me){const c=me.indexOf($e);0<=c&&me.splice(c,1)}}Ee.d(Ht,{P:()=>W})},3888:(er,Ht,Ee)=>{"use strict";function W(me){const c=me(Pe=>{Error.call(Pe),Pe.stack=(new Error).stack});return c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c}Ee.d(Ht,{d:()=>W})},1810:(er,Ht,Ee)=>{"use strict";function W(me,$e){return me.reduce((c,Pe,Jt)=>(c[Pe]=$e[Jt],c),{})}Ee.d(Ht,{n:()=>W})},2806:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{O:()=>c,x:()=>$e});var W=Ee(2416);let me=null;function $e(Pe){if(W.v.useDeprecatedSynchronousErrorHandling){const Jt=!me;if(Jt&&(me={errorThrown:!1,error:null}),Pe(),Jt){const{errorThrown:Vt,error:zt}=me;if(me=null,Vt)throw zt}}else Pe()}function c(Pe){W.v.useDeprecatedSynchronousErrorHandling&&me&&(me.errorThrown=!0,me.error=Pe)}},9672:(er,Ht,Ee)=>{"use strict";function W(me,$e,c,Pe=0,Jt=!1){const Vt=$e.schedule(function(){c(),Jt?me.add(this.schedule(null,Pe)):this.unsubscribe()},Pe);if(me.add(Vt),!Jt)return Vt}Ee.d(Ht,{f:()=>W})},4671:(er,Ht,Ee)=>{"use strict";function W(me){return me}Ee.d(Ht,{y:()=>W})},1144:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{z:()=>W});const W=me=>me&&"number"==typeof me.length&&"function"!=typeof me},2206:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{D:()=>me});var W=Ee(576);function me($e){return Symbol.asyncIterator&&(0,W.m)($e?.[Symbol.asyncIterator])}},576:(er,Ht,Ee)=>{"use strict";function W(me){return"function"==typeof me}Ee.d(Ht,{m:()=>W})},3670:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{c:()=>$e});var W=Ee(8822),me=Ee(576);function $e(c){return(0,me.m)(c[W.L])}},6495:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{T:()=>$e});var W=Ee(2202),me=Ee(576);function $e(c){return(0,me.m)(c?.[W.h])}},8239:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{t:()=>me});var W=Ee(576);function me($e){return(0,W.m)($e?.then)}},3260:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{L:()=>c,Q:()=>$e});var W=Ee(7582),me=Ee(576);function $e(Pe){return(0,W.FC)(this,arguments,function*(){const Vt=Pe.getReader();try{for(;;){const{value:zt,done:pt}=yield(0,W.qq)(Vt.read());if(pt)return yield(0,W.qq)(void 0);yield yield(0,W.qq)(zt)}}finally{Vt.releaseLock()}})}function c(Pe){return(0,me.m)(Pe?.getReader)}},4482:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{A:()=>me,e:()=>$e});var W=Ee(576);function me(c){return(0,W.m)(c?.lift)}function $e(c){return Pe=>{if(me(Pe))return Pe.lift(function(Jt){try{return c(Jt,this)}catch(Vt){this.error(Vt)}});throw new TypeError("Unable to lift unknown Observable type")}}},3268:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{Z:()=>c});var W=Ee(4004);const{isArray:me}=Array;function c(Pe){return(0,W.U)(Jt=>function $e(Pe,Jt){return me(Jt)?Pe(...Jt):Pe(Jt)}(Pe,Jt))}},9635:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{U:()=>$e,z:()=>me});var W=Ee(4671);function me(...c){return $e(c)}function $e(c){return 0===c.length?W.y:1===c.length?c[0]:function(Jt){return c.reduce((Vt,zt)=>zt(Vt),Jt)}}},7849:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{h:()=>$e});var W=Ee(2416),me=Ee(3410);function $e(c){me.z.setTimeout(()=>{const{onUnhandledError:Pe}=W.v;if(!Pe)throw c;Pe(c)})}},4532:(er,Ht,Ee)=>{"use strict";function W(me){return new TypeError(`You provided ${null!==me&&"object"==typeof me?"an invalid object":`'${me}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}Ee.d(Ht,{z:()=>W})},6895:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{Do:()=>tr,EM:()=>pl,HT:()=>c,JF:()=>cs,JJ:()=>ki,K0:()=>Jt,Mx:()=>ra,O5:()=>Hn,PC:()=>Uo,S$:()=>cn,Ts:()=>vi,V_:()=>pt,Ye:()=>en,b0:()=>st,bD:()=>Ha,ez:()=>Zi,gd:()=>wo,q:()=>$e,rS:()=>Ll,sg:()=>Wi,w_:()=>Pe});var W=Ee(8256);let me=null;function $e(){return me}function c(R){me||(me=R)}class Pe{}const Jt=new W.OlP("DocumentToken");let Vt=(()=>{class R{historyGo(z){throw new Error("Not implemented")}}return R.\u0275fac=function(z){return new(z||R)},R.\u0275prov=W.Yz7({token:R,factory:function(){return function zt(){return(0,W.LFG)(yt)}()},providedIn:"platform"}),R})();const pt=new W.OlP("Location Initialized");let yt=(()=>{class R extends Vt{constructor(z){super(),this._doc=z,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return $e().getBaseHref(this._doc)}onPopState(z){const te=$e().getGlobalEventTarget(this._doc,"window");return te.addEventListener("popstate",z,!1),()=>te.removeEventListener("popstate",z)}onHashChange(z){const te=$e().getGlobalEventTarget(this._doc,"window");return te.addEventListener("hashchange",z,!1),()=>te.removeEventListener("hashchange",z)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(z){this._location.pathname=z}pushState(z,te,_e){ct()?this._history.pushState(z,te,_e):this._location.hash=_e}replaceState(z,te,_e){ct()?this._history.replaceState(z,te,_e):this._location.hash=_e}forward(){this._history.forward()}back(){this._history.back()}historyGo(z=0){this._history.go(z)}getState(){return this._history.state}}return R.\u0275fac=function(z){return new(z||R)(W.LFG(Jt))},R.\u0275prov=W.Yz7({token:R,factory:function(){return function $t(){return new yt((0,W.LFG)(Jt))}()},providedIn:"platform"}),R})();function ct(){return!!window.history.pushState}function Kt(R,V){if(0==R.length)return V;if(0==V.length)return R;let z=0;return R.endsWith("/")&&z++,V.startsWith("/")&&z++,2==z?R+V.substring(1):1==z?R+V:R+"/"+V}function ut(R){const V=R.match(/#|\?|$/),z=V&&V.index||R.length;return R.slice(0,z-("/"===R[z-1]?1:0))+R.slice(z)}function Bt(R){return R&&"?"!==R[0]?"?"+R:R}let cn=(()=>{class R{historyGo(z){throw new Error("Not implemented")}}return R.\u0275fac=function(z){return new(z||R)},R.\u0275prov=W.Yz7({token:R,factory:function(){return(0,W.f3M)(st)},providedIn:"root"}),R})();const Wn=new W.OlP("appBaseHref");let st=(()=>{class R extends cn{constructor(z,te){super(),this._platformLocation=z,this._removeListenerFns=[],this._baseHref=te??this._platformLocation.getBaseHrefFromDOM()??(0,W.f3M)(Jt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(z){this._removeListenerFns.push(this._platformLocation.onPopState(z),this._platformLocation.onHashChange(z))}getBaseHref(){return this._baseHref}prepareExternalUrl(z){return Kt(this._baseHref,z)}path(z=!1){const te=this._platformLocation.pathname+Bt(this._platformLocation.search),_e=this._platformLocation.hash;return _e&&z?`${te}${_e}`:te}pushState(z,te,_e,Fe){const Ge=this.prepareExternalUrl(_e+Bt(Fe));this._platformLocation.pushState(z,te,Ge)}replaceState(z,te,_e,Fe){const Ge=this.prepareExternalUrl(_e+Bt(Fe));this._platformLocation.replaceState(z,te,Ge)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(z=0){this._platformLocation.historyGo?.(z)}}return R.\u0275fac=function(z){return new(z||R)(W.LFG(Vt),W.LFG(Wn,8))},R.\u0275prov=W.Yz7({token:R,factory:R.\u0275fac,providedIn:"root"}),R})(),tr=(()=>{class R extends cn{constructor(z,te){super(),this._platformLocation=z,this._baseHref="",this._removeListenerFns=[],null!=te&&(this._baseHref=te)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(z){this._removeListenerFns.push(this._platformLocation.onPopState(z),this._platformLocation.onHashChange(z))}getBaseHref(){return this._baseHref}path(z=!1){let te=this._platformLocation.hash;return null==te&&(te="#"),te.length>0?te.substring(1):te}prepareExternalUrl(z){const te=Kt(this._baseHref,z);return te.length>0?"#"+te:te}pushState(z,te,_e,Fe){let Ge=this.prepareExternalUrl(_e+Bt(Fe));0==Ge.length&&(Ge=this._platformLocation.pathname),this._platformLocation.pushState(z,te,Ge)}replaceState(z,te,_e,Fe){let Ge=this.prepareExternalUrl(_e+Bt(Fe));0==Ge.length&&(Ge=this._platformLocation.pathname),this._platformLocation.replaceState(z,te,Ge)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(z=0){this._platformLocation.historyGo?.(z)}}return R.\u0275fac=function(z){return new(z||R)(W.LFG(Vt),W.LFG(Wn,8))},R.\u0275prov=W.Yz7({token:R,factory:R.\u0275fac}),R})(),en=(()=>{class R{constructor(z){this._subject=new W.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=z;const te=this._locationStrategy.getBaseHref();this._basePath=function ur(R){if(new RegExp("^(https?:)?//").test(R)){const[,z]=R.split(/\/\/[^\/]+/);return z}return R}(ut(un(te))),this._locationStrategy.onPopState(_e=>{this._subject.emit({url:this.path(!0),pop:!0,state:_e.state,type:_e.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(z=!1){return this.normalize(this._locationStrategy.path(z))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(z,te=""){return this.path()==this.normalize(z+Bt(te))}normalize(z){return R.stripTrailingSlash(function ht(R,V){if(!R||!V.startsWith(R))return V;const z=V.substring(R.length);return""===z||["/",";","?","#"].includes(z[0])?z:V}(this._basePath,un(z)))}prepareExternalUrl(z){return z&&"/"!==z[0]&&(z="/"+z),this._locationStrategy.prepareExternalUrl(z)}go(z,te="",_e=null){this._locationStrategy.pushState(_e,"",z,te),this._notifyUrlChangeListeners(this.prepareExternalUrl(z+Bt(te)),_e)}replaceState(z,te="",_e=null){this._locationStrategy.replaceState(_e,"",z,te),this._notifyUrlChangeListeners(this.prepareExternalUrl(z+Bt(te)),_e)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(z=0){this._locationStrategy.historyGo?.(z)}onUrlChange(z){return this._urlChangeListeners.push(z),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(te=>{this._notifyUrlChangeListeners(te.url,te.state)})),()=>{const te=this._urlChangeListeners.indexOf(z);this._urlChangeListeners.splice(te,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(z="",te){this._urlChangeListeners.forEach(_e=>_e(z,te))}subscribe(z,te,_e){return this._subject.subscribe({next:z,error:te,complete:_e})}}return R.normalizeQueryParams=Bt,R.joinWithSlash=Kt,R.stripTrailingSlash=ut,R.\u0275fac=function(z){return new(z||R)(W.LFG(cn))},R.\u0275prov=W.Yz7({token:R,factory:function(){return function rn(){return new en((0,W.LFG)(cn))}()},providedIn:"root"}),R})();function un(R){return R.replace(/\/index.html$/,"")}var Yt=(()=>((Yt=Yt||{})[Yt.Decimal=0]="Decimal",Yt[Yt.Percent=1]="Percent",Yt[Yt.Currency=2]="Currency",Yt[Yt.Scientific=3]="Scientific",Yt))(),hn=(()=>((hn=hn||{})[hn.Decimal=0]="Decimal",hn[hn.Group=1]="Group",hn[hn.List=2]="List",hn[hn.PercentSign=3]="PercentSign",hn[hn.PlusSign=4]="PlusSign",hn[hn.MinusSign=5]="MinusSign",hn[hn.Exponential=6]="Exponential",hn[hn.SuperscriptingExponent=7]="SuperscriptingExponent",hn[hn.PerMille=8]="PerMille",hn[hn.Infinity=9]="Infinity",hn[hn.NaN=10]="NaN",hn[hn.TimeSeparator=11]="TimeSeparator",hn[hn.CurrencyDecimal=12]="CurrencyDecimal",hn[hn.CurrencyGroup=13]="CurrencyGroup",hn))();function Rn(R,V){const z=(0,W.cg1)(R),te=z[W.wAp.NumberSymbols][V];if(typeof te>"u"){if(V===hn.CurrencyDecimal)return z[W.wAp.NumberSymbols][hn.Decimal];if(V===hn.CurrencyGroup)return z[W.wAp.NumberSymbols][hn.Group]}return te}const ne=/^(\d+)?\.((\d+)(-(\d+))?)?$/,q=22,ae=".",De="0",We=";",Ue=",",bt="#";function jr(R){const V=parseInt(R);if(isNaN(V))throw new Error("Invalid integer literal when parsing "+R);return V}function ra(R,V){V=encodeURIComponent(V);for(const z of R.split(";")){const te=z.indexOf("="),[_e,Fe]=-1==te?[z,""]:[z.slice(0,te),z.slice(te+1)];if(_e.trim()===V)return decodeURIComponent(Fe)}return null}class Dn{constructor(V,z,te,_e){this.$implicit=V,this.ngForOf=z,this.index=te,this.count=_e}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Wi=(()=>{class R{set ngForOf(z){this._ngForOf=z,this._ngForOfDirty=!0}set ngForTrackBy(z){this._trackByFn=z}get ngForTrackBy(){return this._trackByFn}constructor(z,te,_e){this._viewContainer=z,this._template=te,this._differs=_e,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(z){z&&(this._template=z)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const z=this._ngForOf;!this._differ&&z&&(this._differ=this._differs.find(z).create(this.ngForTrackBy))}if(this._differ){const z=this._differ.diff(this._ngForOf);z&&this._applyChanges(z)}}_applyChanges(z){const te=this._viewContainer;z.forEachOperation((_e,Fe,Ge)=>{if(null==_e.previousIndex)te.createEmbeddedView(this._template,new Dn(_e.item,this._ngForOf,-1,-1),null===Ge?void 0:Ge);else if(null==Ge)te.remove(null===Fe?void 0:Fe);else if(null!==Fe){const jt=te.get(Fe);te.move(jt,Ge),Ci(jt,_e)}});for(let _e=0,Fe=te.length;_e<Fe;_e++){const jt=te.get(_e).context;jt.index=_e,jt.count=Fe,jt.ngForOf=this._ngForOf}z.forEachIdentityChange(_e=>{Ci(te.get(_e.currentIndex),_e)})}static ngTemplateContextGuard(z,te){return!0}}return R.\u0275fac=function(z){return new(z||R)(W.Y36(W.s_b),W.Y36(W.Rgc),W.Y36(W.ZZ4))},R.\u0275dir=W.lG2({type:R,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),R})();function Ci(R,V){R.context.$implicit=V.item}let Hn=(()=>{class R{constructor(z,te){this._viewContainer=z,this._context=new Pr,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=te}set ngIf(z){this._context.$implicit=this._context.ngIf=z,this._updateView()}set ngIfThen(z){ei("ngIfThen",z),this._thenTemplateRef=z,this._thenViewRef=null,this._updateView()}set ngIfElse(z){ei("ngIfElse",z),this._elseTemplateRef=z,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(z,te){return!0}}return R.\u0275fac=function(z){return new(z||R)(W.Y36(W.s_b),W.Y36(W.Rgc))},R.\u0275dir=W.lG2({type:R,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),R})();class Pr{constructor(){this.$implicit=null,this.ngIf=null}}function ei(R,V){if(V&&!V.createEmbeddedView)throw new Error(`${R} must be a TemplateRef, but received '${(0,W.AaK)(V)}'.`)}let Uo=(()=>{class R{constructor(z,te,_e){this._ngEl=z,this._differs=te,this._renderer=_e,this._ngStyle=null,this._differ=null}set ngStyle(z){this._ngStyle=z,!this._differ&&z&&(this._differ=this._differs.find(z).create())}ngDoCheck(){if(this._differ){const z=this._differ.diff(this._ngStyle);z&&this._applyChanges(z)}}_setStyle(z,te){const[_e,Fe]=z.split("."),Ge=-1===_e.indexOf("-")?void 0:W.JOm.DashCase;null!=te?this._renderer.setStyle(this._ngEl.nativeElement,_e,Fe?`${te}${Fe}`:te,Ge):this._renderer.removeStyle(this._ngEl.nativeElement,_e,Ge)}_applyChanges(z){z.forEachRemovedItem(te=>this._setStyle(te.key,null)),z.forEachAddedItem(te=>this._setStyle(te.key,te.currentValue)),z.forEachChangedItem(te=>this._setStyle(te.key,te.currentValue))}}return R.\u0275fac=function(z){return new(z||R)(W.Y36(W.SBq),W.Y36(W.aQg),W.Y36(W.Qsj))},R.\u0275dir=W.lG2({type:R,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),R})();function hi(R,V){return new W.vHH(2100,!1)}const gr=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let Ll=(()=>{class R{transform(z){if(null==z)return null;if("string"!=typeof z)throw hi();return z.replace(gr,te=>te[0].toUpperCase()+te.slice(1).toLowerCase())}}return R.\u0275fac=function(z){return new(z||R)},R.\u0275pipe=W.Yjl({name:"titlecase",type:R,pure:!0,standalone:!0}),R})(),wo=(()=>{class R{transform(z){if(null==z)return null;if("string"!=typeof z)throw hi();return z.toUpperCase()}}return R.\u0275fac=function(z){return new(z||R)},R.\u0275pipe=W.Yjl({name:"uppercase",type:R,pure:!0,standalone:!0}),R})(),vi=(()=>{class R{transform(z){return JSON.stringify(z,null,2)}}return R.\u0275fac=function(z){return new(z||R)},R.\u0275pipe=W.Yjl({name:"json",type:R,pure:!1,standalone:!0}),R})(),ki=(()=>{class R{constructor(z){this._locale=z}transform(z,te,_e){if(!function ia(R){return!(null==R||""===R||R!=R)}(z))return null;_e=_e||this._locale;try{return function fn(R,V,z){return function vn(R,V,z,te,_e,Fe,Ge=!1){let jt="",bn=!1;if(isFinite(R)){let zn=function po(R){let te,_e,Fe,Ge,jt,V=Math.abs(R)+"",z=0;for((_e=V.indexOf(ae))>-1&&(V=V.replace(ae,"")),(Fe=V.search(/e/i))>0?(_e<0&&(_e=Fe),_e+=+V.slice(Fe+1),V=V.substring(0,Fe)):_e<0&&(_e=V.length),Fe=0;V.charAt(Fe)===De;Fe++);if(Fe===(jt=V.length))te=[0],_e=1;else{for(jt--;V.charAt(jt)===De;)jt--;for(_e-=Fe,te=[],Ge=0;Fe<=jt;Fe++,Ge++)te[Ge]=Number(V.charAt(Fe))}return _e>q&&(te=te.splice(0,q-1),z=_e-1,_e=1),{digits:te,exponent:z,integerLen:_e}}(R);Ge&&(zn=function Tr(R){if(0===R.digits[0])return R;const V=R.digits.length-R.integerLen;return R.exponent?R.exponent+=2:(0===V?R.digits.push(0,0):1===V&&R.digits.push(0),R.integerLen+=2),R}(zn));let $n=V.minInt,wn=V.minFrac,xr=V.maxFrac;if(Fe){const Co=Fe.match(ne);if(null===Co)throw new Error(`${Fe} is not a valid digit info`);const ro=Co[1],So=Co[3],Mo=Co[5];null!=ro&&($n=jr(ro)),null!=So&&(wn=jr(So)),null!=Mo?xr=jr(Mo):null!=So&&wn>xr&&(xr=wn)}!function ji(R,V,z){if(V>z)throw new Error(`The minimum number of digits after fraction (${V}) is higher than the maximum (${z}).`);let te=R.digits,_e=te.length-R.integerLen;const Fe=Math.min(Math.max(V,_e),z);let Ge=Fe+R.integerLen,jt=te[Ge];if(Ge>0){te.splice(Math.max(R.integerLen,Ge));for(let wn=Ge;wn<te.length;wn++)te[wn]=0}else{_e=Math.max(0,_e),R.integerLen=1,te.length=Math.max(1,Ge=Fe+1),te[0]=0;for(let wn=1;wn<Ge;wn++)te[wn]=0}if(jt>=5)if(Ge-1<0){for(let wn=0;wn>Ge;wn--)te.unshift(0),R.integerLen++;te.unshift(1),R.integerLen++}else te[Ge-1]++;for(;_e<Math.max(0,Fe);_e++)te.push(0);let bn=0!==Fe;const zn=V+R.integerLen,$n=te.reduceRight(function(wn,xr,rr,Et){return Et[rr]=(xr+=wn)<10?xr:xr-10,bn&&(0===Et[rr]&&rr>=zn?Et.pop():bn=!1),xr>=10?1:0},0);$n&&(te.unshift($n),R.integerLen++)}(zn,wn,xr);let rr=zn.digits,Et=zn.integerLen;const Rr=zn.exponent;let bi=[];for(bn=rr.every(Co=>!Co);Et<$n;Et++)rr.unshift(0);for(;Et<0;Et++)rr.unshift(0);Et>0?bi=rr.splice(Et,rr.length):(bi=rr,rr=[0]);const no=[];for(rr.length>=V.lgSize&&no.unshift(rr.splice(-V.lgSize,rr.length).join(""));rr.length>V.gSize;)no.unshift(rr.splice(-V.gSize,rr.length).join(""));rr.length&&no.unshift(rr.join("")),jt=no.join(Rn(z,te)),bi.length&&(jt+=Rn(z,_e)+bi.join("")),Rr&&(jt+=Rn(z,hn.Exponential)+"+"+Rr)}else jt=Rn(z,hn.Infinity);return jt=R<0&&!bn?V.negPre+jt+V.negSuf:V.posPre+jt+V.posSuf,jt}(R,function sr(R,V="-"){const z={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},te=R.split(We),_e=te[0],Fe=te[1],Ge=-1!==_e.indexOf(ae)?_e.split(ae):[_e.substring(0,_e.lastIndexOf(De)+1),_e.substring(_e.lastIndexOf(De)+1)],jt=Ge[0],bn=Ge[1]||"";z.posPre=jt.substring(0,jt.indexOf(bt));for(let $n=0;$n<bn.length;$n++){const wn=bn.charAt($n);wn===De?z.minFrac=z.maxFrac=$n+1:wn===bt?z.maxFrac=$n+1:z.posSuf+=wn}const zn=jt.split(Ue);if(z.gSize=zn[1]?zn[1].length:0,z.lgSize=zn[2]||zn[1]?(zn[2]||zn[1]).length:0,Fe){const $n=_e.length-z.posPre.length-z.posSuf.length,wn=Fe.indexOf(bt);z.negPre=Fe.substring(0,wn).replace(/'/g,""),z.negSuf=Fe.slice(wn+$n).replace(/'/g,"")}else z.negPre=V+z.posPre,z.negSuf=z.posSuf;return z}(function Yn(R,V){return(0,W.cg1)(R)[W.wAp.NumberFormats][V]}(V,Yt.Decimal),Rn(V,hn.MinusSign)),V,hn.Group,hn.Decimal,z)}(function ls(R){if("string"==typeof R&&!isNaN(Number(R)-parseFloat(R)))return Number(R);if("number"!=typeof R)throw new Error(`${R} is not a number`);return R}(z),_e,te)}catch(Fe){throw hi()}}}return R.\u0275fac=function(z){return new(z||R)(W.Y36(W.soG,16))},R.\u0275pipe=W.Yjl({name:"number",type:R,pure:!0,standalone:!0}),R})();let Zi=(()=>{class R{}return R.\u0275fac=function(z){return new(z||R)},R.\u0275mod=W.oAB({type:R}),R.\u0275inj=W.cJS({}),R})();const Ha="browser";let pl=(()=>{class R{}return R.\u0275prov=(0,W.Yz7)({token:R,providedIn:"root",factory:()=>new oa((0,W.LFG)(Jt),window)}),R})();class oa{constructor(V,z){this.document=V,this.window=z,this.offset=()=>[0,0]}setOffset(V){this.offset=Array.isArray(V)?()=>V:V}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(V){this.supportsScrolling()&&this.window.scrollTo(V[0],V[1])}scrollToAnchor(V){if(!this.supportsScrolling())return;const z=function ws(R,V){const z=R.getElementById(V)||R.getElementsByName(V)[0];if(z)return z;if("function"==typeof R.createTreeWalker&&R.body&&(R.body.createShadowRoot||R.body.attachShadow)){const te=R.createTreeWalker(R.body,NodeFilter.SHOW_ELEMENT);let _e=te.currentNode;for(;_e;){const Fe=_e.shadowRoot;if(Fe){const Ge=Fe.getElementById(V)||Fe.querySelector(`[name="${V}"]`);if(Ge)return Ge}_e=te.nextNode()}}return null}(this.document,V);z&&(this.scrollToElement(z),z.focus())}setHistoryScrollRestoration(V){if(this.supportScrollRestoration()){const z=this.window.history;z&&z.scrollRestoration&&(z.scrollRestoration=V)}}scrollToElement(V){const z=V.getBoundingClientRect(),te=z.left+this.window.pageXOffset,_e=z.top+this.window.pageYOffset,Fe=this.offset();this.window.scrollTo(te-Fe[0],_e-Fe[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const V=xa(this.window.history)||xa(Object.getPrototypeOf(this.window.history));return!(!V||!V.writable&&!V.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function xa(R){return Object.getOwnPropertyDescriptor(R,"scrollRestoration")}class cs{}},529:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{JF:()=>qi,LE:()=>st,eN:()=>Ne});var W=Ee(6895),me=Ee(8256),$e=Ee(9646),c=Ee(9751),Pe=Ee(4351),Jt=Ee(9300),Vt=Ee(4004);class zt{}class pt{}class yt{constructor(Le){this.normalizedNames=new Map,this.lazyUpdate=null,Le?this.lazyInit="string"==typeof Le?()=>{this.headers=new Map,Le.split("\n").forEach(Oe=>{const Mt=Oe.indexOf(":");if(Mt>0){const Ct=Oe.slice(0,Mt),ie=Ct.toLowerCase(),H=Oe.slice(Mt+1).trim();this.maybeSetNormalizedName(Ct,ie),this.headers.has(ie)?this.headers.get(ie).push(H):this.headers.set(ie,[H])}})}:()=>{this.headers=new Map,Object.entries(Le).forEach(([Oe,Mt])=>{let Ct;if(Ct="string"==typeof Mt?[Mt]:"number"==typeof Mt?[Mt.toString()]:Mt.map(ie=>ie.toString()),Ct.length>0){const ie=Oe.toLowerCase();this.headers.set(ie,Ct),this.maybeSetNormalizedName(Oe,ie)}})}:this.headers=new Map}has(Le){return this.init(),this.headers.has(Le.toLowerCase())}get(Le){this.init();const Oe=this.headers.get(Le.toLowerCase());return Oe&&Oe.length>0?Oe[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(Le){return this.init(),this.headers.get(Le.toLowerCase())||null}append(Le,Oe){return this.clone({name:Le,value:Oe,op:"a"})}set(Le,Oe){return this.clone({name:Le,value:Oe,op:"s"})}delete(Le,Oe){return this.clone({name:Le,value:Oe,op:"d"})}maybeSetNormalizedName(Le,Oe){this.normalizedNames.has(Oe)||this.normalizedNames.set(Oe,Le)}init(){this.lazyInit&&(this.lazyInit instanceof yt?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(Le=>this.applyUpdate(Le)),this.lazyUpdate=null))}copyFrom(Le){Le.init(),Array.from(Le.headers.keys()).forEach(Oe=>{this.headers.set(Oe,Le.headers.get(Oe)),this.normalizedNames.set(Oe,Le.normalizedNames.get(Oe))})}clone(Le){const Oe=new yt;return Oe.lazyInit=this.lazyInit&&this.lazyInit instanceof yt?this.lazyInit:this,Oe.lazyUpdate=(this.lazyUpdate||[]).concat([Le]),Oe}applyUpdate(Le){const Oe=Le.name.toLowerCase();switch(Le.op){case"a":case"s":let Mt=Le.value;if("string"==typeof Mt&&(Mt=[Mt]),0===Mt.length)return;this.maybeSetNormalizedName(Le.name,Oe);const Ct=("a"===Le.op?this.headers.get(Oe):void 0)||[];Ct.push(...Mt),this.headers.set(Oe,Ct);break;case"d":const ie=Le.value;if(ie){let H=this.headers.get(Oe);if(!H)return;H=H.filter(Y=>-1===ie.indexOf(Y)),0===H.length?(this.headers.delete(Oe),this.normalizedNames.delete(Oe)):this.headers.set(Oe,H)}else this.headers.delete(Oe),this.normalizedNames.delete(Oe)}}forEach(Le){this.init(),Array.from(this.normalizedNames.keys()).forEach(Oe=>Le(this.normalizedNames.get(Oe),this.headers.get(Oe)))}}class $t{encodeKey(Le){return cn(Le)}encodeValue(Le){return cn(Le)}decodeKey(Le){return decodeURIComponent(Le)}decodeValue(Le){return decodeURIComponent(Le)}}const ut=/%(\d[a-f0-9])/gi,Bt={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function cn(Xe){return encodeURIComponent(Xe).replace(ut,(Le,Oe)=>Bt[Oe]??Le)}function Wn(Xe){return`${Xe}`}class st{constructor(Le={}){if(this.updates=null,this.cloneFrom=null,this.encoder=Le.encoder||new $t,Le.fromString){if(Le.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function Kt(Xe,Le){const Oe=new Map;return Xe.length>0&&Xe.replace(/^\?/,"").split("&").forEach(Ct=>{const ie=Ct.indexOf("="),[H,Y]=-1==ie?[Le.decodeKey(Ct),""]:[Le.decodeKey(Ct.slice(0,ie)),Le.decodeValue(Ct.slice(ie+1))],le=Oe.get(H)||[];le.push(Y),Oe.set(H,le)}),Oe}(Le.fromString,this.encoder)}else Le.fromObject?(this.map=new Map,Object.keys(Le.fromObject).forEach(Oe=>{const Mt=Le.fromObject[Oe],Ct=Array.isArray(Mt)?Mt.map(Wn):[Wn(Mt)];this.map.set(Oe,Ct)})):this.map=null}has(Le){return this.init(),this.map.has(Le)}get(Le){this.init();const Oe=this.map.get(Le);return Oe?Oe[0]:null}getAll(Le){return this.init(),this.map.get(Le)||null}keys(){return this.init(),Array.from(this.map.keys())}append(Le,Oe){return this.clone({param:Le,value:Oe,op:"a"})}appendAll(Le){const Oe=[];return Object.keys(Le).forEach(Mt=>{const Ct=Le[Mt];Array.isArray(Ct)?Ct.forEach(ie=>{Oe.push({param:Mt,value:ie,op:"a"})}):Oe.push({param:Mt,value:Ct,op:"a"})}),this.clone(Oe)}set(Le,Oe){return this.clone({param:Le,value:Oe,op:"s"})}delete(Le,Oe){return this.clone({param:Le,value:Oe,op:"d"})}toString(){return this.init(),this.keys().map(Le=>{const Oe=this.encoder.encodeKey(Le);return this.map.get(Le).map(Mt=>Oe+"="+this.encoder.encodeValue(Mt)).join("&")}).filter(Le=>""!==Le).join("&")}clone(Le){const Oe=new st({encoder:this.encoder});return Oe.cloneFrom=this.cloneFrom||this,Oe.updates=(this.updates||[]).concat(Le),Oe}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(Le=>this.map.set(Le,this.cloneFrom.map.get(Le))),this.updates.forEach(Le=>{switch(Le.op){case"a":case"s":const Oe=("a"===Le.op?this.map.get(Le.param):void 0)||[];Oe.push(Wn(Le.value)),this.map.set(Le.param,Oe);break;case"d":if(void 0===Le.value){this.map.delete(Le.param);break}{let Mt=this.map.get(Le.param)||[];const Ct=Mt.indexOf(Wn(Le.value));-1!==Ct&&Mt.splice(Ct,1),Mt.length>0?this.map.set(Le.param,Mt):this.map.delete(Le.param)}}}),this.cloneFrom=this.updates=null)}}class en{constructor(){this.map=new Map}set(Le,Oe){return this.map.set(Le,Oe),this}get(Le){return this.map.has(Le)||this.map.set(Le,Le.defaultValue()),this.map.get(Le)}delete(Le){return this.map.delete(Le),this}has(Le){return this.map.has(Le)}keys(){return this.map.keys()}}function ht(Xe){return typeof ArrayBuffer<"u"&&Xe instanceof ArrayBuffer}function un(Xe){return typeof Blob<"u"&&Xe instanceof Blob}function ur(Xe){return typeof FormData<"u"&&Xe instanceof FormData}class Yt{constructor(Le,Oe,Mt,Ct){let ie;if(this.url=Oe,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=Le.toUpperCase(),function rn(Xe){switch(Xe){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||Ct?(this.body=void 0!==Mt?Mt:null,ie=Ct):ie=Mt,ie&&(this.reportProgress=!!ie.reportProgress,this.withCredentials=!!ie.withCredentials,ie.responseType&&(this.responseType=ie.responseType),ie.headers&&(this.headers=ie.headers),ie.context&&(this.context=ie.context),ie.params&&(this.params=ie.params)),this.headers||(this.headers=new yt),this.context||(this.context=new en),this.params){const H=this.params.toString();if(0===H.length)this.urlWithParams=Oe;else{const Y=Oe.indexOf("?");this.urlWithParams=Oe+(-1===Y?"?":Y<Oe.length-1?"&":"")+H}}else this.params=new st,this.urlWithParams=Oe}serializeBody(){return null===this.body?null:ht(this.body)||un(this.body)||ur(this.body)||function Dt(Xe){return typeof URLSearchParams<"u"&&Xe instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof st?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||ur(this.body)?null:un(this.body)?this.body.type||null:ht(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof st?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(Le={}){const Oe=Le.method||this.method,Mt=Le.url||this.url,Ct=Le.responseType||this.responseType,ie=void 0!==Le.body?Le.body:this.body,H=void 0!==Le.withCredentials?Le.withCredentials:this.withCredentials,Y=void 0!==Le.reportProgress?Le.reportProgress:this.reportProgress;let le=Le.headers||this.headers,ge=Le.params||this.params;const Ae=Le.context??this.context;return void 0!==Le.setHeaders&&(le=Object.keys(Le.setHeaders).reduce((ue,ne)=>ue.set(ne,Le.setHeaders[ne]),le)),Le.setParams&&(ge=Object.keys(Le.setParams).reduce((ue,ne)=>ue.set(ne,Le.setParams[ne]),ge)),new Yt(Oe,Mt,ie,{params:ge,headers:le,context:Ae,reportProgress:Y,responseType:Ct,withCredentials:H})}}var _t=(()=>((_t=_t||{})[_t.Sent=0]="Sent",_t[_t.UploadProgress=1]="UploadProgress",_t[_t.ResponseHeader=2]="ResponseHeader",_t[_t.DownloadProgress=3]="DownloadProgress",_t[_t.Response=4]="Response",_t[_t.User=5]="User",_t))();class gt{constructor(Le,Oe=200,Mt="OK"){this.headers=Le.headers||new yt,this.status=void 0!==Le.status?Le.status:Oe,this.statusText=Le.statusText||Mt,this.url=Le.url||null,this.ok=this.status>=200&&this.status<300}}class dn extends gt{constructor(Le={}){super(Le),this.type=_t.ResponseHeader}clone(Le={}){return new dn({headers:Le.headers||this.headers,status:void 0!==Le.status?Le.status:this.status,statusText:Le.statusText||this.statusText,url:Le.url||this.url||void 0})}}class Kn extends gt{constructor(Le={}){super(Le),this.type=_t.Response,this.body=void 0!==Le.body?Le.body:null}clone(Le={}){return new Kn({body:void 0!==Le.body?Le.body:this.body,headers:Le.headers||this.headers,status:void 0!==Le.status?Le.status:this.status,statusText:Le.statusText||this.statusText,url:Le.url||this.url||void 0})}}class hn extends gt{constructor(Le){super(Le,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${Le.url||"(unknown url)"}`:`Http failure response for ${Le.url||"(unknown url)"}: ${Le.status} ${Le.statusText}`,this.error=Le.error||null}}function Br(Xe,Le){return{body:Le,headers:Xe.headers,context:Xe.context,observe:Xe.observe,params:Xe.params,reportProgress:Xe.reportProgress,responseType:Xe.responseType,withCredentials:Xe.withCredentials}}let Ne=(()=>{class Xe{constructor(Oe){this.handler=Oe}request(Oe,Mt,Ct={}){let ie;if(Oe instanceof Yt)ie=Oe;else{let le,ge;le=Ct.headers instanceof yt?Ct.headers:new yt(Ct.headers),Ct.params&&(ge=Ct.params instanceof st?Ct.params:new st({fromObject:Ct.params})),ie=new Yt(Oe,Mt,void 0!==Ct.body?Ct.body:null,{headers:le,context:Ct.context,params:ge,reportProgress:Ct.reportProgress,responseType:Ct.responseType||"json",withCredentials:Ct.withCredentials})}const H=(0,$e.of)(ie).pipe((0,Pe.b)(le=>this.handler.handle(le)));if(Oe instanceof Yt||"events"===Ct.observe)return H;const Y=H.pipe((0,Jt.h)(le=>le instanceof Kn));switch(Ct.observe||"body"){case"body":switch(ie.responseType){case"arraybuffer":return Y.pipe((0,Vt.U)(le=>{if(null!==le.body&&!(le.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return le.body}));case"blob":return Y.pipe((0,Vt.U)(le=>{if(null!==le.body&&!(le.body instanceof Blob))throw new Error("Response is not a Blob.");return le.body}));case"text":return Y.pipe((0,Vt.U)(le=>{if(null!==le.body&&"string"!=typeof le.body)throw new Error("Response is not a string.");return le.body}));default:return Y.pipe((0,Vt.U)(le=>le.body))}case"response":return Y;default:throw new Error(`Unreachable: unhandled observe type ${Ct.observe}}`)}}delete(Oe,Mt={}){return this.request("DELETE",Oe,Mt)}get(Oe,Mt={}){return this.request("GET",Oe,Mt)}head(Oe,Mt={}){return this.request("HEAD",Oe,Mt)}jsonp(Oe,Mt){return this.request("JSONP",Oe,{params:(new st).append(Mt,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Oe,Mt={}){return this.request("OPTIONS",Oe,Mt)}patch(Oe,Mt,Ct={}){return this.request("PATCH",Oe,Br(Ct,Mt))}post(Oe,Mt,Ct={}){return this.request("POST",Oe,Br(Ct,Mt))}put(Oe,Mt,Ct={}){return this.request("PUT",Oe,Br(Ct,Mt))}}return Xe.\u0275fac=function(Oe){return new(Oe||Xe)(me.LFG(zt))},Xe.\u0275prov=me.Yz7({token:Xe,factory:Xe.\u0275fac}),Xe})();function ot(Xe,Le){return Le(Xe)}function xt(Xe,Le){return(Oe,Mt)=>Le.intercept(Oe,{handle:Ct=>Xe(Ct,Mt)})}const Ft=new me.OlP("HTTP_INTERCEPTORS"),kt=new me.OlP("HTTP_INTERCEPTOR_FNS");function Mn(){let Xe=null;return(Le,Oe)=>(null===Xe&&(Xe=((0,me.f3M)(Ft,{optional:!0})??[]).reduceRight(xt,ot)),Xe(Le,Oe))}let Bn=(()=>{class Xe extends zt{constructor(Oe,Mt){super(),this.backend=Oe,this.injector=Mt,this.chain=null}handle(Oe){if(null===this.chain){const Mt=Array.from(new Set(this.injector.get(kt)));this.chain=Mt.reduceRight((Ct,ie)=>function Pt(Xe,Le,Oe){return(Mt,Ct)=>Oe.runInContext(()=>Le(Mt,ie=>Xe(ie,Ct)))}(Ct,ie,this.injector),ot)}return this.chain(Oe,Mt=>this.backend.handle(Mt))}}return Xe.\u0275fac=function(Oe){return new(Oe||Xe)(me.LFG(pt),me.LFG(me.lqb))},Xe.\u0275prov=me.Yz7({token:Xe,factory:Xe.\u0275fac}),Xe})();const zo=/^\)\]\}',?\n/;let xn=(()=>{class Xe{constructor(Oe){this.xhrFactory=Oe}handle(Oe){if("JSONP"===Oe.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new c.y(Mt=>{const Ct=this.xhrFactory.build();if(Ct.open(Oe.method,Oe.urlWithParams),Oe.withCredentials&&(Ct.withCredentials=!0),Oe.headers.forEach((q,ae)=>Ct.setRequestHeader(q,ae.join(","))),Oe.headers.has("Accept")||Ct.setRequestHeader("Accept","application/json, text/plain, */*"),!Oe.headers.has("Content-Type")){const q=Oe.detectContentTypeHeader();null!==q&&Ct.setRequestHeader("Content-Type",q)}if(Oe.responseType){const q=Oe.responseType.toLowerCase();Ct.responseType="json"!==q?q:"text"}const ie=Oe.serializeBody();let H=null;const Y=()=>{if(null!==H)return H;const q=Ct.statusText||"OK",ae=new yt(Ct.getAllResponseHeaders()),De=function uo(Xe){return"responseURL"in Xe&&Xe.responseURL?Xe.responseURL:/^X-Request-URL:/m.test(Xe.getAllResponseHeaders())?Xe.getResponseHeader("X-Request-URL"):null}(Ct)||Oe.url;return H=new dn({headers:ae,status:Ct.status,statusText:q,url:De}),H},le=()=>{let{headers:q,status:ae,statusText:De,url:We}=Y(),Ue=null;204!==ae&&(Ue=typeof Ct.response>"u"?Ct.responseText:Ct.response),0===ae&&(ae=Ue?200:0);let bt=ae>=200&&ae<300;if("json"===Oe.responseType&&"string"==typeof Ue){const Wt=Ue;Ue=Ue.replace(zo,"");try{Ue=""!==Ue?JSON.parse(Ue):null}catch(on){Ue=Wt,bt&&(bt=!1,Ue={error:on,text:Ue})}}bt?(Mt.next(new Kn({body:Ue,headers:q,status:ae,statusText:De,url:We||void 0})),Mt.complete()):Mt.error(new hn({error:Ue,headers:q,status:ae,statusText:De,url:We||void 0}))},ge=q=>{const{url:ae}=Y(),De=new hn({error:q,status:Ct.status||0,statusText:Ct.statusText||"Unknown Error",url:ae||void 0});Mt.error(De)};let Ae=!1;const ue=q=>{Ae||(Mt.next(Y()),Ae=!0);let ae={type:_t.DownloadProgress,loaded:q.loaded};q.lengthComputable&&(ae.total=q.total),"text"===Oe.responseType&&Ct.responseText&&(ae.partialText=Ct.responseText),Mt.next(ae)},ne=q=>{let ae={type:_t.UploadProgress,loaded:q.loaded};q.lengthComputable&&(ae.total=q.total),Mt.next(ae)};return Ct.addEventListener("load",le),Ct.addEventListener("error",ge),Ct.addEventListener("timeout",ge),Ct.addEventListener("abort",ge),Oe.reportProgress&&(Ct.addEventListener("progress",ue),null!==ie&&Ct.upload&&Ct.upload.addEventListener("progress",ne)),Ct.send(ie),Mt.next({type:_t.Sent}),()=>{Ct.removeEventListener("error",ge),Ct.removeEventListener("abort",ge),Ct.removeEventListener("load",le),Ct.removeEventListener("timeout",ge),Oe.reportProgress&&(Ct.removeEventListener("progress",ue),null!==ie&&Ct.upload&&Ct.upload.removeEventListener("progress",ne)),Ct.readyState!==Ct.DONE&&Ct.abort()}})}}return Xe.\u0275fac=function(Oe){return new(Oe||Xe)(me.LFG(W.JF))},Xe.\u0275prov=me.Yz7({token:Xe,factory:Xe.\u0275fac}),Xe})();const Lr=new me.OlP("XSRF_ENABLED"),Hi=new me.OlP("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),fo=new me.OlP("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class Or{}let No=(()=>{class Xe{constructor(Oe,Mt,Ct){this.doc=Oe,this.platform=Mt,this.cookieName=Ct,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Oe=this.doc.cookie||"";return Oe!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,W.Mx)(Oe,this.cookieName),this.lastCookieString=Oe),this.lastToken}}return Xe.\u0275fac=function(Oe){return new(Oe||Xe)(me.LFG(W.K0),me.LFG(me.Lbi),me.LFG(Hi))},Xe.\u0275prov=me.Yz7({token:Xe,factory:Xe.\u0275fac}),Xe})();function Er(Xe,Le){const Oe=Xe.url.toLowerCase();if(!(0,me.f3M)(Lr)||"GET"===Xe.method||"HEAD"===Xe.method||Oe.startsWith("http://")||Oe.startsWith("https://"))return Le(Xe);const Mt=(0,me.f3M)(Or).getToken(),Ct=(0,me.f3M)(fo);return null!=Mt&&!Xe.headers.has(Ct)&&(Xe=Xe.clone({headers:Xe.headers.set(Ct,Mt)})),Le(Xe)}var nn=(()=>((nn=nn||{})[nn.Interceptors=0]="Interceptors",nn[nn.LegacyInterceptors=1]="LegacyInterceptors",nn[nn.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",nn[nn.NoXsrfProtection=3]="NoXsrfProtection",nn[nn.JsonpSupport=4]="JsonpSupport",nn[nn.RequestsMadeViaParent=5]="RequestsMadeViaParent",nn))();function br(Xe,Le){return{\u0275kind:Xe,\u0275providers:Le}}function _r(...Xe){const Le=[Ne,xn,Bn,{provide:zt,useExisting:Bn},{provide:pt,useExisting:xn},{provide:kt,useValue:Er,multi:!0},{provide:Lr,useValue:!0},{provide:Or,useClass:No}];for(const Oe of Xe)Le.push(...Oe.\u0275providers);return(0,me.MR2)(Le)}const Zr=new me.OlP("LEGACY_INTERCEPTOR_FN");let qi=(()=>{class Xe{}return Xe.\u0275fac=function(Oe){return new(Oe||Xe)},Xe.\u0275mod=me.oAB({type:Xe}),Xe.\u0275inj=me.cJS({providers:[_r(br(nn.LegacyInterceptors,[{provide:Zr,useFactory:Mn},{provide:kt,useExisting:Zr,multi:!0}]))]}),Xe})()},8256:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{QbO:()=>$1,tb:()=>T0,AFp:()=>f0,ip1:()=>d0,CZH:()=>Zg,hGG:()=>Mb,z2F:()=>Kg,sBO:()=>db,Sil:()=>Z1,_Vd:()=>nu,EJc:()=>q1,Xts:()=>Fs,SBq:()=>Ih,lqb:()=>_i,qLn:()=>Ph,vpe:()=>Bc,XFs:()=>vt,OlP:()=>ni,zs3:()=>ru,ZZ4:()=>Fy,aQg:()=>zy,soG:()=>Xg,YKP:()=>gv,h0i:()=>af,PXZ:()=>ab,R0b:()=>Ql,FiY:()=>Ce,Lbi:()=>V1,g9A:()=>m0,Qsj:()=>v_,FYo:()=>bm,JOm:()=>ms,tp0:()=>Ze,Rgc:()=>Fp,dDg:()=>rb,eoX:()=>w0,GfV:()=>Ah,s_b:()=>Hg,ifc:()=>We,MMx:()=>uy,Lck:()=>jx,eFA:()=>C0,Gpc:()=>tr,f3M:()=>Y,$WT:()=>mi,MR2:()=>h_,_c5:()=>Sb,c2e:()=>G1,zSh:()=>Uf,wAp:()=>Zn,vHH:()=>Dt,lri:()=>x0,rWj:()=>b0,D6c:()=>Ib,cg1:()=>Mp,kL8:()=>na,dqk:()=>hr,Z0I:()=>Lr,eJc:()=>xy,CqO:()=>bc,QGY:()=>Kl,F4k:()=>Al,RDi:()=>Iu,AaK:()=>cn,qOj:()=>cu,TTD:()=>$s,_Bn:()=>mv,jDz:()=>yv,xp6:()=>Rm,uIk:()=>Gd,Tol:()=>ce,ekj:()=>j,Suo:()=>Vv,Xpm:()=>Tr,lG2:()=>Bo,Yz7:()=>Yr,cJS:()=>uo,oAB:()=>it,Yjl:()=>ra,Y36:()=>Bu,_UZ:()=>hp,qZA:()=>Xd,TgZ:()=>zc,EpF:()=>Il,n5z:()=>oo,LFG:()=>ie,$8M:()=>sc,$Z:()=>Xm,NdJ:()=>ih,CRH:()=>$v,oxw:()=>mp,ALo:()=>Rv,lcZ:()=>Lv,xi3:()=>kv,Q6J:()=>up,DdM:()=>Dv,VKq:()=>Cv,iGM:()=>Uv,MAs:()=>Mg,KtG:()=>Ya,CHM:()=>kl,LSH:()=>pd,P3R:()=>Nf,Akn:()=>$,YNc:()=>Sg,W1O:()=>Wv,_uU:()=>Zt,Oqu:()=>Pn,hij:()=>ar,AsE:()=>lr,Gf:()=>jv});var W=Ee(7579),me=Ee(727),$e=Ee(9751),c=Ee(8189),Pe=Ee(8421),Jt=Ee(515),Vt=Ee(7669),zt=Ee(2076),yt=Ee(2961),ct=Ee(4482);function Kt(i,o,...a){if(!0===o)return void i();if(!1===o)return;const d=new yt.Hp({next:()=>{d.unsubscribe(),i()}});return(0,Pe.Xf)(o(...a)).subscribe(d)}function ut(i){for(let o in i)if(i[o]===ut)return o;throw Error("Could not find renamed property on target object.")}function Bt(i,o){for(const a in o)o.hasOwnProperty(a)&&!i.hasOwnProperty(a)&&(i[a]=o[a])}function cn(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(cn).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;const o=i.toString();if(null==o)return""+o;const a=o.indexOf("\n");return-1===a?o:o.substring(0,a)}function Wn(i,o){return null==i||""===i?null===o?"":o:null==o||""===o?i:i+" "+o}const st=ut({__forward_ref__:ut});function tr(i){return i.__forward_ref__=tr,i.toString=function(){return cn(this())},i}function en(i){return rn(i)?i():i}function rn(i){return"function"==typeof i&&i.hasOwnProperty(st)&&i.__forward_ref__===tr}function ht(i){return i&&!!i.\u0275providers}const ur="https://g.co/ng/security#xss";class Dt extends Error{constructor(o,a){super(Yt(o,a)),this.code=o}}function Yt(i,o){return`NG0${Math.abs(i)}${o?": "+o.trim():""}`}function _t(i){return"string"==typeof i?i:null==i?"":String(i)}function Br(i,o){throw new Dt(-201,!1)}function vr(i,o){null==i&&function tn(i,o,a,d){throw new Error(`ASSERTION ERROR: ${i}`+(null==d?"":` [Expected=> ${a} ${d} ${o} <=Actual]`))}(o,i,null,"!=")}function Yr(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function uo(i){return{providers:i.providers||[],imports:i.imports||[]}}function xn(i){return ho(i,fo)||ho(i,No)}function Lr(i){return null!==xn(i)}function ho(i,o){return i.hasOwnProperty(o)?i[o]:null}function vs(i){return i&&(i.hasOwnProperty(Or)||i.hasOwnProperty(Er))?i[Or]:null}const fo=ut({\u0275prov:ut}),Or=ut({\u0275inj:ut}),No=ut({ngInjectableDef:ut}),Er=ut({ngInjectorDef:ut});var vt=(()=>((vt=vt||{})[vt.Default=0]="Default",vt[vt.Host=1]="Host",vt[vt.Self=2]="Self",vt[vt.SkipSelf=4]="SkipSelf",vt[vt.Optional=8]="Optional",vt))();let nn;function _r(i){const o=nn;return nn=i,o}function Fr(i,o,a){const d=xn(i);return d&&"root"==d.providedIn?void 0===d.value?d.value=d.factory():d.value:a&vt.Optional?null:void 0!==o?o:void Br(cn(i))}const hr=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),or={},Qi="__NG_DI_FLAG__",qi="ngTempTokenPath",eo="ngTokenPath",Di=/\n/gm,Xe="\u0275",Le="__source";let Oe;function Mt(i){const o=Oe;return Oe=i,o}function Ct(i,o=vt.Default){if(void 0===Oe)throw new Dt(-203,!1);return null===Oe?Fr(i,void 0,o):Oe.get(i,o&vt.Optional?null:void 0,o)}function ie(i,o=vt.Default){return(function br(){return nn}()||Ct)(en(i),o)}function Y(i,o=vt.Default){return ie(i,le(o))}function le(i){return typeof i>"u"||"number"==typeof i?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function ge(i){const o=[];for(let a=0;a<i.length;a++){const d=en(i[a]);if(Array.isArray(d)){if(0===d.length)throw new Dt(900,!1);let v,T=vt.Default;for(let I=0;I<d.length;I++){const k=d[I],N=ue(k);"number"==typeof N?-1===N?v=k.token:T|=N:v=k}o.push(ie(v,T))}else o.push(ie(d))}return o}function Ae(i,o){return i[Qi]=o,i.prototype[Qi]=o,i}function ue(i){return i[Qi]}function ae(i){return{toString:i}.toString()}var De=(()=>((De=De||{})[De.OnPush=0]="OnPush",De[De.Default=1]="Default",De))(),We=(()=>{return(i=We||(We={}))[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",We;var i})();const Ue={},bt=[],Wt=ut({\u0275cmp:ut}),on=ut({\u0275dir:ut}),vn=ut({\u0275pipe:ut}),Xn=ut({\u0275mod:ut}),nr=ut({\u0275fac:ut}),fn=ut({__NG_ELEMENT_ID__:ut});let sr=0;function Tr(i){return ae(()=>{const o=Jn(i),a={...o,decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===De.OnPush,directiveDefs:null,pipeDefs:null,dependencies:o.standalone&&i.dependencies||null,getStandaloneInjector:null,data:i.data||{},encapsulation:i.encapsulation||We.Emulated,id:"c"+sr++,styles:i.styles||bt,_:null,schemas:i.schemas||null,tView:null};Dn(a);const d=i.dependencies;return a.directiveDefs=Wi(d,!1),a.pipeDefs=Wi(d,!0),a})}function ji(i){return jn(i)||Qr(i)}function jr(i){return null!==i}function it(i){return ae(()=>({type:i.type,bootstrap:i.bootstrap||bt,declarations:i.declarations||bt,imports:i.imports||bt,exports:i.exports||bt,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function Jr(i,o){if(null==i)return Ue;const a={};for(const d in i)if(i.hasOwnProperty(d)){let v=i[d],T=v;Array.isArray(v)&&(T=v[1],v=v[0]),a[v]=d,o&&(o[v]=T)}return a}function Bo(i){return ae(()=>{const o=Jn(i);return Dn(o),o})}function ra(i){return{type:i.type,name:i.name,factory:null,pure:!1!==i.pure,standalone:!0===i.standalone,onDestroy:i.type.prototype.ngOnDestroy||null}}function jn(i){return i[Wt]||null}function Qr(i){return i[on]||null}function ui(i){return i[vn]||null}function mi(i){const o=jn(i)||Qr(i)||ui(i);return null!==o&&o.standalone}function Ut(i,o){const a=i[Xn]||null;if(!a&&!0===o)throw new Error(`Type ${cn(i)} does not have '\u0275mod' property.`);return a}function Jn(i){const o={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:o,exportAs:i.exportAs||null,standalone:!0===i.standalone,selectors:i.selectors||bt,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Jr(i.inputs,o),outputs:Jr(i.outputs)}}function Dn(i){i.features?.forEach(o=>o(i))}function Wi(i,o){if(!i)return null;const a=o?ui:ji;return()=>("function"==typeof i?i():i).map(d=>a(d)).filter(jr)}const Ci=0,Tt=1,Hn=2,Pr=3,ei=4,ti=5,Qn=6,Pi=7,Vr=8,xs=9,bo=10,An=11,Uo=12,Ri=13,is=14,hi=15,di=16,Si=17,kr=18,mo=19,js=20,Li=21,gr=22,wo=1,ri=2,Qo=7,os=8,jo=9,Dr=10;function to(i){return Array.isArray(i)&&"object"==typeof i[wo]}function vi(i){return Array.isArray(i)&&!0===i[wo]}function ss(i){return 0!=(4&i.flags)}function as(i){return i.componentOffset>-1}function es(i){return 1==(1&i.flags)}function ki(i){return!!i.template}function Oi(i){return 0!=(256&i[Hn])}function cs(i,o){return i.hasOwnProperty(nr)?i[nr]:null}class sa{constructor(o,a,d){this.previousValue=o,this.currentValue=a,this.firstChange=d}isFirstChange(){return this.firstChange}}function $s(){return Lo}function Lo(i){return i.type.prototype.ngOnChanges&&(i.setInput=Hs),Gs}function Gs(){const i=qs(this),o=i?.current;if(o){const a=i.previous;if(a===Ue)i.previous=o;else for(let d in o)a[d]=o[d];i.current=null,this.ngOnChanges(o)}}function Hs(i,o,a,d){const v=this.declaredInputs[a],T=qs(i)||function Ws(i,o){return i[ba]=o}(i,{previous:Ue,current:null}),I=T.current||(T.current={}),k=T.previous,N=k[v];I[v]=new sa(N&&N.currentValue,o,k===Ue),i[d]=o}$s.ngInherit=!0;const ba="__ngSimpleChanges__";function qs(i){return i[ba]||null}const Ki=function(i,o,a){};function Ln(i){for(;Array.isArray(i);)i=i[Ci];return i}function Ts(i,o){return Ln(o[i])}function To(i,o){return Ln(o[i.index])}function Mi(i,o){return i.data[o]}function Ds(i,o){return i[o]}function xi(i,o){const a=o[i];return to(a)?a:a[Ci]}function Cs(i){return 64==(64&i[Hn])}function Fi(i,o){return null==o?null:i[o]}function Xa(i){i[kr]=0}function ml(i,o){i[ti]+=o;let a=i,d=i[Pr];for(;null!==d&&(1===o&&1===a[ti]||-1===o&&0===a[ti]);)d[ti]+=o,a=d,d=d[Pr]}const Vn={lFrame:Do(null),bindingsEnabled:!0};function Ta(){return Vn.bindingsEnabled}function Rt(){return Vn.lFrame.lView}function dr(){return Vn.lFrame.tView}function kl(i){return Vn.lFrame.contextLView=i,i[Vr]}function Ya(i){return Vn.lFrame.contextLView=null,i}function zi(){let i=Ms();for(;null!==i&&64===i.type;)i=i.parent;return i}function Ms(){return Vn.lFrame.currentTNode}function ii(i,o){const a=Vn.lFrame;a.currentTNode=i,a.isParent=o}function Ol(){return Vn.lFrame.isParent}function Ni(){const i=Vn.lFrame;let o=i.bindingRootIndex;return-1===o&&(o=i.bindingRootIndex=i.tView.bindingStartIndex),o}function Xs(){return Vn.lFrame.bindingIndex++}function Vi(i){const o=Vn.lFrame,a=o.bindingIndex;return o.bindingIndex=o.bindingIndex+i,a}function Bl(i,o){const a=Vn.lFrame;a.bindingIndex=a.bindingRootIndex=i,el(o)}function el(i){Vn.lFrame.currentDirectiveIndex=i}function gl(){return Vn.lFrame.currentQueryIndex}function nl(i){Vn.lFrame.currentQueryIndex=i}function Ul(i){const o=i[Tt];return 2===o.type?o.declTNode:1===o.type?i[Qn]:null}function Sa(i,o,a){if(a&vt.SkipSelf){let v=o,T=i;for(;!(v=v.parent,null!==v||a&vt.Host||(v=Ul(T),null===v||(T=T[hi],10&v.type))););if(null===v)return!1;o=v,i=T}const d=Vn.lFrame=ua();return d.currentTNode=o,d.lView=i,!0}function ca(i){const o=ua(),a=i[Tt];Vn.lFrame=o,o.currentTNode=a.firstChild,o.lView=i,o.tView=a,o.contextLView=i,o.bindingIndex=a.bindingStartIndex,o.inI18n=!1}function ua(){const i=Vn.lFrame,o=null===i?null:i.child;return null===o?Do(i):o}function Do(i){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=o),o}function Z(){const i=Vn.lFrame;return Vn.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}const M=Z;function P(){const i=Z();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function he(){return Vn.lFrame.selectedIndex}function be(i){Vn.lFrame.selectedIndex=i}function Ie(){const i=Vn.lFrame;return Mi(i.tView,i.selectedIndex)}function Fe(i,o){for(let a=o.directiveStart,d=o.directiveEnd;a<d;a++){const T=i.data[a].type.prototype,{ngAfterContentInit:I,ngAfterContentChecked:k,ngAfterViewInit:N,ngAfterViewChecked:X,ngOnDestroy:se}=T;I&&(i.contentHooks??(i.contentHooks=[])).push(-a,I),k&&((i.contentHooks??(i.contentHooks=[])).push(a,k),(i.contentCheckHooks??(i.contentCheckHooks=[])).push(a,k)),N&&(i.viewHooks??(i.viewHooks=[])).push(-a,N),X&&((i.viewHooks??(i.viewHooks=[])).push(a,X),(i.viewCheckHooks??(i.viewCheckHooks=[])).push(a,X)),null!=se&&(i.destroyHooks??(i.destroyHooks=[])).push(a,se)}}function Ge(i,o,a){zn(i,o,3,a)}function jt(i,o,a,d){(3&i[Hn])===a&&zn(i,o,a,d)}function bn(i,o){let a=i[Hn];(3&a)===o&&(a&=2047,a+=1,i[Hn]=a)}function zn(i,o,a,d){const T=d??-1,I=o.length-1;let k=0;for(let N=void 0!==d?65535&i[kr]:0;N<I;N++)if("number"==typeof o[N+1]){if(k=o[N],null!=d&&k>=d)break}else o[N]<0&&(i[kr]+=65536),(k<T||-1==T)&&($n(i,a,o,N),i[kr]=(4294901760&i[kr])+N+2),N++}function $n(i,o,a,d){const v=a[d]<0,T=a[d+1],k=i[v?-a[d]:a[d]];if(v){if(i[Hn]>>11<i[kr]>>16&&(3&i[Hn])===o){i[Hn]+=2048,Ki(4,k,T);try{T.call(k)}finally{Ki(5,k,T)}}}else{Ki(4,k,T);try{T.call(k)}finally{Ki(5,k,T)}}}const wn=-1;class xr{constructor(o,a,d){this.factory=o,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=d}}function Mo(i,o,a){let d=0;for(;d<a.length;){const v=a[d];if("number"==typeof v){if(0!==v)break;d++;const T=a[d++],I=a[d++],k=a[d++];i.setAttribute(o,I,k,T)}else{const T=v,I=a[++d];gn(T)?i.setProperty(o,T,I):i.setAttribute(o,T,I),d++}}return d}function Is(i){return 3===i||4===i||6===i}function gn(i){return 64===i.charCodeAt(0)}function ln(i,o){if(null!==o&&0!==o.length)if(null===i||0===i.length)i=o.slice();else{let a=-1;for(let d=0;d<o.length;d++){const v=o[d];"number"==typeof v?a=v:0===a||kn(i,a,v,null,-1===a||2===a?o[++d]:null)}}return i}function kn(i,o,a,d,v){let T=0,I=i.length;if(-1===o)I=-1;else for(;T<i.length;){const k=i[T++];if("number"==typeof k){if(k===o){I=-1;break}if(k>o){I=T-1;break}}}for(;T<i.length;){const k=i[T];if("number"==typeof k)break;if(k===a){if(null===d)return void(null!==v&&(i[T+1]=v));if(d===i[T+1])return void(i[T+2]=v)}T++,null!==d&&T++,null!==v&&T++}-1!==I&&(i.splice(I,0,o),T=I+1),i.splice(T++,0,a),null!==d&&i.splice(T++,0,d),null!==v&&i.splice(T++,0,v)}function fr(i){return i!==wn}function wi(i){return 32767&i}function Bi(i,o){let a=function Vo(i){return i>>16}(i),d=o;for(;a>0;)d=d[hi],a--;return d}let _o=!0;function zr(i){const o=_o;return _o=i,o}const rc=255,Ui=5;let ds=0;const Ei={};function ha(i,o){const a=_l(i,o);if(-1!==a)return a;const d=o[Tt];d.firstCreatePass&&(i.injectorIndex=o.length,Dc(d.data,i),Dc(o,null),Dc(d.blueprint,null));const v=Ys(i,o),T=i.injectorIndex;if(fr(v)){const I=wi(v),k=Bi(v,o),N=k[Tt].data;for(let X=0;X<8;X++)o[T+X]=k[I+X]|N[I+X]}return o[T+8]=v,T}function Dc(i,o){i.push(0,0,0,0,0,0,0,0,o)}function _l(i,o){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===o[i.injectorIndex+8]?-1:i.injectorIndex}function Ys(i,o){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let a=0,d=null,v=o;for(;null!==v;){if(d=sn(v),null===d)return wn;if(a++,v=v[hi],-1!==d.injectorIndex)return d.injectorIndex|a<<16}return wn}function ic(i,o,a){!function Ks(i,o,a){let d;"string"==typeof a?d=a.charCodeAt(0)||0:a.hasOwnProperty(fn)&&(d=a[fn]),null==d&&(d=a[fn]=ds++);const v=d&rc;o.data[i+(v>>Ui)]|=1<<v}(i,o,a)}function Uc(i,o,a){if(a&vt.Optional||void 0!==i)return i;Br()}function $o(i,o,a,d){if(a&vt.Optional&&void 0===d&&(d=null),!(a&(vt.Self|vt.Host))){const v=i[xs],T=_r(void 0);try{return v?v.get(o,d,a&vt.Optional):Fr(o,d,a&vt.Optional)}finally{_r(T)}}return Uc(d,0,a)}function oc(i,o,a,d=vt.Default,v){if(null!==i){if(1024&o[Hn]){const I=function Ma(i,o,a,d,v){let T=i,I=o;for(;null!==T&&null!==I&&1024&I[Hn]&&!(256&I[Hn]);){const k=Vl(T,I,a,d|vt.Self,Ei);if(k!==Ei)return k;let N=T.parent;if(!N){const X=I[Li];if(X){const se=X.get(a,Ei,d);if(se!==Ei)return se}N=sn(I),I=I[hi]}T=N}return v}(i,o,a,d,Ei);if(I!==Ei)return I}const T=Vl(i,o,a,d,Ei);if(T!==Ei)return T}return $o(o,a,d,v)}function Vl(i,o,a,d,v){const T=function wu(i){if("string"==typeof i)return i.charCodeAt(0)||0;const o=i.hasOwnProperty(fn)?i[fn]:void 0;return"number"==typeof o?o>=0?o&rc:Vc:o}(a);if("function"==typeof T){if(!Sa(o,i,d))return d&vt.Host?Uc(v,0,d):$o(o,a,d,v);try{const I=T(d);if(null!=I||d&vt.Optional)return I;Br()}finally{M()}}else if("number"==typeof T){let I=null,k=_l(i,o),N=wn,X=d&vt.Host?o[di][Qn]:null;for((-1===k||d&vt.SkipSelf)&&(N=-1===k?Ys(i,o):o[k+8],N!==wn&&Eu(d,!1)?(I=o[Tt],k=wi(N),o=Bi(N,o)):k=-1);-1!==k;){const se=o[Tt];if(uh(T,k,se.data)){const xe=jc(k,o,a,I,d,X);if(xe!==Ei)return xe}N=o[k+8],N!==wn&&Eu(d,o[Tt].data[k+8]===X)&&uh(T,k,o)?(I=se,k=wi(N),o=Bi(N,o)):k=-1}}return v}function jc(i,o,a,d,v,T){const I=o[Tt],k=I.data[i+8],se=io(k,I,a,null==d?as(k)&&_o:d!=I&&0!=(3&k.type),v&vt.Host&&T===k);return null!==se?rl(o,I,se,k):Ei}function io(i,o,a,d,v){const T=i.providerIndexes,I=o.data,k=1048575&T,N=i.directiveStart,se=T>>20,ze=v?k+se:i.directiveEnd;for(let Ye=d?k:k+se;Ye<ze;Ye++){const wt=I[Ye];if(Ye<N&&a===wt||Ye>=N&&wt.type===a)return Ye}if(v){const Ye=I[N];if(Ye&&ki(Ye)&&Ye.type===a)return N}return null}function rl(i,o,a,d){let v=i[a];const T=o.data;if(function rr(i){return i instanceof xr}(v)){const I=v;I.resolving&&function dn(i,o){const a=o?`. Dependency path: ${o.join(" > ")} > ${i}`:"";throw new Dt(-200,`Circular dependency in DI detected for ${i}${a}`)}(function gt(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():_t(i)}(T[a]));const k=zr(I.canSeeViewProviders);I.resolving=!0;const N=I.injectImpl?_r(I.injectImpl):null;Sa(i,d,vt.Default);try{v=i[a]=I.factory(void 0,T,i,d),o.firstCreatePass&&a>=d.directiveStart&&function _e(i,o,a){const{ngOnChanges:d,ngOnInit:v,ngDoCheck:T}=o.type.prototype;if(d){const I=Lo(o);(a.preOrderHooks??(a.preOrderHooks=[])).push(i,I),(a.preOrderCheckHooks??(a.preOrderCheckHooks=[])).push(i,I)}v&&(a.preOrderHooks??(a.preOrderHooks=[])).push(0-i,v),T&&((a.preOrderHooks??(a.preOrderHooks=[])).push(i,T),(a.preOrderCheckHooks??(a.preOrderCheckHooks=[])).push(i,T))}(a,T[a],o)}finally{null!==N&&_r(N),zr(k),I.resolving=!1,M()}}return v}function uh(i,o,a){return!!(a[o+(i>>Ui)]&1<<i)}function Eu(i,o){return!(i&vt.Self||i&vt.Host&&o)}class ko{constructor(o,a){this._tNode=o,this._lView=a}get(o,a,d){return oc(this._tNode,this._lView,o,le(d),a)}}function Vc(){return new ko(zi(),Rt())}function oo(i){return ae(()=>{const o=i.prototype.constructor,a=o[nr]||As(o),d=Object.prototype;let v=Object.getPrototypeOf(i.prototype).constructor;for(;v&&v!==d;){const T=v[nr]||As(v);if(T&&T!==a)return T;v=Object.getPrototypeOf(v)}return T=>new T})}function As(i){return rn(i)?()=>{const o=As(en(i));return o&&o()}:cs(i)}function sn(i){const o=i[Tt],a=o.type;return 2===a?o.declTNode:1===a?i[Qn]:null}function sc(i){return function bu(i,o){if("class"===o)return i.classes;if("style"===o)return i.styles;const a=i.attrs;if(a){const d=a.length;let v=0;for(;v<d;){const T=a[v];if(Is(T))break;if(0===T)v+=2;else if("number"==typeof T)for(v++;v<d&&"string"==typeof a[v];)v++;else{if(T===o)return a[v+1];v+=2}}}return null}(zi(),i)}const Go="__parameters__";function Ia(i,o,a){return ae(()=>{const d=function Gc(i){return function(...a){if(i){const d=i(...a);for(const v in d)this[v]=d[v]}}}(o);function v(...T){if(this instanceof v)return d.apply(this,T),this;const I=new v(...T);return k.annotation=I,k;function k(N,X,se){const xe=N.hasOwnProperty(Go)?N[Go]:Object.defineProperty(N,Go,{value:[]})[Go];for(;xe.length<=se;)xe.push(null);return(xe[se]=xe[se]||[]).push(I),N}}return a&&(v.prototype=Object.create(a.prototype)),v.prototype.ngMetadataName=i,v.annotationCls=v,v})}class ni{constructor(o,a){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof a?this.__NG_ELEMENT_ID__=a:void 0!==a&&(this.\u0275prov=Yr({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function h(i,o){i.forEach(a=>Array.isArray(a)?h(a,o):o(a))}function r(i,o,a){o>=i.length?i.push(a):i.splice(o,0,a)}function l(i,o){return o>=i.length-1?i.pop():i.splice(o,1)[0]}function g(i,o,a){let d=D(i,o);return d>=0?i[1|d]=a:(d=~d,function p(i,o,a,d){let v=i.length;if(v==o)i.push(a,d);else if(1===v)i.push(d,i[0]),i[0]=a;else{for(v--,i.push(i[v-1],i[v]);v>o;)i[v]=i[v-2],v--;i[o]=a,i[o+1]=d}}(i,d,o,a)),d}function w(i,o){const a=D(i,o);if(a>=0)return i[1|a]}function D(i,o){return function O(i,o,a){let d=0,v=i.length>>a;for(;v!==d;){const T=d+(v-d>>1),I=i[T<<a];if(o===I)return T<<a;I>o?v=T:d=T+1}return~(v<<a)}(i,o,1)}const Ce=Ae(Ia("Optional"),8),Ze=Ae(Ia("SkipSelf"),4);var ms=(()=>((ms=ms||{})[ms.Important=1]="Important",ms[ms.DashCase=2]="DashCase",ms))();const ph=new Map;let Np=0;const ff="__ngContext__";function Ls(i,o){to(o)?(i[ff]=o[js],function Up(i){ph.set(i[js],i)}(o)):i[ff]=o}let rd;function id(i,o){return rd(i,o)}function gh(i){const o=i[Pr];return vi(o)?o[Pr]:o}function Wc(i){return Hl(i[Ri])}function Ac(i){return Hl(i[ei])}function Hl(i){for(;null!==i&&!vi(i);)i=i[ei];return i}function ks(i,o,a,d,v){if(null!=d){let T,I=!1;vi(d)?T=d:to(d)&&(I=!0,d=d[Ci]);const k=Ln(d);0===i&&null!==a?null==v?xl(o,a,k):hc(o,a,k,v||null,!0):1===i&&null!==a?hc(o,a,k,v||null,!0):2===i?function Tf(i,o,a){const d=Io(i,o);d&&function ol(i,o,a,d){i.removeChild(o,a,d)}(i,d,o,a)}(o,k,I):3===i&&o.destroyNode(k),null!=T&&function Df(i,o,a,d,v){const T=a[Qo];T!==Ln(a)&&ks(o,i,d,T,v);for(let k=Dr;k<a.length;k++){const N=a[k];Tl(N[Tt],N,i,o,d,T)}}(o,i,T,a,v)}}function vf(i,o,a){return i.createElement(o,a)}function qp(i,o){const a=i[jo],d=a.indexOf(o),v=o[Pr];512&o[Hn]&&(o[Hn]&=-513,ml(v,-1)),a.splice(d,1)}function xf(i,o){if(i.length<=Dr)return;const a=Dr+o,d=i[a];if(d){const v=d[Si];null!==v&&v!==i&&qp(v,d),o>0&&(i[a-1][ei]=d[ei]);const T=l(i,Dr+o);!function n_(i,o){Tl(i,o,o[An],2,null,null),o[Ci]=null,o[Qn]=null}(d[Tt],d);const I=T[mo];null!==I&&I.detachView(T[Tt]),d[Pr]=null,d[ei]=null,d[Hn]&=-65}return d}function ao(i,o){if(!(128&o[Hn])){const a=o[An];a.destroyNode&&Tl(i,o,a,3,null,null),function Hp(i){let o=i[Ri];if(!o)return On(i[Tt],i);for(;o;){let a=null;if(to(o))a=o[Ri];else{const d=o[Dr];d&&(a=d)}if(!a){for(;o&&!o[ei]&&o!==i;)to(o)&&On(o[Tt],o),o=o[Pr];null===o&&(o=i),to(o)&&On(o[Tt],o),a=o&&o[ei]}o=a}}(o)}}function On(i,o){if(!(128&o[Hn])){o[Hn]&=-65,o[Hn]|=128,function sd(i,o){let a;if(null!=i&&null!=(a=i.destroyHooks))for(let d=0;d<a.length;d+=2){const v=o[a[d]];if(!(v instanceof xr)){const T=a[d+1];if(Array.isArray(T))for(let I=0;I<T.length;I+=2){const k=v[T[I]],N=T[I+1];Ki(4,k,N);try{N.call(k)}finally{Ki(5,k,N)}}else{Ki(4,v,T);try{T.call(v)}finally{Ki(5,v,T)}}}}}(i,o),function Pc(i,o){const a=i.cleanup,d=o[Pi];let v=-1;if(null!==a)for(let T=0;T<a.length-1;T+=2)if("string"==typeof a[T]){const I=a[T+3];I>=0?d[v=I]():d[v=-I].unsubscribe(),T+=2}else{const I=d[v=a[T+1]];a[T].call(I)}if(null!==d){for(let T=v+1;T<d.length;T++)(0,d[T])();o[Pi]=null}}(i,o),1===o[Tt].type&&o[An].destroy();const a=o[Si];if(null!==a&&vi(o[Pr])){a!==o[Pr]&&qp(a,o);const d=o[mo];null!==d&&d.detachView(i)}!function jp(i){ph.delete(i[js])}(o)}}function Sr(i,o,a){return function bf(i,o,a){let d=o;for(;null!==d&&40&d.type;)d=(o=d).parent;if(null===d)return a[Ci];{const{componentOffset:v}=d;if(v>-1){const{encapsulation:T}=i.data[d.directiveStart+v];if(T===We.None||T===We.Emulated)return null}return To(d,a)}}(i,o.parent,a)}function hc(i,o,a,d,v){i.insertBefore(o,a,d,v)}function xl(i,o,a){i.appendChild(o,a)}function bl(i,o,a,d,v){null!==d?hc(i,o,a,d,v):xl(i,o,a)}function Io(i,o){return i.parentNode(o)}let _h,Mf,xh,Xc=function wf(i,o,a){return 40&i.type?To(i,a):null};function Cu(i,o,a,d){const v=Sr(i,d,o),T=o[An],k=function wl(i,o,a){return Xc(i,o,a)}(d.parent||o[Qn],d,o);if(null!=v)if(Array.isArray(a))for(let N=0;N<a.length;N++)bl(T,v,a[N],k,!1);else bl(T,v,a,k,!1);void 0!==_h&&_h(T,d,o,a,v)}function ad(i,o){if(null!==o){const a=o.type;if(3&a)return To(o,i);if(4&a)return cd(-1,i[o.index]);if(8&a){const d=o.child;if(null!==d)return ad(i,d);{const v=i[o.index];return vi(v)?cd(-1,v):Ln(v)}}if(32&a)return id(o,i)()||Ln(i[o.index]);{const d=ld(i,o);return null!==d?Array.isArray(d)?d[0]:ad(gh(i[di]),d):ad(i,o.next)}}return null}function ld(i,o){return null!==o?i[di][Qn].projection[o.projection]:null}function cd(i,o){const a=Dr+i+1;if(a<o.length){const d=o[a],v=d[Tt].firstChild;if(null!==v)return ad(d,v)}return o[Qo]}function El(i,o,a,d,v,T,I){for(;null!=a;){const k=d[a.index],N=a.type;if(I&&0===o&&(k&&Ls(Ln(k),d),a.flags|=2),32!=(32&a.flags))if(8&N)El(i,o,a.child,d,v,T,!1),ks(o,i,v,k,T);else if(32&N){const X=id(a,d);let se;for(;se=X();)ks(o,i,v,se,T);ks(o,i,v,k,T)}else 16&N?yh(i,o,d,a,v,T):ks(o,i,v,k,T);a=I?a.projectionNext:a.next}}function Tl(i,o,a,d,v,T){El(a,d,i.firstChild,o,v,T,!1)}function yh(i,o,a,d,v,T){const I=a[di],N=I[Qn].projection[d.projection];if(Array.isArray(N))for(let X=0;X<N.length;X++)ks(o,i,v,N[X],T);else El(i,o,N,I[Pr],v,T,!0)}function Cf(i,o,a){""===a?i.removeAttribute(o,"class"):i.setAttribute(o,"class",a)}function Xp(i,o,a){const{mergedAttrs:d,classes:v,styles:T}=a;null!==d&&Mo(i,o,d),null!==v&&Cf(i,o,v),null!==T&&function o_(i,o,a){i.setAttribute(o,"style",a)}(i,o,T)}function Iu(i){Mf=i}function bh(i){return function hd(){if(void 0===xh&&(xh=null,hr.trustedTypes))try{xh=hr.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return xh}()?.createScriptURL(i)||i}class ta{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${ur})`}}function al(i){return i instanceof ta?i.changingThisBreaksApplicationSecurity:i}function Cl(i,o){const a=function Af(i){return i instanceof ta&&i.getTypeName()||null}(i);if(null!=a&&a!==o){if("ResourceURL"===a&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${a} (see ${ur})`)}return a===o}const Lf=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var yo=(()=>((yo=yo||{})[yo.NONE=0]="NONE",yo[yo.HTML=1]="HTML",yo[yo.STYLE=2]="STYLE",yo[yo.SCRIPT=3]="SCRIPT",yo[yo.URL=4]="URL",yo[yo.RESOURCE_URL=5]="RESOURCE_URL",yo))();function pd(i){const o=La();return o?o.sanitize(yo.URL,i)||"":Cl(i,"URL")?al(i):function dd(i){return(i=String(i)).match(Lf)?i:"unsafe:"+i}(_t(i))}function um(i){const o=La();if(o)return bh(o.sanitize(yo.RESOURCE_URL,i)||"");if(Cl(i,"ResourceURL"))return bh(al(i));throw new Dt(904,!1)}function Nf(i,o,a){return function dm(i,o){return"src"===o&&("embed"===i||"frame"===i||"iframe"===i||"media"===i||"script"===i)||"href"===o&&("base"===i||"link"===i)?um:pd}(o,a)(i)}function La(){const i=Rt();return i&&i[Uo]}const Fs=new ni("ENVIRONMENT_INITIALIZER"),pm=new ni("INJECTOR",-1),md=new ni("INJECTOR_DEF_TYPES");class mm{get(o,a=or){if(a===or){const d=new Error(`NullInjectorError: No provider for ${cn(o)}!`);throw d.name="NullInjectorError",d}return a}}function h_(i){return{\u0275providers:i}}function d_(...i){return{\u0275providers:Ru(0,i),\u0275fromNgModule:!0}}function Ru(i,...o){const a=[],d=new Set;let v;return h(o,T=>{const I=T;gd(I,a,[],d)&&(v||(v=[]),v.push(I))}),void 0!==v&&Th(v,a),a}function Th(i,o){for(let a=0;a<i.length;a++){const{providers:v}=i[a];Qc(v,T=>{o.push(T)})}}function gd(i,o,a,d){if(!(i=en(i)))return!1;let v=null,T=vs(i);const I=!T&&jn(i);if(T||I){if(I&&!I.standalone)return!1;v=i}else{const N=i.ngModule;if(T=vs(N),!T)return!1;v=N}const k=d.has(v);if(I){if(k)return!1;if(d.add(v),I.dependencies){const N="function"==typeof I.dependencies?I.dependencies():I.dependencies;for(const X of N)gd(X,o,a,d)}}else{if(!T)return!1;{if(null!=T.imports&&!k){let X;d.add(v);try{h(T.imports,se=>{gd(se,o,a,d)&&(X||(X=[]),X.push(se))})}finally{}void 0!==X&&Th(X,o)}if(!k){const X=cs(v)||(()=>new v);o.push({provide:v,useFactory:X,deps:bt},{provide:md,useValue:v,multi:!0},{provide:Fs,useValue:()=>ie(v),multi:!0})}const N=T.providers;null==N||k||Qc(N,se=>{o.push(se)})}}return v!==i&&void 0!==i.providers}function Qc(i,o){for(let a of i)ht(a)&&(a=a.\u0275providers),Array.isArray(a)?Qc(a,o):o(a)}const f_=ut({provide:String,useValue:ut});function Bf(i){return null!==i&&"object"==typeof i&&f_ in i}function eu(i){return"function"==typeof i}const Uf=new ni("Set Injector scope."),ku={},m_={};let Lc;function _d(){return void 0===Lc&&(Lc=new mm),Lc}class _i{}class Dh extends _i{get destroyed(){return this._destroyed}constructor(o,a,d,v){super(),this.parent=a,this.source=d,this.scopes=v,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Sh(o,I=>this.processProvider(I)),this.records.set(pm,tu(void 0,this)),v.has("environment")&&this.records.set(_i,tu(void 0,this));const T=this.records.get(Uf);null!=T&&"string"==typeof T.value&&this.scopes.add(T.value),this.injectorDefTypes=new Set(this.get(md.multi,bt,vt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();for(const o of this._onDestroyHooks)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(o){this._onDestroyHooks.push(o)}runInContext(o){this.assertNotDestroyed();const a=Mt(this),d=_r(void 0);try{return o()}finally{Mt(a),_r(d)}}get(o,a=or,d=vt.Default){this.assertNotDestroyed(),d=le(d);const v=Mt(this),T=_r(void 0);try{if(!(d&vt.SkipSelf)){let k=this.records.get(o);if(void 0===k){const N=function jf(i){return"function"==typeof i||"object"==typeof i&&i instanceof ni}(o)&&xn(o);k=N&&this.injectableDefInScope(N)?tu(yd(o),ku):null,this.records.set(o,k)}if(null!=k)return this.hydrate(o,k)}return(d&vt.Self?_d():this.parent).get(o,a=d&vt.Optional&&a===or?null:a)}catch(I){if("NullInjectorError"===I.name){if((I[qi]=I[qi]||[]).unshift(cn(o)),v)throw I;return function ne(i,o,a,d){const v=i[qi];throw o[Le]&&v.unshift(o[Le]),i.message=function q(i,o,a,d=null){i=i&&"\n"===i.charAt(0)&&i.charAt(1)==Xe?i.slice(2):i;let v=cn(o);if(Array.isArray(o))v=o.map(cn).join(" -> ");else if("object"==typeof o){let T=[];for(let I in o)if(o.hasOwnProperty(I)){let k=o[I];T.push(I+":"+("string"==typeof k?JSON.stringify(k):cn(k)))}v=`{${T.join(", ")}}`}return`${a}${d?"("+d+")":""}[${v}]: ${i.replace(Di,"\n  ")}`}("\n"+i.message,v,a,d),i[eo]=v,i[qi]=null,i}(I,o,"R3InjectorError",this.source)}throw I}finally{_r(T),Mt(v)}}resolveInjectorInitializers(){const o=Mt(this),a=_r(void 0);try{const d=this.get(Fs.multi,bt,vt.Self);for(const v of d)v()}finally{Mt(o),_r(a)}}toString(){const o=[],a=this.records;for(const d of a.keys())o.push(cn(d));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Dt(205,!1)}processProvider(o){let a=eu(o=en(o))?o:en(o&&o.provide);const d=function xd(i){return Bf(i)?tu(void 0,i.useValue):tu(Ou(i),ku)}(o);if(eu(o)||!0!==o.multi)this.records.get(a);else{let v=this.records.get(a);v||(v=tu(void 0,ku,!0),v.factory=()=>ge(v.multi),this.records.set(a,v)),a=o,v.multi.push(o)}this.records.set(a,d)}hydrate(o,a){return a.value===ku&&(a.value=m_,a.value=a.factory()),"object"==typeof a.value&&a.value&&function Ch(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}injectableDefInScope(o){if(!o.providedIn)return!1;const a=en(o.providedIn);return"string"==typeof a?"any"===a||this.scopes.has(a):this.injectorDefTypes.has(a)}}function yd(i){const o=xn(i),a=null!==o?o.factory:cs(i);if(null!==a)return a;if(i instanceof ni)throw new Dt(204,!1);if(i instanceof Function)return function vd(i){const o=i.length;if(o>0)throw function m(i,o){const a=[];for(let d=0;d<i;d++)a.push(o);return a}(o,"?"),new Dt(204,!1);const a=function Hi(i){return i&&(i[fo]||i[No])||null}(i);return null!==a?()=>a.factory(i):()=>new i}(i);throw new Dt(204,!1)}function Ou(i,o,a){let d;if(eu(i)){const v=en(i);return cs(v)||yd(v)}if(Bf(i))d=()=>en(i.useValue);else if(function _m(i){return!(!i||!i.useFactory)}(i))d=()=>i.useFactory(...ge(i.deps||[]));else if(function gm(i){return!(!i||!i.useExisting)}(i))d=()=>ie(en(i.useExisting));else{const v=en(i&&(i.useClass||i.provide));if(!function ym(i){return!!i.deps}(i))return cs(v)||yd(v);d=()=>new v(...ge(i.deps))}return d}function tu(i,o,a=!1){return{factory:i,value:o,multi:a?[]:void 0}}function Sh(i,o){for(const a of i)Array.isArray(a)?Sh(a,o):a&&ht(a)?Sh(a.\u0275providers,o):o(a)}class g_{}class Vf{}class __{resolveComponentFactory(o){throw function Mh(i){const o=Error(`No component factory found for ${cn(i)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=i,o}(o)}}let nu=(()=>{class i{}return i.NULL=new __,i})();function $f(){return pc(zi(),Rt())}function pc(i,o){return new Ih(To(i,o))}let Ih=(()=>{class i{constructor(a){this.nativeElement=a}}return i.__NG_ELEMENT_ID__=$f,i})();function y_(i){return i instanceof Ih?i.nativeElement:i}class bm{}let v_=(()=>{class i{}return i.__NG_ELEMENT_ID__=()=>function x_(){const i=Rt(),a=xi(zi().index,i);return(to(a)?a:i)[An]}(),i})(),b_=(()=>{class i{}return i.\u0275prov=Yr({token:i,providedIn:"root",factory:()=>null}),i})();class Ah{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const w_=new Ah("15.2.9"),bd={},kc="ngOriginalError";function Gf(i){return i[kc]}class Ph{constructor(){this._console=console}handleError(o){const a=this._findOriginalError(o);this._console.error("ERROR",o),a&&this._console.error("ORIGINAL ERROR",a)}_findOriginalError(o){let a=o&&Gf(o);for(;a&&Gf(a);)a=Gf(a);return a||null}}function gc(i){return i instanceof Function?i():i}function Tm(i,o,a){let d=i.length;for(;;){const v=i.indexOf(o,a);if(-1===v)return v;if(0===v||i.charCodeAt(v-1)<=32){const T=o.length;if(v+T===d||i.charCodeAt(v+T)<=32)return v}a=v+1}}const qf="ng-template";function Dm(i,o,a){let d=0,v=!0;for(;d<i.length;){let T=i[d++];if("string"==typeof T&&v){const I=i[d++];if(a&&"class"===T&&-1!==Tm(I.toLowerCase(),o,0))return!0}else{if(1===T){for(;d<i.length&&"string"==typeof(T=i[d++]);)if(T.toLowerCase()===o)return!0;return!1}"number"==typeof T&&(v=!1)}}return!1}function Wf(i){return 4===i.type&&i.value!==qf}function Cm(i,o,a){return o===(4!==i.type||a?i.value:qf)}function Sm(i,o,a){let d=4;const v=i.attrs||[],T=function Td(i){for(let o=0;o<i.length;o++)if(Is(i[o]))return o;return i.length}(v);let I=!1;for(let k=0;k<o.length;k++){const N=o[k];if("number"!=typeof N){if(!I)if(4&d){if(d=2|1&d,""!==N&&!Cm(i,N,a)||""===N&&1===o.length){if(ll(d))return!1;I=!0}}else{const X=8&d?N:o[++k];if(8&d&&null!==i.attrs){if(!Dm(i.attrs,X,a)){if(ll(d))return!1;I=!0}continue}const xe=A_(8&d?"class":N,v,Wf(i),a);if(-1===xe){if(ll(d))return!1;I=!0;continue}if(""!==X){let ze;ze=xe>T?"":v[xe+1].toLowerCase();const Ye=8&d?ze:null;if(Ye&&-1!==Tm(Ye,X,0)||2&d&&X!==ze){if(ll(d))return!1;I=!0}}}}else{if(!I&&!ll(d)&&!ll(N))return!1;if(I&&ll(N))continue;I=!1,d=N|1&d}}return ll(d)||I}function ll(i){return 0==(1&i)}function A_(i,o,a,d){if(null===o)return-1;let v=0;if(d||!a){let T=!1;for(;v<o.length;){const I=o[v];if(I===i)return v;if(3===I||6===I)T=!0;else{if(1===I||2===I){let k=o[++v];for(;"string"==typeof k;)k=o[++v];continue}if(4===I)break;if(0===I){v+=4;continue}}v+=T?1:2}return-1}return function Am(i,o){let a=i.indexOf(4);if(a>-1)for(a++;a<i.length;){const d=i[a];if("number"==typeof d)return-1;if(d===o)return a;a++}return-1}(o,i)}function Mm(i,o,a=!1){for(let d=0;d<o.length;d++)if(Sm(i,o[d],a))return!0;return!1}function zu(i,o){return i?":not("+o.trim()+")":o}function Nu(i){let o=i[0],a=1,d=2,v="",T=!1;for(;a<i.length;){let I=i[a];if("string"==typeof I)if(2&d){const k=i[++a];v+="["+I+(k.length>0?'="'+k+'"':"")+"]"}else 8&d?v+="."+I:4&d&&(v+=" "+I);else""!==v&&!ll(I)&&(o+=zu(T,v),v=""),d=I,T=T||!ll(d);a++}return""!==v&&(o+=zu(T,v)),o}const pr={};function Rm(i){Lm(dr(),Rt(),he()+i,!1)}function Lm(i,o,a,d){if(!d)if(3==(3&o[Hn])){const T=i.preOrderCheckHooks;null!==T&&Ge(o,T,a)}else{const T=i.preOrderHooks;null!==T&&jt(o,T,0,a)}be(a)}function Bm(i,o=null,a=null,d){const v=Um(i,o,a,d);return v.resolveInjectorInitializers(),v}function Um(i,o=null,a=null,d,v=new Set){const T=[a||bt,d_(i)];return d=d||("object"==typeof i?void 0:cn(i)),new Dh(T,o||_d(),d||null,v)}let ru=(()=>{class i{static create(a,d){if(Array.isArray(a))return Bm({name:""},d,a,"");{const v=a.name??"";return Bm({name:v},a.parent,a.providers,v)}}}return i.THROW_IF_NOT_FOUND=or,i.NULL=new mm,i.\u0275prov=Yr({token:i,providedIn:"any",factory:()=>ie(pm)}),i.__NG_ELEMENT_ID__=-1,i})();function Bu(i,o=vt.Default){const a=Rt();return null===a?ie(i,o):oc(zi(),a,en(i),o)}function Xm(){throw new Error("invalid")}function su(i,o){const a=i.contentQueries;if(null!==a)for(let d=0;d<a.length;d+=2){const T=a[d+1];if(-1!==T){const I=i.data[T];nl(a[d]),I.contentQueries(2,o[T],T)}}}function Id(i,o,a,d,v,T,I,k,N,X,se){const xe=o.blueprint.slice();return xe[Ci]=v,xe[Hn]=76|d,(null!==se||i&&1024&i[Hn])&&(xe[Hn]|=1024),Xa(xe),xe[Pr]=xe[hi]=i,xe[Vr]=a,xe[bo]=I||i&&i[bo],xe[An]=k||i&&i[An],xe[Uo]=N||i&&i[Uo]||null,xe[xs]=X||i&&i[xs]||null,xe[Qn]=T,xe[js]=function Bp(){return Np++}(),xe[Li]=se,xe[di]=2==o.type?i[di]:xe,xe}function Uu(i,o,a,d,v){let T=i.data[o];if(null===T)T=function kh(i,o,a,d,v){const T=Ms(),I=Ol(),N=i.data[o]=function Qm(i,o,a,d,v,T){return{type:a,index:d,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:v,attrs:T,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,I?T:T&&T.parent,a,o,d,v);return null===i.firstChild&&(i.firstChild=N),null!==T&&(I?null==T.child&&null!==N.parent&&(T.child=N):null===T.next&&(T.next=N,N.prev=T)),N}(i,o,a,d,v),function Nl(){return Vn.lFrame.inI18n}()&&(T.flags|=32);else if(64&T.type){T.type=a,T.value=d,T.attrs=v;const I=function go(){const i=Vn.lFrame,o=i.currentTNode;return i.isParent?o:o.parent}();T.injectorIndex=null===I?-1:I.injectorIndex}return ii(T,!0),T}function au(i,o,a,d){if(0===a)return-1;const v=o.length;for(let T=0;T<a;T++)o.push(d),i.blueprint.push(d),i.data.push(null);return v}function Ad(i,o,a){ca(o);try{const d=i.viewQuery;null!==d&&zd(1,d,a);const v=i.template;null!==v&&ju(i,o,v,1,a),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&su(i,o),i.staticViewQueries&&zd(2,i.viewQuery,a);const T=i.components;null!==T&&function B_(i,o){for(let a=0;a<o.length;a++)hg(i,o[a])}(o,T)}catch(d){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),d}finally{o[Hn]&=-5,P()}}function Ns(i,o,a,d){const v=o[Hn];if(128!=(128&v)){ca(o);try{Xa(o),function Ja(i){return Vn.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==a&&ju(i,o,a,2,d);const I=3==(3&v);if(I){const X=i.preOrderCheckHooks;null!==X&&Ge(o,X,null)}else{const X=i.preOrderHooks;null!==X&&jt(o,X,0,null),bn(o,0)}if(function Hu(i){for(let o=Wc(i);null!==o;o=Ac(o)){if(!o[ri])continue;const a=o[jo];for(let d=0;d<a.length;d++){const v=a[d];512&v[Hn]||ml(v[Pr],1),v[Hn]|=512}}}(o),function q_(i){for(let o=Wc(i);null!==o;o=Ac(o))for(let a=Dr;a<o.length;a++){const d=o[a],v=d[Tt];Cs(d)&&Ns(v,d,v.template,d[Vr])}}(o),null!==i.contentQueries&&su(i,o),I){const X=i.contentCheckHooks;null!==X&&Ge(o,X)}else{const X=i.contentHooks;null!==X&&jt(o,X,1),bn(o,1)}!function Md(i,o){const a=i.hostBindingOpCodes;if(null!==a)try{for(let d=0;d<a.length;d++){const v=a[d];if(v<0)be(~v);else{const T=v,I=a[++d],k=a[++d];Bl(I,T),k(2,o[T])}}}finally{be(-1)}}(i,o);const k=i.components;null!==k&&function Km(i,o){for(let a=0;a<o.length;a++)np(i,o[a])}(o,k);const N=i.viewQuery;if(null!==N&&zd(2,N,d),I){const X=i.viewCheckHooks;null!==X&&Ge(o,X)}else{const X=i.viewHooks;null!==X&&jt(o,X,2),bn(o,2)}!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),o[Hn]&=-41,512&o[Hn]&&(o[Hn]&=-513,ml(o[Pr],-1))}finally{P()}}}function ju(i,o,a,d,v){const T=he(),I=2&d;try{be(-1),I&&o.length>gr&&Lm(i,o,gr,!1),Ki(I?2:0,v),a(d,v)}finally{be(T),Ki(I?3:1,v)}}function Fc(i,o,a){if(ss(o)){const v=o.directiveEnd;for(let T=o.directiveStart;T<v;T++){const I=i.data[T];I.contentQueries&&I.contentQueries(1,a[T],T)}}}function Oh(i,o,a){Ta()&&(function og(i,o,a,d){const v=a.directiveStart,T=a.directiveEnd;as(a)&&function Od(i,o,a){const d=To(o,i),v=Ym(a),T=i[bo],I=qu(i,Id(i,v,null,a.onPush?32:16,d,o,T,T.createRenderer(d,a),null,null,null));i[o.index]=I}(o,a,i.data[v+a.componentOffset]),i.firstCreatePass||ha(a,o),Ls(d,o);const I=a.initialInputs;for(let k=v;k<T;k++){const N=i.data[k],X=rl(o,i,k,a);Ls(X,o),null!==I&&G_(0,k-v,X,N,0,I),ki(N)&&(xi(a.index,o)[Vr]=rl(o,i,k,a))}}(i,o,a,To(a,o)),64==(64&a.flags)&&$u(i,o,a))}function Vu(i,o,a=To){const d=o.localNames;if(null!==d){let v=o.index+1;for(let T=0;T<d.length;T+=2){const I=d[T+1],k=-1===I?a(o,i):i[I];i[v++]=k}}}function Ym(i){const o=i.tView;return null===o||o.incompleteFirstPass?i.tView=Pd(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts):o}function Pd(i,o,a,d,v,T,I,k,N,X){const se=gr+d,xe=se+v,ze=function Jm(i,o){const a=[];for(let d=0;d<o;d++)a.push(d<i?null:pr);return a}(se,xe),Ye="function"==typeof X?X():X;return ze[Tt]={type:i,blueprint:ze,template:a,queries:null,viewQuery:k,declTNode:o,data:ze.slice().fill(null,se),bindingStartIndex:se,expandoStartIndex:xe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof T?T():T,pipeRegistry:"function"==typeof I?I():I,firstChild:null,schemas:N,consts:Ye,incompleteFirstPass:!1}}function Qf(i,o,a,d){const v=Nd(o);null===a?v.push(d):(v.push(a),i.firstCreatePass&&dg(i).push(d,v.length-1))}function Rd(i,o,a,d){for(let v in i)if(i.hasOwnProperty(v)){a=null===a?{}:a;const T=i[v];null===d?ep(a,o,v,T):d.hasOwnProperty(v)&&ep(a,o,d[v],T)}return a}function ep(i,o,a,d){i.hasOwnProperty(a)?i[a].push(o,d):i[a]=[o,d]}function Ld(i,o,a,d){if(Ta()){const v=null===d?null:{"":-1},T=function ag(i,o){const a=i.directiveRegistry;let d=null,v=null;if(a)for(let T=0;T<a.length;T++){const I=a[T];if(Mm(o,I.selectors,!1))if(d||(d=[]),ki(I))if(null!==I.findHostDirectiveDefs){const k=[];v=v||new Map,I.findHostDirectiveDefs(I,k,v),d.unshift(...k,I),Fh(i,o,k.length)}else d.unshift(I),Fh(i,o,0);else v=v||new Map,I.findHostDirectiveDefs?.(I,d,v),d.push(I)}return null===d?null:[d,v]}(i,a);let I,k;null===T?I=k=null:[I,k]=T,null!==I&&rg(i,o,a,I,v,k),v&&function Gu(i,o,a){if(o){const d=i.localNames=[];for(let v=0;v<o.length;v+=2){const T=a[o[v+1]];if(null==T)throw new Dt(-301,!1);d.push(o[v],T)}}}(a,d,v)}a.mergedAttrs=ln(a.mergedAttrs,a.attrs)}function rg(i,o,a,d,v,T){for(let X=0;X<d.length;X++)ic(ha(a,o),i,d[X].type);!function kd(i,o,a){i.flags|=1,i.directiveStart=o,i.directiveEnd=o+a,i.providerIndexes=o}(a,i.data.length,d.length);for(let X=0;X<d.length;X++){const se=d[X];se.providersResolver&&se.providersResolver(se)}let I=!1,k=!1,N=au(i,o,d.length,null);for(let X=0;X<d.length;X++){const se=d[X];a.mergedAttrs=ln(a.mergedAttrs,se.hostAttrs),cg(i,a,o,N,se),lg(N,se,v),null!==se.contentQueries&&(a.flags|=4),(null!==se.hostBindings||null!==se.hostAttrs||0!==se.hostVars)&&(a.flags|=64);const xe=se.type.prototype;!I&&(xe.ngOnChanges||xe.ngOnInit||xe.ngDoCheck)&&((i.preOrderHooks??(i.preOrderHooks=[])).push(a.index),I=!0),!k&&(xe.ngOnChanges||xe.ngDoCheck)&&((i.preOrderCheckHooks??(i.preOrderCheckHooks=[])).push(a.index),k=!0),N++}!function j_(i,o,a){const v=o.directiveEnd,T=i.data,I=o.attrs,k=[];let N=null,X=null;for(let se=o.directiveStart;se<v;se++){const xe=T[se],ze=a?a.get(xe):null,wt=ze?ze.outputs:null;N=Rd(xe.inputs,se,N,ze?ze.inputs:null),X=Rd(xe.outputs,se,X,wt);const Xt=null===N||null===I||Wf(o)?null:H_(N,se,I);k.push(Xt)}null!==N&&(N.hasOwnProperty("class")&&(o.flags|=8),N.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=k,o.inputs=N,o.outputs=X}(i,a,T)}function $u(i,o,a){const d=a.directiveStart,v=a.directiveEnd,T=a.index,I=function nc(){return Vn.lFrame.currentDirectiveIndex}();try{be(T);for(let k=d;k<v;k++){const N=i.data[k],X=o[k];el(k),(null!==N.hostBindings||0!==N.hostVars||null!==N.hostAttrs)&&sg(N,X)}}finally{be(-1),el(I)}}function sg(i,o){null!==i.hostBindings&&i.hostBindings(1,o)}function Fh(i,o,a){o.componentOffset=a,(i.components??(i.components=[])).push(o.index)}function lg(i,o,a){if(a){if(o.exportAs)for(let d=0;d<o.exportAs.length;d++)a[o.exportAs[d]]=i;ki(o)&&(a[""]=i)}}function cg(i,o,a,d,v){i.data[d]=v;const T=v.factory||(v.factory=cs(v.type)),I=new xr(T,ki(v),Bu);i.blueprint[d]=I,a[d]=I,function $_(i,o,a,d,v){const T=v.hostBindings;if(T){let I=i.hostBindingOpCodes;null===I&&(I=i.hostBindingOpCodes=[]);const k=~o.index;(function ig(i){let o=i.length;for(;o>0;){const a=i[--o];if("number"==typeof a&&a<0)return a}return 0})(I)!=k&&I.push(k),I.push(a,d,T)}}(i,o,d,au(i,a,v.hostVars,pr),v)}function ka(i,o,a,d,v,T){const I=To(i,o);!function tp(i,o,a,d,v,T,I){if(null==T)i.removeAttribute(o,v,a);else{const k=null==I?_t(T):I(T,d||"",v);i.setAttribute(o,v,k,a)}}(o[An],I,T,i.value,a,d,v)}function G_(i,o,a,d,v,T){const I=T[o];if(null!==I){const k=d.setInput;for(let N=0;N<I.length;){const X=I[N++],se=I[N++],xe=I[N++];null!==k?d.setInput(a,xe,X,se):a[se]=xe}}}function H_(i,o,a){let d=null,v=0;for(;v<a.length;){const T=a[v];if(0!==T)if(5!==T){if("number"==typeof T)break;if(i.hasOwnProperty(T)){null===d&&(d=[]);const I=i[T];for(let k=0;k<I.length;k+=2)if(I[k]===o){d.push(T,I[k+1],a[v+1]);break}}v+=2}else v+=2;else v+=4}return d}function ug(i,o,a,d){return[i,!0,!1,o,null,0,d,a,null,null]}function np(i,o){const a=xi(o,i);if(Cs(a)){const d=a[Tt];48&a[Hn]?Ns(d,a,d.template,a[Vr]):a[ti]>0&&rp(a)}}function rp(i){for(let d=Wc(i);null!==d;d=Ac(d))for(let v=Dr;v<d.length;v++){const T=d[v];if(Cs(T))if(512&T[Hn]){const I=T[Tt];Ns(I,T,I.template,T[Vr])}else T[ti]>0&&rp(T)}const a=i[Tt].components;if(null!==a)for(let d=0;d<a.length;d++){const v=xi(a[d],i);Cs(v)&&v[ti]>0&&rp(v)}}function hg(i,o){const a=xi(o,i),d=a[Tt];(function W_(i,o){for(let a=o.length;a<i.blueprint.length;a++)o.push(i.blueprint[a])})(d,a),Ad(d,a,a[Vr])}function qu(i,o){return i[Ri]?i[is][ei]=o:i[Ri]=o,i[is]=o,o}function Fd(i){for(;i;){i[Hn]|=32;const o=gh(i);if(Oi(i)&&!o)return i;i=o}return null}function Ml(i,o,a,d=!0){const v=o[bo];v.begin&&v.begin();try{Ns(i,o,i.template,a)}catch(I){throw d&&op(o,I),I}finally{v.end&&v.end()}}function zd(i,o,a){nl(0),o(i,a)}function Nd(i){return i[Pi]||(i[Pi]=[])}function dg(i){return i.cleanup||(i.cleanup=[])}function op(i,o){const a=i[xs],d=a?a.get(Ph,null):null;d&&d.handleError(o)}function Bd(i,o,a,d,v){for(let T=0;T<a.length;){const I=a[T++],k=a[T++],N=o[I],X=i.data[I];null!==X.setInput?X.setInput(N,v,d,k):N[k]=v}}function Oa(i,o,a){const d=Ts(o,i);!function uc(i,o,a){i.setValue(o,a)}(i[An],d,a)}function cl(i,o,a){let d=a?i.styles:null,v=a?i.classes:null,T=0;if(null!==o)for(let I=0;I<o.length;I++){const k=o[I];"number"==typeof k?T=k:1==T?v=Wn(v,k):2==T&&(d=Wn(d,k+": "+o[++I]+";"))}a?i.styles=d:i.stylesWithoutHost=d,a?i.classes=v:i.classesWithoutHost=v}function Wu(i,o,a,d,v=!1){for(;null!==a;){const T=o[a.index];if(null!==T&&d.push(Ln(T)),vi(T))for(let k=Dr;k<T.length;k++){const N=T[k],X=N[Tt].firstChild;null!==X&&Wu(N[Tt],N,X,d)}const I=a.type;if(8&I)Wu(i,o,a.child,d);else if(32&I){const k=id(a,o);let N;for(;N=k();)d.push(N)}else if(16&I){const k=ld(o,a);if(Array.isArray(k))d.push(...k);else{const N=gh(o[di]);Wu(N[Tt],N,k,d,!0)}}a=v?a.projectionNext:a.next}return d}class Xl{get rootNodes(){const o=this._lView,a=o[Tt];return Wu(a,o,a.firstChild,[])}constructor(o,a){this._lView=o,this._cdRefInjectingView=a,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Vr]}set context(o){this._lView[Vr]=o}get destroyed(){return 128==(128&this._lView[Hn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[Pr];if(vi(o)){const a=o[os],d=a?a.indexOf(this):-1;d>-1&&(xf(o,d),l(a,d))}this._attachedToViewContainer=!1}ao(this._lView[Tt],this._lView)}onDestroy(o){Qf(this._lView[Tt],this._lView,null,o)}markForCheck(){Fd(this._cdRefInjectingView||this._lView)}detach(){this._lView[Hn]&=-65}reattach(){this._lView[Hn]|=64}detectChanges(){Ml(this._lView[Tt],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Dt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function i_(i,o){Tl(i,o,o[An],2,null,null)}(this._lView[Tt],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new Dt(902,!1);this._appRef=o}}class Zu extends Xl{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;Ml(o[Tt],o,o[Vr],!1)}checkNoChanges(){}get context(){return null}}class Fa extends nu{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const a=jn(o);return new zh(a,this.ngModule)}}function za(i){const o=[];for(let a in i)i.hasOwnProperty(a)&&o.push({propName:i[a],templateName:a});return o}class pg{constructor(o,a){this.injector=o,this.parentInjector=a}get(o,a,d){d=le(d);const v=this.injector.get(o,bd,d);return v!==bd||a===bd?v:this.parentInjector.get(o,a,d)}}class zh extends Vf{get inputs(){return za(this.componentDef.inputs)}get outputs(){return za(this.componentDef.outputs)}constructor(o,a){super(),this.componentDef=o,this.ngModule=a,this.componentType=o.type,this.selector=function Lh(i){return i.map(Nu).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!a}create(o,a,d,v){let T=(v=v||this.ngModule)instanceof _i?v:v?.injector;T&&null!==this.componentDef.getStandaloneInjector&&(T=this.componentDef.getStandaloneInjector(T)||T);const I=T?new pg(o,T):o,k=I.get(bm,null);if(null===k)throw new Dt(407,!1);const N=I.get(b_,null),X=k.createRenderer(null,this.componentDef),se=this.componentDef.selectors[0][0]||"div",xe=d?function U_(i,o,a){return i.selectRootElement(o,a===We.ShadowDom)}(X,d,this.componentDef.encapsulation):vf(X,se,function X_(i){const o=i.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(se)),ze=this.componentDef.onPush?288:272,Ye=Pd(0,null,null,1,0,null,null,null,null,null),wt=Id(null,Ye,null,ze,null,null,k,X,N,I,null);let Xt,pn;ca(wt);try{const Cn=this.componentDef;let qn,Gt=null;Cn.findHostDirectiveDefs?(qn=[],Gt=new Map,Cn.findHostDirectiveDefs(Cn,qn,Gt),qn.push(Cn)):qn=[Cn];const yr=function lu(i,o){const a=i[Tt],d=gr;return i[d]=o,Uu(a,d,2,"#host",null)}(wt,xe),xo=function mg(i,o,a,d,v,T,I,k){const N=v[Tt];!function gg(i,o,a,d){for(const v of i)o.mergedAttrs=ln(o.mergedAttrs,v.hostAttrs);null!==o.mergedAttrs&&(cl(o,o.mergedAttrs,!0),null!==a&&Xp(d,a,o))}(d,i,o,I);const X=T.createRenderer(o,a),se=Id(v,Ym(a),null,a.onPush?32:16,v[i.index],i,T,X,k||null,null,null);return N.firstCreatePass&&Fh(N,i,d.length-1),qu(v,se),v[i.index]=se}(yr,xe,Cn,qn,wt,k,X);pn=Mi(Ye,gr),xe&&function Ud(i,o,a,d){if(d)Mo(i,a,["ng-version",w_.full]);else{const{attrs:v,classes:T}=function Pm(i){const o=[],a=[];let d=1,v=2;for(;d<i.length;){let T=i[d];if("string"==typeof T)2===v?""!==T&&o.push(T,i[++d]):8===v&&a.push(T);else{if(!ll(v))break;v=T}d++}return{attrs:o,classes:a}}(o.selectors[0]);v&&Mo(i,a,v),T&&T.length>0&&Cf(i,a,T.join(" "))}}(X,Cn,xe,d),void 0!==a&&function ap(i,o,a){const d=i.projection=[];for(let v=0;v<o.length;v++){const T=a[v];d.push(null!=T?Array.from(T):null)}}(pn,this.ngContentSelectors,a),Xt=function K_(i,o,a,d,v,T){const I=zi(),k=v[Tt],N=To(I,v);rg(k,v,I,a,null,d);for(let se=0;se<a.length;se++)Ls(rl(v,k,I.directiveStart+se,I),v);$u(k,v,I),N&&Ls(N,v);const X=rl(v,k,I.directiveStart+I.componentOffset,I);if(i[Vr]=v[Vr]=X,null!==T)for(const se of T)se(X,o);return Fc(k,I,i),X}(xo,Cn,qn,Gt,wt,[Xu]),Ad(Ye,wt,null)}finally{P()}return new sp(this.componentType,Xt,pc(pn,wt),wt,pn)}}class sp extends g_{constructor(o,a,d,v,T){super(),this.location=d,this._rootLView=v,this._tNode=T,this.instance=a,this.hostView=this.changeDetectorRef=new Zu(v),this.componentType=o}setInput(o,a){const d=this._tNode.inputs;let v;if(null!==d&&(v=d[o])){const T=this._rootLView;Bd(T[Tt],T,v,o,a),Fd(xi(this._tNode.index,T))}}get injector(){return new ko(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function Xu(){const i=zi();Fe(Rt()[Tt],i)}function cu(i){let o=function Ku(i){return Object.getPrototypeOf(i.prototype).constructor}(i.type),a=!0;const d=[i];for(;o;){let v;if(ki(i))v=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new Dt(903,!1);v=o.\u0275dir}if(v){if(a){d.push(v);const I=i;I.inputs=Vd(i.inputs),I.declaredInputs=Vd(i.declaredInputs),I.outputs=Vd(i.outputs);const k=v.hostBindings;k&&_g(i,k);const N=v.viewQuery,X=v.contentQueries;if(N&&Nh(i,N),X&&lp(i,X),Bt(i.inputs,v.inputs),Bt(i.declaredInputs,v.declaredInputs),Bt(i.outputs,v.outputs),ki(v)&&v.data.animation){const se=i.data;se.animation=(se.animation||[]).concat(v.data.animation)}}const T=v.features;if(T)for(let I=0;I<T.length;I++){const k=T[I];k&&k.ngInherit&&k(i),k===cu&&(a=!1)}}o=Object.getPrototypeOf(o)}!function jd(i){let o=0,a=null;for(let d=i.length-1;d>=0;d--){const v=i[d];v.hostVars=o+=v.hostVars,v.hostAttrs=ln(v.hostAttrs,a=ln(a,v.hostAttrs))}}(d)}function Vd(i){return i===Ue?{}:i===bt?[]:i}function Nh(i,o){const a=i.viewQuery;i.viewQuery=a?(d,v)=>{o(d,v),a(d,v)}:o}function lp(i,o){const a=i.contentQueries;i.contentQueries=a?(d,v,T)=>{o(d,v,T),a(d,v,T)}:o}function _g(i,o){const a=i.hostBindings;i.hostBindings=a?(d,v)=>{o(d,v),a(d,v)}:o}function $d(i){return!!hu(i)&&(Array.isArray(i)||!(i instanceof Map)&&Symbol.iterator in i)}function hu(i){return null!==i&&("function"==typeof i||"object"==typeof i)}function Na(i,o,a){return i[o]=a}function Bs(i,o,a){return!Object.is(i[o],a)&&(i[o]=a,!0)}function ul(i,o,a,d){const v=Bs(i,o,a);return Bs(i,o+1,d)||v}function Gd(i,o,a,d){const v=Rt();return Bs(v,Xs(),o)&&(dr(),ka(Ie(),v,i,o,a,d)),Gd}function pu(i,o,a,d,v,T){const k=ul(i,function hs(){return Vn.lFrame.bindingIndex}(),a,v);return Vi(2),k?o+_t(a)+d+_t(v)+T:pr}function Sg(i,o,a,d,v,T,I,k){const N=Rt(),X=dr(),se=i+gr,xe=X.firstCreatePass?function Zd(i,o,a,d,v,T,I,k,N){const X=o.consts,se=Uu(o,i,4,I||null,Fi(X,k));Ld(o,a,se,Fi(X,N)),Fe(o,se);const xe=se.tView=Pd(2,se,d,v,T,o.directiveRegistry,o.pipeRegistry,null,o.schemas,X);return null!==o.queries&&(o.queries.template(o,se),xe.queries=o.queries.embeddedTView(se)),se}(se,X,N,o,a,d,v,T,I):X.data[se];ii(xe,!1);const ze=N[An].createComment("");Cu(X,N,ze,xe),Ls(ze,N),qu(N,N[se]=ug(ze,N,ze,xe)),es(xe)&&Oh(X,N,xe),null!=I&&Vu(N,xe,k)}function Mg(i){return Ds(function Fl(){return Vn.lFrame.contextLView}(),gr+i)}function up(i,o,a){const d=Rt();return Bs(d,Xs(),o)&&function Ao(i,o,a,d,v,T,I,k){const N=To(o,a);let se,X=o.inputs;!k&&null!=X&&(se=X[d])?(Bd(i,a,se,d,v),as(o)&&function tg(i,o){const a=xi(o,i);16&a[Hn]||(a[Hn]|=32)}(a,o.index)):3&o.type&&(d=function eg(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(d),v=null!=I?I(v,o.value||"",d):v,T.setProperty(N,d,v))}(dr(),Ie(),d,i,o,d[An],a,!1),up}function qh(i,o,a,d,v){const I=v?"class":"style";Bd(i,a,o.inputs[I],I,d)}function zc(i,o,a,d){const v=Rt(),T=dr(),I=gr+i,k=v[An],N=T.firstCreatePass?function J_(i,o,a,d,v,T){const I=o.consts,N=Uu(o,i,2,d,Fi(I,v));return Ld(o,a,N,Fi(I,T)),null!==N.attrs&&cl(N,N.attrs,!1),null!==N.mergedAttrs&&cl(N,N.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,N),N}(I,T,v,o,a,d):T.data[I],X=v[I]=vf(k,o,function te(){return Vn.lFrame.currentNamespace}()),se=es(N);return ii(N,!0),Xp(k,X,N),32!=(32&N.flags)&&Cu(T,v,X,N),0===function Ss(){return Vn.lFrame.elementDepthCount}()&&Ls(X,v),function Ea(){Vn.lFrame.elementDepthCount++}(),se&&(Oh(T,v,N),Fc(T,N,v)),null!==d&&Vu(v,N),zc}function Xd(){let i=zi();Ol()?function Ca(){Vn.lFrame.isParent=!1}():(i=i.parent,ii(i,!1));const o=i;!function Zs(){Vn.lFrame.elementDepthCount--}();const a=dr();return a.firstCreatePass&&(Fe(a,i),ss(i)&&a.queries.elementEnd(i)),null!=o.classesWithoutHost&&function no(i){return 0!=(8&i.flags)}(o)&&qh(a,o,Rt(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function Co(i){return 0!=(16&i.flags)}(o)&&qh(a,o,Rt(),o.stylesWithoutHost,!1),Xd}function hp(i,o,a,d){return zc(i,o,a,d),Xd(),hp}function Il(){return Rt()}function Kl(i){return!!i&&"function"==typeof i.then}function Al(i){return!!i&&"function"==typeof i.subscribe}const bc=Al;function ih(i,o,a,d){const v=Rt(),T=dr(),I=zi();return function pp(i,o,a,d,v,T,I){const k=es(d),X=i.firstCreatePass&&dg(i),se=o[Vr],xe=Nd(o);let ze=!0;if(3&d.type||I){const Xt=To(d,o),pn=I?I(Xt):Xt,Cn=xe.length,qn=I?yr=>I(Ln(yr[d.index])):d.index;let Gt=null;if(!I&&k&&(Gt=function Ag(i,o,a,d){const v=i.cleanup;if(null!=v)for(let T=0;T<v.length-1;T+=2){const I=v[T];if(I===a&&v[T+1]===d){const k=o[Pi],N=v[T+2];return k.length>N?k[N]:null}"string"==typeof I&&(T+=2)}return null}(i,o,v,d.index)),null!==Gt)(Gt.__ngLastListenerFn__||Gt).__ngNextListenerFn__=T,Gt.__ngLastListenerFn__=T,ze=!1;else{T=Pg(d,o,se,T,!1);const yr=a.listen(pn,v,T);xe.push(T,yr),X&&X.push(v,qn,Cn,Cn+1)}}else T=Pg(d,o,se,T,!1);const Ye=d.outputs;let wt;if(ze&&null!==Ye&&(wt=Ye[v])){const Xt=wt.length;if(Xt)for(let pn=0;pn<Xt;pn+=2){const xo=o[wt[pn]][wt[pn+1]].subscribe(T),Ko=xe.length;xe.push(T,xo),X&&X.push(v,d.index,Ko,-(Ko+1))}}}(T,v,v[An],I,i,o,d),ih}function Yd(i,o,a,d){try{return Ki(6,o,a),!1!==a(d)}catch(v){return op(i,v),!1}finally{Ki(7,o,a)}}function Pg(i,o,a,d,v){return function T(I){if(I===Function)return d;Fd(i.componentOffset>-1?xi(i.index,o):o);let N=Yd(o,a,d,I),X=T.__ngNextListenerFn__;for(;X;)N=Yd(o,a,X,I)&&N,X=X.__ngNextListenerFn__;return v&&!1===N&&(I.preventDefault(),I.returnValue=!1),N}}function mp(i=1){return function U(i){return(Vn.lFrame.contextLView=function ee(i,o){for(;i>0;)o=o[hi],i--;return o}(i,Vn.lFrame.contextLView))[Vr]}(i)}function Ua(i,o){return i<<17|o<<2}function Yl(i){return i>>17&32767}function Ec(i){return 2|i}function Nc(i){return(131068&i)>>2}function tf(i,o){return-131069&i|o<<2}function oh(i){return 1|i}function xp(i,o,a,d,v){const T=i[a+1],I=null===o;let k=d?Yl(T):Nc(T),N=!1;for(;0!==k&&(!1===N||I);){const se=i[k+1];ny(i[k],o)&&(N=!0,i[k+1]=d?oh(se):Ec(se)),k=d?Yl(se):Nc(se)}N&&(i[a+1]=d?Ec(T):oh(T))}function ny(i,o){return null===i||null==o||(Array.isArray(i)?i[1]:i)===o||!(!Array.isArray(i)||"string"!=typeof o)&&D(i,o)>=0}const Po={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function bp(i){return i.substring(Po.key,Po.keyEnd)}function zg(i){return i.substring(Po.value,Po.valueEnd)}function e(i,o){const a=Po.textEnd;return a===o?-1:(o=Po.keyEnd=function y(i,o,a){for(;o<a&&i.charCodeAt(o)>32;)o++;return o}(i,Po.key=o,a),f(i,o,a))}function s(i,o){const a=Po.textEnd;let d=Po.key=f(i,o,a);return a===d?-1:(d=Po.keyEnd=function b(i,o,a){let d;for(;o<a&&(45===(d=i.charCodeAt(o))||95===d||(-33&d)>=65&&(-33&d)<=90||d>=48&&d<=57);)o++;return o}(i,d,a),d=C(i,d,a),d=Po.value=f(i,d,a),d=Po.valueEnd=function S(i,o,a){let d=-1,v=-1,T=-1,I=o,k=I;for(;I<a;){const N=i.charCodeAt(I++);if(59===N)return k;34===N||39===N?k=I=L(i,N,I,a):o===I-4&&85===T&&82===v&&76===d&&40===N?k=I=L(i,41,I,a):N>32&&(k=I),T=v,v=d,d=-33&N}return k}(i,d,a),C(i,d,a))}function u(i){Po.key=0,Po.keyEnd=0,Po.value=0,Po.valueEnd=0,Po.textEnd=i.length}function f(i,o,a){for(;o<a&&i.charCodeAt(o)<=32;)o++;return o}function C(i,o,a,d){return(o=f(i,o,a))<a&&o++,o}function L(i,o,a,d){let v=-1,T=a;for(;T<d;){const I=i.charCodeAt(T++);if(I==o&&92!==v)return T;v=92==I&&92===v?0:I}throw new Error}function j(i,o){return function Te(i,o,a,d){const v=Rt(),T=dr(),I=Vi(2);T.firstUpdatePass&&Re(T,i,I,d),o!==pr&&Bs(v,I,o)&&rt(T,T.data[he()],v,v[An],i,v[I+1]=function Qt(i,o){return null==i||""===i||("string"==typeof o?i+=o:"object"==typeof i&&(i=cn(al(i)))),i}(o,a),d,I)}(i,o,null,!0),j}function $(i){pe(mt,J,i,!1)}function J(i,o){for(let a=function n(i){return u(i),s(i,f(i,0,Po.textEnd))}(o);a>=0;a=s(o,a))mt(i,bp(o),zg(o))}function ce(i){pe(St,ye,i,!0)}function ye(i,o){for(let a=function t(i){return u(i),e(i,f(i,0,Po.textEnd))}(o);a>=0;a=e(o,a))g(i,bp(o),!0)}function pe(i,o,a,d){const v=dr(),T=Vi(2);v.firstUpdatePass&&Re(v,null,T,d);const I=Rt();if(a!==pr&&Bs(I,T,a)){const k=v.data[he()];if(mn(k,d)&&!we(v,T)){let N=d?k.classesWithoutHost:k.stylesWithoutHost;null!==N&&(a=Wn(N,a||"")),qh(v,k,I,a,d)}else!function Ot(i,o,a,d,v,T,I,k){v===pr&&(v=bt);let N=0,X=0,se=0<v.length?v[0]:null,xe=0<T.length?T[0]:null;for(;null!==se||null!==xe;){const ze=N<v.length?v[N+1]:void 0,Ye=X<T.length?T[X+1]:void 0;let Xt,wt=null;se===xe?(N+=2,X+=2,ze!==Ye&&(wt=xe,Xt=Ye)):null===xe||null!==se&&se<xe?(N+=2,wt=se):(X+=2,wt=xe,Xt=Ye),null!==wt&&rt(i,o,a,d,wt,Xt,I,k),se=N<v.length?v[N]:null,xe=X<T.length?T[X]:null}}(v,k,I,I[An],I[T+1],I[T+1]=function dt(i,o,a){if(null==a||""===a)return bt;const d=[],v=al(a);if(Array.isArray(v))for(let T=0;T<v.length;T++)i(d,v[T],!0);else if("object"==typeof v)for(const T in v)v.hasOwnProperty(T)&&i(d,T,v[T]);else"string"==typeof v&&o(d,v);return d}(i,o,a),d,T)}}function we(i,o){return o>=i.expandoStartIndex}function Re(i,o,a,d){const v=i.data;if(null===v[a+1]){const T=v[he()],I=we(i,a);mn(T,d)&&null===o&&!I&&(o=!1),o=function Me(i,o,a,d){const v=function tl(i){const o=Vn.lFrame.currentDirectiveIndex;return-1===o?null:i[o]}(i);let T=d?o.residualClasses:o.residualStyles;if(null===v)0===(d?o.classBindings:o.styleBindings)&&(a=Je(a=At(null,i,o,a,d),o.attrs,d),T=null);else{const I=o.directiveStylingLast;if(-1===I||i[I]!==v)if(a=At(v,i,o,a,d),null===T){let N=function Ke(i,o,a){const d=a?o.classBindings:o.styleBindings;if(0!==Nc(d))return i[Yl(d)]}(i,o,d);void 0!==N&&Array.isArray(N)&&(N=At(null,i,o,N[1],d),N=Je(N,o.attrs,d),function qe(i,o,a,d){i[Yl(a?o.classBindings:o.styleBindings)]=d}(i,o,d,N))}else T=function lt(i,o,a){let d;const v=o.directiveEnd;for(let T=1+o.directiveStylingLast;T<v;T++)d=Je(d,i[T].hostAttrs,a);return Je(d,o.attrs,a)}(i,o,d)}return void 0!==T&&(d?o.residualClasses=T:o.residualStyles=T),a}(v,T,o,d),function ty(i,o,a,d,v,T){let I=T?o.classBindings:o.styleBindings,k=Yl(I),N=Nc(I);i[d]=a;let se,X=!1;if(Array.isArray(a)?(se=a[1],(null===se||D(a,se)>0)&&(X=!0)):se=a,v)if(0!==N){const ze=Yl(i[k+1]);i[d+1]=Ua(ze,k),0!==ze&&(i[ze+1]=tf(i[ze+1],d)),i[k+1]=function Pl(i,o){return 131071&i|o<<17}(i[k+1],d)}else i[d+1]=Ua(k,0),0!==k&&(i[k+1]=tf(i[k+1],d)),k=d;else i[d+1]=Ua(N,0),0===k?k=d:i[N+1]=tf(i[N+1],d),N=d;X&&(i[d+1]=Ec(i[d+1])),xp(i,se,d,!0),xp(i,se,d,!1),function Fg(i,o,a,d,v){const T=v?i.residualClasses:i.residualStyles;null!=T&&"string"==typeof o&&D(T,o)>=0&&(a[d+1]=oh(a[d+1]))}(o,se,i,d,T),I=Ua(k,N),T?o.classBindings=I:o.styleBindings=I}(v,T,o,a,I,d)}}function At(i,o,a,d,v){let T=null;const I=a.directiveEnd;let k=a.directiveStylingLast;for(-1===k?k=a.directiveStart:k++;k<I&&(T=o[k],d=Je(d,T.hostAttrs,v),T!==i);)k++;return null!==i&&(a.directiveStylingLast=k),d}function Je(i,o,a){const d=a?1:2;let v=-1;if(null!==o)for(let T=0;T<o.length;T++){const I=o[T];"number"==typeof I?v=I:v===d&&(Array.isArray(i)||(i=void 0===i?[]:["",i]),g(i,I,!!a||o[++T]))}return void 0===i?null:i}function mt(i,o,a){g(i,o,al(a))}function St(i,o,a){const d=String(o);""!==d&&!d.includes(" ")&&g(i,d,a)}function rt(i,o,a,d,v,T,I,k){if(!(3&o.type))return;const N=i.data,X=N[k+1],se=function Zh(i){return 1==(1&i)}(X)?qt(N,o,a,v,Nc(X),I):void 0;Sn(se)||(Sn(T)||function vp(i){return 2==(2&i)}(X)&&(T=qt(N,null,a,v,k,I)),function Zp(i,o,a,d,v){if(o)v?i.addClass(a,d):i.removeClass(a,d);else{let T=-1===d.indexOf("-")?void 0:ms.DashCase;null==v?i.removeStyle(a,d,T):("string"==typeof v&&v.endsWith("!important")&&(v=v.slice(0,-10),T|=ms.Important),i.setStyle(a,d,v,T))}}(d,I,Ts(he(),a),v,T))}function qt(i,o,a,d,v,T){const I=null===o;let k;for(;v>0;){const N=i[v],X=Array.isArray(N),se=X?N[1]:N,xe=null===se;let ze=a[v+1];ze===pr&&(ze=xe?bt:void 0);let Ye=xe?w(ze,d):se===d?ze:void 0;if(X&&!Sn(Ye)&&(Ye=w(N,d)),Sn(Ye)&&(k=Ye,I))return k;const wt=i[v+1];v=I?Yl(wt):Nc(wt)}if(null!==o){let N=T?o.residualClasses:o.residualStyles;null!=N&&(k=w(N,d))}return k}function Sn(i){return void 0!==i}function mn(i,o){return 0!=(i.flags&(o?8:16))}function Zt(i,o=""){const a=Rt(),d=dr(),v=i+gr,T=d.firstCreatePass?Uu(d,v,1,o,null):d.data[v],I=a[v]=function ql(i,o){return i.createText(o)}(a[An],o);Cu(d,a,I,T),ii(T,!1)}function Pn(i){return ar("",i,""),Pn}function ar(i,o,a){const d=Rt(),v=function Qu(i,o,a,d){return Bs(i,Xs(),a)?o+_t(a)+d:pr}(d,i,o,a);return v!==pr&&Oa(d,he(),v),ar}function lr(i,o,a,d,v){const T=Rt(),I=pu(T,i,o,a,d,v);return I!==pr&&Oa(T,he(),I),lr}const ja=void 0;var Sp=["en",[["a","p"],["AM","PM"],ja],[["AM","PM"],ja,ja],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],ja,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],ja,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",ja,"{1} 'at' {0}",ja],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Cp(i){const a=Math.floor(Math.abs(i)),d=i.toString().replace(/^[^.]*\.?/,"").length;return 1===a&&0===d?1:5}];let Va={};function Mp(i){const o=function vu(i){return i.toLowerCase().replace(/_/g,"-")}(i);let a=lh(o);if(a)return a;const d=o.split("-")[0];if(a=lh(d),a)return a;if("en"===d)return Sp;throw new Dt(701,!1)}function na(i){return Mp(i)[Zn.PluralCase]}function lh(i){return i in Va||(Va[i]=hr.ng&&hr.ng.common&&hr.ng.common.locales&&hr.ng.common.locales[i]),Va[i]}var Zn=(()=>((Zn=Zn||{})[Zn.LocaleId=0]="LocaleId",Zn[Zn.DayPeriodsFormat=1]="DayPeriodsFormat",Zn[Zn.DayPeriodsStandalone=2]="DayPeriodsStandalone",Zn[Zn.DaysFormat=3]="DaysFormat",Zn[Zn.DaysStandalone=4]="DaysStandalone",Zn[Zn.MonthsFormat=5]="MonthsFormat",Zn[Zn.MonthsStandalone=6]="MonthsStandalone",Zn[Zn.Eras=7]="Eras",Zn[Zn.FirstDayOfWeek=8]="FirstDayOfWeek",Zn[Zn.WeekendRange=9]="WeekendRange",Zn[Zn.DateFormat=10]="DateFormat",Zn[Zn.TimeFormat=11]="TimeFormat",Zn[Zn.DateTimeFormat=12]="DateTimeFormat",Zn[Zn.NumberSymbols=13]="NumberSymbols",Zn[Zn.NumberFormats=14]="NumberFormats",Zn[Zn.CurrencyCode=15]="CurrencyCode",Zn[Zn.CurrencySymbol=16]="CurrencySymbol",Zn[Zn.CurrencyName=17]="CurrencyName",Zn[Zn.Currencies=18]="Currencies",Zn[Zn.Directionality=19]="Directionality",Zn[Zn.PluralCase=20]="PluralCase",Zn[Zn.ExtraData=21]="ExtraData",Zn))();const sf="en-US";let $y=sf;function oy(i,o,a,d,v){if(i=en(i),Array.isArray(i))for(let T=0;T<i.length;T++)oy(i[T],o,a,d,v);else{const T=dr(),I=Rt();let k=eu(i)?i:en(i.provide),N=Ou(i);const X=zi(),se=1048575&X.providerIndexes,xe=X.directiveStart,ze=X.providerIndexes>>20;if(eu(i)||!i.multi){const Ye=new xr(N,v,Bu),wt=ay(k,o,v?se:se+ze,xe);-1===wt?(ic(ha(X,I),T,k),sy(T,i,o.length),o.push(k),X.directiveStart++,X.directiveEnd++,v&&(X.providerIndexes+=1048576),a.push(Ye),I.push(Ye)):(a[wt]=Ye,I[wt]=Ye)}else{const Ye=ay(k,o,se+ze,xe),wt=ay(k,o,se,se+ze),pn=wt>=0&&a[wt];if(v&&!pn||!v&&!(Ye>=0&&a[Ye])){ic(ha(X,I),T,k);const Cn=function Ux(i,o,a,d,v){const T=new xr(i,a,Bu);return T.multi=[],T.index=o,T.componentProviders=0,pv(T,v,d&&!a),T}(v?Bx:Nx,a.length,v,d,N);!v&&pn&&(a[wt].providerFactory=Cn),sy(T,i,o.length,0),o.push(k),X.directiveStart++,X.directiveEnd++,v&&(X.providerIndexes+=1048576),a.push(Cn),I.push(Cn)}else sy(T,i,Ye>-1?Ye:wt,pv(a[v?wt:Ye],N,!v&&d));!v&&d&&pn&&a[wt].componentProviders++}}}function sy(i,o,a,d){const v=eu(o),T=function p_(i){return!!i.useClass}(o);if(v||T){const N=(T?en(o.useClass):o).prototype.ngOnDestroy;if(N){const X=i.destroyHooks||(i.destroyHooks=[]);if(!v&&o.multi){const se=X.indexOf(a);-1===se?X.push(a,[d,N]):X[se+1].push(d,N)}else X.push(a,N)}}}function pv(i,o,a){return a&&i.componentProviders++,i.multi.push(o)-1}function ay(i,o,a,d){for(let v=a;v<d;v++)if(o[v]===i)return v;return-1}function Nx(i,o,a,d){return ly(this.multi,[])}function Bx(i,o,a,d){const v=this.multi;let T;if(this.providerFactory){const I=this.providerFactory.componentProviders,k=rl(a,a[Tt],this.providerFactory.index,d);T=k.slice(0,I),ly(v,T);for(let N=I;N<k.length;N++)T.push(k[N])}else T=[],ly(v,T);return T}function ly(i,o){for(let a=0;a<i.length;a++)o.push((0,i[a])());return o}function mv(i,o=[]){return a=>{a.providersResolver=(d,v)=>function zx(i,o,a){const d=dr();if(d.firstCreatePass){const v=ki(i);oy(a,d.data,d.blueprint,v,!0),oy(o,d.data,d.blueprint,v,!1)}}(d,v?v(i):i,o)}}class af{}class gv{}function jx(i,o){return new _v(i,o??null)}class _v extends af{constructor(o,a){super(),this._parent=a,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Fa(this);const d=Ut(o);this._bootstrapComponents=gc(d.bootstrap),this._r3Injector=Um(o,a,[{provide:af,useValue:this},{provide:nu,useValue:this.componentFactoryResolver}],cn(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class cy extends gv{constructor(o){super(),this.moduleType=o}create(o){return new _v(this.moduleType,o)}}class Vx extends af{constructor(o,a,d){super(),this.componentFactoryResolver=new Fa(this),this.instance=null;const v=new Dh([...o,{provide:af,useValue:this},{provide:nu,useValue:this.componentFactoryResolver}],a||_d(),d,new Set(["environment"]));this.injector=v,v.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function uy(i,o,a=null){return new Vx(i,o,a).injector}let $x=(()=>{class i{constructor(a){this._injector=a,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(a){if(!a.standalone)return null;if(!this.cachedInjectors.has(a.id)){const d=Ru(0,a.type),v=d.length>0?uy([d],this._injector,`Standalone[${a.type.name}]`):null;this.cachedInjectors.set(a.id,v)}return this.cachedInjectors.get(a.id)}ngOnDestroy(){try{for(const a of this.cachedInjectors.values())null!==a&&a.destroy()}finally{this.cachedInjectors.clear()}}}return i.\u0275prov=Yr({token:i,providedIn:"environment",factory:()=>new i(ie(_i))}),i})();function yv(i){i.getStandaloneInjector=o=>o.get($x).getOrCreateStandaloneInjector(i)}function Dv(i,o,a){const d=Ni()+i,v=Rt();return v[d]===pr?Na(v,d,a?o.call(a):o()):function Vh(i,o){return i[o]}(v,d)}function Cv(i,o,a,d){return Sv(Rt(),Ni(),i,o,a,d)}function kp(i,o){const a=i[o];return a===pr?void 0:a}function Sv(i,o,a,d,v,T){const I=o+a;return Bs(i,I,v)?Na(i,I+1,T?d.call(T,v):d(v)):kp(i,I+1)}function Rv(i,o){const a=dr();let d;const v=i+gr;a.firstCreatePass?(d=function s1(i,o){if(o)for(let a=o.length-1;a>=0;a--){const d=o[a];if(i===d.name)return d}}(o,a.pipeRegistry),a.data[v]=d,d.onDestroy&&(a.destroyHooks??(a.destroyHooks=[])).push(v,d.onDestroy)):d=a.data[v];const T=d.factory||(d.factory=cs(d.type)),I=_r(Bu);try{const k=zr(!1),N=T();return zr(k),function Y_(i,o,a,d){a>=i.data.length&&(i.data[a]=null,i.blueprint[a]=null),o[a]=d}(a,Rt(),v,N),N}finally{_r(I)}}function Lv(i,o,a){const d=i+gr,v=Rt(),T=Ds(v,d);return Op(v,d)?Sv(v,Ni(),o,T.transform,a,T):T.transform(a)}function kv(i,o,a,d){const v=i+gr,T=Rt(),I=Ds(T,v);return Op(T,v)?function Mv(i,o,a,d,v,T,I){const k=o+a;return ul(i,k,v,T)?Na(i,k+2,I?d.call(I,v,T):d(v,T)):kp(i,k+2)}(T,Ni(),o,I.transform,a,d,I):I.transform(a,d)}function Op(i,o){return i[Tt].data[o].pure}function dy(i){return o=>{setTimeout(i,void 0,o)}}const Bc=class u1 extends W.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,a,d){let v=o,T=a||(()=>null),I=d;if(o&&"object"==typeof o){const N=o;v=N.next?.bind(N),T=N.error?.bind(N),I=N.complete?.bind(N)}this.__isAsync&&(T=dy(T),v&&(v=dy(v)),I&&(I=dy(I)));const k=super.subscribe({next:v,error:T,complete:I});return o instanceof me.w0&&o.add(k),k}};function h1(){return this._results[Symbol.iterator]()}class fy{get changes(){return this._changes||(this._changes=new Bc)}constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const a=fy.prototype;a[Symbol.iterator]||(a[Symbol.iterator]=h1)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,a){return this._results.reduce(o,a)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,a){const d=this;d.dirty=!1;const v=function Oo(i){return i.flat(Number.POSITIVE_INFINITY)}(o);(this._changesDetected=!function qc(i,o,a){if(i.length!==o.length)return!1;for(let d=0;d<i.length;d++){let v=i[d],T=o[d];if(a&&(v=a(v),T=a(T)),T!==v)return!1}return!0}(d._results,v,a))&&(d._results=v,d.length=v.length,d.last=v[this.length-1],d.first=v[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Fp=(()=>{class i{}return i.__NG_ELEMENT_ID__=p1,i})();const d1=Fp,f1=class extends d1{constructor(o,a,d){super(),this._declarationLView=o,this._declarationTContainer=a,this.elementRef=d}createEmbeddedView(o,a){const d=this._declarationTContainer.tView,v=Id(this._declarationLView,d,o,16,null,d.declTNode,null,null,null,null,a||null);v[Si]=this._declarationLView[this._declarationTContainer.index];const I=this._declarationLView[mo];return null!==I&&(v[mo]=I.createEmbeddedView(d)),Ad(d,v,o),new Xl(v)}};function p1(){return Gg(zi(),Rt())}function Gg(i,o){return 4&i.type?new f1(o,i,pc(i,o)):null}let Hg=(()=>{class i{}return i.__NG_ELEMENT_ID__=m1,i})();function m1(){return zv(zi(),Rt())}const g1=Hg,Ov=class extends g1{constructor(o,a,d){super(),this._lContainer=o,this._hostTNode=a,this._hostLView=d}get element(){return pc(this._hostTNode,this._hostLView)}get injector(){return new ko(this._hostTNode,this._hostLView)}get parentInjector(){const o=Ys(this._hostTNode,this._hostLView);if(fr(o)){const a=Bi(o,this._hostLView),d=wi(o);return new ko(a[Tt].data[d+8],a)}return new ko(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const a=Fv(this._lContainer);return null!==a&&a[o]||null}get length(){return this._lContainer.length-Dr}createEmbeddedView(o,a,d){let v,T;"number"==typeof d?v=d:null!=d&&(v=d.index,T=d.injector);const I=o.createEmbeddedView(a||{},T);return this.insert(I,v),I}createComponent(o,a,d,v,T){const I=o&&!function $l(i){return"function"==typeof i}(o);let k;if(I)k=a;else{const xe=a||{};k=xe.index,d=xe.injector,v=xe.projectableNodes,T=xe.environmentInjector||xe.ngModuleRef}const N=I?o:new zh(jn(o)),X=d||this.parentInjector;if(!T&&null==N.ngModule){const ze=(I?X:this.parentInjector).get(_i,null);ze&&(T=ze)}const se=N.create(X,v,void 0,T);return this.insert(se.hostView,k),se}insert(o,a){const d=o._lView,v=d[Tt];if(function Yi(i){return vi(i[Pr])}(d)){const se=this.indexOf(o);if(-1!==se)this.detach(se);else{const xe=d[Pr],ze=new Ov(xe,xe[Qn],xe[Pr]);ze.detach(ze.indexOf(o))}}const T=this._adjustIndex(a),I=this._lContainer;!function od(i,o,a,d){const v=Dr+d,T=a.length;d>0&&(a[v-1][ei]=o),d<T-Dr?(o[ei]=a[v],r(a,Dr+d,o)):(a.push(o),o[ei]=null),o[Pr]=a;const I=o[Si];null!==I&&a!==I&&function vl(i,o){const a=i[jo];o[di]!==o[Pr][Pr][di]&&(i[ri]=!0),null===a?i[jo]=[o]:a.push(o)}(I,o);const k=o[mo];null!==k&&k.insertView(i),o[Hn]|=64}(v,d,I,T);const k=cd(T,I),N=d[An],X=Io(N,I[Qo]);return null!==X&&function r_(i,o,a,d,v,T){d[Ci]=v,d[Qn]=o,Tl(i,d,a,1,v,T)}(v,I[Qn],N,d,X,k),o.attachToViewContainerRef(),r(py(I),T,o),o}move(o,a){return this.insert(o,a)}indexOf(o){const a=Fv(this._lContainer);return null!==a?a.indexOf(o):-1}remove(o){const a=this._adjustIndex(o,-1),d=xf(this._lContainer,a);d&&(l(py(this._lContainer),a),ao(d[Tt],d))}detach(o){const a=this._adjustIndex(o,-1),d=xf(this._lContainer,a);return d&&null!=l(py(this._lContainer),a)?new Xl(d):null}_adjustIndex(o,a=0){return o??this.length+a}};function Fv(i){return i[os]}function py(i){return i[os]||(i[os]=[])}function zv(i,o){let a;const d=o[i.index];if(vi(d))a=d;else{let v;if(8&i.type)v=Ln(d);else{const T=o[An];v=T.createComment("");const I=To(i,o);hc(T,Io(T,I),v,function Wp(i,o){return i.nextSibling(o)}(T,I),!1)}o[i.index]=a=ug(d,o,v,i),qu(o,a)}return new Ov(a,i,o)}class my{constructor(o){this.queryList=o,this.matches=null}clone(){return new my(this.queryList)}setDirty(){this.queryList.setDirty()}}class gy{constructor(o=[]){this.queries=o}createEmbeddedView(o){const a=o.queries;if(null!==a){const d=null!==o.contentQueries?o.contentQueries[0]:a.length,v=[];for(let T=0;T<d;T++){const I=a.getByIndex(T);v.push(this.queries[I.indexInDeclarationView].clone())}return new gy(v)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let a=0;a<this.queries.length;a++)null!==qv(o,a).matches&&this.queries[a].setDirty()}}class Nv{constructor(o,a,d=null){this.predicate=o,this.flags=a,this.read=d}}class _y{constructor(o=[]){this.queries=o}elementStart(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].elementStart(o,a)}elementEnd(o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(o)}embeddedTView(o){let a=null;for(let d=0;d<this.length;d++){const v=null!==a?a.length:0,T=this.getByIndex(d).embeddedTView(o,v);T&&(T.indexInDeclarationView=d,null!==a?a.push(T):a=[T])}return null!==a?new _y(a):null}template(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].template(o,a)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class yy{constructor(o,a=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(o,a){this.isApplyingToNode(a)&&this.matchTNode(o,a)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,a){this.elementStart(o,a)}embeddedTView(o,a){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,a),new yy(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const a=this._declarationNodeIndex;let d=o.parent;for(;null!==d&&8&d.type&&d.index!==a;)d=d.parent;return a===(null!==d?d.index:-1)}return this._appliesToNextNode}matchTNode(o,a){const d=this.metadata.predicate;if(Array.isArray(d))for(let v=0;v<d.length;v++){const T=d[v];this.matchTNodeWithReadOption(o,a,_1(a,T)),this.matchTNodeWithReadOption(o,a,io(a,o,T,!1,!1))}else d===Fp?4&a.type&&this.matchTNodeWithReadOption(o,a,-1):this.matchTNodeWithReadOption(o,a,io(a,o,d,!1,!1))}matchTNodeWithReadOption(o,a,d){if(null!==d){const v=this.metadata.read;if(null!==v)if(v===Ih||v===Hg||v===Fp&&4&a.type)this.addMatch(a.index,-2);else{const T=io(a,o,v,!1,!1);null!==T&&this.addMatch(a.index,T)}else this.addMatch(a.index,d)}}addMatch(o,a){null===this.matches?this.matches=[o,a]:this.matches.push(o,a)}}function _1(i,o){const a=i.localNames;if(null!==a)for(let d=0;d<a.length;d+=2)if(a[d]===o)return a[d+1];return null}function v1(i,o,a,d){return-1===a?function y1(i,o){return 11&i.type?pc(i,o):4&i.type?Gg(i,o):null}(o,i):-2===a?function x1(i,o,a){return a===Ih?pc(o,i):a===Fp?Gg(o,i):a===Hg?zv(o,i):void 0}(i,o,d):rl(i,i[Tt],a,o)}function Bv(i,o,a,d){const v=o[mo].queries[d];if(null===v.matches){const T=i.data,I=a.matches,k=[];for(let N=0;N<I.length;N+=2){const X=I[N];k.push(X<0?null:v1(o,T[X],I[N+1],a.metadata.read))}v.matches=k}return v.matches}function vy(i,o,a,d){const v=i.queries.getByIndex(a),T=v.matches;if(null!==T){const I=Bv(i,o,v,a);for(let k=0;k<T.length;k+=2){const N=T[k];if(N>0)d.push(I[k/2]);else{const X=T[k+1],se=o[-N];for(let xe=Dr;xe<se.length;xe++){const ze=se[xe];ze[Si]===ze[Pr]&&vy(ze[Tt],ze,X,d)}if(null!==se[jo]){const xe=se[jo];for(let ze=0;ze<xe.length;ze++){const Ye=xe[ze];vy(Ye[Tt],Ye,X,d)}}}}}return d}function Uv(i){const o=Rt(),a=dr(),d=gl();nl(d+1);const v=qv(a,d);if(i.dirty&&function tc(i){return 4==(4&i[Hn])}(o)===(2==(2&v.metadata.flags))){if(null===v.matches)i.reset([]);else{const T=v.crossesNgTemplate?vy(a,o,d,[]):Bv(a,o,v,d);i.reset(T,y_),i.notifyOnChanges()}return!0}return!1}function jv(i,o,a){const d=dr();d.firstCreatePass&&(Hv(d,new Nv(i,o,a),-1),2==(2&o)&&(d.staticViewQueries=!0)),Gv(d,Rt(),o)}function Vv(i,o,a,d){const v=dr();if(v.firstCreatePass){const T=zi();Hv(v,new Nv(o,a,d),T.index),function w1(i,o){const a=i.contentQueries||(i.contentQueries=[]);o!==(a.length?a[a.length-1]:-1)&&a.push(i.queries.length-1,o)}(v,i),2==(2&a)&&(v.staticContentQueries=!0)}Gv(v,Rt(),a)}function $v(){return function b1(i,o){return i[mo].queries[o].queryList}(Rt(),gl())}function Gv(i,o,a){const d=new fy(4==(4&a));Qf(i,o,d,d.destroy),null===o[mo]&&(o[mo]=new gy),o[mo].queries.push(new my(d))}function Hv(i,o,a){null===i.queries&&(i.queries=new _y),i.queries.track(new yy(o,a))}function qv(i,o){return i.queries.getByIndex(o)}function Wv(i,o){return Gg(i,o)}function xy(i){return!!Ut(i)}function Wg(...i){}const d0=new ni("Application Initializer");let Zg=(()=>{class i{constructor(a){this.appInits=a,this.resolve=Wg,this.reject=Wg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((d,v)=>{this.resolve=d,this.reject=v})}runInitializers(){if(this.initialized)return;const a=[],d=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let v=0;v<this.appInits.length;v++){const T=this.appInits[v]();if(Kl(T))a.push(T);else if(bc(T)){const I=new Promise((k,N)=>{T.subscribe({complete:k,error:N})});a.push(I)}}Promise.all(a).then(()=>{d()}).catch(v=>{this.reject(v)}),0===a.length&&d(),this.initialized=!0}}return i.\u0275fac=function(a){return new(a||i)(ie(d0,8))},i.\u0275prov=Yr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const f0=new ni("AppId",{providedIn:"root",factory:function p0(){return`${Dy()}${Dy()}${Dy()}`}});function Dy(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const m0=new ni("Platform Initializer"),V1=new ni("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),$1=new ni("AnimationModuleType");let G1=(()=>{class i{log(a){console.log(a)}warn(a){console.warn(a)}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Yr({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const Xg=new ni("LocaleId",{providedIn:"root",factory:()=>Y(Xg,vt.Optional|vt.SkipSelf)||function H1(){return typeof $localize<"u"&&$localize.locale||sf}()}),q1=new ni("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class W1{constructor(o,a){this.ngModuleFactory=o,this.componentFactories=a}}let Z1=(()=>{class i{compileModuleSync(a){return new cy(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){const d=this.compileModuleSync(a),T=gc(Ut(a).declarations).reduce((I,k)=>{const N=jn(k);return N&&I.push(new zh(N)),I},[]);return new W1(d,T)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Yr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const Y1=(()=>Promise.resolve(0))();function Cy(i){typeof Zone>"u"?Y1.then(()=>{i&&i.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",i)}class Ql{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:d=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Bc(!1),this.onMicrotaskEmpty=new Bc(!1),this.onStable=new Bc(!1),this.onError=new Bc(!1),typeof Zone>"u")throw new Dt(908,!1);Zone.assertZonePatched();const v=this;v._nesting=0,v._outer=v._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(v._inner=v._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(v._inner=v._inner.fork(Zone.longStackTraceZoneSpec)),v.shouldCoalesceEventChangeDetection=!d&&a,v.shouldCoalesceRunChangeDetection=d,v.lastRequestAnimationFrameId=-1,v.nativeRequestAnimationFrame=function J1(){let i=hr.requestAnimationFrame,o=hr.cancelAnimationFrame;if(typeof Zone<"u"&&i&&o){const a=i[Zone.__symbol__("OriginalDelegate")];a&&(i=a);const d=o[Zone.__symbol__("OriginalDelegate")];d&&(o=d)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function tb(i){const o=()=>{!function eb(i){i.isCheckStableRunning||-1!==i.lastRequestAnimationFrameId||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call(hr,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,My(i),i.isCheckStableRunning=!0,Sy(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),My(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,d,v,T,I,k)=>{try{return y0(i),a.invokeTask(v,T,I,k)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===T.type||i.shouldCoalesceRunChangeDetection)&&o(),v0(i)}},onInvoke:(a,d,v,T,I,k,N)=>{try{return y0(i),a.invoke(v,T,I,k,N)}finally{i.shouldCoalesceRunChangeDetection&&o(),v0(i)}},onHasTask:(a,d,v,T)=>{a.hasTask(v,T),d===v&&("microTask"==T.change?(i._hasPendingMicrotasks=T.microTask,My(i),Sy(i)):"macroTask"==T.change&&(i.hasPendingMacrotasks=T.macroTask))},onHandleError:(a,d,v,T)=>(a.handleError(v,T),i.runOutsideAngular(()=>i.onError.emit(T)),!1)})}(v)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ql.isInAngularZone())throw new Dt(909,!1)}static assertNotInAngularZone(){if(Ql.isInAngularZone())throw new Dt(909,!1)}run(o,a,d){return this._inner.run(o,a,d)}runTask(o,a,d,v){const T=this._inner,I=T.scheduleEventTask("NgZoneEvent: "+v,o,Q1,Wg,Wg);try{return T.runTask(I,a,d)}finally{T.cancelTask(I)}}runGuarded(o,a,d){return this._inner.runGuarded(o,a,d)}runOutsideAngular(o){return this._outer.run(o)}}const Q1={};function Sy(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function My(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&-1!==i.lastRequestAnimationFrameId)}function y0(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function v0(i){i._nesting--,Sy(i)}class nb{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Bc,this.onMicrotaskEmpty=new Bc,this.onStable=new Bc,this.onError=new Bc}run(o,a,d){return o.apply(a,d)}runGuarded(o,a,d){return o.apply(a,d)}runOutsideAngular(o){return o()}runTask(o,a,d,v){return o.apply(a,d)}}const x0=new ni(""),b0=new ni("");let Iy,rb=(()=>{class i{constructor(a,d,v){this._ngZone=a,this.registry=d,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Iy||(function ib(i){Iy=i}(v),v.addToWindow(d)),this._watchAngularEvents(),a.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ql.assertNotInAngularZone(),Cy(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Cy(()=>{for(;0!==this._callbacks.length;){let a=this._callbacks.pop();clearTimeout(a.timeoutId),a.doneCb(this._didWork)}this._didWork=!1});else{let a=this.getPendingTasks();this._callbacks=this._callbacks.filter(d=>!d.updateCb||!d.updateCb(a)||(clearTimeout(d.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(a=>({source:a.source,creationLocation:a.creationLocation,data:a.data})):[]}addCallback(a,d,v){let T=-1;d&&d>0&&(T=setTimeout(()=>{this._callbacks=this._callbacks.filter(I=>I.timeoutId!==T),a(this._didWork,this.getPendingTasks())},d)),this._callbacks.push({doneCb:a,timeoutId:T,updateCb:v})}whenStable(a,d,v){if(v&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(a,d,v),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(a){this.registry.registerApplication(a,this)}unregisterApplication(a){this.registry.unregisterApplication(a)}findProviders(a,d,v){return[]}}return i.\u0275fac=function(a){return new(a||i)(ie(Ql),ie(w0),ie(b0))},i.\u0275prov=Yr({token:i,factory:i.\u0275fac}),i})(),w0=(()=>{class i{constructor(){this._applications=new Map}registerApplication(a,d){this._applications.set(a,d)}unregisterApplication(a){this._applications.delete(a)}unregisterAllApplications(){this._applications.clear()}getTestability(a){return this._applications.get(a)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(a,d=!0){return Iy?.findTestabilityInTree(this,a,d)??null}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Yr({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const xu=!1;let ch=null;const E0=new ni("AllowMultipleToken"),Ay=new ni("PlatformDestroyListeners"),T0=new ni("appBootstrapListener");class ab{constructor(o,a){this.name=o,this.token=a}}function C0(i,o,a=[]){const d=`Platform: ${o}`,v=new ni(d);return(T=[])=>{let I=Py();if(!I||I.injector.get(E0,!1)){const k=[...a,...T,{provide:v,useValue:!0}];i?i(k):function lb(i){if(ch&&!ch.get(E0,!1))throw new Dt(400,!1);ch=i;const o=i.get(M0);(function D0(i){const o=i.get(m0,null);o&&o.forEach(a=>a())})(i)}(function S0(i=[],o){return ru.create({name:o,providers:[{provide:Uf,useValue:"platform"},{provide:Ay,useValue:new Set([()=>ch=null])},...i]})}(k,d))}return function ub(i){const o=Py();if(!o)throw new Dt(401,!1);return o}()}}function Py(){return ch?.get(M0)??null}let M0=(()=>{class i{constructor(a){this._injector=a,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(a,d){const v=function A0(i,o){let a;return a="noop"===i?new nb:("zone.js"===i?void 0:i)||new Ql(o),a}(d?.ngZone,function I0(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!i||!i.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!i||!i.ngZoneRunCoalescing)||!1}}(d)),T=[{provide:Ql,useValue:v}];return v.run(()=>{const I=ru.create({providers:T,parent:this.injector,name:a.moduleType.name}),k=a.create(I),N=k.injector.get(Ph,null);if(!N)throw new Dt(402,!1);return v.runOutsideAngular(()=>{const X=v.onError.subscribe({next:se=>{N.handleError(se)}});k.onDestroy(()=>{Yg(this._modules,k),X.unsubscribe()})}),function P0(i,o,a){try{const d=a();return Kl(d)?d.catch(v=>{throw o.runOutsideAngular(()=>i.handleError(v)),v}):d}catch(d){throw o.runOutsideAngular(()=>i.handleError(d)),d}}(N,v,()=>{const X=k.injector.get(Zg);return X.runInitializers(),X.donePromise.then(()=>(function Gy(i){vr(i,"Expected localeId to be defined"),"string"==typeof i&&($y=i.toLowerCase().replace(/_/g,"-"))}(k.injector.get(Xg,sf)||sf),this._moduleDoBootstrap(k),k))})})}bootstrapModule(a,d=[]){const v=R0({},d);return function ob(i,o,a){const d=new cy(a);return Promise.resolve(d)}(0,0,a).then(T=>this.bootstrapModuleFactory(T,v))}_moduleDoBootstrap(a){const d=a.injector.get(Kg);if(a._bootstrapComponents.length>0)a._bootstrapComponents.forEach(v=>d.bootstrap(v));else{if(!a.instance.ngDoBootstrap)throw new Dt(-403,!1);a.instance.ngDoBootstrap(d)}this._modules.push(a)}onDestroy(a){this._destroyListeners.push(a)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Dt(404,!1);this._modules.slice().forEach(d=>d.destroy()),this._destroyListeners.forEach(d=>d());const a=this._injector.get(Ay,null);a&&(a.forEach(d=>d()),a.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return i.\u0275fac=function(a){return new(a||i)(ie(ru))},i.\u0275prov=Yr({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();function R0(i,o){return Array.isArray(o)?o.reduce(R0,i):{...i,...o}}let Kg=(()=>{class i{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(a,d,v){this._zone=a,this._injector=d,this._exceptionHandler=v,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const T=new $e.y(k=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{k.next(this._stable),k.complete()})}),I=new $e.y(k=>{let N;this._zone.runOutsideAngular(()=>{N=this._zone.onStable.subscribe(()=>{Ql.assertNotInAngularZone(),Cy(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,k.next(!0))})})});const X=this._zone.onUnstable.subscribe(()=>{Ql.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{k.next(!1)}))});return()=>{N.unsubscribe(),X.unsubscribe()}});this.isStable=function pt(...i){const o=(0,Vt.yG)(i),a=(0,Vt._6)(i,1/0),d=i;return d.length?1===d.length?(0,Pe.Xf)(d[0]):(0,c.J)(a)((0,zt.D)(d,o)):Jt.E}(T,I.pipe(function $t(i={}){const{connector:o=(()=>new W.x),resetOnError:a=!0,resetOnComplete:d=!0,resetOnRefCountZero:v=!0}=i;return T=>{let I,k,N,X=0,se=!1,xe=!1;const ze=()=>{k?.unsubscribe(),k=void 0},Ye=()=>{ze(),I=N=void 0,se=xe=!1},wt=()=>{const Xt=I;Ye(),Xt?.unsubscribe()};return(0,ct.e)((Xt,pn)=>{X++,!xe&&!se&&ze();const Cn=N=N??o();pn.add(()=>{X--,0===X&&!xe&&!se&&(k=Kt(wt,v))}),Cn.subscribe(pn),!I&&X>0&&(I=new yt.Hp({next:qn=>Cn.next(qn),error:qn=>{xe=!0,ze(),k=Kt(Ye,a,qn),Cn.error(qn)},complete:()=>{se=!0,ze(),k=Kt(Ye,d),Cn.complete()}}),(0,Pe.Xf)(Xt).subscribe(I))})(T)}}()))}bootstrap(a,d){const v=a instanceof Vf;if(!this._injector.get(Zg).done){!v&&mi(a);throw new Dt(405,xu)}let I;I=v?a:this._injector.get(nu).resolveComponentFactory(a),this.componentTypes.push(I.componentType);const k=function sb(i){return i.isBoundToModule}(I)?void 0:this._injector.get(af),X=I.create(ru.NULL,[],d||I.selector,k),se=X.location.nativeElement,xe=X.injector.get(x0,null);return xe?.registerApplication(se),X.onDestroy(()=>{this.detachView(X.hostView),Yg(this.components,X),xe?.unregisterApplication(se)}),this._loadComponent(X),X}tick(){if(this._runningTick)throw new Dt(101,!1);try{this._runningTick=!0;for(let a of this._views)a.detectChanges()}catch(a){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(a))}finally{this._runningTick=!1}}attachView(a){const d=a;this._views.push(d),d.attachToAppRef(this)}detachView(a){const d=a;Yg(this._views,d),d.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a);const d=this._injector.get(T0,[]);d.push(...this._bootstrapListeners),d.forEach(v=>v(a))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(a=>a()),this._views.slice().forEach(a=>a.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(a){return this._destroyListeners.push(a),()=>Yg(this._destroyListeners,a)}destroy(){if(this._destroyed)throw new Dt(406,!1);const a=this._injector;a.destroy&&!a.destroyed&&a.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return i.\u0275fac=function(a){return new(a||i)(ie(Ql),ie(_i),ie(Ph))},i.\u0275prov=Yr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Yg(i,o){const a=i.indexOf(o);a>-1&&i.splice(a,1)}let db=(()=>{class i{}return i.__NG_ELEMENT_ID__=fb,i})();function fb(i){return function pb(i,o,a){if(as(i)&&!a){const d=xi(i.index,o);return new Xl(d,d)}return 47&i.type?new Xl(o[di],o):null}(zi(),Rt(),16==(16&i))}class z0{constructor(){}supports(o){return $d(o)}create(o){return new xb(o)}}const vb=(i,o)=>o;class xb{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||vb}forEachItem(o){let a;for(a=this._itHead;null!==a;a=a._next)o(a)}forEachOperation(o){let a=this._itHead,d=this._removalsHead,v=0,T=null;for(;a||d;){const I=!d||a&&a.currentIndex<B0(d,v,T)?a:d,k=B0(I,v,T),N=I.currentIndex;if(I===d)v--,d=d._nextRemoved;else if(a=a._next,null==I.previousIndex)v++;else{T||(T=[]);const X=k-v,se=N-v;if(X!=se){for(let ze=0;ze<X;ze++){const Ye=ze<T.length?T[ze]:T[ze]=0,wt=Ye+ze;se<=wt&&wt<X&&(T[ze]=Ye+1)}T[I.previousIndex]=se-X}}k!==N&&o(I,k,N)}}forEachPreviousItem(o){let a;for(a=this._previousItHead;null!==a;a=a._nextPrevious)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachMovedItem(o){let a;for(a=this._movesHead;null!==a;a=a._nextMoved)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}forEachIdentityChange(o){let a;for(a=this._identityChangesHead;null!==a;a=a._nextIdentityChange)o(a)}diff(o){if(null==o&&(o=[]),!$d(o))throw new Dt(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let v,T,I,a=this._itHead,d=!1;if(Array.isArray(o)){this.length=o.length;for(let k=0;k<this.length;k++)T=o[k],I=this._trackByFn(k,T),null!==a&&Object.is(a.trackById,I)?(d&&(a=this._verifyReinsertion(a,T,I,k)),Object.is(a.item,T)||this._addIdentityChange(a,T)):(a=this._mismatch(a,T,I,k),d=!0),a=a._next}else v=0,function Uh(i,o){if(Array.isArray(i))for(let a=0;a<i.length;a++)o(i[a]);else{const a=i[Symbol.iterator]();let d;for(;!(d=a.next()).done;)o(d.value)}}(o,k=>{I=this._trackByFn(v,k),null!==a&&Object.is(a.trackById,I)?(d&&(a=this._verifyReinsertion(a,k,I,v)),Object.is(a.item,k)||this._addIdentityChange(a,k)):(a=this._mismatch(a,k,I,v),d=!0),a=a._next,v++}),this.length=v;return this._truncate(a),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,a,d,v){let T;return null===o?T=this._itTail:(T=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._reinsertAfter(o,T,v)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(d,v))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._moveAfter(o,T,v)):o=this._addAfter(new bb(a,d),T,v),o}_verifyReinsertion(o,a,d,v){let T=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null);return null!==T?o=this._reinsertAfter(T,o._prev,v):o.currentIndex!=v&&(o.currentIndex=v,this._addToMoves(o,v)),o}_truncate(o){for(;null!==o;){const a=o._next;this._addToRemovals(this._unlink(o)),o=a}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,a,d){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const v=o._prevRemoved,T=o._nextRemoved;return null===v?this._removalsHead=T:v._nextRemoved=T,null===T?this._removalsTail=v:T._prevRemoved=v,this._insertAfter(o,a,d),this._addToMoves(o,d),o}_moveAfter(o,a,d){return this._unlink(o),this._insertAfter(o,a,d),this._addToMoves(o,d),o}_addAfter(o,a,d){return this._insertAfter(o,a,d),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,a,d){const v=null===a?this._itHead:a._next;return o._next=v,o._prev=a,null===v?this._itTail=o:v._prev=o,null===a?this._itHead=o:a._next=o,null===this._linkedRecords&&(this._linkedRecords=new N0),this._linkedRecords.put(o),o.currentIndex=d,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const a=o._prev,d=o._next;return null===a?this._itHead=d:a._next=d,null===d?this._itTail=a:d._prev=a,o}_addToMoves(o,a){return o.previousIndex===a||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new N0),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,a){return o.item=a,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class bb{constructor(o,a){this.item=o,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class wb{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,a){let d;for(d=this._head;null!==d;d=d._nextDup)if((null===a||a<=d.currentIndex)&&Object.is(d.trackById,o))return d;return null}remove(o){const a=o._prevDup,d=o._nextDup;return null===a?this._head=d:a._nextDup=d,null===d?this._tail=a:d._prevDup=a,null===this._head}}class N0{constructor(){this.map=new Map}put(o){const a=o.trackById;let d=this.map.get(a);d||(d=new wb,this.map.set(a,d)),d.add(o)}get(o,a){const v=this.map.get(o);return v?v.get(o,a):null}remove(o){const a=o.trackById;return this.map.get(a).remove(o)&&this.map.delete(a),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function B0(i,o,a){const d=i.previousIndex;if(null===d)return d;let v=0;return a&&d<a.length&&(v=a[d]),d+o+v}class U0{constructor(){}supports(o){return o instanceof Map||hu(o)}create(){return new Eb}}class Eb{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let a;for(a=this._mapHead;null!==a;a=a._next)o(a)}forEachPreviousItem(o){let a;for(a=this._previousMapHead;null!==a;a=a._nextPrevious)o(a)}forEachChangedItem(o){let a;for(a=this._changesHead;null!==a;a=a._nextChanged)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}diff(o){if(o){if(!(o instanceof Map||hu(o)))throw new Dt(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let a=this._mapHead;if(this._appendAfter=null,this._forEach(o,(d,v)=>{if(a&&a.key===v)this._maybeAddToChanges(a,d),this._appendAfter=a,a=a._next;else{const T=this._getOrCreateRecordForKey(v,d);a=this._insertBeforeOrAppend(a,T)}}),a){a._prev&&(a._prev._next=null),this._removalsHead=a;for(let d=a;null!==d;d=d._nextRemoved)d===this._mapHead&&(this._mapHead=null),this._records.delete(d.key),d._nextRemoved=d._next,d.previousValue=d.currentValue,d.currentValue=null,d._prev=null,d._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,a){if(o){const d=o._prev;return a._next=o,a._prev=d,o._prev=a,d&&(d._next=a),o===this._mapHead&&(this._mapHead=a),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=a,a._prev=this._appendAfter):this._mapHead=a,this._appendAfter=a,null}_getOrCreateRecordForKey(o,a){if(this._records.has(o)){const v=this._records.get(o);this._maybeAddToChanges(v,a);const T=v._prev,I=v._next;return T&&(T._next=I),I&&(I._prev=T),v._next=null,v._prev=null,v}const d=new Tb(o);return this._records.set(o,d),d.currentValue=a,this._addToAdditions(d),d}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,a){Object.is(a,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=a,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,a){o instanceof Map?o.forEach(a):Object.keys(o).forEach(d=>a(o[d],d))}}class Tb{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function j0(){return new Fy([new z0])}let Fy=(()=>{class i{constructor(a){this.factories=a}static create(a,d){if(null!=d){const v=d.factories.slice();a=a.concat(v)}return new i(a)}static extend(a){return{provide:i,useFactory:d=>i.create(a,d||j0()),deps:[[i,new Ze,new Ce]]}}find(a){const d=this.factories.find(v=>v.supports(a));if(null!=d)return d;throw new Dt(901,!1)}}return i.\u0275prov=Yr({token:i,providedIn:"root",factory:j0}),i})();function V0(){return new zy([new U0])}let zy=(()=>{class i{constructor(a){this.factories=a}static create(a,d){if(d){const v=d.factories.slice();a=a.concat(v)}return new i(a)}static extend(a){return{provide:i,useFactory:d=>i.create(a,d||V0()),deps:[[i,new Ze,new Ce]]}}find(a){const d=this.factories.find(v=>v.supports(a));if(d)return d;throw new Dt(901,!1)}}return i.\u0275prov=Yr({token:i,providedIn:"root",factory:V0}),i})();const Sb=C0(null,"core",[]);let Mb=(()=>{class i{constructor(a){}}return i.\u0275fac=function(a){return new(a||i)(ie(Kg))},i.\u0275mod=it({type:i}),i.\u0275inj=uo({}),i})();function Ib(i){return"boolean"==typeof i?i:null!=i&&"false"!==i}},1481:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{Dx:()=>Er,b2:()=>Hi,q6:()=>uo,se:()=>hn});var W=Ee(6895),me=Ee(8256);class $e extends W.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class c extends $e{static makeCurrent(){(0,W.HT)(new c)}onAndCancel(ne,q,ae){return ne.addEventListener(q,ae,!1),()=>{ne.removeEventListener(q,ae,!1)}}dispatchEvent(ne,q){ne.dispatchEvent(q)}remove(ne){ne.parentNode&&ne.parentNode.removeChild(ne)}createElement(ne,q){return(q=q||this.getDefaultDocument()).createElement(ne)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(ne){return ne.nodeType===Node.ELEMENT_NODE}isShadowRoot(ne){return ne instanceof DocumentFragment}getGlobalEventTarget(ne,q){return"window"===q?window:"document"===q?ne:"body"===q?ne.body:null}getBaseHref(ne){const q=function Jt(){return Pe=Pe||document.querySelector("base"),Pe?Pe.getAttribute("href"):null}();return null==q?null:function zt(ue){Vt=Vt||document.createElement("a"),Vt.setAttribute("href",ue);const ne=Vt.pathname;return"/"===ne.charAt(0)?ne:`/${ne}`}(q)}resetBaseElement(){Pe=null}getUserAgent(){return window.navigator.userAgent}getCookie(ne){return(0,W.Mx)(document.cookie,ne)}}let Vt,Pe=null;const pt=new me.OlP("TRANSITION_ID"),ct=[{provide:me.ip1,useFactory:function yt(ue,ne,q){return()=>{q.get(me.CZH).donePromise.then(()=>{const ae=(0,W.q)(),De=ne.querySelectorAll(`style[ng-transition="${ue}"]`);for(let We=0;We<De.length;We++)ae.remove(De[We])})}},deps:[pt,W.K0,me.zs3],multi:!0}];let Kt=(()=>{class ue{build(){return new XMLHttpRequest}}return ue.\u0275fac=function(q){return new(q||ue)},ue.\u0275prov=me.Yz7({token:ue,factory:ue.\u0275fac}),ue})();const ut=new me.OlP("EventManagerPlugins");let Bt=(()=>{class ue{constructor(q,ae){this._zone=ae,this._eventNameToPlugin=new Map,q.forEach(De=>{De.manager=this}),this._plugins=q.slice().reverse()}addEventListener(q,ae,De){return this._findPluginFor(ae).addEventListener(q,ae,De)}addGlobalEventListener(q,ae,De){return this._findPluginFor(ae).addGlobalEventListener(q,ae,De)}getZone(){return this._zone}_findPluginFor(q){const ae=this._eventNameToPlugin.get(q);if(ae)return ae;const De=this._plugins;for(let We=0;We<De.length;We++){const Ue=De[We];if(Ue.supports(q))return this._eventNameToPlugin.set(q,Ue),Ue}throw new Error(`No event manager plugin found for event ${q}`)}}return ue.\u0275fac=function(q){return new(q||ue)(me.LFG(ut),me.LFG(me.R0b))},ue.\u0275prov=me.Yz7({token:ue,factory:ue.\u0275fac}),ue})();class cn{constructor(ne){this._doc=ne}addGlobalEventListener(ne,q,ae){const De=(0,W.q)().getGlobalEventTarget(this._doc,ne);if(!De)throw new Error(`Unsupported event target ${De} for event ${q}`);return this.addEventListener(De,q,ae)}}let Wn=(()=>{class ue{constructor(){this.usageCount=new Map}addStyles(q){for(const ae of q)1===this.changeUsageCount(ae,1)&&this.onStyleAdded(ae)}removeStyles(q){for(const ae of q)0===this.changeUsageCount(ae,-1)&&this.onStyleRemoved(ae)}onStyleRemoved(q){}onStyleAdded(q){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(q,ae){const De=this.usageCount;let We=De.get(q)??0;return We+=ae,We>0?De.set(q,We):De.delete(q),We}ngOnDestroy(){for(const q of this.getAllStyles())this.onStyleRemoved(q);this.usageCount.clear()}}return ue.\u0275fac=function(q){return new(q||ue)},ue.\u0275prov=me.Yz7({token:ue,factory:ue.\u0275fac}),ue})(),st=(()=>{class ue extends Wn{constructor(q){super(),this.doc=q,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(q){for(const ae of this.hostNodes)this.addStyleToHost(ae,q)}onStyleRemoved(q){const ae=this.styleRef;ae.get(q)?.forEach(We=>We.remove()),ae.delete(q)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(q){this.hostNodes.add(q);for(const ae of this.getAllStyles())this.addStyleToHost(q,ae)}removeHost(q){this.hostNodes.delete(q)}addStyleToHost(q,ae){const De=this.doc.createElement("style");De.textContent=ae,q.appendChild(De);const We=this.styleRef.get(ae);We?We.push(De):this.styleRef.set(ae,[De])}resetHostNodes(){const q=this.hostNodes;q.clear(),q.add(this.doc.head)}}return ue.\u0275fac=function(q){return new(q||ue)(me.LFG(W.K0))},ue.\u0275prov=me.Yz7({token:ue,factory:ue.\u0275fac}),ue})();const tr={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},en=/%COMP%/g,Yt=new me.OlP("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function dn(ue,ne){return ne.flat(100).map(q=>q.replace(en,ue))}function Kn(ue){return ne=>{if("__ngUnwrap__"===ne)return ue;!1===ue(ne)&&(ne.preventDefault(),ne.returnValue=!1)}}let hn=(()=>{class ue{constructor(q,ae,De,We){this.eventManager=q,this.sharedStylesHost=ae,this.appId=De,this.removeStylesOnCompDestory=We,this.rendererByCompId=new Map,this.defaultRenderer=new Br(q)}createRenderer(q,ae){if(!q||!ae)return this.defaultRenderer;const De=this.getOrCreateRenderer(q,ae);return De instanceof kt?De.applyToHost(q):De instanceof Ft&&De.applyStyles(),De}getOrCreateRenderer(q,ae){const De=this.rendererByCompId;let We=De.get(ae.id);if(!We){const Ue=this.eventManager,bt=this.sharedStylesHost,Wt=this.removeStylesOnCompDestory;switch(ae.encapsulation){case me.ifc.Emulated:We=new kt(Ue,bt,ae,this.appId,Wt);break;case me.ifc.ShadowDom:return new Pt(Ue,bt,q,ae);default:We=new Ft(Ue,bt,ae,Wt)}We.onDestroy=()=>De.delete(ae.id),De.set(ae.id,We)}return We}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return ue.\u0275fac=function(q){return new(q||ue)(me.LFG(Bt),me.LFG(st),me.LFG(me.AFp),me.LFG(Yt))},ue.\u0275prov=me.Yz7({token:ue,factory:ue.\u0275fac}),ue})();class Br{constructor(ne){this.eventManager=ne,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(ne,q){return q?document.createElementNS(tr[q]||q,ne):document.createElement(ne)}createComment(ne){return document.createComment(ne)}createText(ne){return document.createTextNode(ne)}appendChild(ne,q){(xt(ne)?ne.content:ne).appendChild(q)}insertBefore(ne,q,ae){ne&&(xt(ne)?ne.content:ne).insertBefore(q,ae)}removeChild(ne,q){ne&&ne.removeChild(q)}selectRootElement(ne,q){let ae="string"==typeof ne?document.querySelector(ne):ne;if(!ae)throw new Error(`The selector "${ne}" did not match any elements`);return q||(ae.textContent=""),ae}parentNode(ne){return ne.parentNode}nextSibling(ne){return ne.nextSibling}setAttribute(ne,q,ae,De){if(De){q=De+":"+q;const We=tr[De];We?ne.setAttributeNS(We,q,ae):ne.setAttribute(q,ae)}else ne.setAttribute(q,ae)}removeAttribute(ne,q,ae){if(ae){const De=tr[ae];De?ne.removeAttributeNS(De,q):ne.removeAttribute(`${ae}:${q}`)}else ne.removeAttribute(q)}addClass(ne,q){ne.classList.add(q)}removeClass(ne,q){ne.classList.remove(q)}setStyle(ne,q,ae,De){De&(me.JOm.DashCase|me.JOm.Important)?ne.style.setProperty(q,ae,De&me.JOm.Important?"important":""):ne.style[q]=ae}removeStyle(ne,q,ae){ae&me.JOm.DashCase?ne.style.removeProperty(q):ne.style[q]=""}setProperty(ne,q,ae){ne[q]=ae}setValue(ne,q){ne.nodeValue=q}listen(ne,q,ae){return"string"==typeof ne?this.eventManager.addGlobalEventListener(ne,q,Kn(ae)):this.eventManager.addEventListener(ne,q,Kn(ae))}}function xt(ue){return"TEMPLATE"===ue.tagName&&void 0!==ue.content}class Pt extends Br{constructor(ne,q,ae,De){super(ne),this.sharedStylesHost=q,this.hostEl=ae,this.shadowRoot=ae.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const We=dn(De.id,De.styles);for(const Ue of We){const bt=document.createElement("style");bt.textContent=Ue,this.shadowRoot.appendChild(bt)}}nodeOrShadowRoot(ne){return ne===this.hostEl?this.shadowRoot:ne}appendChild(ne,q){return super.appendChild(this.nodeOrShadowRoot(ne),q)}insertBefore(ne,q,ae){return super.insertBefore(this.nodeOrShadowRoot(ne),q,ae)}removeChild(ne,q){return super.removeChild(this.nodeOrShadowRoot(ne),q)}parentNode(ne){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(ne)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Ft extends Br{constructor(ne,q,ae,De,We=ae.id){super(ne),this.sharedStylesHost=q,this.removeStylesOnCompDestory=De,this.rendererUsageCount=0,this.styles=dn(We,ae.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class kt extends Ft{constructor(ne,q,ae,De,We){const Ue=De+"-"+ae.id;super(ne,q,ae,We,Ue),this.contentAttr=function _t(ue){return"_ngcontent-%COMP%".replace(en,ue)}(Ue),this.hostAttr=function gt(ue){return"_nghost-%COMP%".replace(en,ue)}(Ue)}applyToHost(ne){this.applyStyles(),this.setAttribute(ne,this.hostAttr,"")}createElement(ne,q){const ae=super.createElement(ne,q);return super.setAttribute(ae,this.contentAttr,""),ae}}let Mn=(()=>{class ue extends cn{constructor(q){super(q)}supports(q){return!0}addEventListener(q,ae,De){return q.addEventListener(ae,De,!1),()=>this.removeEventListener(q,ae,De)}removeEventListener(q,ae,De){return q.removeEventListener(ae,De)}}return ue.\u0275fac=function(q){return new(q||ue)(me.LFG(W.K0))},ue.\u0275prov=me.Yz7({token:ue,factory:ue.\u0275fac}),ue})();const Bn=["alt","control","meta","shift"],Ur={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},En={alt:ue=>ue.altKey,control:ue=>ue.ctrlKey,meta:ue=>ue.metaKey,shift:ue=>ue.shiftKey};let Rn=(()=>{class ue extends cn{constructor(q){super(q)}supports(q){return null!=ue.parseEventName(q)}addEventListener(q,ae,De){const We=ue.parseEventName(ae),Ue=ue.eventCallback(We.fullKey,De,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,W.q)().onAndCancel(q,We.domEventName,Ue))}static parseEventName(q){const ae=q.toLowerCase().split("."),De=ae.shift();if(0===ae.length||"keydown"!==De&&"keyup"!==De)return null;const We=ue._normalizeKey(ae.pop());let Ue="",bt=ae.indexOf("code");if(bt>-1&&(ae.splice(bt,1),Ue="code."),Bn.forEach(on=>{const vn=ae.indexOf(on);vn>-1&&(ae.splice(vn,1),Ue+=on+".")}),Ue+=We,0!=ae.length||0===We.length)return null;const Wt={};return Wt.domEventName=De,Wt.fullKey=Ue,Wt}static matchEventFullKeyCode(q,ae){let De=Ur[q.key]||q.key,We="";return ae.indexOf("code.")>-1&&(De=q.code,We="code."),!(null==De||!De)&&(De=De.toLowerCase()," "===De?De="space":"."===De&&(De="dot"),Bn.forEach(Ue=>{Ue!==De&&(0,En[Ue])(q)&&(We+=Ue+".")}),We+=De,We===ae)}static eventCallback(q,ae,De){return We=>{ue.matchEventFullKeyCode(We,q)&&De.runGuarded(()=>ae(We))}}static _normalizeKey(q){return"esc"===q?"escape":q}}return ue.\u0275fac=function(q){return new(q||ue)(me.LFG(W.K0))},ue.\u0275prov=me.Yz7({token:ue,factory:ue.\u0275fac}),ue})();const uo=(0,me.eFA)(me._c5,"browser",[{provide:me.Lbi,useValue:W.bD},{provide:me.g9A,useValue:function Ai(){c.makeCurrent()},multi:!0},{provide:W.K0,useFactory:function Yr(){return(0,me.RDi)(document),document},deps:[]}]),xn=new me.OlP(""),Lr=[{provide:me.rWj,useClass:class $t{addToWindow(ne){me.dqk.getAngularTestability=(ae,De=!0)=>{const We=ne.findTestabilityInTree(ae,De);if(null==We)throw new Error("Could not find testability for element.");return We},me.dqk.getAllAngularTestabilities=()=>ne.getAllTestabilities(),me.dqk.getAllAngularRootElements=()=>ne.getAllRootElements(),me.dqk.frameworkStabilizers||(me.dqk.frameworkStabilizers=[]),me.dqk.frameworkStabilizers.push(ae=>{const De=me.dqk.getAllAngularTestabilities();let We=De.length,Ue=!1;const bt=function(Wt){Ue=Ue||Wt,We--,0==We&&ae(Ue)};De.forEach(function(Wt){Wt.whenStable(bt)})})}findTestabilityInTree(ne,q,ae){return null==q?null:ne.getTestability(q)??(ae?(0,W.q)().isShadowRoot(q)?this.findTestabilityInTree(ne,q.host,!0):this.findTestabilityInTree(ne,q.parentElement,!0):null)}},deps:[]},{provide:me.lri,useClass:me.dDg,deps:[me.R0b,me.eoX,me.rWj]},{provide:me.dDg,useClass:me.dDg,deps:[me.R0b,me.eoX,me.rWj]}],ho=[{provide:me.zSh,useValue:"root"},{provide:me.qLn,useFactory:function Ti(){return new me.qLn},deps:[]},{provide:ut,useClass:Mn,multi:!0,deps:[W.K0,me.R0b,me.Lbi]},{provide:ut,useClass:Rn,multi:!0,deps:[W.K0]},{provide:hn,useClass:hn,deps:[Bt,st,me.AFp,Yt]},{provide:me.FYo,useExisting:hn},{provide:Wn,useExisting:st},{provide:st,useClass:st,deps:[W.K0]},{provide:Bt,useClass:Bt,deps:[ut,me.R0b]},{provide:W.JF,useClass:Kt,deps:[]},[]];let Hi=(()=>{class ue{constructor(q){}static withServerTransition(q){return{ngModule:ue,providers:[{provide:me.AFp,useValue:q.appId},{provide:pt,useExisting:me.AFp},ct]}}}return ue.\u0275fac=function(q){return new(q||ue)(me.LFG(xn,12))},ue.\u0275mod=me.oAB({type:ue}),ue.\u0275inj=me.cJS({providers:[...ho,...Lr],imports:[W.ez,me.hGG]}),ue})(),Er=(()=>{class ue{constructor(q){this._doc=q}getTitle(){return this._doc.title}setTitle(q){this._doc.title=q||""}}return ue.\u0275fac=function(q){return new(q||ue)(me.LFG(W.K0))},ue.\u0275prov=me.Yz7({token:ue,factory:function(q){let ae=null;return ae=q?new q:function No(){return new Er((0,me.LFG)(W.K0))}(),ae},providedIn:"root"}),ue})();typeof window<"u"&&window},6771:(er,Ht,Ee)=>{"use strict";Ee.d(Ht,{gz:()=>ts,rH:()=>Vl,Od:()=>jc,Bz:()=>$l,lC:()=>Hs});var W=Ee(8256),me=Ee(2076),$e=Ee(9646),c=Ee(7579);class Pe extends c.x{constructor(_){super(),this._value=_}get value(){return this.getValue()}_subscribe(_){const g=super._subscribe(_);return!g.closed&&_.next(this._value),g}getValue(){const{hasError:_,thrownError:g,_value:w}=this;if(_)throw g;return this._throwIfClosed(),w}next(_){super.next(this._value=_)}}const Vt=(0,Ee(3888).d)(p=>function(){p(this),this.name="EmptyError",this.message="no elements in sequence"});var zt=Ee(9751),pt=Ee(4742),yt=Ee(4671),ct=Ee(3268),$t=Ee(7669),Kt=Ee(1810),ut=Ee(5403),Bt=Ee(9672);function cn(...p){const _=(0,$t.yG)(p),g=(0,$t.jO)(p),{args:w,keys:D}=(0,pt.D)(p);if(0===w.length)return(0,me.D)([],_);const A=new zt.y(function Wn(p,_,g=yt.y){return w=>{st(_,()=>{const{length:D}=p,A=new Array(D);let O=D,G=D;for(let K=0;K<D;K++)st(_,()=>{const re=(0,me.D)(p[K],_);let Q=!1;re.subscribe((0,ut.x)(w,oe=>{A[K]=oe,Q||(Q=!0,G--),G||w.next(g(A.slice()))},()=>{--O||w.complete()}))},w)},w)}}(w,_,D?O=>(0,Kt.n)(D,O):yt.y));return g?A.pipe((0,ct.Z)(g)):A}function st(p,_,g){p?(0,Bt.f)(g,p,_):_()}var tr=Ee(8189);function rn(...p){return function en(){return(0,tr.J)(1)}()((0,me.D)(p,(0,$t.yG)(p)))}var ht=Ee(8421);function un(p){return new zt.y(_=>{(0,ht.Xf)(p()).subscribe(_)})}var ur=Ee(9635),Dt=Ee(576);function Yt(p,_){const g=(0,Dt.m)(p)?p:()=>p,w=D=>D.error(g());return new zt.y(_?D=>_.schedule(w,0,D):w)}var _t=Ee(515),gt=Ee(727),dn=Ee(4482);function Kn(){return(0,dn.e)((p,_)=>{let g=null;p._refCount++;const w=(0,ut.x)(_,void 0,void 0,void 0,()=>{if(!p||p._refCount<=0||0<--p._refCount)return void(g=null);const D=p._connection,A=g;g=null,D&&(!A||D===A)&&D.unsubscribe(),_.unsubscribe()});p.subscribe(w),w.closed||(g=p.connect())})}class hn extends zt.y{constructor(_,g){super(),this.source=_,this.subjectFactory=g,this._subject=null,this._refCount=0,this._connection=null,(0,dn.A)(_)&&(this.lift=_.lift)}_subscribe(_){return this.getSubject().subscribe(_)}getSubject(){const _=this._subject;return(!_||_.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:_}=this;this._subject=this._connection=null,_?.unsubscribe()}connect(){let _=this._connection;if(!_){_=this._connection=new gt.w0;const g=this.getSubject();_.add(this.source.subscribe((0,ut.x)(g,void 0,()=>{this._teardown(),g.complete()},w=>{this._teardown(),g.error(w)},()=>this._teardown()))),_.closed&&(this._connection=null,_=gt.w0.EMPTY)}return _}refCount(){return Kn()(this)}}var Br=Ee(6895),Ne=Ee(4004),ot=Ee(3900);function xt(p){return p<=0?()=>_t.E:(0,dn.e)((_,g)=>{let w=0;_.subscribe((0,ut.x)(g,D=>{++w<=p&&(g.next(D),p<=w&&g.complete())}))})}var Ft=Ee(9300),kt=Ee(5577);function Mn(p){return(0,dn.e)((_,g)=>{let w=!1;_.subscribe((0,ut.x)(g,D=>{w=!0,g.next(D)},()=>{w||g.next(p),g.complete()}))})}function Bn(p=Ur){return(0,dn.e)((_,g)=>{let w=!1;_.subscribe((0,ut.x)(g,D=>{w=!0,g.next(D)},()=>w?g.complete():g.error(p())))})}function Ur(){return new Vt}function En(p,_){const g=arguments.length>=2;return w=>w.pipe(p?(0,Ft.h)((D,A)=>p(D,A,w)):yt.y,xt(1),g?Mn(_):Bn(()=>new Vt))}var Rn=Ee(4351),Yn=Ee(8505);function Un(p){return(0,dn.e)((_,g)=>{let A,w=null,D=!1;w=_.subscribe((0,ut.x)(g,void 0,void 0,O=>{A=(0,ht.Xf)(p(O,Un(p)(_))),w?(w.unsubscribe(),w=null,A.subscribe(g)):D=!0})),D&&(w.unsubscribe(),w=null,A.subscribe(g))})}function tn(p,_){return(0,dn.e)(function vr(p,_,g,w,D){return(A,O)=>{let G=g,K=_,re=0;A.subscribe((0,ut.x)(O,Q=>{const oe=re++;K=G?p(K,Q,oe):(G=!0,Q),w&&O.next(K)},D&&(()=>{G&&O.next(K),O.complete()})))}}(p,_,arguments.length>=2,!0))}function Kr(p){return p<=0?()=>_t.E:(0,dn.e)((_,g)=>{let w=[];_.subscribe((0,ut.x)(g,D=>{w.push(D),p<w.length&&w.shift()},()=>{for(const D of w)g.next(D);g.complete()},void 0,()=>{w=null}))})}function Ai(p,_){const g=arguments.length>=2;return w=>w.pipe(p?(0,Ft.h)((D,A)=>p(D,A,w)):yt.y,Kr(1),g?Mn(_):Bn(()=>new Vt))}function zo(p){return(0,dn.e)((_,g)=>{try{_.subscribe(g)}finally{g.add(p)}})}var uo=Ee(1481);const xn="primary",Lr=Symbol("RouteTitle");class ho{constructor(_){this.params=_||{}}has(_){return Object.prototype.hasOwnProperty.call(this.params,_)}get(_){if(this.has(_)){const g=this.params[_];return Array.isArray(g)?g[0]:g}return null}getAll(_){if(this.has(_)){const g=this.params[_];return Array.isArray(g)?g:[g]}return[]}get keys(){return Object.keys(this.params)}}function Hi(p){return new ho(p)}function vs(p,_,g){const w=g.path.split("/");if(w.length>p.length||"full"===g.pathMatch&&(_.hasChildren()||w.length<p.length))return null;const D={};for(let A=0;A<w.length;A++){const O=w[A],G=p[A];if(O.startsWith(":"))D[O.substring(1)]=G;else if(O!==G.path)return null}return{consumed:p.slice(0,w.length),posParams:D}}function Or(p,_){const g=p?Object.keys(p):void 0,w=_?Object.keys(_):void 0;if(!g||!w||g.length!=w.length)return!1;let D;for(let A=0;A<g.length;A++)if(D=g[A],!No(p[D],_[D]))return!1;return!0}function No(p,_){if(Array.isArray(p)&&Array.isArray(_)){if(p.length!==_.length)return!1;const g=[...p].sort(),w=[..._].sort();return g.every((D,A)=>w[A]===D)}return p===_}function Er(p){return Array.prototype.concat.apply([],p)}function vt(p){return p.length>0?p[p.length-1]:null}function br(p,_){for(const g in p)p.hasOwnProperty(g)&&_(p[g],g)}function _r(p){return(0,W.CqO)(p)?p:(0,W.QGY)(p)?(0,me.D)(Promise.resolve(p)):(0,$e.of)(p)}const Fr=!1,Zr={exact:function Jo(p,_,g){if(!Mt(p.segments,_.segments)||!eo(p.segments,_.segments,g)||p.numberOfChildren!==_.numberOfChildren)return!1;for(const w in _.children)if(!p.children[w]||!Jo(p.children[w],_.children[w],g))return!1;return!0},subset:Qi},hr={exact:function Ar(p,_){return Or(p,_)},subset:function or(p,_){return Object.keys(_).length<=Object.keys(p).length&&Object.keys(_).every(g=>No(p[g],_[g]))},ignored:()=>!0};function Yo(p,_,g){return Zr[g.paths](p.root,_.root,g.matrixParams)&&hr[g.queryParams](p.queryParams,_.queryParams)&&!("exact"===g.fragment&&p.fragment!==_.fragment)}function Qi(p,_,g){return qi(p,_,_.segments,g)}function qi(p,_,g,w){if(p.segments.length>g.length){const D=p.segments.slice(0,g.length);return!(!Mt(D,g)||_.hasChildren()||!eo(D,g,w))}if(p.segments.length===g.length){if(!Mt(p.segments,g)||!eo(p.segments,g,w))return!1;for(const D in _.children)if(!p.children[D]||!Qi(p.children[D],_.children[D],w))return!1;return!0}{const D=g.slice(0,p.segments.length),A=g.slice(p.segments.length);return!!(Mt(p.segments,D)&&eo(p.segments,D,w)&&p.children[xn])&&qi(p.children[xn],_,A,w)}}function eo(p,_,g){return _.every((w,D)=>hr[g](p[D].parameters,w.parameters))}class Di{constructor(_=new Xe([],{}),g={},w=null){this.root=_,this.queryParams=g,this.fragment=w}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Hi(this.queryParams)),this._queryParamMap}toString(){return Y.serialize(this)}}class Xe{constructor(_,g){this.segments=_,this.children=g,this.parent=null,br(g,(w,D)=>w.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return le(this)}}class Le{constructor(_,g){this.path=_,this.parameters=g}get parameterMap(){return this._parameterMap||(this._parameterMap=Hi(this.parameters)),this._parameterMap}toString(){return We(this)}}function Mt(p,_){return p.length===_.length&&p.every((g,w)=>g.path===_[w].path)}let ie=(()=>{class p{}return p.\u0275fac=function(g){return new(g||p)},p.\u0275prov=W.Yz7({token:p,factory:function(){return new H},providedIn:"root"}),p})();class H{parse(_){const g=new sr(_);return new Di(g.parseRootSegment(),g.parseQueryParams(),g.parseFragment())}serialize(_){const g=`/${ge(_.root,!0)}`,w=function bt(p){const _=Object.keys(p).map(g=>{const w=p[g];return Array.isArray(w)?w.map(D=>`${ue(g)}=${ue(D)}`).join("&"):`${ue(g)}=${ue(w)}`}).filter(g=>!!g);return _.length?`?${_.join("&")}`:""}(_.queryParams);return`${g}${w}${"string"==typeof _.fragment?`#${function ne(p){return encodeURI(p)}(_.fragment)}`:""}`}}const Y=new H;function le(p){return p.segments.map(_=>We(_)).join("/")}function ge(p,_){if(!p.hasChildren())return le(p);if(_){const g=p.children[xn]?ge(p.children[xn],!1):"",w=[];return br(p.children,(D,A)=>{A!==xn&&w.push(`${A}:${ge(D,!1)}`)}),w.length>0?`${g}(${w.join("//")})`:g}{const g=function Ct(p,_){let g=[];return br(p.children,(w,D)=>{D===xn&&(g=g.concat(_(w,D)))}),br(p.children,(w,D)=>{D!==xn&&(g=g.concat(_(w,D)))}),g}(p,(w,D)=>D===xn?[ge(p.children[xn],!1)]:[`${D}:${ge(w,!1)}`]);return 1===Object.keys(p.children).length&&null!=p.children[xn]?`${le(p)}/${g[0]}`:`${le(p)}/(${g.join("//")})`}}function Ae(p){return encodeURIComponent(p).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ue(p){return Ae(p).replace(/%3B/gi,";")}function q(p){return Ae(p).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ae(p){return decodeURIComponent(p)}function De(p){return ae(p.replace(/\+/g,"%20"))}function We(p){return`${q(p.path)}${function Ue(p){return Object.keys(p).map(_=>`;${q(_)}=${q(p[_])}`).join("")}(p.parameters)}`}const Wt=/^[^\/()?;=#]+/;function on(p){const _=p.match(Wt);return _?_[0]:""}const vn=/^[^=?&#]+/,nr=/^[^&#]+/;class sr{constructor(_){this.url=_,this.remaining=_}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Xe([],{}):new Xe([],this.parseChildren())}parseQueryParams(){const _={};if(this.consumeOptional("?"))do{this.parseQueryParam(_)}while(this.consumeOptional("&"));return _}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const _=[];for(this.peekStartsWith("(")||_.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),_.push(this.parseSegment());let g={};this.peekStartsWith("/(")&&(this.capture("/"),g=this.parseParens(!0));let w={};return this.peekStartsWith("(")&&(w=this.parseParens(!1)),(_.length>0||Object.keys(g).length>0)&&(w[xn]=new Xe(_,g)),w}parseSegment(){const _=on(this.remaining);if(""===_&&this.peekStartsWith(";"))throw new W.vHH(4009,Fr);return this.capture(_),new Le(ae(_),this.parseMatrixParams())}parseMatrixParams(){const _={};for(;this.consumeOptional(";");)this.parseParam(_);return _}parseParam(_){const g=on(this.remaining);if(!g)return;this.capture(g);let w="";if(this.consumeOptional("=")){const D=on(this.remaining);D&&(w=D,this.capture(w))}_[ae(g)]=ae(w)}parseQueryParam(_){const g=function Xn(p){const _=p.match(vn);return _?_[0]:""}(this.remaining);if(!g)return;this.capture(g);let w="";if(this.consumeOptional("=")){const O=function fn(p){const _=p.match(nr);return _?_[0]:""}(this.remaining);O&&(w=O,this.capture(w))}const D=De(g),A=De(w);if(_.hasOwnProperty(D)){let O=_[D];Array.isArray(O)||(O=[O],_[D]=O),O.push(A)}else _[D]=A}parseParens(_){const g={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const w=on(this.remaining),D=this.remaining[w.length];if("/"!==D&&")"!==D&&";"!==D)throw new W.vHH(4010,Fr);let A;w.indexOf(":")>-1?(A=w.slice(0,w.indexOf(":")),this.capture(A),this.capture(":")):_&&(A=xn);const O=this.parseChildren();g[A]=1===Object.keys(O).length?O[xn]:new Xe([],O),this.consumeOptional("//")}return g}peekStartsWith(_){return this.remaining.startsWith(_)}consumeOptional(_){return!!this.peekStartsWith(_)&&(this.remaining=this.remaining.substring(_.length),!0)}capture(_){if(!this.consumeOptional(_))throw new W.vHH(4011,Fr)}}function Tr(p){return p.segments.length>0?new Xe([],{[xn]:p}):p}function po(p){const _={};for(const w of Object.keys(p.children)){const A=po(p.children[w]);(A.segments.length>0||A.hasChildren())&&(_[w]=A)}return function ji(p){if(1===p.numberOfChildren&&p.children[xn]){const _=p.children[xn];return new Xe(p.segments.concat(_.segments),_.children)}return p}(new Xe(p.segments,_))}function jr(p){return p instanceof Di}const it=!1;function ra(p,_,g,w,D){if(0===g.length)return ui(_.root,_.root,_.root,w,D);const A=function Jn(p){if("string"==typeof p[0]&&1===p.length&&"/"===p[0])return new Ut(!0,0,p);let _=0,g=!1;const w=p.reduce((D,A,O)=>{if("object"==typeof A&&null!=A){if(A.outlets){const G={};return br(A.outlets,(K,re)=>{G[re]="string"==typeof K?K.split("/"):K}),[...D,{outlets:G}]}if(A.segmentPath)return[...D,A.segmentPath]}return"string"!=typeof A?[...D,A]:0===O?(A.split("/").forEach((G,K)=>{0==K&&"."===G||(0==K&&""===G?g=!0:".."===G?_++:""!=G&&D.push(G))}),D):[...D,A]},[]);return new Ut(g,_,w)}(g);return A.toRoot()?ui(_.root,_.root,new Xe([],{}),w,D):function O(K){const re=function Ci(p,_,g,w){if(p.isAbsolute)return new Dn(_.root,!0,0);if(-1===w)return new Dn(g,g===_.root,0);return function Tt(p,_,g){let w=p,D=_,A=g;for(;A>D;){if(A-=D,w=w.parent,!w)throw new W.vHH(4005,it&&"Invalid number of '../'");D=w.segments.length}return new Dn(w,!1,D-A)}(g,w+(jn(p.commands[0])?0:1),p.numberOfDoubleDots)}(A,_,p.snapshot?._urlSegment,K),Q=re.processChildren?ei(re.segmentGroup,re.index,A.commands):Pr(re.segmentGroup,re.index,A.commands);return ui(_.root,re.segmentGroup,Q,w,D)}(p.snapshot?._lastPathIndex)}function jn(p){return"object"==typeof p&&null!=p&&!p.outlets&&!p.segmentPath}function Qr(p){return"object"==typeof p&&null!=p&&p.outlets}function ui(p,_,g,w,D){let O,A={};w&&br(w,(K,re)=>{A[re]=Array.isArray(K)?K.map(Q=>`${Q}`):`${K}`}),O=p===_?g:mi(p,_,g);const G=Tr(po(O));return new Di(G,A,D)}function mi(p,_,g){const w={};return br(p.children,(D,A)=>{w[A]=D===_?g:mi(D,_,g)}),new Xe(p.segments,w)}class Ut{constructor(_,g,w){if(this.isAbsolute=_,this.numberOfDoubleDots=g,this.commands=w,_&&w.length>0&&jn(w[0]))throw new W.vHH(4003,it&&"Root segment cannot have matrix parameters");const D=w.find(Qr);if(D&&D!==vt(w))throw new W.vHH(4004,it&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Dn{constructor(_,g,w){this.segmentGroup=_,this.processChildren=g,this.index=w}}function Pr(p,_,g){if(p||(p=new Xe([],{})),0===p.segments.length&&p.hasChildren())return ei(p,_,g);const w=function ti(p,_,g){let w=0,D=_;const A={match:!1,pathIndex:0,commandIndex:0};for(;D<p.segments.length;){if(w>=g.length)return A;const O=p.segments[D],G=g[w];if(Qr(G))break;const K=`${G}`,re=w<g.length-1?g[w+1]:null;if(D>0&&void 0===K)break;if(K&&re&&"object"==typeof re&&void 0===re.outlets){if(!xs(K,re,O))return A;w+=2}else{if(!xs(K,{},O))return A;w++}D++}return{match:!0,pathIndex:D,commandIndex:w}}(p,_,g),D=g.slice(w.commandIndex);if(w.match&&w.pathIndex<p.segments.length){const A=new Xe(p.segments.slice(0,w.pathIndex),{});return A.children[xn]=new Xe(p.segments.slice(w.pathIndex),p.children),ei(A,0,D)}return w.match&&0===D.length?new Xe(p.segments,{}):w.match&&!p.hasChildren()?Qn(p,_,g):w.match?ei(p,0,D):Qn(p,_,g)}function ei(p,_,g){if(0===g.length)return new Xe(p.segments,{});{const w=function Hn(p){return Qr(p[0])?p[0].outlets:{[xn]:p}}(g),D={};if(!w[xn]&&p.children[xn]&&1===p.numberOfChildren&&0===p.children[xn].segments.length){const A=ei(p.children[xn],_,g);return new Xe(p.segments,A.children)}return br(w,(A,O)=>{"string"==typeof A&&(A=[A]),null!==A&&(D[O]=Pr(p.children[O],_,A))}),br(p.children,(A,O)=>{void 0===w[O]&&(D[O]=A)}),new Xe(p.segments,D)}}function Qn(p,_,g){const w=p.segments.slice(0,_);let D=0;for(;D<g.length;){const A=g[D];if(Qr(A)){const K=Pi(A.outlets);return new Xe(w,K)}if(0===D&&jn(g[0])){w.push(new Le(p.segments[_].path,Vr(g[0]))),D++;continue}const O=Qr(A)?A.outlets[xn]:`${A}`,G=D<g.length-1?g[D+1]:null;O&&G&&jn(G)?(w.push(new Le(O,Vr(G))),D+=2):(w.push(new Le(O,{})),D++)}return new Xe(w,{})}function Pi(p){const _={};return br(p,(g,w)=>{"string"==typeof g&&(g=[g]),null!==g&&(_[w]=Qn(new Xe([],{}),0,g))}),_}function Vr(p){const _={};return br(p,(g,w)=>_[w]=`${g}`),_}function xs(p,_,g){return p==g.path&&Or(_,g.parameters)}const bo="imperative";class An{constructor(_,g){this.id=_,this.url=g}}class Uo extends An{constructor(_,g,w="imperative",D=null){super(_,g),this.type=0,this.navigationTrigger=w,this.restoredState=D}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Ri extends An{constructor(_,g,w){super(_,g),this.urlAfterRedirects=w,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class is extends An{constructor(_,g,w,D){super(_,g),this.reason=w,this.code=D,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class hi extends An{constructor(_,g,w,D){super(_,g),this.reason=w,this.code=D,this.type=16}}class di extends An{constructor(_,g,w,D){super(_,g),this.error=w,this.target=D,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Si extends An{constructor(_,g,w,D){super(_,g),this.urlAfterRedirects=w,this.state=D,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class kr extends An{constructor(_,g,w,D){super(_,g),this.urlAfterRedirects=w,this.state=D,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class mo extends An{constructor(_,g,w,D,A){super(_,g),this.urlAfterRedirects=w,this.state=D,this.shouldActivate=A,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class js extends An{constructor(_,g,w,D){super(_,g),this.urlAfterRedirects=w,this.state=D,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Li extends An{constructor(_,g,w,D){super(_,g),this.urlAfterRedirects=w,this.state=D,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gr{constructor(_){this.route=_,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Ll{constructor(_){this.route=_,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class wo{constructor(_){this.snapshot=_,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ri{constructor(_){this.snapshot=_,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Qo{constructor(_){this.snapshot=_,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class os{constructor(_){this.snapshot=_,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class jo{constructor(_,g,w){this.routerEvent=_,this.position=g,this.anchor=w,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let to=(()=>{class p{createUrlTree(g,w,D,A,O,G){return ra(g||w.root,D,A,O,G)}}return p.\u0275fac=function(g){return new(g||p)},p.\u0275prov=W.Yz7({token:p,factory:p.\u0275fac}),p})(),ss=(()=>{class p{}return p.\u0275fac=function(g){return new(g||p)},p.\u0275prov=W.Yz7({token:p,factory:function(_){return to.\u0275fac(_)},providedIn:"root"}),p})();class as{constructor(_){this._root=_}get root(){return this._root.value}parent(_){const g=this.pathFromRoot(_);return g.length>1?g[g.length-2]:null}children(_){const g=es(_,this._root);return g?g.children.map(w=>w.value):[]}firstChild(_){const g=es(_,this._root);return g&&g.children.length>0?g.children[0].value:null}siblings(_){const g=ki(_,this._root);return g.length<2?[]:g[g.length-2].children.map(D=>D.value).filter(D=>D!==_)}pathFromRoot(_){return ki(_,this._root).map(g=>g.value)}}function es(p,_){if(p===_.value)return _;for(const g of _.children){const w=es(p,g);if(w)return w}return null}function ki(p,_){if(p===_.value)return[_];for(const g of _.children){const w=ki(p,g);if(w.length)return w.unshift(_),w}return[]}class Oi{constructor(_,g){this.value=_,this.children=g}toString(){return`TreeNode(${this.value})`}}function bs(p){const _={};return p&&p.children.forEach(g=>_[g.value.outlet]=g),_}class ia extends as{constructor(_,g){super(_),this.snapshot=g,ya(this,_)}toString(){return this.snapshot.toString()}}function ls(p,_){const g=function _a(p,_){const O=new Vs([],{},{},"",{},xn,_,null,p.root,-1,{});return new dl("",new Oi(O,[]))}(p,_),w=new Pe([new Le("",{})]),D=new Pe({}),A=new Pe({}),O=new Pe({}),G=new Pe(""),K=new ts(w,D,O,G,A,xn,_,g.root);return K.snapshot=g.root,new ia(new Oi(K,[]),g)}class ts{constructor(_,g,w,D,A,O,G,K){this.url=_,this.params=g,this.queryParams=w,this.fragment=D,this.data=A,this.outlet=O,this.component=G,this.title=this.data?.pipe((0,Ne.U)(re=>re[Lr]))??(0,$e.of)(void 0),this._futureSnapshot=K}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Ne.U)(_=>Hi(_)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Ne.U)(_=>Hi(_)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Zi(p,_="emptyOnly"){const g=p.pathFromRoot;let w=0;if("always"!==_)for(w=g.length-1;w>=1;){const D=g[w],A=g[w-1];if(D.routeConfig&&""===D.routeConfig.path)w--;else{if(A.component)break;w--}}return function Ha(p){return p.reduce((_,g)=>({params:{..._.params,...g.params},data:{..._.data,...g.data},resolve:{...g.data,..._.resolve,...g.routeConfig?.data,...g._resolvedData}}),{params:{},data:{},resolve:{}})}(g.slice(w))}class Vs{get title(){return this.data?.[Lr]}constructor(_,g,w,D,A,O,G,K,re,Q,oe){this.url=_,this.params=g,this.queryParams=w,this.fragment=D,this.data=A,this.outlet=O,this.component=G,this.routeConfig=K,this._urlSegment=re,this._lastPathIndex=Q,this._resolve=oe}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Hi(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Hi(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(w=>w.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class dl extends as{constructor(_,g){super(g),this.url=_,ya(this,g)}toString(){return qa(this._root)}}function ya(p,_){_.value._routerState=p,_.children.forEach(g=>ya(p,g))}function qa(p){const _=p.children.length>0?` { ${p.children.map(qa).join(", ")} } `:"";return`${p.value}${_}`}function ec(p){if(p.snapshot){const _=p.snapshot,g=p._futureSnapshot;p.snapshot=g,Or(_.queryParams,g.queryParams)||p.queryParams.next(g.queryParams),_.fragment!==g.fragment&&p.fragment.next(g.fragment),Or(_.params,g.params)||p.params.next(g.params),function fo(p,_){if(p.length!==_.length)return!1;for(let g=0;g<p.length;++g)if(!Or(p[g],_[g]))return!1;return!0}(_.url,g.url)||p.url.next(g.url),Or(_.data,g.data)||p.data.next(g.data)}else p.snapshot=p._futureSnapshot,p.data.next(p._futureSnapshot.data)}function Wa(p,_){const g=Or(p.params,_.params)&&function Oe(p,_){return Mt(p,_)&&p.every((g,w)=>Or(g.parameters,_[w].parameters))}(p.url,_.url);return g&&!(!p.parent!=!_.parent)&&(!p.parent||Wa(p.parent,_.parent))}function va(p,_,g){if(g&&p.shouldReuseRoute(_.value,g.value.snapshot)){const w=g.value;w._futureSnapshot=_.value;const D=function pl(p,_,g){return _.children.map(w=>{for(const D of g.children)if(p.shouldReuseRoute(w.value,D.value.snapshot))return va(p,w,D);return va(p,w)})}(p,_,g);return new Oi(w,D)}{if(p.shouldAttach(_.value)){const A=p.retrieve(_.value);if(null!==A){const O=A.route;return O.value._futureSnapshot=_.value,O.children=_.children.map(G=>va(p,G)),O}}const w=function oa(p){return new ts(new Pe(p.url),new Pe(p.params),new Pe(p.queryParams),new Pe(p.fragment),new Pe(p.data),p.outlet,p.component,p)}(_.value),D=_.children.map(A=>va(p,A));return new Oi(w,D)}}const xa="ngNavigationCancelingError";function ws(p,_){const{redirectTo:g,navigationBehaviorOptions:w}=jr(_)?{redirectTo:_,navigationBehaviorOptions:void 0}:_,D=wr(!1,0,_);return D.url=g,D.navigationBehaviorOptions=w,D}function wr(p,_,g){const w=new Error("NavigationCancelingError: "+(p||""));return w[xa]=!0,w.cancellationCode=_,g&&(w.url=g),w}function cs(p){return sa(p)&&jr(p.url)}function sa(p){return p&&p[xa]}class $s{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Lo,this.attachRef=null}}let Lo=(()=>{class p{constructor(){this.contexts=new Map}onChildOutletCreated(g,w){const D=this.getOrCreateContext(g);D.outlet=w,this.contexts.set(g,D)}onChildOutletDestroyed(g){const w=this.getContext(g);w&&(w.outlet=null,w.attachRef=null)}onOutletDeactivated(){const g=this.contexts;return this.contexts=new Map,g}onOutletReAttached(g){this.contexts=g}getOrCreateContext(g){let w=this.getContext(g);return w||(w=new $s,this.contexts.set(g,w)),w}getContext(g){return this.contexts.get(g)||null}}return p.\u0275fac=function(g){return new(g||p)},p.\u0275prov=W.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();const Gs=!1;let Hs=(()=>{class p{constructor(){this.activated=null,this._activatedRoute=null,this.name=xn,this.activateEvents=new W.vpe,this.deactivateEvents=new W.vpe,this.attachEvents=new W.vpe,this.detachEvents=new W.vpe,this.parentContexts=(0,W.f3M)(Lo),this.location=(0,W.f3M)(W.s_b),this.changeDetector=(0,W.f3M)(W.sBO),this.environmentInjector=(0,W.f3M)(W.lqb)}ngOnChanges(g){if(g.name){const{firstChange:w,previousValue:D}=g.name;if(w)return;this.isTrackedInParentContexts(D)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(D)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(g){return this.parentContexts.getContext(g)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const g=this.parentContexts.getContext(this.name);g?.route&&(g.attachRef?this.attach(g.attachRef,g.route):this.activateWith(g.route,g.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new W.vHH(4012,Gs);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new W.vHH(4012,Gs);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new W.vHH(4012,Gs);this.location.detach();const g=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(g.instance),g}attach(g,w){this.activated=g,this._activatedRoute=w,this.location.insert(g.hostView),this.attachEvents.emit(g.instance)}deactivate(){if(this.activated){const g=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(g)}}activateWith(g,w){if(this.isActivated)throw new W.vHH(4013,Gs);this._activatedRoute=g;const D=this.location,O=g.snapshot.component,G=this.parentContexts.getOrCreateContext(this.name).children,K=new ba(g,G,D.injector);if(w&&function qs(p){return!!p.resolveComponentFactory}(w)){const re=w.resolveComponentFactory(O);this.activated=D.createComponent(re,D.length,K)}else this.activated=D.createComponent(O,{index:D.length,injector:K,environmentInjector:w??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return p.\u0275fac=function(g){return new(g||p)},p.\u0275dir=W.lG2({type:p,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[W.TTD]}),p})();class ba{constructor(_,g,w){this.route=_,this.childContexts=g,this.parent=w}get(_,g){return _===ts?this.route:_===Lo?this.childContexts:this.parent.get(_,g)}}let Ws=(()=>{class p{}return p.\u0275fac=function(g){return new(g||p)},p.\u0275cmp=W.Xpm({type:p,selectors:[["ng-component"]],standalone:!0,features:[W.jDz],decls:1,vars:0,template:function(g,w){1&g&&W._UZ(0,"router-outlet")},dependencies:[Hs],encapsulation:2}),p})();function Eo(p,_){return p.providers&&!p._injector&&(p._injector=(0,W.MMx)(p.providers,_,`Route: ${p.path}`)),p._injector??_}function wa(p){const _=p.children&&p.children.map(wa),g=_?{...p,children:_}:{...p};return!g.component&&!g.loadComponent&&(_||g.loadChildren)&&g.outlet&&g.outlet!==xn&&(g.component=Ws),g}function Mi(p){return p.outlet||xn}function Ds(p,_){const g=p.filter(w=>Mi(w)===_);return g.push(...p.filter(w=>Mi(w)!==_)),g}function xi(p){if(!p)return null;if(p.routeConfig?._injector)return p.routeConfig._injector;for(let _=p.parent;_;_=_.parent){const g=_.routeConfig;if(g?._loadedInjector)return g._loadedInjector;if(g?._injector)return g._injector}return null}class Cs{constructor(_,g,w,D){this.routeReuseStrategy=_,this.futureState=g,this.currState=w,this.forwardEvent=D}activate(_){const g=this.futureState._root,w=this.currState?this.currState._root:null;this.deactivateChildRoutes(g,w,_),ec(this.futureState.root),this.activateChildRoutes(g,w,_)}deactivateChildRoutes(_,g,w){const D=bs(g);_.children.forEach(A=>{const O=A.value.outlet;this.deactivateRoutes(A,D[O],w),delete D[O]}),br(D,(A,O)=>{this.deactivateRouteAndItsChildren(A,w)})}deactivateRoutes(_,g,w){const D=_.value,A=g?g.value:null;if(D===A)if(D.component){const O=w.getContext(D.outlet);O&&this.deactivateChildRoutes(_,g,O.children)}else this.deactivateChildRoutes(_,g,w);else A&&this.deactivateRouteAndItsChildren(g,w)}deactivateRouteAndItsChildren(_,g){_.value.component&&this.routeReuseStrategy.shouldDetach(_.value.snapshot)?this.detachAndStoreRouteSubtree(_,g):this.deactivateRouteAndOutlet(_,g)}detachAndStoreRouteSubtree(_,g){const w=g.getContext(_.value.outlet),D=w&&_.value.component?w.children:g,A=bs(_);for(const O of Object.keys(A))this.deactivateRouteAndItsChildren(A[O],D);if(w&&w.outlet){const O=w.outlet.detach(),G=w.children.onOutletDeactivated();this.routeReuseStrategy.store(_.value.snapshot,{componentRef:O,route:_,contexts:G})}}deactivateRouteAndOutlet(_,g){const w=g.getContext(_.value.outlet),D=w&&_.value.component?w.children:g,A=bs(_);for(const O of Object.keys(A))this.deactivateRouteAndItsChildren(A[O],D);w&&(w.outlet&&(w.outlet.deactivate(),w.children.onOutletDeactivated()),w.attachRef=null,w.resolver=null,w.route=null)}activateChildRoutes(_,g,w){const D=bs(g);_.children.forEach(A=>{this.activateRoutes(A,D[A.value.outlet],w),this.forwardEvent(new os(A.value.snapshot))}),_.children.length&&this.forwardEvent(new ri(_.value.snapshot))}activateRoutes(_,g,w){const D=_.value,A=g?g.value:null;if(ec(D),D===A)if(D.component){const O=w.getOrCreateContext(D.outlet);this.activateChildRoutes(_,g,O.children)}else this.activateChildRoutes(_,g,w);else if(D.component){const O=w.getOrCreateContext(D.outlet);if(this.routeReuseStrategy.shouldAttach(D.snapshot)){const G=this.routeReuseStrategy.retrieve(D.snapshot);this.routeReuseStrategy.store(D.snapshot,null),O.children.onOutletReAttached(G.contexts),O.attachRef=G.componentRef,O.route=G.route.value,O.outlet&&O.outlet.attach(G.componentRef,G.route.value),ec(G.route.value),this.activateChildRoutes(_,null,O.children)}else{const G=xi(D.snapshot),K=G?.get(W._Vd)??null;O.attachRef=null,O.route=D,O.resolver=K,O.injector=G,O.outlet&&O.outlet.activateWith(D,O.injector),this.activateChildRoutes(_,null,O.children)}}else this.activateChildRoutes(_,null,w)}}class Yi{constructor(_){this.path=_,this.route=this.path[this.path.length-1]}}class Fi{constructor(_,g){this.component=_,this.route=g}}function Xa(p,_,g){const w=p._root;return $r(w,_?_._root:null,g,[w.value])}function Vn(p,_){const g=Symbol(),w=_.get(p,g);return w===g?"function"!=typeof p||(0,W.Z0I)(p)?_.get(p):p:w}function $r(p,_,g,w,D={canDeactivateChecks:[],canActivateChecks:[]}){const A=bs(_);return p.children.forEach(O=>{(function Ka(p,_,g,w,D={canDeactivateChecks:[],canActivateChecks:[]}){const A=p.value,O=_?_.value:null,G=g?g.getContext(p.value.outlet):null;if(O&&A.routeConfig===O.routeConfig){const K=function Ss(p,_,g){if("function"==typeof g)return g(p,_);switch(g){case"pathParamsChange":return!Mt(p.url,_.url);case"pathParamsOrQueryParamsChange":return!Mt(p.url,_.url)||!Or(p.queryParams,_.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Wa(p,_)||!Or(p.queryParams,_.queryParams);default:return!Wa(p,_)}}(O,A,A.routeConfig.runGuardsAndResolvers);K?D.canActivateChecks.push(new Yi(w)):(A.data=O.data,A._resolvedData=O._resolvedData),$r(p,_,A.component?G?G.children:null:g,w,D),K&&G&&G.outlet&&G.outlet.isActivated&&D.canDeactivateChecks.push(new Fi(G.outlet.component,O))}else O&&Ea(_,G,D),D.canActivateChecks.push(new Yi(w)),$r(p,null,A.component?G?G.children:null:g,w,D)})(O,A[O.value.outlet],g,w.concat([O.value]),D),delete A[O.value.outlet]}),br(A,(O,G)=>Ea(O,g.getContext(G),D)),D}function Ea(p,_,g){const w=bs(p),D=p.value;br(w,(A,O)=>{Ea(A,D.component?_?_.children.getContext(O):null:_,g)}),g.canDeactivateChecks.push(new Fi(D.component&&_&&_.outlet&&_.outlet.isActivated?_.outlet.component:null,D))}function Zs(p){return"function"==typeof p}function Ms(p){return p instanceof Vt||"EmptyError"===p?.name}const go=Symbol("INITIAL_VALUE");function ii(){return(0,ot.w)(p=>cn(p.map(_=>_.pipe(xt(1),function Pt(...p){const _=(0,$t.yG)(p);return(0,dn.e)((g,w)=>{(_?rn(p,g,_):rn(p,g)).subscribe(w)})}(go)))).pipe((0,Ne.U)(_=>{for(const g of _)if(!0!==g){if(g===go)return go;if(!1===g||g instanceof Di)return g}return!0}),(0,Ft.h)(_=>_!==go),xt(1)))}function Vi(p){return(0,ur.z)((0,Yn.b)(_=>{if(jr(_))throw ws(0,_)}),(0,Ne.U)(_=>!0===_))}const Qa={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Bl(p,_,g,w,D){const A=nc(p,_,g);return A.matched?function Nl(p,_,g,w){const D=_.canMatch;if(!D||0===D.length)return(0,$e.of)(!0);const A=D.map(O=>{const G=Vn(O,p);return _r(function kl(p){return p&&Zs(p.canMatch)}(G)?G.canMatch(_,g):p.runInContext(()=>G(_,g)))});return(0,$e.of)(A).pipe(ii(),Vi())}(w=Eo(_,w),_,g).pipe((0,Ne.U)(O=>!0===O?A:{...Qa})):(0,$e.of)(A)}function nc(p,_,g){if(""===_.path)return"full"===_.pathMatch&&(p.hasChildren()||g.length>0)?{...Qa}:{matched:!0,consumedSegments:[],remainingSegments:g,parameters:{},positionalParamSegments:{}};const D=(_.matcher||vs)(g,p,_);if(!D)return{...Qa};const A={};br(D.posParams,(G,K)=>{A[K]=G.path});const O=D.consumed.length>0?{...A,...D.consumed[D.consumed.length-1].parameters}:A;return{matched:!0,consumedSegments:D.consumed,remainingSegments:g.slice(D.consumed.length),parameters:O,positionalParamSegments:D.posParams??{}}}function el(p,_,g,w){if(g.length>0&&function nl(p,_,g){return g.some(w=>Sa(p,_,w)&&Mi(w)!==xn)}(p,g,w)){const A=new Xe(_,function gl(p,_,g,w){const D={};D[xn]=w,w._sourceSegment=p,w._segmentIndexShift=_.length;for(const A of g)if(""===A.path&&Mi(A)!==xn){const O=new Xe([],{});O._sourceSegment=p,O._segmentIndexShift=_.length,D[Mi(A)]=O}return D}(p,_,w,new Xe(g,p.children)));return A._sourceSegment=p,A._segmentIndexShift=_.length,{segmentGroup:A,slicedSegments:[]}}if(0===g.length&&function Ul(p,_,g){return g.some(w=>Sa(p,_,w))}(p,g,w)){const A=new Xe(p.segments,function tl(p,_,g,w,D){const A={};for(const O of w)if(Sa(p,g,O)&&!D[Mi(O)]){const G=new Xe([],{});G._sourceSegment=p,G._segmentIndexShift=_.length,A[Mi(O)]=G}return{...D,...A}}(p,_,g,w,p.children));return A._sourceSegment=p,A._segmentIndexShift=_.length,{segmentGroup:A,slicedSegments:g}}const D=new Xe(p.segments,p.children);return D._sourceSegment=p,D._segmentIndexShift=_.length,{segmentGroup:D,slicedSegments:g}}function Sa(p,_,g){return(!(p.hasChildren()||_.length>0)||"full"!==g.pathMatch)&&""===g.path}function ca(p,_,g,w){return!!(Mi(p)===w||w!==xn&&Sa(_,g,p))&&("**"===p.path||nc(_,p,g).matched)}function ua(p,_,g){return 0===_.length&&!p.children[g]}const Do=!1;class Z{constructor(_){this.segmentGroup=_||null}}class M{constructor(_){this.urlTree=_}}function P(p){return Yt(new Z(p))}function U(p){return Yt(new M(p))}class Ie{constructor(_,g,w,D,A){this.injector=_,this.configLoader=g,this.urlSerializer=w,this.urlTree=D,this.config=A,this.allowRedirects=!0}apply(){const _=el(this.urlTree.root,[],[],this.config).segmentGroup,g=new Xe(_.segments,_.children);return this.expandSegmentGroup(this.injector,this.config,g,xn).pipe((0,Ne.U)(A=>this.createUrlTree(po(A),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Un(A=>{if(A instanceof M)return this.allowRedirects=!1,this.match(A.urlTree);throw A instanceof Z?this.noMatchError(A):A}))}match(_){return this.expandSegmentGroup(this.injector,this.config,_.root,xn).pipe((0,Ne.U)(D=>this.createUrlTree(po(D),_.queryParams,_.fragment))).pipe(Un(D=>{throw D instanceof Z?this.noMatchError(D):D}))}noMatchError(_){return new W.vHH(4002,Do)}createUrlTree(_,g,w){const D=Tr(_);return new Di(D,g,w)}expandSegmentGroup(_,g,w,D){return 0===w.segments.length&&w.hasChildren()?this.expandChildren(_,g,w).pipe((0,Ne.U)(A=>new Xe([],A))):this.expandSegment(_,w,g,w.segments,D,!0)}expandChildren(_,g,w){const D=[];for(const A of Object.keys(w.children))"primary"===A?D.unshift(A):D.push(A);return(0,me.D)(D).pipe((0,Rn.b)(A=>{const O=w.children[A],G=Ds(g,A);return this.expandSegmentGroup(_,G,O,A).pipe((0,Ne.U)(K=>({segment:K,outlet:A})))}),tn((A,O)=>(A[O.outlet]=O.segment,A),{}),Ai())}expandSegment(_,g,w,D,A,O){return(0,me.D)(w).pipe((0,Rn.b)(G=>this.expandSegmentAgainstRoute(_,g,w,G,D,A,O).pipe(Un(re=>{if(re instanceof Z)return(0,$e.of)(null);throw re}))),En(G=>!!G),Un((G,K)=>{if(Ms(G))return ua(g,D,A)?(0,$e.of)(new Xe([],{})):P(g);throw G}))}expandSegmentAgainstRoute(_,g,w,D,A,O,G){return ca(D,g,A,O)?void 0===D.redirectTo?this.matchSegmentAgainstRoute(_,g,D,A,O):G&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(_,g,w,D,A,O):P(g):P(g)}expandSegmentAgainstRouteUsingRedirect(_,g,w,D,A,O){return"**"===D.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(_,w,D,O):this.expandRegularSegmentAgainstRouteUsingRedirect(_,g,w,D,A,O)}expandWildCardWithParamsAgainstRouteUsingRedirect(_,g,w,D){const A=this.applyRedirectCommands([],w.redirectTo,{});return w.redirectTo.startsWith("/")?U(A):this.lineralizeSegments(w,A).pipe((0,kt.z)(O=>{const G=new Xe(O,{});return this.expandSegment(_,G,g,O,D,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(_,g,w,D,A,O){const{matched:G,consumedSegments:K,remainingSegments:re,positionalParamSegments:Q}=nc(g,D,A);if(!G)return P(g);const oe=this.applyRedirectCommands(K,D.redirectTo,Q);return D.redirectTo.startsWith("/")?U(oe):this.lineralizeSegments(D,oe).pipe((0,kt.z)(fe=>this.expandSegment(_,g,w,fe.concat(re),O,!1)))}matchSegmentAgainstRoute(_,g,w,D,A){return"**"===w.path?(_=Eo(w,_),w.loadChildren?(w._loadedRoutes?(0,$e.of)({routes:w._loadedRoutes,injector:w._loadedInjector}):this.configLoader.loadChildren(_,w)).pipe((0,Ne.U)(G=>(w._loadedRoutes=G.routes,w._loadedInjector=G.injector,new Xe(D,{})))):(0,$e.of)(new Xe(D,{}))):Bl(g,w,D,_).pipe((0,ot.w)(({matched:O,consumedSegments:G,remainingSegments:K})=>O?this.getChildConfig(_=w._injector??_,w,D).pipe((0,kt.z)(Q=>{const oe=Q.injector??_,fe=Q.routes,{segmentGroup:de,slicedSegments:ve}=el(g,G,K,fe),Se=new Xe(de.segments,de.children);if(0===ve.length&&Se.hasChildren())return this.expandChildren(oe,fe,Se).pipe((0,Ne.U)(He=>new Xe(G,He)));if(0===fe.length&&0===ve.length)return(0,$e.of)(new Xe(G,{}));const Ce=Mi(w)===A;return this.expandSegment(oe,Se,fe,ve,Ce?xn:A,!0).pipe((0,Ne.U)(Ze=>new Xe(G.concat(Ze.segments),Ze.children)))})):P(g)))}getChildConfig(_,g,w){return g.children?(0,$e.of)({routes:g.children,injector:_}):g.loadChildren?void 0!==g._loadedRoutes?(0,$e.of)({routes:g._loadedRoutes,injector:g._loadedInjector}):function Xs(p,_,g,w){const D=_.canLoad;if(void 0===D||0===D.length)return(0,$e.of)(!0);const A=D.map(O=>{const G=Vn(O,p);return _r(function us(p){return p&&Zs(p.canLoad)}(G)?G.canLoad(_,g):p.runInContext(()=>G(_,g)))});return(0,$e.of)(A).pipe(ii(),Vi())}(_,g,w).pipe((0,kt.z)(D=>D?this.configLoader.loadChildren(_,g).pipe((0,Yn.b)(A=>{g._loadedRoutes=A.routes,g._loadedInjector=A.injector})):function he(p){return Yt(wr(Do,3))}())):(0,$e.of)({routes:[],injector:_})}lineralizeSegments(_,g){let w=[],D=g.root;for(;;){if(w=w.concat(D.segments),0===D.numberOfChildren)return(0,$e.of)(w);if(D.numberOfChildren>1||!D.children[xn])return _.redirectTo,Yt(new W.vHH(4e3,Do));D=D.children[xn]}}applyRedirectCommands(_,g,w){return this.applyRedirectCreateUrlTree(g,this.urlSerializer.parse(g),_,w)}applyRedirectCreateUrlTree(_,g,w,D){const A=this.createSegmentGroup(_,g.root,w,D);return new Di(A,this.createQueryParams(g.queryParams,this.urlTree.queryParams),g.fragment)}createQueryParams(_,g){const w={};return br(_,(D,A)=>{if("string"==typeof D&&D.startsWith(":")){const G=D.substring(1);w[A]=g[G]}else w[A]=D}),w}createSegmentGroup(_,g,w,D){const A=this.createSegments(_,g.segments,w,D);let O={};return br(g.children,(G,K)=>{O[K]=this.createSegmentGroup(_,G,w,D)}),new Xe(A,O)}createSegments(_,g,w,D){return g.map(A=>A.path.startsWith(":")?this.findPosParam(_,A,D):this.findOrReturn(A,w))}findPosParam(_,g,w){const D=w[g.path.substring(1)];if(!D)throw new W.vHH(4001,Do);return D}findOrReturn(_,g){let w=0;for(const D of g){if(D.path===_.path)return g.splice(w),D;w++}return _}}class V{}class _e{constructor(_,g,w,D,A,O,G){this.injector=_,this.rootComponentType=g,this.config=w,this.urlTree=D,this.url=A,this.paramsInheritanceStrategy=O,this.urlSerializer=G}recognize(){const _=el(this.urlTree.root,[],[],this.config.filter(g=>void 0===g.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,_,xn).pipe((0,Ne.U)(g=>{if(null===g)return null;const w=new Vs([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},xn,this.rootComponentType,null,this.urlTree.root,-1,{}),D=new Oi(w,g),A=new dl(this.url,D);return this.inheritParamsAndData(A._root),A}))}inheritParamsAndData(_){const g=_.value,w=Zi(g,this.paramsInheritanceStrategy);g.params=Object.freeze(w.params),g.data=Object.freeze(w.data),_.children.forEach(D=>this.inheritParamsAndData(D))}processSegmentGroup(_,g,w,D){return 0===w.segments.length&&w.hasChildren()?this.processChildren(_,g,w):this.processSegment(_,g,w,w.segments,D)}processChildren(_,g,w){return(0,me.D)(Object.keys(w.children)).pipe((0,Rn.b)(D=>{const A=w.children[D],O=Ds(g,D);return this.processSegmentGroup(_,O,A,D)}),tn((D,A)=>D&&A?(D.push(...A),D):null),function Ti(p,_=!1){return(0,dn.e)((g,w)=>{let D=0;g.subscribe((0,ut.x)(w,A=>{const O=p(A,D++);(O||_)&&w.next(A),!O&&w.complete()}))})}(D=>null!==D),Mn(null),Ai(),(0,Ne.U)(D=>{if(null===D)return null;const A=bn(D);return function Fe(p){p.sort((_,g)=>_.value.outlet===xn?-1:g.value.outlet===xn?1:_.value.outlet.localeCompare(g.value.outlet))}(A),A}))}processSegment(_,g,w,D,A){return(0,me.D)(g).pipe((0,Rn.b)(O=>this.processSegmentAgainstRoute(O._injector??_,O,w,D,A)),En(O=>!!O),Un(O=>{if(Ms(O))return ua(w,D,A)?(0,$e.of)([]):(0,$e.of)(null);throw O}))}processSegmentAgainstRoute(_,g,w,D,A){if(g.redirectTo||!ca(g,w,D,A))return(0,$e.of)(null);let O;if("**"===g.path){const G=D.length>0?vt(D).parameters:{},K=wn(w)+D.length,re=new Vs(D,G,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,rr(g),Mi(g),g.component??g._loadedComponent??null,g,$n(w),K,Et(g));O=(0,$e.of)({snapshot:re,consumedSegments:[],remainingSegments:[]})}else O=Bl(w,g,D,_).pipe((0,Ne.U)(({matched:G,consumedSegments:K,remainingSegments:re,parameters:Q})=>{if(!G)return null;const oe=wn(w)+K.length;return{snapshot:new Vs(K,Q,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,rr(g),Mi(g),g.component??g._loadedComponent??null,g,$n(w),oe,Et(g)),consumedSegments:K,remainingSegments:re}}));return O.pipe((0,ot.w)(G=>{if(null===G)return(0,$e.of)(null);const{snapshot:K,consumedSegments:re,remainingSegments:Q}=G;_=g._injector??_;const oe=g._loadedInjector??_,fe=function Ge(p){return p.children?p.children:p.loadChildren?p._loadedRoutes:[]}(g),{segmentGroup:de,slicedSegments:ve}=el(w,re,Q,fe.filter(Ce=>void 0===Ce.redirectTo));if(0===ve.length&&de.hasChildren())return this.processChildren(oe,fe,de).pipe((0,Ne.U)(Ce=>null===Ce?null:[new Oi(K,Ce)]));if(0===fe.length&&0===ve.length)return(0,$e.of)([new Oi(K,[])]);const Se=Mi(g)===A;return this.processSegment(oe,fe,de,ve,Se?xn:A).pipe((0,Ne.U)(Ce=>null===Ce?null:[new Oi(K,Ce)]))}))}}function jt(p){const _=p.value.routeConfig;return _&&""===_.path&&void 0===_.redirectTo}function bn(p){const _=[],g=new Set;for(const w of p){if(!jt(w)){_.push(w);continue}const D=_.find(A=>w.value.routeConfig===A.value.routeConfig);void 0!==D?(D.children.push(...w.children),g.add(D)):_.push(w)}for(const w of g){const D=bn(w.children);_.push(new Oi(w.value,D))}return _.filter(w=>!g.has(w))}function $n(p){let _=p;for(;_._sourceSegment;)_=_._sourceSegment;return _}function wn(p){let _=p,g=_._segmentIndexShift??0;for(;_._sourceSegment;)_=_._sourceSegment,g+=_._segmentIndexShift??0;return g-1}function rr(p){return p.data||{}}function Et(p){return p.resolve||{}}function Mo(p){return"string"==typeof p.title||null===p.title}function Is(p){return(0,ot.w)(_=>{const g=p(_);return g?(0,me.D)(g).pipe((0,Ne.U)(()=>_)):(0,$e.of)(_)})}const ln=new W.OlP("ROUTES");let kn=(()=>{class p{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,W.f3M)(W.Sil)}loadComponent(g){if(this.componentLoaders.get(g))return this.componentLoaders.get(g);if(g._loadedComponent)return(0,$e.of)(g._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(g);const w=_r(g.loadComponent()).pipe((0,Ne.U)(wi),(0,Yn.b)(A=>{this.onLoadEndListener&&this.onLoadEndListener(g),g._loadedComponent=A}),zo(()=>{this.componentLoaders.delete(g)})),D=new hn(w,()=>new c.x).pipe(Kn());return this.componentLoaders.set(g,D),D}loadChildren(g,w){if(this.childrenLoaders.get(w))return this.childrenLoaders.get(w);if(w._loadedRoutes)return(0,$e.of)({routes:w._loadedRoutes,injector:w._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(w);const A=this.loadModuleFactoryOrRoutes(w.loadChildren).pipe((0,Ne.U)(G=>{this.onLoadEndListener&&this.onLoadEndListener(w);let K,re,Q=!1;Array.isArray(G)?re=G:(K=G.create(g).injector,re=Er(K.get(ln,[],W.XFs.Self|W.XFs.Optional)));return{routes:re.map(wa),injector:K}}),zo(()=>{this.childrenLoaders.delete(w)})),O=new hn(A,()=>new c.x).pipe(Kn());return this.childrenLoaders.set(w,O),O}loadModuleFactoryOrRoutes(g){return _r(g()).pipe((0,Ne.U)(wi),(0,kt.z)(w=>w instanceof W.YKP||Array.isArray(w)?(0,$e.of)(w):(0,me.D)(this.compiler.compileModuleAsync(w))))}}return p.\u0275fac=function(g){return new(g||p)},p.\u0275prov=W.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();function wi(p){return function fr(p){return p&&"object"==typeof p&&"default"in p}(p)?p.default:p}let Bi=(()=>{class p{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new c.x,this.configLoader=(0,W.f3M)(kn),this.environmentInjector=(0,W.f3M)(W.lqb),this.urlSerializer=(0,W.f3M)(ie),this.rootContexts=(0,W.f3M)(Lo),this.navigationId=0,this.afterPreactivation=()=>(0,$e.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=D=>this.events.next(new Ll(D)),this.configLoader.onLoadStartListener=D=>this.events.next(new gr(D))}complete(){this.transitions?.complete()}handleNavigationRequest(g){const w=++this.navigationId;this.transitions?.next({...this.transitions.value,...g,id:w})}setupNavigations(g){return this.transitions=new Pe({id:0,targetPageId:0,currentUrlTree:g.currentUrlTree,currentRawUrl:g.currentUrlTree,extractedUrl:g.urlHandlingStrategy.extract(g.currentUrlTree),urlAfterRedirects:g.urlHandlingStrategy.extract(g.currentUrlTree),rawUrl:g.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:bo,restoredState:null,currentSnapshot:g.routerState.snapshot,targetSnapshot:null,currentRouterState:g.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,Ft.h)(w=>0!==w.id),(0,Ne.U)(w=>({...w,extractedUrl:g.urlHandlingStrategy.extract(w.rawUrl)})),(0,ot.w)(w=>{let D=!1,A=!1;return(0,$e.of)(w).pipe((0,Yn.b)(O=>{this.currentNavigation={id:O.id,initialUrl:O.rawUrl,extractedUrl:O.extractedUrl,trigger:O.source,extras:O.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,ot.w)(O=>{const G=g.browserUrlTree.toString(),K=!g.navigated||O.extractedUrl.toString()!==G||G!==g.currentUrlTree.toString();if(!K&&"reload"!==(O.extras.onSameUrlNavigation??g.onSameUrlNavigation)){const Q="";return this.events.next(new hi(O.id,g.serializeUrl(w.rawUrl),Q,0)),g.rawUrlTree=O.rawUrl,O.resolve(null),_t.E}if(g.urlHandlingStrategy.shouldProcessUrl(O.rawUrl))return _o(O.source)&&(g.browserUrlTree=O.extractedUrl),(0,$e.of)(O).pipe((0,ot.w)(Q=>{const oe=this.transitions?.getValue();return this.events.next(new Uo(Q.id,this.urlSerializer.serialize(Q.extractedUrl),Q.source,Q.restoredState)),oe!==this.transitions?.getValue()?_t.E:Promise.resolve(Q)}),function tt(p,_,g,w){return(0,ot.w)(D=>function be(p,_,g,w,D){return new Ie(p,_,g,w,D).apply()}(p,_,g,D.extractedUrl,w).pipe((0,Ne.U)(A=>({...D,urlAfterRedirects:A}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,g.config),(0,Yn.b)(Q=>{this.currentNavigation={...this.currentNavigation,finalUrl:Q.urlAfterRedirects},w.urlAfterRedirects=Q.urlAfterRedirects}),function Rr(p,_,g,w,D){return(0,kt.z)(A=>function te(p,_,g,w,D,A,O="emptyOnly"){return new _e(p,_,g,w,D,O,A).recognize().pipe((0,ot.w)(G=>null===G?function z(p){return new zt.y(_=>_.error(p))}(new V):(0,$e.of)(G)))}(p,_,g,A.urlAfterRedirects,w.serialize(A.urlAfterRedirects),w,D).pipe((0,Ne.U)(O=>({...A,targetSnapshot:O}))))}(this.environmentInjector,this.rootComponentType,g.config,this.urlSerializer,g.paramsInheritanceStrategy),(0,Yn.b)(Q=>{if(w.targetSnapshot=Q.targetSnapshot,"eager"===g.urlUpdateStrategy){if(!Q.extras.skipLocationChange){const fe=g.urlHandlingStrategy.merge(Q.urlAfterRedirects,Q.rawUrl);g.setBrowserUrl(fe,Q)}g.browserUrlTree=Q.urlAfterRedirects}const oe=new Si(Q.id,this.urlSerializer.serialize(Q.extractedUrl),this.urlSerializer.serialize(Q.urlAfterRedirects),Q.targetSnapshot);this.events.next(oe)}));if(K&&g.urlHandlingStrategy.shouldProcessUrl(g.rawUrlTree)){const{id:Q,extractedUrl:oe,source:fe,restoredState:de,extras:ve}=O,Se=new Uo(Q,this.urlSerializer.serialize(oe),fe,de);this.events.next(Se);const Ce=ls(oe,this.rootComponentType).snapshot;return w={...O,targetSnapshot:Ce,urlAfterRedirects:oe,extras:{...ve,skipLocationChange:!1,replaceUrl:!1}},(0,$e.of)(w)}{const Q="";return this.events.next(new hi(O.id,g.serializeUrl(w.extractedUrl),Q,1)),g.rawUrlTree=O.rawUrl,O.resolve(null),_t.E}}),(0,Yn.b)(O=>{const G=new kr(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot);this.events.next(G)}),(0,Ne.U)(O=>w={...O,guards:Xa(O.targetSnapshot,O.currentSnapshot,this.rootContexts)}),function Ol(p,_){return(0,kt.z)(g=>{const{targetSnapshot:w,currentSnapshot:D,guards:{canActivateChecks:A,canDeactivateChecks:O}}=g;return 0===O.length&&0===A.length?(0,$e.of)({...g,guardsResult:!0}):function Ca(p,_,g,w){return(0,me.D)(p).pipe((0,kt.z)(D=>function Ja(p,_,g,w,D){const A=_&&_.routeConfig?_.routeConfig.canDeactivate:null;if(!A||0===A.length)return(0,$e.of)(!0);const O=A.map(G=>{const K=xi(_)??D,re=Vn(G,K);return _r(function dr(p){return p&&Zs(p.canDeactivate)}(re)?re.canDeactivate(p,_,g,w):K.runInContext(()=>re(p,_,g,w))).pipe(En())});return(0,$e.of)(O).pipe(ii())}(D.component,D.route,g,_,w)),En(D=>!0!==D,!0))}(O,w,D,p).pipe((0,kt.z)(G=>G&&function Ta(p){return"boolean"==typeof p}(G)?function Fl(p,_,g,w){return(0,me.D)(_).pipe((0,Rn.b)(D=>rn(function zl(p,_){return null!==p&&_&&_(new wo(p)),(0,$e.of)(!0)}(D.route.parent,w),function la(p,_){return null!==p&&_&&_(new Qo(p)),(0,$e.of)(!0)}(D.route,w),function hs(p,_,g){const w=_[_.length-1],A=_.slice(0,_.length-1).reverse().map(O=>function ml(p){const _=p.routeConfig?p.routeConfig.canActivateChild:null;return _&&0!==_.length?{node:p,guards:_}:null}(O)).filter(O=>null!==O).map(O=>un(()=>{const G=O.guards.map(K=>{const re=xi(O.node)??g,Q=Vn(K,re);return _r(function Rt(p){return p&&Zs(p.canActivateChild)}(Q)?Q.canActivateChild(w,p):re.runInContext(()=>Q(w,p))).pipe(En())});return(0,$e.of)(G).pipe(ii())}));return(0,$e.of)(A).pipe(ii())}(p,D.path,g),function Ni(p,_,g){const w=_.routeConfig?_.routeConfig.canActivate:null;if(!w||0===w.length)return(0,$e.of)(!0);const D=w.map(A=>un(()=>{const O=xi(_)??g,G=Vn(A,O);return _r(function Da(p){return p&&Zs(p.canActivate)}(G)?G.canActivate(_,p):O.runInContext(()=>G(_,p))).pipe(En())}));return(0,$e.of)(D).pipe(ii())}(p,D.route,g))),En(D=>!0!==D,!0))}(w,A,p,_):(0,$e.of)(G)),(0,Ne.U)(G=>({...g,guardsResult:G})))})}(this.environmentInjector,O=>this.events.next(O)),(0,Yn.b)(O=>{if(w.guardsResult=O.guardsResult,jr(O.guardsResult))throw ws(0,O.guardsResult);const G=new mo(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot,!!O.guardsResult);this.events.next(G)}),(0,Ft.h)(O=>!!O.guardsResult||(g.restoreHistory(O),this.cancelNavigationTransition(O,"",3),!1)),Is(O=>{if(O.guards.canActivateChecks.length)return(0,$e.of)(O).pipe((0,Yn.b)(G=>{const K=new js(G.id,this.urlSerializer.serialize(G.extractedUrl),this.urlSerializer.serialize(G.urlAfterRedirects),G.targetSnapshot);this.events.next(K)}),(0,ot.w)(G=>{let K=!1;return(0,$e.of)(G).pipe(function bi(p,_){return(0,kt.z)(g=>{const{targetSnapshot:w,guards:{canActivateChecks:D}}=g;if(!D.length)return(0,$e.of)(g);let A=0;return(0,me.D)(D).pipe((0,Rn.b)(O=>function no(p,_,g,w){const D=p.routeConfig,A=p._resolve;return void 0!==D?.title&&!Mo(D)&&(A[Lr]=D.title),function Co(p,_,g,w){const D=function ro(p){return[...Object.keys(p),...Object.getOwnPropertySymbols(p)]}(p);if(0===D.length)return(0,$e.of)({});const A={};return(0,me.D)(D).pipe((0,kt.z)(O=>function So(p,_,g,w){const D=xi(_)??w,A=Vn(p,D);return _r(A.resolve?A.resolve(_,g):D.runInContext(()=>A(_,g)))}(p[O],_,g,w).pipe(En(),(0,Yn.b)(G=>{A[O]=G}))),Kr(1),function Yr(p){return(0,Ne.U)(()=>p)}(A),Un(O=>Ms(O)?_t.E:Yt(O)))}(A,p,_,w).pipe((0,Ne.U)(O=>(p._resolvedData=O,p.data=Zi(p,g).resolve,D&&Mo(D)&&(p.data[Lr]=D.title),null)))}(O.route,w,p,_)),(0,Yn.b)(()=>A++),Kr(1),(0,kt.z)(O=>A===D.length?(0,$e.of)(g):_t.E))})}(g.paramsInheritanceStrategy,this.environmentInjector),(0,Yn.b)({next:()=>K=!0,complete:()=>{K||(g.restoreHistory(G),this.cancelNavigationTransition(G,"",2))}}))}),(0,Yn.b)(G=>{const K=new Li(G.id,this.urlSerializer.serialize(G.extractedUrl),this.urlSerializer.serialize(G.urlAfterRedirects),G.targetSnapshot);this.events.next(K)}))}),Is(O=>{const G=K=>{const re=[];K.routeConfig?.loadComponent&&!K.routeConfig._loadedComponent&&re.push(this.configLoader.loadComponent(K.routeConfig).pipe((0,Yn.b)(Q=>{K.component=Q}),(0,Ne.U)(()=>{})));for(const Q of K.children)re.push(...G(Q));return re};return cn(G(O.targetSnapshot.root)).pipe(Mn(),xt(1))}),Is(()=>this.afterPreactivation()),(0,Ne.U)(O=>{const G=function fl(p,_,g){const w=va(p,_._root,g?g._root:void 0);return new ia(w,_)}(g.routeReuseStrategy,O.targetSnapshot,O.currentRouterState);return w={...O,targetRouterState:G}}),(0,Yn.b)(O=>{g.currentUrlTree=O.urlAfterRedirects,g.rawUrlTree=g.urlHandlingStrategy.merge(O.urlAfterRedirects,O.rawUrl),g.routerState=O.targetRouterState,"deferred"===g.urlUpdateStrategy&&(O.extras.skipLocationChange||g.setBrowserUrl(g.rawUrlTree,O),g.browserUrlTree=O.urlAfterRedirects)}),((p,_,g)=>(0,Ne.U)(w=>(new Cs(_,w.targetRouterState,w.currentRouterState,g).activate(p),w)))(this.rootContexts,g.routeReuseStrategy,O=>this.events.next(O)),xt(1),(0,Yn.b)({next:O=>{D=!0,this.lastSuccessfulNavigation=this.currentNavigation,g.navigated=!0,this.events.next(new Ri(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(g.currentUrlTree))),g.titleStrategy?.updateTitle(O.targetRouterState.snapshot),O.resolve(!0)},complete:()=>{D=!0}}),zo(()=>{D||A||this.cancelNavigationTransition(w,"",1),this.currentNavigation?.id===w.id&&(this.currentNavigation=null)}),Un(O=>{if(A=!0,sa(O)){cs(O)||(g.navigated=!0,g.restoreHistory(w,!0));const G=new is(w.id,this.urlSerializer.serialize(w.extractedUrl),O.message,O.cancellationCode);if(this.events.next(G),cs(O)){const K=g.urlHandlingStrategy.merge(O.url,g.rawUrlTree),re={skipLocationChange:w.extras.skipLocationChange,replaceUrl:"eager"===g.urlUpdateStrategy||_o(w.source)};g.scheduleNavigation(K,bo,null,re,{resolve:w.resolve,reject:w.reject,promise:w.promise})}else w.resolve(!1)}else{g.restoreHistory(w,!0);const G=new di(w.id,this.urlSerializer.serialize(w.extractedUrl),O,w.targetSnapshot??void 0);this.events.next(G);try{w.resolve(g.errorHandler(O))}catch(K){w.reject(K)}}return _t.E}))}))}cancelNavigationTransition(g,w,D){const A=new is(g.id,this.urlSerializer.serialize(g.extractedUrl),w,D);this.events.next(A),g.resolve(!1)}}return p.\u0275fac=function(g){return new(g||p)},p.\u0275prov=W.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();function _o(p){return p!==bo}let zr=(()=>{class p{buildTitle(g){let w,D=g.root;for(;void 0!==D;)w=this.getResolvedTitleForRoute(D)??w,D=D.children.find(A=>A.outlet===xn);return w}getResolvedTitleForRoute(g){return g.data[Lr]}}return p.\u0275fac=function(g){return new(g||p)},p.\u0275prov=W.Yz7({token:p,factory:function(){return(0,W.f3M)(jl)},providedIn:"root"}),p})(),jl=(()=>{class p extends zr{constructor(g){super(),this.title=g}updateTitle(g){const w=this.buildTitle(g);void 0!==w&&this.title.setTitle(w)}}return p.\u0275fac=function(g){return new(g||p)(W.LFG(uo.Dx))},p.\u0275prov=W.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})(),rc=(()=>{class p{}return p.\u0275fac=function(g){return new(g||p)},p.\u0275prov=W.Yz7({token:p,factory:function(){return(0,W.f3M)(ds)},providedIn:"root"}),p})();class Ui{shouldDetach(_){return!1}store(_,g){}shouldAttach(_){return!1}retrieve(_){return null}shouldReuseRoute(_,g){return _.routeConfig===g.routeConfig}}let ds=(()=>{class p extends Ui{}return p.\u0275fac=function(){let _;return function(w){return(_||(_=W.n5z(p)))(w||p)}}(),p.\u0275prov=W.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();const Ks=new W.OlP("",{providedIn:"root",factory:()=>({})});let ha=(()=>{class p{}return p.\u0275fac=function(g){return new(g||p)},p.\u0275prov=W.Yz7({token:p,factory:function(){return(0,W.f3M)(Dc)},providedIn:"root"}),p})(),Dc=(()=>{class p{shouldProcessUrl(g){return!0}extract(g){return g}merge(g,w){return g}}return p.\u0275fac=function(g){return new(g||p)},p.\u0275prov=W.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();function Ys(p){throw p}function ic(p,_,g){return _.parse("/")}const bu={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Uc={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let $o=(()=>{class p{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,W.f3M)(W.c2e),this.isNgZoneEnabled=!1,this.options=(0,W.f3M)(Ks,{optional:!0})||{},this.errorHandler=this.options.errorHandler||Ys,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||ic,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,W.f3M)(ha),this.routeReuseStrategy=(0,W.f3M)(rc),this.urlCreationStrategy=(0,W.f3M)(ss),this.titleStrategy=(0,W.f3M)(zr),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Er((0,W.f3M)(ln,{optional:!0})??[]),this.navigationTransitions=(0,W.f3M)(Bi),this.urlSerializer=(0,W.f3M)(ie),this.location=(0,W.f3M)(Br.Ye),this.isNgZoneEnabled=(0,W.f3M)(W.R0b)instanceof W.R0b&&W.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Di,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=ls(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(g=>{this.lastSuccessfulId=g.id,this.currentPageId=this.browserPageId??0},g=>{this.console.warn(`Unhandled Navigation Error: ${g}`)})}resetRootComponentType(g){this.routerState.root.component=g,this.navigationTransitions.rootComponentType=g}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const g=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),bo,g)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(g=>{const w="popstate"===g.type?"popstate":"hashchange";"popstate"===w&&setTimeout(()=>{this.navigateToSyncWithBrowser(g.url,w,g.state)},0)}))}navigateToSyncWithBrowser(g,w,D){const A={replaceUrl:!0},O=D?.navigationId?D:null;if(D){const K={...D};delete K.navigationId,delete K.\u0275routerPageId,0!==Object.keys(K).length&&(A.state=K)}const G=this.parseUrl(g);this.scheduleNavigation(G,w,O,A)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(g){this.config=g.map(wa),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(g,w={}){const{relativeTo:D,queryParams:A,fragment:O,queryParamsHandling:G,preserveFragment:K}=w,re=K?this.currentUrlTree.fragment:O;let Q=null;switch(G){case"merge":Q={...this.currentUrlTree.queryParams,...A};break;case"preserve":Q=this.currentUrlTree.queryParams;break;default:Q=A||null}return null!==Q&&(Q=this.removeEmptyProps(Q)),this.urlCreationStrategy.createUrlTree(D,this.routerState,this.currentUrlTree,g,Q,re??null)}navigateByUrl(g,w={skipLocationChange:!1}){const D=jr(g)?g:this.parseUrl(g),A=this.urlHandlingStrategy.merge(D,this.rawUrlTree);return this.scheduleNavigation(A,bo,null,w)}navigate(g,w={skipLocationChange:!1}){return function oc(p){for(let _=0;_<p.length;_++){const g=p[_];if(null==g)throw new W.vHH(4008,false)}}(g),this.navigateByUrl(this.createUrlTree(g,w),w)}serializeUrl(g){return this.urlSerializer.serialize(g)}parseUrl(g){let w;try{w=this.urlSerializer.parse(g)}catch(D){w=this.malformedUriErrorHandler(D,this.urlSerializer,g)}return w}isActive(g,w){let D;if(D=!0===w?{...bu}:!1===w?{...Uc}:w,jr(g))return Yo(this.currentUrlTree,g,D);const A=this.parseUrl(g);return Yo(this.currentUrlTree,A,D)}removeEmptyProps(g){return Object.keys(g).reduce((w,D)=>{const A=g[D];return null!=A&&(w[D]=A),w},{})}scheduleNavigation(g,w,D,A,O){if(this.disposed)return Promise.resolve(!1);let G,K,re,Q;return O?(G=O.resolve,K=O.reject,re=O.promise):re=new Promise((oe,fe)=>{G=oe,K=fe}),Q="computed"===this.canceledNavigationResolution?D&&D.\u0275routerPageId?D.\u0275routerPageId:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:Q,source:w,restoredState:D,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:g,extras:A,resolve:G,reject:K,promise:re,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),re.catch(oe=>Promise.reject(oe))}setBrowserUrl(g,w){const D=this.urlSerializer.serialize(g);if(this.location.isCurrentPathEqualTo(D)||w.extras.replaceUrl){const O={...w.extras.state,...this.generateNgRouterState(w.id,this.browserPageId)};this.location.replaceState(D,"",O)}else{const A={...w.extras.state,...this.generateNgRouterState(w.id,w.targetPageId)};this.location.go(D,"",A)}}restoreHistory(g,w=!1){if("computed"===this.canceledNavigationResolution){const A=this.currentPageId-(this.browserPageId??this.currentPageId);0!==A?this.location.historyGo(A):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===A&&(this.resetState(g),this.browserUrlTree=g.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(w&&this.resetState(g),this.resetUrlToCurrentUrlTree())}resetState(g){this.routerState=g.currentRouterState,this.currentUrlTree=g.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,g.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(g,w){return"computed"===this.canceledNavigationResolution?{navigationId:g,\u0275routerPageId:w}:{navigationId:g}}}return p.\u0275fac=function(g){return new(g||p)},p.\u0275prov=W.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})(),Vl=(()=>{class p{constructor(g,w,D,A,O,G){this.router=g,this.route=w,this.tabIndexAttribute=D,this.renderer=A,this.el=O,this.locationStrategy=G,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new c.x;const K=O.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===K||"area"===K,this.isAnchorElement?this.subscription=g.events.subscribe(re=>{re instanceof Ri&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(g){this._preserveFragment=(0,W.D6c)(g)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(g){this._skipLocationChange=(0,W.D6c)(g)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(g){this._replaceUrl=(0,W.D6c)(g)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(g){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",g)}ngOnChanges(g){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(g){null!=g?(this.commands=Array.isArray(g)?g:[g],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(g,w,D,A,O){return!!(null===this.urlTree||this.isAnchorElement&&(0!==g||w||D||A||O||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const g=null===this.href?null:(0,W.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",g)}applyAttributeValue(g,w){const D=this.renderer,A=this.el.nativeElement;null!==w?D.setAttribute(A,g,w):D.removeAttribute(A,g)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return p.\u0275fac=function(g){return new(g||p)(W.Y36($o),W.Y36(ts),W.$8M("tabindex"),W.Y36(W.Qsj),W.Y36(W.SBq),W.Y36(Br.S$))},p.\u0275dir=W.lG2({type:p,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(g,w){1&g&&W.NdJ("click",function(A){return w.onClick(A.button,A.ctrlKey,A.shiftKey,A.altKey,A.metaKey)}),2&g&&W.uIk("target",w.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[W.TTD]}),p})(),jc=(()=>{class p{get isActive(){return this._isActive}constructor(g,w,D,A,O){this.router=g,this.element=w,this.renderer=D,this.cdr=A,this.link=O,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new W.vpe,this.routerEventsSubscription=g.events.subscribe(G=>{G instanceof Ri&&this.update()})}ngAfterContentInit(){(0,$e.of)(this.links.changes,(0,$e.of)(null)).pipe((0,tr.J)()).subscribe(g=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const g=[...this.links.toArray(),this.link].filter(w=>!!w).map(w=>w.onChanges);this.linkInputChangesSubscription=(0,me.D)(g).pipe((0,tr.J)()).subscribe(w=>{this._isActive!==this.isLinkActive(this.router)(w)&&this.update()})}set routerLinkActive(g){const w=Array.isArray(g)?g:g.split(" ");this.classes=w.filter(D=>!!D)}ngOnChanges(g){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||Promise.resolve().then(()=>{const g=this.hasActiveLinks();this._isActive!==g&&(this._isActive=g,this.cdr.markForCheck(),this.classes.forEach(w=>{g?this.renderer.addClass(this.element.nativeElement,w):this.renderer.removeClass(this.element.nativeElement,w)}),g&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(g))})}isLinkActive(g){const w=function io(p){return!!p.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return D=>!!D.urlTree&&g.isActive(D.urlTree,w)}hasActiveLinks(){const g=this.isLinkActive(this.router);return this.link&&g(this.link)||this.links.some(g)}}return p.\u0275fac=function(g){return new(g||p)(W.Y36($o),W.Y36(W.SBq),W.Y36(W.Qsj),W.Y36(W.sBO),W.Y36(Vl,8))},p.\u0275dir=W.lG2({type:p,selectors:[["","routerLinkActive",""]],contentQueries:function(g,w,D){if(1&g&&W.Suo(D,Vl,5),2&g){let A;W.iGM(A=W.CRH())&&(w.links=A)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[W.TTD]}),p})();class rl{}let Eu=(()=>{class p{constructor(g,w,D,A,O){this.router=g,this.injector=D,this.preloadingStrategy=A,this.loader=O}setUpPreloading(){this.subscription=this.router.events.pipe((0,Ft.h)(g=>g instanceof Ri),(0,Rn.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(g,w){const D=[];for(const A of w){A.providers&&!A._injector&&(A._injector=(0,W.MMx)(A.providers,g,`Route: ${A.path}`));const O=A._injector??g,G=A._loadedInjector??O;(A.loadChildren&&!A._loadedRoutes&&void 0===A.canLoad||A.loadComponent&&!A._loadedComponent)&&D.push(this.preloadConfig(O,A)),(A.children||A._loadedRoutes)&&D.push(this.processRoutes(G,A.children??A._loadedRoutes))}return(0,me.D)(D).pipe((0,tr.J)())}preloadConfig(g,w){return this.preloadingStrategy.preload(w,()=>{let D;D=w.loadChildren&&void 0===w.canLoad?this.loader.loadChildren(g,w):(0,$e.of)(null);const A=D.pipe((0,kt.z)(O=>null===O?(0,$e.of)(void 0):(w._loadedRoutes=O.routes,w._loadedInjector=O.injector,this.processRoutes(O.injector??g,O.routes))));if(w.loadComponent&&!w._loadedComponent){const O=this.loader.loadComponent(w);return(0,me.D)([A,O]).pipe((0,tr.J)())}return A})}}return p.\u0275fac=function(g){return new(g||p)(W.LFG($o),W.LFG(W.Sil),W.LFG(W.lqb),W.LFG(rl),W.LFG(kn))},p.\u0275prov=W.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();const ko=new W.OlP("");let Vc=(()=>{class p{constructor(g,w,D,A,O={}){this.urlSerializer=g,this.transitions=w,this.viewportScroller=D,this.zone=A,this.options=O,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},O.scrollPositionRestoration=O.scrollPositionRestoration||"disabled",O.anchorScrolling=O.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(g=>{g instanceof Uo?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=g.navigationTrigger,this.restoredId=g.restoredState?g.restoredState.navigationId:0):g instanceof Ri&&(this.lastId=g.id,this.scheduleScrollEvent(g,this.urlSerializer.parse(g.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(g=>{g instanceof jo&&(g.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(g.position):g.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(g.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(g,w){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new jo(g,"popstate"===this.lastSource?this.store[this.restoredId]:null,w))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return p.\u0275fac=function(g){W.$Z()},p.\u0275prov=W.Yz7({token:p,factory:p.\u0275fac}),p})();var oo=(()=>((oo=oo||{})[oo.COMPLETE=0]="COMPLETE",oo[oo.FAILED=1]="FAILED",oo[oo.REDIRECTING=2]="REDIRECTING",oo))();const Ma=!1;function ns(p,_){return{\u0275kind:p,\u0275providers:_}}const Go=new W.OlP("",{providedIn:"root",factory:()=>!1});function Ia(){const p=(0,W.f3M)(W.zs3);return _=>{const g=p.get(W.z2F);if(_!==g.components[0])return;const w=p.get($o),D=p.get(Hc);1===p.get(ac)&&w.initialNavigation(),p.get(Sc,null,W.XFs.Optional)?.setUpPreloading(),p.get(ko,null,W.XFs.Optional)?.init(),w.resetRootComponentType(g.componentTypes[0]),D.closed||(D.next(),D.complete(),D.unsubscribe())}}const Hc=new W.OlP(Ma?"bootstrap done indicator":"",{factory:()=>new c.x}),ac=new W.OlP(Ma?"initial navigation":"",{providedIn:"root",factory:()=>1});function Cc(){let p=[];return p=Ma?[{provide:W.Xts,multi:!0,useFactory:()=>{const _=(0,W.f3M)($o);return()=>_.events.subscribe(g=>{console.group?.(`Router Event: ${g.constructor.name}`),console.log(function Dr(p){if(!("type"in p))return`Unknown Router Event: ${p.constructor.name}`;switch(p.type){case 14:return`ActivationEnd(path: '${p.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${p.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${p.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${p.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${p.id}, url: '${p.url}', urlAfterRedirects: '${p.urlAfterRedirects}', state: ${p.state}, shouldActivate: ${p.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${p.id}, url: '${p.url}', urlAfterRedirects: '${p.urlAfterRedirects}', state: ${p.state})`;case 2:return`NavigationCancel(id: ${p.id}, url: '${p.url}')`;case 16:return`NavigationSkipped(id: ${p.id}, url: '${p.url}')`;case 1:return`NavigationEnd(id: ${p.id}, url: '${p.url}', urlAfterRedirects: '${p.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${p.id}, url: '${p.url}', error: ${p.error})`;case 0:return`NavigationStart(id: ${p.id}, url: '${p.url}')`;case 6:return`ResolveEnd(id: ${p.id}, url: '${p.url}', urlAfterRedirects: '${p.urlAfterRedirects}', state: ${p.state})`;case 5:return`ResolveStart(id: ${p.id}, url: '${p.url}', urlAfterRedirects: '${p.urlAfterRedirects}', state: ${p.state})`;case 10:return`RouteConfigLoadEnd(path: ${p.route.path})`;case 9:return`RouteConfigLoadStart(path: ${p.route.path})`;case 4:return`RoutesRecognized(id: ${p.id}, url: '${p.url}', urlAfterRedirects: '${p.urlAfterRedirects}', state: ${p.state})`;case 15:return`Scroll(anchor: '${p.anchor}', position: '${p.position?`${p.position[0]}, ${p.position[1]}`:null}')`}}(g)),console.log(g),console.groupEnd?.()})}}]:[],ns(1,p)}const Sc=new W.OlP(Ma?"router preloader":"");function hh(p){return ns(0,[{provide:Sc,useExisting:Eu},{provide:rl,useExisting:p}])}const fa=!1,Tu=new W.OlP(fa?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),$i=[Br.Ye,{provide:ie,useClass:H},$o,Lo,{provide:ts,useFactory:function sc(p){return p.routerState.root},deps:[$o]},kn,fa?{provide:Go,useValue:!0}:[]];function Mc(){return new W.PXZ("Router",$o)}let $l=(()=>{class p{constructor(g){}static forRoot(g,w){return{ngModule:p,providers:[$i,fa&&w?.enableTracing?Cc().\u0275providers:[],{provide:ln,multi:!0,useValue:g},{provide:Tu,useFactory:r,deps:[[$o,new W.FiY,new W.tp0]]},{provide:Ks,useValue:w||{}},w?.useHash?{provide:Br.S$,useClass:Br.Do}:{provide:Br.S$,useClass:Br.b0},{provide:ko,useFactory:()=>{const p=(0,W.f3M)(Br.EM),_=(0,W.f3M)(W.R0b),g=(0,W.f3M)(Ks),w=(0,W.f3M)(Bi),D=(0,W.f3M)(ie);return g.scrollOffset&&p.setOffset(g.scrollOffset),new Vc(D,w,p,_,g)}},w?.preloadingStrategy?hh(w.preloadingStrategy).\u0275providers:[],{provide:W.PXZ,multi:!0,useFactory:Mc},w?.initialNavigation?l(w):[],[{provide:m,useFactory:Ia},{provide:W.tb,multi:!0,useExisting:m}]]}}static forChild(g){return{ngModule:p,providers:[{provide:ln,multi:!0,useValue:g}]}}}return p.\u0275fac=function(g){return new(g||p)(W.LFG(Tu,8))},p.\u0275mod=W.oAB({type:p}),p.\u0275inj=W.cJS({imports:[Ws]}),p})();function r(p){if(fa&&p)throw new W.vHH(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function l(p){return["disabled"===p.initialNavigation?ns(3,[{provide:W.ip1,multi:!0,useFactory:()=>{const _=(0,W.f3M)($o);return()=>{_.setUpLocationChangeListener()}}},{provide:ac,useValue:2}]).\u0275providers:[],"enabledBlocking"===p.initialNavigation?ns(2,[{provide:ac,useValue:0},{provide:W.ip1,multi:!0,deps:[W.zs3],useFactory:_=>{const g=_.get(Br.V_,Promise.resolve());return()=>g.then(()=>new Promise(w=>{const D=_.get($o),A=_.get(Hc);(function As(p,_){p.events.pipe((0,Ft.h)(g=>g instanceof Ri||g instanceof is||g instanceof di||g instanceof hi),(0,Ne.U)(g=>g instanceof Ri||g instanceof hi?oo.COMPLETE:g instanceof is&&(0===g.code||1===g.code)?oo.REDIRECTING:oo.FAILED),(0,Ft.h)(g=>g!==oo.REDIRECTING),xt(1)).subscribe(()=>{_()})})(D,()=>{w(!0)}),_.get(Bi).afterPreactivation=()=>(w(!0),A.closed?(0,$e.of)(void 0):A),D.initialNavigation()}))}}]).\u0275providers:[]]}const m=new W.OlP(fa?"Router Initializer":"")},7582:(er,Ht,Ee)=>{"use strict";function $t(Ne,ot,xt,Pt){return new(xt||(xt=Promise))(function(kt,Mn){function Bn(Rn){try{En(Pt.next(Rn))}catch(Yn){Mn(Yn)}}function Ur(Rn){try{En(Pt.throw(Rn))}catch(Yn){Mn(Yn)}}function En(Rn){Rn.done?kt(Rn.value):function Ft(kt){return kt instanceof xt?kt:new xt(function(Mn){Mn(kt)})}(Rn.value).then(Bn,Ur)}En((Pt=Pt.apply(Ne,ot||[])).next())})}function rn(Ne){return this instanceof rn?(this.v=Ne,this):new rn(Ne)}function ht(Ne,ot,xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Ft,Pt=xt.apply(Ne,ot||[]),kt=[];return Ft={},Mn("next"),Mn("throw"),Mn("return"),Ft[Symbol.asyncIterator]=function(){return this},Ft;function Mn(Un){Pt[Un]&&(Ft[Un]=function(vr){return new Promise(function(tn,Kr){kt.push([Un,vr,tn,Kr])>1||Bn(Un,vr)})})}function Bn(Un,vr){try{!function Ur(Un){Un.value instanceof rn?Promise.resolve(Un.value.v).then(En,Rn):Yn(kt[0][2],Un)}(Pt[Un](vr))}catch(tn){Yn(kt[0][3],tn)}}function En(Un){Bn("next",Un)}function Rn(Un){Bn("throw",Un)}function Yn(Un,vr){Un(vr),kt.shift(),kt.length&&Bn(kt[0][0],kt[0][1])}}function ur(Ne){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var xt,ot=Ne[Symbol.asyncIterator];return ot?ot.call(Ne):(Ne=function cn(Ne){var ot="function"==typeof Symbol&&Symbol.iterator,xt=ot&&Ne[ot],Pt=0;if(xt)return xt.call(Ne);if(Ne&&"number"==typeof Ne.length)return{next:function(){return Ne&&Pt>=Ne.length&&(Ne=void 0),{value:Ne&&Ne[Pt++],done:!Ne}}};throw new TypeError(ot?"Object is not iterable.":"Symbol.iterator is not defined.")}(Ne),xt={},Pt("next"),Pt("throw"),Pt("return"),xt[Symbol.asyncIterator]=function(){return this},xt);function Pt(kt){xt[kt]=Ne[kt]&&function(Mn){return new Promise(function(Bn,Ur){!function Ft(kt,Mn,Bn,Ur){Promise.resolve(Ur).then(function(En){kt({value:En,done:Bn})},Mn)}(Bn,Ur,(Mn=Ne[kt](Mn)).done,Mn.value)})}}}Ee.d(Ht,{FC:()=>ht,KL:()=>ur,mG:()=>$t,qq:()=>rn})}},er=>{er(er.s=33)}]);